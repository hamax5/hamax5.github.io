<html class="wf-katexmath-i4-active wf-katexmain-n4-active wf-active"><head>
    <meta charset="utf-8">
    <title>Canvas Paint Tool</title>
    

<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!--   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/material-design-inspired-color-picker@1.7.2/dist/md-color-picker.min.js"></script>
<script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/FileSaver.min.js"></script>
<script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/palette_3c.js"></script>
<script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/algebrite/algebrite.bundle-for-browser.js"></script>

<link rel="stylesheet" href="https://ktky.sakura.ne.jp/lib/CindyJS/CindyJS.css">
<script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/CindyJS/Cindy.js"></script><script src="https://ktky.sakura.ne.jp/lib/CindyJS/katex/katex.min.js"></script><script src="https://ktky.sakura.ne.jp/lib/CindyJS/webfont.js"></script><script src="https://ktky.sakura.ne.jp/lib/CindyJS/katex-plugin.js"></script>

        <script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/palette/Markdown.Converter.js"></script>
        <script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/palette/Markdown.Sanitizer.js"></script>
        <script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/palette/Markdown.Editor.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_HTML-full"></script>
  
        <script type="text/javascript" src="https://ktky.sakura.ne.jp/lib/palette/MJPDEditing.js"></script>

        <script>
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
                tex2jax: { inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ], displayMath: [ ["$$","$$"], ["\\[", "\\]"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno" },
                TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
                messageStyle: "none"
            });
        </script>

<link rel="stylesheet" href="https://ktky.sakura.ne.jp/lib/CindyJS/katex/katex.min.css" media="all"></head>

<!--
<body style="transform: scale(1.2); transform: scale(2);">
<body style="transform: scale(1.625,1.625) translate(250px,0px);">
<body style="transform: scale(1.45,1.45) translate(150px,0px);">
-->
<body>

 <div id="scale_div" style="position: absolute; transform-origin: 0px 0px; transform: scale(1);">
<!--
<iframe id="test_iframe" src="file:///C:/data/EPS4/cresco_oekaki/sugaku1.png" target="_blank rel="noreferrer noopener" width="1000" height="1600"></iframe>
-->

<input type="button" value="flick" onclick="mode='flick'; Palette.load_url_width($('#url1')[0],'#test_iframe'); set_cood('#b0',46,831);">
<input type="button" value="keyboard" onclick="mode='keyboard'; Palette.load_url_width($('#url2')[0],'#test_iframe'); set_cood('#b0',78,612);">

<div id="top_display" style="display: flex;">

  <div id="iframe1">
<!--   <iframe id="test_iframe" src="kettaskorgvF1223.html" target="_blank rel=" noreferrer="" noopener"="" width="660" height="3000" style="pointer-events: auto;"></iframe> -->
    <iframe id="test_iframe" src="kettaskv001F0319a.html" target="_blank rel=" noreferrer="" noopener"="" width="670" height="2000" style="pointer-events: auto;"></iframe>
  </div>
  
<!--  <div id="test" height="3000" class="painton" style="top: 0px; left: 0; margin: auto; position: absolute; height: 3000px;  pointer-events: auto;"> -->
  <div id="test" class="painton" style="top: 0px; left: 0; margin: auto; position: absolute;  pointer-events: auto;">


<div id="b0" class="palette body top button" index="1" style="top: 831px; left: 46px; position: absolute;">
    <input type="button" undefined="" class="palette button target exe" style="position: absolute; width: 73px; height: 50.3333px; top: 0px; left: 0px;" value="Rec"><input type="button" class="palette body move button" value="i: b0" style="position: absolute; width: 50px; height: 50px; top: -50px; left: 0px;"><input type="button" class="palette body eraser button" value="x" style="position: absolute; width: 30px; height: 30px; top: -30px; left: 43px; padding: 0px; font-size: 11px;"><input type="button" class="palette body size button" value="s" style="position: absolute; width: 30px; height: 30px; top: 50.3333px; left: 43px; padding: 0px; font-size: 11px;"><input type="button" class="palette body edit button" value="e" style="position: absolute; width: 30px; height: 30px; top: 50.3333px; left: 0px; padding: 0px; font-size: 11px; background-color: rgb(240, 240, 240);"><textarea class="palette body texta button" rows="20" cols="80" value="" head="0" style="position: absolute; top: 0px; left: 73px; display: none;">copy_data();</textarea></div><div id="c1" class="palette body top cindy" index="1" style="top: 219px; left: 425px; position: absolute; display: block;">
    <div id="CSCanvas_1" class="CindyJS-widget palette body target cindy" style="position: relative; width: 203px; height: 159px;"><canvas width="406" height="318" style="position: absolute; border: none; top: 0px; left: 0px; padding: 0px; margin: 0px; height: 100%; width: 100%; background-color: rgb(168, 176, 192);"></canvas><div style="position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px"></div></div><div style="position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%"></div></div></div><input type="button" class="palette body move cindy" value="i: c1" style="position: absolute; width: 50px; height: 50px; top: -50px; left: 0px;"><input type="button" class="palette body eraser cindy" value="x" style="position: absolute; width: 30px; height: 30px; top: -30px; left: 173px; padding: 0px; font-size: 11px;"><input type="button" class="palette body size cindy" value="s" style="position: absolute; width: 30px; height: 30px; top: 159px; left: 173px; padding: 0px; font-size: 11px;"><input type="button" class="palette body edit cindy" value="e" style="position: absolute; width: 30px; height: 30px; top: 159px; left: 0px; padding: 0px; font-size: 11px;"><input type="button" class="palette body exe cindy" value="j" style="position: absolute; width: 30px; height: 30px; top: 0px; left: -30px; padding: 0px; font-size: 11px;"><textarea class="palette body texta cindy" rows="20" cols="80" value="" head="0" style="position: absolute; top: 0px; left: 203px; display: none;"></textarea></div><div id="b1" class="palette body top button" index="2" style="top: 306px; left: 323px; position: absolute;">
    <input type="button" undefined="" class="palette button target exe" style="position: absolute; width: 85px; height: 30px; top: 0px; left: 0px;" value="Plot"><input type="button" class="palette body move button" value="i: b1" style="position: absolute; width: 50px; height: 50px; top: -50px; left: 0px;"><input type="button" class="palette body eraser button" value="x" style="position: absolute; width: 30px; height: 30px; top: -30px; left: 55px; padding: 0px; font-size: 11px;"><input type="button" class="palette body size button" value="s" style="position: absolute; width: 30px; height: 30px; top: 30px; left: 55px; padding: 0px; font-size: 11px;"><input type="button" class="palette body edit button" value="e" style="position: absolute; width: 30px; height: 30px; top: 30px; left: 0px; padding: 0px; font-size: 11px; background-color: rgb(240, 240, 240);"><textarea class="palette body texta button" rows="20" cols="80" value="" head="0" style="position: absolute; top: 0px; left: 85px; display: none;">var fx = get_ketmath_input_raw();
var fx1 = fx.split("=")[1];
var fx2 = cseval('c1','Tocindyform("'+fx1+'")');
var com = "plot(x*x-3*x); plot("+fx2+")";
csdraw('c1',com);
</textarea></div><div id="f1" class="palette body top img" index="1" style="top: 230px; left: 101px; position: absolute; display: none;">
    <img src="data:image/png;base64,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" class="palette body target img" style="width: 194px; height: auto; position: absolute; top: 0px; left: 0px; border: solid;"><input type="button" class="palette body move img" value="i: f1" style="position: absolute; width: 50px; height: 50px; top: -50px; left: 0px;"><input type="button" class="palette body eraser img" value="x" style="position: absolute; width: 30px; height: 30px; top: -30px; left: 164px; padding: 0px; font-size: 11px;"><input type="button" class="palette body size img" value="s" style="position: absolute; width: 30px; height: 30px; top: 46px; left: 164px; padding: 0px; font-size: 11px;"><input type="button" class="palette body edit img" value="e" style="position: absolute; width: 30px; height: 30px; top: 46px; left: 0px; padding: 0px; font-size: 11px;"><input type="button" class="palette body exe img" value="j" style="position: absolute; width: 30px; height: 30px; top: 0px; left: -30px; padding: 0px; font-size: 11px;"><textarea class="palette body texta img" rows="20" cols="80" value="" head="0" style="position: absolute; top: 0px; left: 194px; display: none;"></textarea></div><div class="palette body top textarea" index="1" style="top: 125px; left: 126.867px; position: absolute;">
    <textarea class="palette textarea target" style="position: absolute; width: 120px; height: 50px; top: 0px; left: 0px;"></textarea><input type="button" class="palette body move textarea" value="" style="position: absolute; width: 50px; height: 50px; top: -50px; left: 0px;"><input type="button" class="palette body eraser textarea" value="x" style="position: absolute; width: 30px; height: 30px; top: -30px; left: 90px; padding: 0px; font-size: 11px;"><input type="button" class="palette body size textarea" value="s" style="position: absolute; width: 30px; height: 30px; top: 50px; left: 90px; padding: 0px; font-size: 11px;"><input type="button" class="palette body edit textarea" value="e" style="position: absolute; width: 30px; height: 30px; top: 50px; left: 0px; padding: 0px; font-size: 11px; background-color: rgb(240, 240, 240);"><input type="button" class="palette body exe textarea" value="j" style="position: absolute; width: 30px; height: 30px; top: 0px; left: -30px; padding: 0px; font-size: 11px;"><textarea class="palette body texta textarea" rows="20" cols="80" value="" head="0" style="position: absolute; top: 0px; left: 120px; display: none;">csdraw("c1",gettext());</textarea></div><div class="palette body top cindy" index="2" style="top: 55px; left: 400px; position: absolute; display: block;">
    <div id="CSCanvas_2" class="CindyJS-widget palette body target cindy" style="position: relative; width: 378px; height: 290px;"><canvas width="758" height="582" style="position: absolute; border: none; top: 0px; left: 0px; padding: 0px; margin: 0px; height: 100%; width: 100%; background-color: rgb(247, 247, 247);"></canvas><div style="position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px"></div></div><div style="position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%"></div></div></div><input type="button" class="palette body move cindy" value="" style="position: absolute; width: 50px; height: 50px; top: -50px; left: 0px;"><input type="button" class="palette body eraser cindy" value="x" style="position: absolute; width: 30px; height: 30px; top: -30px; left: 348px; padding: 0px; font-size: 11px;"><input type="button" class="palette body size cindy" value="s" style="position: absolute; width: 30px; height: 30px; top: 290px; left: 348px; padding: 0px; font-size: 11px;"><input type="button" class="palette body edit cindy" value="e" style="position: absolute; width: 30px; height: 30px; top: 290px; left: 0px; padding: 0px; font-size: 11px;"><input type="button" class="palette body exe cindy" value="j" style="position: absolute; width: 30px; height: 30px; top: 0px; left: -30px; padding: 0px; font-size: 11px"><textarea class="palette body texta cindy" rows="20" cols="80" value="" head="0" style="position: absolute; top: 0px; left: 378px; display: none;"></textarea></div><div class="palette body top cindy" index="3" style="top: 55px; left: 400px; position: absolute; display: block;">
    <div id="CSCanvas_3" class="CindyJS-widget palette body target cindy" style="position: relative; width: 677px; height: 485px;"><canvas width="1354" height="970" style="position: absolute; border: none; top: 0px; left: 0px; padding: 0px; margin: 0px; height: 100%; width: 100%; background-color: rgb(247, 247, 247);"></canvas><div style="position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px"></div></div><div style="position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%"></div></div></div><input type="button" class="palette body move cindy" value="" style="position: absolute; width: 50px; height: 50px; top: -50px; left: 0px;"><input type="button" class="palette body eraser cindy" value="x" style="position: absolute; width: 30px; height: 30px; top: -30px; left: 647px; padding: 0px; font-size: 11px;"><input type="button" class="palette body size cindy" value="s" style="position: absolute; width: 30px; height: 30px; top: 485px; left: 647px; padding: 0px; font-size: 11px;"><input type="button" class="palette body edit cindy" value="e" style="position: absolute; width: 30px; height: 30px; top: 485px; left: 0px; padding: 0px; font-size: 11px;"><input type="button" class="palette body exe cindy" value="j" style="position: absolute; width: 30px; height: 30px; top: 0px; left: -30px; padding: 0px; font-size: 11px"><textarea class="palette body texta cindy" rows="20" cols="80" value="" head="0" style="position: absolute; top: 0px; left: 677px; display: none;"></textarea></div></div>


<div>


<div class="menu" style="">

    <div>
      <input type="button" value="保存" onclick="Palette.save()">
    </div>
    <div>
       <input type="text" class="selector" size="3">
      <input type="button" value="button" onclick="Palette.gen_button('test',this.parentElement.querySelector('.selector').value)">
    </div>
    <div>
      <input type="text" class="selector" size="3">
      図:
      <input type="file" onchange="Palette.upload_image(this,'test',this.parentElement.querySelector('.selector').value)">
    </div>
    <div>
       <input type="text" class="selector" size="3">
      <input type="button" value="text" onclick="Palette.gen_text('test',this.parentElement.querySelector('.selector').value)">
    </div>

    <div>
       <input type="text" class="selector" size="3">
      <input type="button" value="text2" onclick="Palette.gen_text2('test',this.parentElement.querySelector('.selector').value)">
    </div>
    
    <div>
       <input type="text" class="selector" size="3">
      <input type="button" value="textarea" onclick="Palette.gen_textarea('test',this.parentElement.querySelector('.selector').value)">
    </div>
    <div>
       <input type="text" class="selector" size="3">
      <input type="button" value="markdown" onclick="Palette.gen_markdown('test',this.parentElement.querySelector('.selector').value)">
    </div>
    <div>
       <input type="text" class="selector" size="3">
      <input type="button" value="radio" onclick="Palette.gen_radio('test',this.parentElement.querySelector('.selector').value, this.parentElement.querySelector('.radiochoice').value)">
      <input type="text" class="radiochoice" size="3">
    </div>
    <div>
      <input type="text" class="selector" size="3">
      Cinderella:
       <input type="file" onchange="Palette.upload_cinderella(this,'test',this.parentElement.querySelector('.selector').value)">
    </div>
    <div>
       <input type="text" class="selector" size="3">
      <input type="button" value="compound" onclick="Palette.gen_compound('test',this.parentElement.querySelector('.selector').value, this.parentElement.querySelector('.elt').value)">
      <input type="text" class="elt" size="3">
    </div>
  </div>

</div>

</div>

    
<div>
      <input type="button" value="モード切り替え" onclick="Palette.mode_change(); set_mode_scale();">
</div>


<div class="system_area" style="">

<div class="paint_url" name="url1" style="">
URL1:
<input class="paint_url_data" type="text" size="50" value="kettaskv001F0319a.html">
<input class="paint_url_width" type="text" size="5" value="670">
 <!-- <input type="button" class="paint_url_click" value="ロード"> -->
 <!-- <input id="url1" type="button" onclick="Palette.load_url(this,'#test_iframe')" value="load"> -->
<input id="url1" type="button" onclick="Palette.load_url_width(this,'#test_iframe'); set_cood('#b0',46,831);" value="load">
    </div>

<div class="paint_url" name="url2" style="">
URL2:
<input class="paint_url_data" type="text" size="50" value="kettaskv0529-1.html">
<input class="paint_url_width" type="text" size="5" value="815">
<!-- <input type="button" class="paint_url_click" value="ロード"> -->
<!-- <input id="url2" type="button" onclick="Palette.load_url(this,'#test_iframe')" value="load">  -->
<input id="url2" type="button" onclick="Palette.load_url_width(this,'#test_iframe'); set_cood('#b0',78,612);" value="load">
</div>

<div class="show_hide" style="">
表示設定:
<input class="show_hide_data" id="show_hide_data_1" type="text" size="50" value="{ &quot;#c1&quot;:[2,3], &quot;#b1&quot;:[2,3], &quot;#f1&quot;:[2]}">
</div>

<div class="logname" style="">
log名:
<input class="logname_data" id="logname_data_1" type="text" size="50" value="kaiseki1">
</div>

<div>
<textarea id="log" style="width: 166px; height: 37px;"></textarea>
</div>

<div id="system_init" style="display:none;">
System init:<br>
<textarea id="system_init_textarea" cols="80" rows="10">
Palette_Cindy.cinderella_code[1]=`Palette_Cindy.cinderella_obj[1] = CindyJS({"scripts":"cs*","defaultAppearance":{"dimDependent":0.7,"fontFamily":"sans-serif","lineSize":1,"pointSize":5,"textsize":12},"angleUnit":"°","ports":[{"id":"CSCanvas_1","width":203,"height":159,"transform":[{"visibleRect":[-9.06,9.34,14.1,-4.14]}],"axes":true,"grid":1,"background":"rgb(168,176,192)"}],"csconsole":false,"cinderella":{"build":2071,"version":[3,0,2071]}});`;
eval(Palette_Cindy.cinderella_code[1]);
Palette_Cindy.cinderella_json[1]=`{"scripts":"cs*","defaultAppearance":{"dimDependent":0.7,"fontFamily":"sans-serif","lineSize":1,"pointSize":5,"textsize":12},"angleUnit":"°","ports":[{"id":"CSCanvas_1","width":203,"height":159,"transform":[{"visibleRect":[-9.06,9.34,14.1,-4.14]}],"axes":true,"grid":1,"background":"rgb(168,176,192)"}],"csconsole":false,"cinderella":{"build":2071,"version":[3,0,2071]}}`;
Palette_Cindy.cinderella_init[1]="csdraw() := (\n//Script (CindyScript)\nplot(x*x-3*x);\n);\n";
Palette_Cindy.cinderella_obj[1].evokeCS(Palette_Cindy.cinderella_init[1]);

Palette_Cindy.cinderella_code[2]=`Palette_Cindy.cinderella_obj[2] = CindyJS({"scripts":"cs*","use":["katex"],"defaultAppearance":{"dimDependent":0.7,"fontFamily":"sans-serif","lineSize":1,"pointSize":5,"textsize":12},"angleUnit":"°","geometry":[{"name":"Zz","type":"Free","pos":[4,1.978563556852648,0.3957127113705296],"color":[1,1,1],"labeled":false,"textsize":10,"size":2,"border":false},{"name":"NE","type":"Free","pos":[4,3.5376884422110364,0.7830327047117029],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"SW","type":"Free","pos":[4,3.2,-0.8],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"TH","type":"Free","pos":[-1.2030769487644923,-4,0.8888888888888888],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"FI","type":"Free","pos":[0.4997396556406349,-4,0.8],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"LB","type":"Free","pos":[4,3.6363636363636362,-0.7272727272727273],"color":[1,0,0],"size":0,"border":true}],"ports":[{"width":378,"height":290,"id":"CSCanvas_2","transform":[{"visibleRect":[-7.1707434963018235,6.962518639784892,12.090055731514326,-5.843310036006386]}],"grid":1,"snap":true,"background":"rgb(247,247,247)"}],"csconsole":false,"cinderella":{"build":2083,"version":[3,0,2083]}});`;
eval(Palette_Cindy.cinderella_code[2]);
Palette_Cindy.cinderella_json[2]=`{"scripts":"cs*","use":["katex"],"defaultAppearance":{"dimDependent":0.7,"fontFamily":"sans-serif","lineSize":1,"pointSize":5,"textsize":12},"angleUnit":"°","geometry":[{"name":"Zz","type":"Free","pos":[4,1.978563556852648,0.3957127113705296],"color":[1,1,1],"labeled":false,"textsize":10,"size":2,"border":false},{"name":"NE","type":"Free","pos":[4,3.5376884422110364,0.7830327047117029],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"SW","type":"Free","pos":[4,3.2,-0.8],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"TH","type":"Free","pos":[-1.2030769487644923,-4,0.8888888888888888],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"FI","type":"Free","pos":[0.4997396556406349,-4,0.8],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"LB","type":"Free","pos":[4,3.6363636363636362,-0.7272727272727273],"color":[1,0,0],"size":0,"border":true}],"ports":[{"width":378,"height":290,"id":"CSCanvas_2","transform":[{"visibleRect":[-7.1707434963018235,6.962518639784892,12.090055731514326,-5.843310036006386]}],"grid":1,"snap":true,"background":"rgb(247,247,247)"}],"csconsole":false,"cinderella":{"build":2083,"version":[3,0,2083]}}`;
Palette_Cindy.cinderella_init[2]="csinit() := (\nInvert(x):=reverse(x);\nKetinit():=Ketinit(\"fig\",0.3); //190831from\nKetinit(Arg):=(//181001from\n  if(isstring(Arg),\n    Ketinit(Arg,0.3);\n  ,\n    Ketinit(\"fig\",Arg);\n  );\n);\nKetinit(work,strictsep):=( //200509\n regional(pt,tmp,tmp1,tmp2,letterc,boxc,shadowc,mboxc);\n  PenThickInit=8;\n  ULEN=\"1cm\";\n  MEMORI=0.05;//18.01.15from\n  MEMORIInit=MEMORI;\n  MEMORINow=MEMORI;\n  MARKLEN=0.05;\n  MARKLENInit=MARKLEN; //180504\n  MARKLENNow= MARKLEN;\n  GENTEN=[0,0];//18.01.15to\n  TABLECOUNT=0; //190428\n  KETPICLAYER=20;\n  MilliIn=1/2.54*1000;\n  PenThick=round(MilliIn*0.02);\n  PenThickInit=PenThick;\n  TenSizeInit=0.02;\n  TenSize=TenSizeInit;\n  YaSize=1; YaAngle=18; YaPosition=1;\n  YaCut=0.2; //191203\n  YasenStyle=\"dr,1\"; Yajiristyle=\"tf\";\n  KETPICCOUNT=1;\n  KCOLOR=[0,0,0,1]; //200513,200618\n  GLIST=[]; //201005rechanged\n  GCLIST=[]; //201005rechanged\n  AddGraphList=[]; //210422[2lines]\n  PointDataList=[];\n  if(!islist(VLISTadd),VLIST=[],VLIST=VLISTadd); //200123\n  if(!islist(FUNLISTadd),FUNLIST=[],FUNLIST=FUNLISTadd); //200123\n  LETTERlist=[];\n  ADDAXES=\"1\";\n  AXSTYLE=[[\"l\",\"x\",\"e\",\"y\",\"n\",\"O\",\"sw\"],[],[]]; //230704\n  AXCOUNT=1; //181215\n  SHADECTR=1; //190222\n  LFmark=unicode(\"000a\"); Bs=unicode(\"005c\");\n  CRmark=unicode(\"000d\");//16.12.13\n  Dq=unicode(\"0022\");\n  Changework(Dircdy+pathsep()+work); //180329to,181001\n  ArrowlineNumber=1;  // 15.01.05\n  ArrowheadNumber=1;\n  BezierNumber=1; //15.01.03\n  SCALEX=1;\n  SCALEY=1;\n  XMIN=-5;\n  XMAX=5;\n  YMIN=-5;\n  YMAX=5;\n  StrictSep=strictsep; //190831\n  Setwindow(\"Msg=n\"); // 16.05.31\n  forall(remove(allpoints(),[SW,NE]),\n    Strictmove(#.name);\n    Ptpos(#,#.xy); //200529\n  ); //190917\n);\nSetwindow():=Setwindow(\"Msg=y\");\nSetwindow(str):=(\n  regional(tmp,tmp1,tmp2,msg);\n  msg=\"Y\";\n  tmp=indexof(str,\"=\"); // 16.02.10\n  msg=Toupper(substring(str,tmp,tmp+1));\n  Strictmove(\"SW\"); Strictmove(\"NE\");//190927\n  if((ispoint(SW)) &amp; (ispoint(NE)),\n    tmp1=LLcrd(Ptpos(SW));//190912[2lines]\n    tmp2=LLcrd(Ptpos(NE));\n    XMIN=tmp1_1; XMAX=tmp2_1;\n    YMIN=tmp1_2; YMAX=tmp2_2;\n  ,\n    if(!ispoint(SW), //191005from\n      Putpoint(\"SW\",Pcrd([-5,-5]));\n      XMIN=-5; YMIN=-5;\n      Ptpos(SW,SW.xy);\n    );\n    if(!ispoint(NE),\n      Putpoint(\"NE\", Pcrd([5,5]));\n      XMAX=5; YMAX=5;\n      Ptpos(NE,NE.xy);\n    ); //191005to\n  );\n);\nSetwindow(xrange,yrange):=Setwindow(xrange,yrange,\"Msg=y\");\nSetwindow(xrange,yrange,msg):=(\n  XMIN=xrange_1;\n  XMAX=xrange_2;\n  YMIN=yrange_1;\n  YMAX=yrange_2;\n  Ptpos(SW,Pcrd([XMIN,YMIN])); //190927from\n  Ptpos(NE,Pcrd([XMAX,YMAX]));\n  Strictmove(\"SW\"); Strictmove(\"NE\");\n);\nToupper(str):=(\n  regional(alphabet,out,tmp,tmp1);\n  alphabet=\"abcdefghijklmnopqrstuvwxyz\";\n  out=\"\";\n  forall(1..(length(str)),\n    tmp=substring(str,#-1,#);\n    tmp1=indexof(alphabet,tmp);\n    if(tmp1&gt;0,\n      out=out+unicode(text(tmp1+64),base-&gt;10);\n    ,\n      out=out+tmp;\n    );\n  );\n  out;\n);\nLLcrd(pt):=(\n  regional(tmp);\n  if(ispoint(pt),\n    tmp=pt.xy\n  ,\n    tmp=pt;\n  );\n  tmp=[tmp_1/SCALEX,tmp_2/SCALEY];\n  re(tmp); //191231\n);\nPutpoint(name,Pt):=Putpoint(name,Pt,Pt);\nPutpoint(name,Ptinit,Pt):=(\n  regional(ptstr); \n    ptstr=name+\".xy=\"+Textformat(Pcrd(Pt),10)+\";\";\n    parse(ptstr);\n    Ptpos(name,Pcrd([Pt_1,Pt_2])); //200529\n);\nTextformat(value,dig):=(\n  regional(vv,tmp,tmp1);\n  if(islist(value),\n    tmp1=\"[\";\n    forall(value,\n      tmp1=tmp1+Textformat(#,dig)+\",\";\n    );\n    if(length(tmp1)&gt;1, //18.01.29from\n      tmp1=substring(tmp1,0,length(tmp1)-1);\n    );\n    tmp1=tmp1+\"]\"; //18.01.29until\n  ,\n    if(ispoint(value) % isstring(value),\n      if(isstring(value),tmp1=Dq+value+Dq,tmp1=text(value)); // 15.10.02\n    ,\n      tmp1=format(value,dig);\n    );\n  );\n  tmp1;\n);\nPtpos(pt):=Ptpos(pt,[]);\nPtpos(ptorg,pos):=(\n  regional(pt,out,tmp);\n  if(ispoint(ptorg),pt=ptorg,pt=parse(ptorg));\n  if(length(pos)==0,\n    tmp=pt.name+\"position\";\n    out=parse(tmp);\n    if(!islist(out),\n      tmp=tmp+\"=\"+Textformat(pt.xy,12)+\";\";  //200108 6-&gt;12\n      parse(tmp);\n    );\n  ,\n    pt.xy=pos;\n    tmp=pt.name+\"position=\"+Textformat(pt.xy,12)+\";\"; //200108 6-&gt;12\n    parse(tmp);\n    out=pt.xy;\n  );\n  out;\n);\nPcrd(pt):=(\n  regional(tmp);\n  if(ispoint(pt),\n    tmp=pt.xy;\n  ,\n    tmp=[pt_1*SCALEX,pt_2*SCALEY];\n  );\n re(tmp); //191231\n);\nStrictmove(pC):=Strictmove(pC,StrictSep); //190831\nStrictmove(pCorg,sep):=(\n  regional(pC,tmp,tmp1,tmp2);\n  pC=pCorg;\n  if(ispoint(pC),pC=pC.name);\n  tmp1=pC+\"position\";\n  if(!islist(parse(tmp1)),\n    tmp=tmp1+\"=\"+Textformat(parse(pC).xy,12)+\";\"; //200112\n    parse(tmp);\n  ,\n   tmp=parse(pC).xy;\n    tmp2=mouse().xy;\n    if(|tmp-tmp2|&gt;sep,\n      tmp=pC+\".xy=\"+pC+\"position\";\n      parse(pC).xy=parse(pC+\"position\");\n    ,\n      tmp=tmp1+\"=\"+Textformat(parse(pC).xy,12)+\";\"; //200112\n      parse(tmp);\n    );\n  );\n);\nKetinit3d():=Ketinit3d(1);\nKetinit3d(subflg):=(\n  regional(ctr,tmp,tmp1,tmp2,tmp3,tmp4);\n SUBSCR=0; // \n  Setwindow(\"Msg=no\");\n  Addax(0);\n  TSIZE=10;\n  TSIZEZ=10;\n  ErrFlg=0;\n  xPos=-5; yTh=tmp-0.5; yPh=tmp-1;\n  THETA=(TH.x-xPos)*20*pi/180;\n  PHI=(FI.x-xPos)*40*pi/180; //190713to\n  Skeleton=1; //210324\n);\nAddax(param):=(\n  ADDAXES=text(param);\n);\nStart3d():=Start3d([],[]); \nStart3d(Arg):=( //190503from\n  regional(tmp);\n  tmp=select(Arg,isstring(#)); //190822\n  tmp=select(tmp,indexof(#,\"=\")&gt;0);\n  if(length(tmp)==0,\n    Start3d(Arg,[]);\n  ,\n    Start3d([],Arg);\n  );\n);\nStart3d(ptexception,optionjs):=(//190503to\n  regional(xPos,yTh,yPh,xmn,xMx,ymn,yMx,pt,pt3,pt2,theta,phi,\n    Eps,tmp,tmp1,tmp2,tmp3,tmp4);\n  PTEXCEPTION=[\"LB\"];\n  SLIDEFLG=\"Y\";\n  forall(optionjs,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"S\",\n      SLIDEFLG=Toupper(substring(tmp_2,0,1));\n    );\n    if(tmp1==\"R\",\n      tmp2=tmp_2;\n      if(substring(tmp2,0,1)==\"[\",tmp2=substring(tmp2,1,length(tmp2)-1));\n      tmp2=tokenize(tmp2,\",\");\n      REMOVEPTJS=concat(REMOVEPTJS,tmp2);\n    );\n  );\n  GCLIST=[];\n  SEG3dlist=[];\n  KETJSOP=[]; //190129\n  REMOVEPTJS=[]; SLIDEFLG=\"Y\"; //190504\n  KetcindyjsDataList=[]; //190511\n  ArrowlineNumber=1;  // 16.01.31\n  ArrowheadNumber=1;\n  BezierNumber=1; //16.01.31\n  BezierNumber3=1; //16.08.19\n  Setwindow(\"Msg=no\"); // 16.06.20from\n  tmp=round(4*SW.y)/4;\n  xPos=-5; yTh=tmp-0.5; yPh=tmp-1; //220126\n  Putpoint(\"LB\",[xPos-0.5,yPh]); //220215[2lines]\n  inspect(LB,\"ptsize\",0);\n  inspect(LB,\"labeled\",false);\n  if(SLIDEFLG==\"Y\", // \n    Slider(\"TH\",[xPos,yTh],[xPos+9,yTh],[\"Color=green\"]); //190209\n    Slider(\"FI\",[xPos,yPh],[xPos+9,yPh],[\"Color=green\"]); //190209\n    THETA=(TH.x-xPos)*20*pi/180;\n    PHI=(FI.x-xPos)*40*pi/180; // 16.06.20until\n    drawtext([xPos-0.8,yTh-0.1],Sprintf(THETA*180/pi,2),align-&gt;\"right\");\n    drawtext([xPos-0.8,yPh-0.1],Sprintf(PHI*180/pi,2),align-&gt;\"right\");  //220208to\n  ); // \n  if(Ptselected(TH) % Ptselected(FI), //190505\n    if(length(Ch)&gt;0,\n      ChNum=Ch_(length(Ch));\n      if(ChNum==0, ChNum=1);\n    ,\n      ChNum=1;\n    );\n    Ch=[0];\n  );\n  tmp=ptexception; //181106\n  if(!islist(tmp),tmp=[tmp]);  //190209\n  PTEXCEPTION=concat(PTEXCEPTION,tmp); //190209 \n  Ptseg3data(PTEXCEPTION);//16.08.23\n  FuncListC=[]; //220126[2lines]\n  SurfList=[];\n  LenAddSurf=0; //220202\n);\nStrsplit(strorg,key):=( // 210422 renewed\n  regional(str,ctr,tmp,tmp1,out);\n  str=strorg+key; \n  out=[];\n  tmp=indexof(str,key);\n  while(tmp&gt;0,\n    tmp1=substring(str,0,tmp-1);\n    out=append(out,tmp1);\n    str=substring(str,tmp-1+length(key),length(str));\n    tmp=indexof(str,key);\n  );\n  out;\n);\nSlider(ptstr,p1,p2):=Slider(ptstr,p1,p2,[]);\nSlider(ptstr,p1,p2,optionsorg):=(//220903\n  regional(pA,pB,pC,options,color,thick,sep,\n        tmp,tmp1,tmp2);\n  options=optionsorg;\n  color=\"Color=0.6*[0,0,1]\"; //190120from\n  thick=\"size-&gt;2\";\n  sep=0.3; //190824\n  forall(options,\n    tmp=Toupper(substring(#,0,1));\n    if(tmp==\"C\",\n      color=#;\n      options=remove(options,[tmp]);//220903\n    );\n    if(tmp==\"T\",\n      tmp=Strsplit(#,\"=\");\n      thick=\"size-&gt;\"+tmp_2;\n      options=remove(options,[tmp]);//220903\n    );\n    if(tmp==\"S\",//190824from\n      tmp=Strsplit(#,\"=\");\n      sep=parse(tmp_2);\n      options=remove(options,[tmp]);//220903\n    ); //190824to\n  );\n  tmp=Indexall(ptstr,\"-\");\n  if(length(tmp)&gt;0,\n    pA=substring(ptstr,0,tmp_1-1); //190824from\n    pC=substring(ptstr,tmp_1,tmp_2-1);\n    pB=substring(ptstr,tmp_2,length(ptstr));\n    parse(pA).xy=p1;\n    parse(pB).xy=p2; //190824to\n    tmp1=pC+\"position\"; //190827from\n    if(!islist(parse(tmp1)),\n      tmp2=parse(pC).xy;\n      if(|tmp2-p1|&lt;0.1,tmp2=p1+0.1*(p2-p1)/|p2-p1|);\n      if(|tmp2-p2|&lt;0.1,tmp2=p2+0.1*(p1-p2)/|p1-p2|);\n      tmp=tmp1+\"=\"+textformat(tmp2,10)+\";\";\n      parse(tmp);\n      parse(pC).xy=tmp2;\n    ); //190827to\n    PTEXCEPTION=concat(TEXCEPTION,[pA,pC,pB]);\n  ,\n    pC=ptstr; pA=pC+\"l\"; pB=pC+\"r\"; \n    PTEXCEPTION=concat(PTEXCEPTION,[pC]);\n  );\n  options=concat(options,[\"Msg=n\",color,thick]); //220903[2lines]\n  if(!contains(options,\"nodisp\"),options=append(options,\"notex\"));\n  Listplot(pA+pB,[p1,p2],options);\n  Putonseg(pC,parse(\"sg\"+pA+pB));\n);\nIndexall(str,key):=(\n  regional(rest,out,flg,tmp,tmp1,);\n  out=[];\n  rest=str;\n  flg=0;\n  forall(1..(length(str)),\n    if(flg==0,\n      tmp=indexof(rest,key);\n      if(tmp&gt;0,\n        tmp1=tmp+length(str)-length(rest);\n        out=append(out,tmp1);\n        rest=substring(rest,tmp,length(rest));\n      ,\n        flg=1;\n      );\n    );\n  );\n  out;\n);\nListplot(list):=Listplot(list,[]);\nListplot(Arg1,Arg2):=(\n  regional(name,list,options,str);\n  if(isstring(Arg1),\n    name=Arg1;\n    list=Arg2;\n    Listplot(name,list,[]);\n  ,\n    list=Arg1;\n    options=Arg2;\n    name=\"\";\n    forall(list, // 16.10.07from\n       name=name+#.name;\n    );// 16.10.07until\n    Listplot(name,list,options);\n  );\n);\nListplot(nm,list,options):=(\n  regional(name,cutend,tmp,tmp1,tmp2,ptlist,Ltype,opcindy,Noflg,eqL,Msg,color,color4);\n  if(substring(nm,0,1)==\"-\",  // 16.01.27 from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"sg\"+nm;\n  ); // upto\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opcindy=tmp_(length(tmp));\n  Msg=\"Y\";  //190206\n Msg=\"N\"; //\n  cutend=[0,0];//180719\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"M\",\n      Msg=Toupper(substring(tmp_2,0,1));\n    );\n    if(tmp1==\"C\",//180719from\n      tmp2=replace(tmp_2,\"[\",\"\");\n      tmp2=replace(tmp2,\"]\",\"\");\n      cutend=tokenize(tmp2,\",\");\n      if(length(cutend)==1,cutend=[cutend_1,cutend_1]);     \n    );//180719to\n  );\n  if(Noflg&lt;3,\n    if(Msg==\"Y\", //190206\n      println(\"generate Listplot \"+name);\n    );\n    if(isstring(list_1),tmp=apply(list,parse(#)),tmp=list); // 15.03.24\n    ptlist=apply(tmp,Pcrd(#));\n    if(|cutend|&gt;0,//180719from\n      tmp=ptlist_(length(ptlist))-ptlist_1;\n      tmp=tmp/|tmp|;\n      ptlist_1=ptlist_1+tmp*cutend_1;\n      ptlist_(length(ptlist))=ptlist_(length(ptlist))-tmp*cutend_2;\n    );//180719to\n    tmp=name+\"=\"+Textformat(ptlist,5)+\";\"; //190415\n    parse(tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  tmp1=apply(list,Lcrd(#));\n  tmp1;\n);\nDivoptions(options):=(\n  regional(Ltype,Noflg,Inflg,Outflg,eqL,realL,strL,\n      color,opstr,opcindy,flg,tmp,tmp1,tmp2);\n  Ltype=\"dr\";  // 2015.01.13\n  Noflg=0;\n  Inflg=0;\n  Outflg=0;\n  eqL=[];\n  realL=[];\n  strL=[];\n  color=Colorcmyk2rgb(KCOLOR); //200513\n  opstr=\"\";\n  opcindy=\"\";\n  forall(options,\n    flg=0;\n    if(flg==0,\n      if(isreal(#) % ispoint(#) % islist(#),\n        realL=append(realL,#);\n        opstr=opstr+\",\"+text(#);\n        flg=1;\n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"=\")&gt;0,\n        tmp=Strsplit(#,\"=\"); //180602from\n        tmp1=Toupper(tmp_1);\n        tmp2=tmp_2;\n        if(tmp1==\"COLOR\",\n          if(indexof(tmp2,\"[\")&gt;0, //180928\n            tmp1=parse(tmp2);\n            color=tmp1;\n            if(length(tmp1)==4,\n              tmp1=Colorcmyk2rgb(tmp1);\n            );\n          ,\n            color=Colorname2cmyk(tmp2);//200425\n            tmp1=Colorcmyk2rgb(color); ;//200425\n          );\n          tmp=\"color-&gt;\"+text(tmp1);\n          opcindy=opcindy+\",\"+tmp;\n        ,\n          eqL=append(eqL,#);\n        );//180602to\n        flg=1; \n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"no\")+indexof(#,\"No\")&gt;0,\n        if(indexof(#,\"tex\")&gt;0,Noflg=1);\n        if(indexof(#,\"disp\")&gt;0,Noflg=2);\n        if(indexof(#,\"data\")&gt;0,Noflg=3);\n        flg=1;\n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"-&gt;\")&gt;0,\n        opcindy=opcindy+\",\"+#;\n        flg=1; \n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"out\")+indexof(#,\"Out\")&gt;0,\n        if(indexof(#,\"-\")==0,\n          Outflg=1;\n        ,\n          Outflg=2;\n        );\n        flg=1;\n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"in\")+indexof(#,\"In\")&gt;0,\n        if(indexof(#,\"-\")==0,\n          Inflg=1;\n        ,\n          Inflg=2;\n        );\n        flg=1;\n      );\n    );\n    if(flg==0,\n      tmp=substring(#,0,2);\n      tmp1=indexof(tmp,\"dr\")+indexof(tmp,\"Dr\");\n      tmp1=tmp1+indexof(tmp,\"da\")+indexof(tmp,\"Da\");\n      tmp1=tmp1+indexof(tmp,\"id\")+indexof(tmp,\"Id\");\n      tmp1=tmp1+indexof(tmp,\"do\")+indexof(tmp,\"Do\");\n      tmp1=tmp1+indexof(tmp,\"dp\")+indexof(tmp,\"Dp\");\n      if(tmp1&gt;0,\n        Ltype=#;\n        flg=1;\n      );\n      if(flg==0,\n        if(length(#)&gt;0, //180408\n          strL=append(strL,#);\n          opstr=opstr+\",\"+Dq+#+Dq;\n        );\n      );\n    );\n  );\n  if(indexof(opcindy,\"color-&gt;\")==0,// 16.10.07from\n    tmp=Colorcmyk2rgb(KCOLOR); //200513[2lines]\n    opcindy=opcindy+\",color-&gt;\"+text(tmp);\n  );\n  [Ltype,Noflg,Inflg,Outflg,eqL,realL,strL,color,opstr,opcindy];\n);\nColorname2cmyk(name):=( //181212\n  regional(dL,code,tmp);\n  dL=[\n    [\"greenyellow\",[0.15,0,0.69,0]],[\"yellow\",[0,0,1,0]],\n    [\"goldenrod\",[0,0.1,0.84,0]],[\"dandelion\",[0,0.29,0.84,0]],\n    [\"apricot\",[0,0.32,0.52,0]],[\"peach\",[0,0.5,0.7,0]],\n    [\"melon\",[0,0.46,0.5,0]],[\"yelloworange\",[0,0.42,1,0]],\n    [\"orange\",[0,0.61,0.87,0]],[\"burntorange\",[0,0.51,1,0]],\n    [\"bittersweet\",[0,0.75,1,0.24]],[\"redorange\",[0,0.77,0.87,0]],\n    [\"mahogany\",[0,0.85,0.87,0.35]],[\"maroon\",[0,0.87,0.68,0.32]],\n    [\"brickred\",[0,0.89,0.94,0.28]],[\"red\",[0,1,1,0]],\n    [\"orangered\",[0,1,0.5,0]],[\"rubinered\",[0,1,0.13,0]],\n    [\"wildstrawberry\",[0,0.96,0.39,0]],[\"salmon\",[0,0.53,0.38,0]],\n    [\"carnationpink\",[0,0.63,0,0]],[\"magenta\",[0,1,0,0]],\n    [\"violetred\",[0,0.81,0,0]],[\"rhodamine\",[0,0.82,0,0]],\n    [\"mulberry\",[0.34,0.9,0,0.02]],[\"redviolet\",[0.07,0.9,0,0.34]],\n    [\"fuchsia\",[0.47,0.91,0,0.08]],[\"lavender\",[0,0.48,0,0]],\n    [\"thistle\",[0.12,0.59,0,0]],[\"orchid\",[0.32,0.64,0,0]],\n    [\"darkorchid\",[0.4,0.8,0.2,0]],[\"purple\",[0.45,0.86,0,0]],\n    [\"plum\",[0.5,1,0,0]],[\"violet\",[0.79,0.88,0,0]],\n    [\"royalpurple\",[0.75,0.9,0,0]],[\"blueviolet\",[0.86,0.91,0,0.04]],\n    [\"periwinkle\",[0.57,0.55,0,0]], [\"cadetblue\",[0.62,0.57,0.23,0]],\n    [\"cornflowerblue\",[0.65,0.13,0,0]],\n    [\"midnightblue\",[0.98,0.13,0,0.43]],\n    [\"navyblue\",[0.94,0.54,0,0]],[\"royalblue\",[1,0.5,0,0]],\n    [\"blue\",[1,1,0,0]],[\"cerulean\",[0.94,0.11,0,0]],\n    [\"cyan\",[1,0,0,0]],[\"processblue\",[0.96,0,0,0]],\n    [\"skyblue\",[0.62,0,0.12,0]],[\"turquoise\",[0.85,0,0.2,0]],\n    [\"tealblue\",[0.86,0,0.34,0.02]],[\"aquamarine\",[0.82,0,0.3,0]],\n    [\"bluegreen\",[0.85,0,0.33,0]],[\"emerald\",[1,0,0.5,0]],\n    [\"junglegreen\",[0.99,0,0.52,0]],[\"seagreen\",[0.69,0,0.5,0]],\n    [\"green\",[1,0,1,0]],[\"forestgreen\",[0.91,0,0.88,0.12]],\n    [\"pinegreen\",[0.92,0,0.59,0.25]],[\"limegreen\",[0.5,0,1,0]],\n    [\"yellowgreen\",[0.44,0,0.74,0]],[\"springgreen\",[0.26,0,0.76,0]],\n    [\"olivegreen\",[0.64,0,0.95,0.4]],[\"rawsienna\",[0,0.72,1,0.45]],\n    [\"sepia\",[0,0.83,1,0.7]],[\"brown\",[0,0.81,1,0.6]],\n    [\"tan\",[0.14,0.42,0.56,0]],[\"gray\",[0,0,0,0.5]],\n    [\"lightgray\",[0,0,0,0.15]], //190429,0809\n    [\"cindycolor\",[0.125,0.083,0,0.247]], //201027\n    [\"black\",[0,0,0,1]],[\"white\",[0,0,0,0]],\n    [\"offwhite\",[0,0,0,0.03]] //190809\n  ];\n  tmp=select(dL,#_1==name);\n  if(length(tmp)&gt;0,\n    tmp=tmp_1;\n    code=tmp_2;\n  ,\n    println(\"    \"+name+\" not found\");\n    code=Assign(name); //190323\n  );\n);\nAssign(str):=( //190125from\n  regional(tmp);\n  tmp=[];\n  forall(VLIST,tmp=concat(tmp,[#_1,#_2]));\n  Assign(str,tmp);\n); //190125to\nAssign(funstr,vrL):=Assign(funstr,vrL,6);\nAssign(funstr,Arg1,Arg2):=( //190813from\n  regional(vrL,precise,nn,out,tmp);\n  if(islist(Arg1),\n    vrL=Arg1; precise=Arg2;\n    nn=length(vrL)/2;\n    out=funstr;\n    forall(1..nn,\n      out=Assign(out,vrL_(2*#-1),vrL_(2*#),precise);\n    );\n  , \n    out=Assign(funstr,Arg1,Arg2,6);\n  );\n  out;\n); //190813to\nAssign(funstr,varname,rep,precision):=(\n  regional(repstr,ii,jj,tmp,tmp1,tmp2,Notvar,Flg);\n  if(isstring(rep),repstr=rep,repstr=\"(\"+Textformat(rep,precise)+\")\"); //190811to\n  tmp=[46];  // 12.20\n  tmp=concat(tmp,48..57);\n  tmp=concat(tmp,65..90);\n  tmp=concat(tmp,97..122);\n  Notvar=apply(tmp,unicode(text(#),base-&gt;10));\n  tmp2=\"\";\n  forall(1..100,\n    ii=indexof(funstr,varname);\n    if(ii&gt;0,\n      Flg=0;\n      if(ii&gt;1,\n        tmp=substring(funstr,ii-2,ii-1);\n        if(contains(Notvar,tmp),\n          tmp2=tmp2+substring(funstr,0,ii);\n          funstr=substring(funstr,ii,length(funstr));\n          Flg=1;\n        );\n      );\n      if(Flg==0,\n        jj=ii-1+length(varname);\n        if(jj&lt;length(funstr),\n          tmp=substring(funstr,jj,jj+1));\n          if(contains(Notvar,tmp),\n          tmp2=tmp2+substring(funstr,0,jj);\n          funstr=substring(funstr,jj,length(funstr));\n          Flg=1;\n        );\n      );\n      if(Flg==0,\n        tmp2=tmp2+substring(funstr,0,ii-1)+repstr;\n        funstr=substring(funstr,jj,length(funstr));\n      );\n    );\n  );\n  funstr=tmp2+funstr;\n  funstr;\n);\nColorcmyk2rgb(clr):=(\n  regional(clrnew,tmp,black);\n  if(length(clr)==4,  //200618\n    black=clr_4;\n    tmp=apply(clr,1-min(1,#*(1-black)+black));\n    clrnew=tmp_(1..3);\n  ,\n    clrnew=clr;  //200618\n  );\n  clrnew;\n);\nColorrgb2cmyk(clr):=(\n  regional(clrnew,tmp,black);\n  if(length(clr)==3, //200618\n    tmp=apply(clr,1-#);\n    black=min(tmp);\n    if(black!=1, //181112from\n      tmp=apply(clr,(1-#-black)/(1-black));\n      clrnew=append(tmp,black);\n    ,\n      clrnew=[0,0,0,1];  //200618\n    ); //181112to\n  ,\n    clrnew=clr;\n  );\n  clrnew;\n);\nGetlinestyle(str,name):=(\n  regional(noflg,tmp,tmp1,tmp2,Dop,Ltype,subflg);\n  Ltype=-1;\n  Dop=\"\";\n  tmp1=indexof(str,\",\");\n  if(tmp1&gt;0,\n    Dop=\",\"+substring(str,tmp1,length(str));\n  );\n  noflg=parse(substring(str,0,1));\n  if(substring(name,0,3)==\"sub\",subflg=1,subflg=0);  // 16.02.29\n  if(noflg&lt;=1, //1900818from\n    tmp1=Toupper(substring(str,1,3));\n  ,\n    tmp1=\"NO\";\n  ); //1900818to\n  tmp2=\"\"; //190119from\n  tmp=indexof(str,\",\");\n  if(tmp&gt;0,\n    tmp2=substring(str,tmp,length(str));\n  ); //190119to\n  if(tmp1==\"DR\",\n    if(length(tmp2)==0,tmp2=\"1\"); //190125\n    Ltype=[0,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"DA\",\n    if(length(tmp2)==0,tmp2=\"1,1\"); //190125\n    if(indexof(tmp2,\",\")==0,tmp2=tmp2+\",1\"); //200911\n    Ltype=[1,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"ID\",\n    if(length(tmp2)==0,tmp2=\"1,1\"); //190125\n    if(indexof(tmp2,\",\")==0,tmp2=tmp2+\",1\"); //200911\n    Ltype=[2,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"DO\",\n    if(length(tmp2)==0,tmp2=\"1,1\"); //190125\n    if(indexof(tmp2,\",\")==0,tmp2=tmp2+\",1\"); //200911\n    Ltype=[3,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"DP\",\n    if(length(tmp2)==0,tmp2=\"1\"); //190125\n    Ltype=[0,tmp2];  //190119\n    tmp1=parse(name);\n    tmp2=\"\";\n    forall(tmp1,\n      tmp2=tmp2+Textformat(#_1,5)+\",\";\n    );\n    tmp2=substring(tmp2,0,length(tmp2)-1);\n    if(noflg==0,\n    );\n  );\n  if(tmp1==\"NO\", //190818from\n    Ltype=[-1,\"0\"];\n  );  //190818to\n  Ltype;\n);\nLcrd(pt):=(\n  regional(tmp);\n  if(ispoint(pt),\n    tmp=[pt.x/SCALEX,pt.y/SCALEY];\n  ,\n    tmp=pt;\n  );\n  re(tmp); //191231\n);\nPutonseg(name,sgstr):=(\n  regional(seg,p1,p2);\n  if(isstring(sgstr),seg=parse(sgstr),seg=sgstr);\n  Putonseg(name,LLcrd(seg_1),LLcrd(seg_2));\n);\nPutonseg(name,p1,p2):=Putonseg(name,p1,p2,[]);\nPutonseg(name,p1org,p2org,options):=(\n  regional(Eps,par,p1,p2,dx,dy,p,tmp,tmp1,tmp2);\n  Eps=10^(-5);\n  par=0.5;\n  tmp=Divoptions(options);\n  if(length(tmp_6)&gt;0,\n    par=tmp_6_1;\n  );\n  p1=Lcrd(p1org);//16.10.11from\n  p2=Lcrd(p2org);\n  p1=Pcrd(p1); p2=Pcrd(p2); //190120\n  dx=p2_1-p1_1;\n  dy=p2_2-p1_2;\n  p=parse(name+\".xy\");\n  if(abs(dx)&gt;abs(dy), //190120from\n    if(p1_1&gt;p2_1,tmp=p1;p1=p2;p2=tmp);\n    if(p_1&lt;p1_1,parse(name+\".xy=\"+Textformat(p1,10));p=p1);\n    if(p_1&gt;p2_1,parse(name+\".xy=\"+Textformat(p2,10));p=p2);\n    tmp=(p2_2-p1_2)/(p2_1-p1_1)*(p_1-p1_1)+p1_2;\n    parse(name+\".y=\"+tmp+\";\"); //190415\n  ,\n    if(p1_2&gt;p2_2,tmp=p1;p1=p2;p2=tmp);\n    if(p_2&lt;p1_2,parse(name+\".xy=\"+Textformat(p1,10));p=p1);\n    if(p_2&gt;p2_2,parse(name+\".xy=\"+Textformat(p2,10));p=p2);\n    tmp=(p2_1-p1_1)/(p2_2-p1_2)*(p_2-p1_2)+p1_1;\n    parse(name+\".x=\"+tmp+\";\"); //190415\n  ); //190120to\n);\nSprintf(value,dig):=(\n  regional(vv,tmp,tmp1);\n  if(!islist(value),  // 17.03.12from\n    if(isstring(value),\n      vv=value;\n    ,\n      vv=Textformat(value,dig);\n    );  // 17.03.12from\n    if(indexof(vv,\".\")==0,vv=vv+\".\");\n    vv=vv+\"0000000000000000\";\n    tmp=indexof(vv,\".\")+dig;\n    vv=substring(vv,0,tmp);\n  ,\n    vv=apply(value,Sprintf(#,dig));\n  );\n  vv;\n);\nPtselected():=Ptselected(allpoints()); //190805\nPtselected(ptlistorg):=(\n regional(ptlist,flg,Eps);\n Eps=StrictSep;//(XMAX-XMIN)/10; //190505,221003\n flg=0;\n ptlist=ptlistorg; //190505[2lines]\n if(!islist(ptlist),ptlist=[ptlist]);\n forall(ptlist,\n  if(flg==0,\n    if(|mouse().xy-#.xy|&lt;Eps,flg=1); // \n  );\n );\n if(flg==0,false,true);\n);\nPtseg3data():=Ptseg3data([]);\nPtseg3data(options):=(\n  regional(pt,ptz,pt3,plist,plistz,tmp,tmp1,tmp2);\n  tmp=remove(allpoints(),options);\n  tmp=remove(tmp,[SW,NE,TH,FI]);\n  plist=select(tmp,indexof(#.name,\"z\")==0);\n  plistz=select(tmp,indexof(#.name,\"z\")&gt;0);\n  if(Ptselected(TH) % Ptselected(FI),\n    forall(plist,pt,\n      tmp=select(plistz,#.name==pt.name+\"z\");\n      if(length(tmp)&gt;0,\n        ptz=tmp_1;\n      ,\n        ptz=[];\n      );\n      tmp=select(VLIST,#_1==pt.name+\"3d\"); //190506\n      if(length(tmp)&gt;0,\n        pt3=tmp_1_2;\n        pt.xy=Parapt(pt3);\n        ptz.xy=Parasubpt(pt3);\n      ,\n        pt3=Mainsubpt3d(pt.xy,ptz.xy); //181107[2lines]\n        Defvar(pt+\"3d\",pt3);\n      );\n    );\n  ,\n    Mkpointlist(options); // 16.12.18\n  );\n);\nParapt(pt):=(\n  regional(Xz,Yz);\n  Xz=-pt_1*sin(PHI)+pt_2*cos(PHI);\n  Yz=-pt_1*cos(PHI)*cos(THETA)-pt_2*sin(PHI)*cos(THETA)+pt_3*sin(THETA);\n  [Xz,Yz];\n);\nParasubpt(pt):=( //181027\n  regional(mv,dp,xs);\n  mv=NE.x-SW.x;\n  dp=pi/24;\n  xs=-pt_1*sin(PHI+dp)+pt_2*cos(PHI+dp);\n  [xs+mv,pt_3];\n);\nMainsubpt3d(pm,psv):=( //181027\n  regional(Eps,mv,dp,v,x,y,z);\n  Eps=10^(-4);\n  mv=NE.x-SW.x;\n  dp=pi/24;\n  if(abs(cos(THETA))&gt;Eps,\n    if(length(psv)&gt;1,v=psv_2, v=psv);\n    x=(v*cos(PHI)*sin(THETA)-pm_1*sin(PHI)*cos(THETA)-pm_2*cos(PHI))/cos(THETA);\n    y=(v*sin(PHI)*sin(THETA)+pm_1*cos(PHI)*cos(THETA)-pm_2*sin(PHI))/cos(THETA);\n    z=v;\n  ,\n    if(length(psv)&gt;1,v=psv_1, v=psv);\n    x=(pm_1*cos(PHI+dp)-(v-mv)*cos(PHI))/sin(dp);\n\ty=(pm_1*sin(PHI+dp)-(v-mv)*sin(PHI))/sin(dp);\n    z=pm_2;\n  );\n  [x,y,z];\n);\nDefvar(varstr):=(\n  regional(name,value,tmp,tmp1);\n  if(isstring(varstr),\n    parse(varstr+\";\");\n    tmp=indexof(varstr,\"=\");\n    name=substring(varstr,0,tmp-1);\n    value=substring(varstr,tmp,length(varstr));\n    value=parse(value);\n    tmp1=select(1..length(VLIST),VLIST_#_1==name);\n    if(length(tmp1)&gt;0,\n      tmp=tmp1_1;\n      VLIST_tmp=[name,value];\n    ,\n      VLIST=prepend([name,value],VLIST);\n    );\n  ,\n    forall(1..(length(varstr)/2), // 16.11.16from\n      name=varstr_(2*#-1);\n      value=varstr_(2*#);\n      Defvar(name,value);\n    ); // 16.11.16until\n  );\n);\nDefvar(name,value):=(\n  regional(tmp,tmp1);\n  if(islist(value),\n    tmp1=\"[\";\n    forall(value,\n      if(isstring(#), // 16.11.14\n        tmp1=tmp1+Dq+#+Dq+\",\"; // 16.11.14\n      ,\n        tmp1=tmp1+format(#,16)+\",\"; //190918\n      );\n    );\n    tmp1=substring(tmp1,0,length(tmp1)-1)+\"]\";\n  ,\n    tmp1=format(value,10);\n  );\n  tmp=name+\"=\"+tmp1+\";\"; // 15.02.06//190415\n  parse(tmp);\n  VLIST=select(VLIST,#_1!=name); // 15.02.08\n  VLIST=prepend([name,value],VLIST);\n);\nMkpointlist():=Mkpointlist([]); //16.11.12\nMkpointlist(options):=( //181030\n  regional(Eps,dp,mv,pos,worklist,plist,pt,ptstr,pt3,ptz,par,\n     tmp,tmp1,tmp2,tmp3,tmp4,p1,p2,flg);\n  dp=pi/24;\n  mv=NE.x-SW.x;\n  Eps=10^(-4);\n  pos=[NE.x+1,NE.y+0.1];\n  worklist=Workprocess(); //181030\n  plist=select(worklist,length(#_3)!=2);\n  plist=apply(plist,#_1);\n  plist=remove(plist,PTEXCEPTION);\n  tmp=apply(VLIST,#_1);//181029from\n  tmp=select(tmp,indexof(#,\"3d\")&gt;0);\n  tmp2=apply(tmp,replace(#,\"3d\",\"\"));\n  forall(tmp2,ptstr,\n    if(!contains(plist,ptstr),\n      tmp=select(VLIST,\n            (#_1==pt+\"3d\")%(#_1==pt+\"2d\")%(#_1==pt+\"fix\"));\n      VLIST=remove(VLIST,tmp);\n    );\n  ); //181029to\n  if(SUBSCR==0,plist=[]);\n  forall(plist,ptstr,\n    pt=parse(ptstr);\n    inspect(pt,\"ptsize\",3);\n    inspect(pt,\"color\",2);\n    inspect(pt,\"textsize\",TSIZE);\n    ptz=pt.name+\"z\";  //190505\n    tmp=Finddef(pt);\n    tmp=select(VLIST,#_1==pt.name+\"3d\"); //190505\n    if(length(tmp)==0,\n      tmp=parse(ptz); //181108from\n      if(ispoint(tmp),\n        pt3=Mainsubpt3d(pt.xy,tmp.xy); //181108to\n      ,\n        if(abs(cos(THETA))&gt;Eps,//181028from\n          tmp1=Mainsubpt3d(pt.xy,0); \n          tmp=Parasubpt(tmp1);\n          Putpoint(ptz,tmp,[tmp_1,parse(ptz+\".y\")]);\n          pt3=Mainsubpt3d(pt.xy,parse(ptz+\".xy\"));\n        ,\n          if(abs(sin(PHI))&gt;abs(cos(PHI)), //181029from\n            tmp=Parasubpt([-pt.x/sin(PHI),0,pt.y]);\n          ,\n            tmp=Parasubpt([0,pt.x/cos(PHI),pt.y]);\n          );\n          Putpoint(ptz,tmp,[parse(ptz+\".x\"),pt.y]);//181029\n          pt3=Mainsubpt3d(pt.xy,parse(ptz+\".xy\"));\n        );\n      ); //181028to\n      Defvar(pt.name+\"3d\",pt3); //190505\n      Defvar(pt.name+\"fix\",0); //190505\n    );\n    flg=0;\n    if(isstring(ptz),ptz=parse(ptz));//181029from\n    inspect(ptz,\"ptsize\",3);\n    inspect(ptz,\"color\",3);\n    inspect(ptz,\"textsize\",TSIZEZ);//181029to\n    if(Ptselected(pt),\n      if(parse(pt.name+\"fix\")!=1, //190505\n        tmp=select(VLIST,#_1==pt.name+\"3d\"); //190505\n        tmp1=tmp_1_2;\n        pt3=Mainsubpt3d(pt.xy,ptz.xy); //181029\n        Putpoint(ptz.name,Parasubpt(pt3));\n        if(Norm(tmp1-pt3)&gt;Eps,\n           Defvar(pt.name+\"3d\",pt3); //190505\n        );\n        flg=1;\n      );\n    );\n    if(Ptselected(ptz),//181108from\n      tmp=select(VLIST,#_1==pt.name+\"3d\");  //190505\n      tmp1=tmp_1_2;\n      tmp=Parasubpt(tmp1); //181108from\n      if(abs(cos(THETA))&gt;Eps,\n        tmp=ptz.name+\".x=\"+format(tmp_1,10)+\";\"; //210112\n        parse(tmp);\n        tmp=Parapt([tmp1_1,tmp1_2,ptz.y]);\n        Putpoint(pt.name,tmp); //190505\n     ,\n        tmp=ptz.name+\".y=\"+format(tmp_2,10)+\";\";  //190505\n        parse(tmp);\n        if(abs(sin(PHI+dp))&gt;abs(cos(PHI+dp)), //181108\n          tmp=-(ptz.x-mv-tmp1_2*cos(PHI+dp))/sin(PHI+dp);\n          tmp=Parapt([tmp,tmp1_2,tmp1_3]);\n        ,\n          tmp=(ptz.x-mv+tmp1_1*sin(PHI+dp))/cos(PHI+dp); //181109pm\n          tmp=Parapt([tmp1_1,tmp,tmp1_3]);\n        );\n        Putpoint(pt.name,tmp); //190505\n      );\n      pt3=Mainsubpt3d(pt.xy,ptz.xy); \n      Defvar(pt.name+\"3d\",pt3); //190505\n      flg=2;\n    );\n    if(Ptselected(TH) % Ptselected(FI), //181029\n      tmp=select(VLIST,#_1==pt.name+\"3d\"); //190505\n      if(length(tmp)&gt;0, //17.10.07\n        tmp1=Parapt(tmp_1_2);\n        Putpoint(pt.name,tmp1);  //190505\n        tmp2=Parasubpt(tmp_1_2);//181027[2lines]\n        Putpoint(ptz.name,tmp2);  //190505\n        flg=3;\n      ); //17.10.07\n    );\n    if(flg==0, //181030from\n      pt3=Mainsubpt3d(pt.xy,ptz.xy);\n      Defvar(pt.name+\"3d\",pt3); //190505\n    ); //181030to\n    if(Ptselected(pt) % Ptselected(ptz),\n    );\n    if(!contains([\"p\",\"q\"],pt.name), //190505\n      ptL=append(ptL,pt);\n    );\n  );\n);\nWorkprocess():=Drawprocess(300,[\"Disp=n\"]); //181030\nWorkprocess(nn):=(\n  Drawprocess(nn,[\"Disp=n\"]); \n);\nDrawprocess():=Drawprocess(300,[\"Disp=y\"]);\nDrawprocess(nn):=Drawprocess(nn,[\"Disp=y\"]);\nDrawprocess(nn,options):=(\n  regional(All,added,remain,out,flg,dispflg,eqL,tmp,tmp1,tmp2);\n  tmp=Divoptions(options); //181030from\n  eqL=tmp_5;\n  dispflg=\"Y\";\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    tmp2=Toupper(substring(tmp_2,0,1));\n    if(tmp1==\"D\",dispflg=tmp2);\n  ); //181030to\n  tmp=remove(allpoints(),[NE,SW,TH,FI]);\n  tmp1=select(tmp,\n    substring(#.name,length(#.name)-1,length(#.name))!=\"z\"); //190505\n  tmp1=concat(tmp1,alllines());\n  All=apply(tmp1,Dependgeo(#));\n  added=select(All,length(#_3)==0);\n  out=sort(apply(added,#_1));\n  remain=remove(All,added);\n  flg=0;\n  repeat(nn,\n    if(flg==0,\n      tmp1=select(remain,remove(#_3,out)==[]);\n      tmp2=sort(apply(tmp1,#_1));\n      out=concat(out,tmp2);\n      remain=remove(remain,tmp1);\n      if(length(remain)==0,flg=1);\n    );\n  );\n  if(dispflg==\"Y\",\n    println(\"Process of drawing\");\n  );\n  tmp1=[];//181030from\n  forall(out,\n    tmp=Dependgeo(parse(#));\n    tmp1=append(tmp1,tmp);\n    if(dispflg==\"Y\",\n      println(Dependgeo(parse(#)));\n    );\n  );\n  tmp1;//181030to\n);\nDependgeo(geo):=(\n  regional(tmp,tmp1,tmp2,out);\n  tmp=Finddef(geo);\n  if(!iscircle(geo),\n    out=[geo.name]; //190505\n  ,\n    out=[geo];\n  );\n  if(length(tmp)&lt;3,\n    out=concat(out,[tmp_1,[]]);\n  ,\n    out=concat(out,[tmp_1]);\n    tmp1=[tmp_2,tmp_3];\n    tmp=parse(tmp1_2);\n    if(islist(tmp) % isreal(tmp),\n      tmp1=[tmp1_1];\n    );\n    out=append(out,tmp1);\n  );\n  out;\n);\nFinddef(G):=(\n  regional(def,tmp,tmp1,tmp2,tmp3);\n  if(isstring(G),tmp=parse(G),tmp=G);\n  def=text(inspect(tmp,\"definition\"));\n  tmp1=indexof(def,\"(\");\n  tmp2=indexof(def,\";\");\n  tmp3=indexof(def,\")\");\n  tmp=[substring(def,0,tmp1-1)];\n  if(tmp2&gt;0,\n    tmp=append(tmp,substring(def,tmp1,tmp2-1));\n    if(indexof(def,\")\",tmp3+1)==0,\n      tmp=append(tmp,substring(def,tmp2,tmp3-1));\n    ,\n      tmp=append(tmp,substring(def,tmp2,tmp3));\n    );\n  ,\n    tmp=append(tmp,substring(def,tmp1-1,tmp3));\n  );\n  tmp;\n);\nNorm(v1):=(  // 16.09.01\n  regional(out,tmp,tmp1,tmp2);\n  out=0;\n  forall(1..(length(v1)),\n    out=out+(v1_#)^2;\n  );\n  out=sqrt(out);\n  out;\n);\nNorm(v1,v2):=(\n  Norm(v2-v1);\n);\nXyzax3data(nm,Xrange,Yrange,Zrange):=\n          Xyzax3data(nm,Xrange,Yrange,Zrange,[]);\nXyzax3data(nm,Xrange,Yrange,Zrange,optionorg):=(\n  regional(name2,name3,Out,tmp,tmp1,tmp2,ops,eqL,reL,strL,msgflg,\n    options,opstr,opcindy,Ltype,Noflg,Axname,Arrow,Origin,color,color4);\n  name2=\"ax2d\"+nm;\n  name3=\"ax3d\"+nm;\n  options=optionorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  reL=tmp_6;\n  strL=tmp_7;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  Axname=1;\n  Arrow=[];  // 190505\n  Origin=\"\"; // 16.08.14\n  if(length(reL)&gt;0,\n    Axname=reL_1;\n  );\n  forall(strL,  // 16.08.14from\n    tmp1=Toupper(substring(#,0,1));\n    if(tmp1==\"A\",\n      tmp=substring(#,1,length(#));\n      if(length(tmp)&gt;0,\n        Arrow=tokenize(tmp,\",\"); //190505\n        if(length(Arrow)==1,Arrow=append(Arrow,18));\n      );\n    );\n    if(tmp1==\"O\",\n      tmp=indexof(#,\",\");\n      if(tmp&gt;0,\n        Origin=substring(#,tmp,length(#));\n      ,\n        tmp=substring(#,1,length(#));\n        if(length(tmp)&gt;0,\n          Origin=tmp;\n        ,\n          Origin=\"sw\";\n        );\n      );\n    );\n  ); // 16.08.14to\n  options=remove(options,reL);\n  options=remove(options,strL);\n  msgflg=\"Y\";  //190506from\nmsgflg=\"N\";  //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"M\",\n      msgflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n  ); //190506to\n  tmp1=indexof(Xrange,\"=\");\n  tmp=parse(substring(Xrange,tmp1,length(Xrange)));\n  Px=[tmp_1,0,0]; Qx=[tmp_2,0,0];\n  tmp1=indexof(Yrange,\"=\");\n  tmp=parse(substring(Yrange,tmp1,length(Yrange)));\n  Py=[0,tmp_1,0]; Qy=[0,tmp_2,0];\n  tmp1=indexof(Zrange,\"=\");\n  tmp=parse(substring(Zrange,tmp1,length(Zrange)));\n  Pz=[0,0,tmp_1]; Qz=[0,0,tmp_2];\n  tmp=[\"nodisp\",\"Msg=n\"];\n  Spaceline(\"-axx3d\"+nm,[Px,Qx],tmp);\n  Spaceline(\"-axy3d\"+nm,[Py,Qy],tmp);\n  Spaceline(\"-axz3d\"+nm,[Pz,Qz],tmp);\n  Out=[[Px,Qx],[Py,Qy],[Pz,Qz]];\n  if(Axname&gt;0,\n    Xyzaxparaname(Xrange,Yrange,Zrange,[Axname]);\n  );\n  if(Noflg&lt;3,\n    if(msgflg==\"Y\",\n      tmp=\"generate axes \"+name3;\n      tmp=tmp+\" : axx3d\"+nm+\",axy3d\"+nm+\",axz3d\"+nm;\n      println(tmp);\n    );\n    tmp=\"[\"+\"axx3d\"+nm+\",\"+\"axy3d\"+nm+\",\";\n    tmp=tmp+\"axz3d\"+nm+\"]\";\n    tmp=name3+\"=\"+tmp;\n    parse(tmp);\n    tmp1=Projpara([name3],[\"nodata\"]);\n    tmp=name2+\"=\"+textformat(tmp1,10)+\";\"; //190415\n    parse(tmp);\n    tmp=name3+\"=Xyzax3data(\"+\n\t  Dq+Xrange+Dq+\",\"+Dq+Yrange+Dq+\",\"+Dq+Zrange+Dq+\")\";\n    GLIST=append(GLIST,tmp);\n    tmp=name2+\"=Projpara(\"+name3+\")\";\n    GLIST=append(GLIST,tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      if(color4!=KCOLOR, //180904\n        Texcom(\"{\");Com2nd(\"Setcolor(\"+color4+\")\");//180722\n      );\n\t  Ltype=Getlinestyle(text(Noflg)+Ltype,name2);\n      if(color4!=KCOLOR, //180904\n        Texcom(\"}\");//180722\n      );\n\t,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name2,Ltype,opcindy]);\n    if(Noflg&lt;1,  // 16.08.14from\n      if(length(Arrow)==2, //190505from\n        tmp1=Parapt(Px); tmp2=Parapt(Qx);\n        ops=[Arrow_1,Arrow_2,\"Line=n\"];\n        Arrowhead(\"ax1\",tmp2,tmp2-tmp1,ops); //210521\n        tmp1=Parapt(Py); tmp2=Parapt(Qy);\n        Arrowhead(\"ax2\",tmp2,tmp2-tmp1,ops); //210521\n        tmp1=Parapt(Pz); tmp2=Parapt(Qz);\n        Arrowhead(\"ax3\",tmp2,tmp2-tmp1,ops); //210521\n      ); //190505to\n      if(length(Origin)&gt;0,\n        Letter([Parapt([0,0,0]),Origin,\"O\"]);\n      );\n    );  // 16.08.14until\n    if(SUBSCR==1, //  15.02.11\n      Subgraph(name3,opcindy); //181029\n    );\n  );\n  Out;\n);\nSpaceline(ptlist):=Spaceline(ptlist,[]); // 16.02.22 from\nSpaceline(Arg1,Arg2):=(\n  regional(name,tmp,tmp1,tmp2);\n  if(isstring(Arg1),\n    Spaceline(Arg1,Arg2,[]);\n  ,\n    tmp=Arg1.name; //190505\n    tmp=substring(tmp,1,length(tmp)-1);\n    name=\"-\"+replace(tmp,\",\",\"\");\n    Spaceline(name,Arg1,Arg2);\n  );\n); // 16.02.22 to\nSpaceline(nm,ptlistorg,optionorg):=(\n  regional(name2,name3,options,Out,tmp,tmp1,tmp2,\n        opstr,opcindy,Ltype,Noflg,eqL,ptlist, Msg,color,color4);\n  ptlist=apply(ptlistorg,if(ispoint(#),parse(#.name+\"3d\"),#)); // 190505\n  ptlist=apply(ptlist,if(isstring(#),parse(#),#)); //190330\n  if(substring(nm,0,2)==\"bz\",\n    name2=replace(nm,\"bz\",\"bz2d\");\n    name3=replace(nm,\"bz\",\"bz3d\");\n  ,\n    if(substring(nm,0,1)==\"-\",\n      tmp=substring(nm,1,length(nm));\n      if(indexof(tmp,\"3d\")&gt;0,name3=tmp,name3=tmp+\"3d\");\n      name2=replace(name3,\"3d\",\"2d\");\n    ,\n      name2=\"sl2d\"+nm;\n      name3=\"sl3d\"+nm;\n    );\n  );\n  options=select(optionorg,length(#)&gt;0);  // 160415\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  Msg=1;\nMsg=0; // \n  forall(eqL,\n    tmp=substring(#,0,1);\n    if(Toupper(tmp)==\"M\",\n      tmp=indexof(#,\"=\");\n      tmp1=substring(#,tmp,tmp+1);\n      if(Toupper(tmp1)==\"N\",\n        Msg=0;\n      );\n    );\n  );\n  if(Noflg&lt;3,\n    if(Msg==1,\n      println(\"generate Spaceline \"+name3);\n    );\n    tmp=name3+\"=\"+Textformat(ptlist,10)+\";\"; //190330//190415\n    parse(tmp);\n    tmp1=Projpara(name3,[\"nodata\"]);\n    tmp=name2+\"=\"+Textformat(tmp1,10)+\";\"; //190415\n    parse(tmp);\n    tmp=\"[\";\n    forall(ptlist, //17.07.13from\n      if(isstring(#),\n        tmp=tmp+#+\",\";\n      ,\n        tmp=tmp+Textformat(#,10)+\",\";\n      );\n    );\n    tmp=substring(tmp,0,length(tmp)-1)+\"]\";\n    tmp=name3+\"=Spaceline(\"+tmp+\")\"; //17.07.13to\n    GLIST=append(GLIST,tmp);\n    tmp=name2+\"=Projpara(\"+name3+\")\";\n    GLIST=append(GLIST,tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      if(color4!=KCOLOR, //180904\n        Texcom(\"{\");Com2nd(\"Setcolor(\"+color4+\")\");//180722\n      );\n\t  Ltype=Getlinestyle(text(Noflg)+Ltype,name2);\n      if(color4!=KCOLOR, //180904\n        Texcom(\"}\");//180722\n      );\n\t,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name2,Ltype,opcindy]);\n  );\n  ptlist;\n);\nProjpara(ptdata):=Projpara(ptdata,[]);\nProjpara(ptdata,optionsorg):=(\n  regional(options,name2,name3,Ltype,Noflg,eqL,opcindy,\n     dtL,ptL,tmp,tmp1,Out,color,color4,msg);\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  msg=\"Y\"; //180602from\nmsg=\"N\"; //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1)); //181111\n    if(tmp1==\"M\",\n      tmp=substring(tmp_2,0,1);\n      msg=Toupper(tmp);\n      options=remove(options,[#]);\n    );\n  );//180602to\n  Out=[];\n  if(isstring(ptdata),tmp=parse(ptdata),tmp=ptdata);\n  if(Measuredepth(tmp)&lt;1,dtL=ptdata,dtL=[ptdata]);\n  forall(dtL,name3,\n    if(indexof(name3,\"3d\")&gt;0, //17.05.24\n      name2=replace(name3,\"3d\",\"2d\");\n    ,\n      name2=\"para\"+name3;\n    );  \n    ptL=Projcurve(name3);\n    ptL=select(ptL,length(#)&gt;1);//17.06.02\n    if(length(ptL)==1,\n      ptL=ptL_1;\n    );\n    if(Noflg&lt;3,\n      if(msg==\"Y\", //220206\n        println(\"generate projparadata  \"+name2);\n      );//180602to\n      tmp=name2+\"=\"+Textformat(ptL,6)+\";\"; //220206\n      parse(tmp);\n      tmp=name2+\"=Projpara(\"+name3+\")\";\n      GLIST=append(GLIST,tmp);\n    );\n    if(Noflg&lt;3, //190818\n      if(isstring(Ltype),\n        if(color4!=KCOLOR, //180904\n          Texcom(\"{\");Com2nd(\"Setcolor(\"+color4+\")\");//180722\n        );\n\t\tLtype=Getlinestyle(text(Noflg)+Ltype,name2);\n        if(color4!=KCOLOR, //180904\n          Texcom(\"}\");//180722\n        );\n\t  ,\n        if(Noflg==1,Ltype=0);\n      );\n     GCLIST=append(GCLIST,[name2,Ltype,opcindy]);\n    );\n    Out=append(Out,ptL);\n  );\n  if(length(Out)==1,Out=Out_1);\n  if(length(Out)==1,Out=Out_1); // 15.02.24\n  tmp=[];\n  forall(Out,\n    if(length(#)&gt;0,tmp=append(tmp,#));\n  );\n  Out=tmp;\n  Out;\n);\nMeasuredepth(list):=( //190423\n  regional(str,nn,tmp,tmp1,tmp2);\n  str=text(list);\n  tmp1=Indexall(str,\"[\");\n  tmp2=select(tmp1,!contains(tmp1,#+1));\n  nn=tmp2_1;\n  tmp1=substring(str,nn,length(str));\n  tmp=indexof(tmp1,\",\");\n  tmp1=substring(tmp1,0,tmp-1);\n  if(!ispoint(parse(tmp1)),\n    nn=nn-1;\n  );\n  nn;\n);\nProjcurve(crv):=(\n  regional(CurveL,Curve,Eps,AnsL,Out,sp,cp,st,,ct,ii,pt,\n       Xz,Yz,tmp,tmp1,tmp2);\n  Eps=10^(-6);\n  sp=sin(PHI); cp=cos(PHI);\n  st=sin(THETA); ct=cos(THETA);\n  if(isstring(crv),CurveL=parse(crv),CurveL=crv);\n  if(Measuredepth(CurveL)==1,CurveL=[CurveL]);\n  Out=[];\n  forall(CurveL,Curve,\n    AnsL=[];\n    forall(1..length(Curve),ii,\n      pt=Curve_ii;\n      if(pt_1!=\"inf\",\n        Xz=-pt_1*sp+pt_2*cp;\n        Yz=-pt_1*cp*ct-pt_2*sp*ct+pt_3*st;\n        tmp=[Xz,Yz];\n        if(ii==1,\n           AnsL=[tmp];\n        ,\n          tmp1=AnsL_(length(AnsL));\n          if(tmp1_1==\"inf\" % |tmp-tmp1|&gt;Eps,\n            AnsL=append(AnsL,tmp);\n          );\n        );\n      ,\n        AnsL=append(AnsL,[\"inf\"]);\n      );\n    );\n    tmp1=[];\n    tmp2=select(1..length(AnsL),AnsL_#==[\"inf\"]);\n    tmp=1;\n    forall(tmp2,\n      if(#&gt;tmp,\n        tmp1=concat(tmp1,[AnsL_(tmp..(#-1))])\n      );\n      tmp=#+1;\n    );\n    if(tmp&lt;length(AnsL),\n      tmp1=concat(tmp1,[AnsL_(tmp..length(AnsL))]);\n    );\n    AnsL=tmp1;\n    if(length(AnsL)==1,AnsL=AnsL_1);\n    Out=append(Out,AnsL);\n  );\n  if(length(Out)==1,\n    Out=Out_1;\n  );\n  Out;\n);\nXyzaxparaname(Xrange,Yrange,Zrange):=\n   Xyzaxparaname(Xrange,Yrange,Zrange,[]);\nXyzaxparaname(Xrange,Yrange,Zrange,options):=(\n regional(tmp,tmp1,tmp2,Eps,Dr,Noflg,Xname,Yname,Zname,\n     px,qx,py,qy,pz,qz,ph,qh,rr,ch);\n  Eps=10.0^(-6);\n  Dr=0.19*1000/2.54/MilliIn;\n  Noflg=0;\n  forall(options,\n    if(isreal(#),Dr=Dr*#);\n  );\n  tmp1=Strsplit(Xrange,\"=\");\n  Xname=tmp1_1;\n  tmp=parse(tmp1_2);\n  px=[tmp_1,0,0]; qx=[tmp_2,0,0];\n  tmp1=Strsplit(Yrange,\"=\");\n  Yname=tmp1_1;\n  tmp=parse(tmp1_2);\n  py=[0,tmp_1,0]; qy=[0,tmp_2,0];\n  tmp1=Strsplit(Zrange,\"=\");\n  Zname=tmp1_1;\n  tmp=parse(tmp1_2);\n  pz=[0,0,tmp_1]; qz=[0,0,tmp_2];\n  COM2ndlist=select(COM2ndlist,indexof(#,Dqq(\"$\"+Xname+\"$\"))==0);//180608[3lines]\n  COM2ndlist=select(COM2ndlist,indexof(#,Dqq(\"$\"+Yname+\"$\"))==0);\n  COM2ndlist=select(COM2ndlist,indexof(#,Dqq(\"$\"+Zname+\"$\"))==0);\n  ph=Parapt(px); qh=Parapt(qx); rr=|ph-qh|;\n  if(rr&gt;Eps,\n    ch=qh+Dr/rr*(qh-ph);\n    Expr(ch,\"c\",Xname);\n  );\n  ph=Parapt(py); qh=Parapt(qy); rr=|ph-qh|;\n  if(rr&gt;Eps,\n    ch=qh+Dr/rr*(qh-ph);\n    Expr(ch,\"c\",Yname);\n  );\n  ph=Parapt(pz); qh=Parapt(qz); rr=|ph-qh|;\n  if(rr&gt;Eps,\n    ch=qh+Dr/rr*(qh-ph);\n    Expr(ch,\"c\",Zname);\n  );\n);\nDqq(str):=DqDq(str); //18.02.11\nDqDq(str):=(\n  unicode(\"0022\")+str+unicode(\"0022\");\n);\nExpr(Pt,Dr,St):=Expr([Pt,Dr,St]);\nExpr(list):=Expr(list,[]);\nExpr(Pt,Dr,St,options):=Expr([Pt,Dr,St],options); //190409\nExpr(listorg,options):=( //16.10.09\n  regional(list,str,tmp,tmp1,tmp2);\n  list=listorg;\n  forall(1..round(length(list)/3),\n    str=list_(3*#);\n    if(isstring(str), //200526from\n      if(!iswindows(),\n        str=replace(str,\"¥\",\"\\\");\n      ); \n    ,\n      str=format(str,10)\n    ); //200526to\n    str=\"$\"+str+\"$\"; //200526\n    list_(3*#)=str;\n  );\n  Letter(list,options);\n);\nLetter(Pt,Dr,St):=Letter([Pt,Dr,St]);\nLetter(list):=Letter(list,[]);\nLetter(Pt,Dr,St,options):=Letter([Pt,Dr,St],options);//181218\nLetter(list,options):=(\n  regional(Nj,Pos,Dir,Str,Off,Xmv,Ymv,Noflg,opcindy,\n      opL,aln,sz,clr,bld,ita,tmp,tmp1,tmp2,color,color4,eqL);\n  tmp=Divoptions(options);\n  eqL=tmp_5; //190209\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opL=select(options,indexof(#,\"-&gt;\")&gt;0); //16.10.09from\n  tmp=select(opL,indexof(#,\"color\"));\n  sz=16; //210516\n  bld=false;\n  ita=false;\n  aln=\"left\";\n  forall(opL,\n    tmp=indexof(#,\"-&gt;\");\n    tmp1=Removespace(substring(#,0,tmp-1));\n    tmp2=substring(#,tmp+1,length(#));\n    if(tmp1==\"size\",sz=parse(tmp2));\n    if(tmp1==\"color\",clr=parse(tmp2));\n    if(tmp1==\"bold\",bld=parse(tmp2));\n    if(tmp1==\"ita\",ita=parse(tmp2));\n  );//16.10.09to\n  forall(eqL, //190209from\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"S\",\n      sz=round(parse(tmp_2)*16); //210516\n    );\n  ); //190209to\n  Nj=1;\n  if(Ketcindyjsfigure&gt;0,sz=round(sz*Ketcindyjsscale) ); // \n  while(Nj+2&lt;=length(list),\n    Pos=Lcrd(list_Nj);  //220814\n    Dir=list_(Nj+1);\n    Str=list_(Nj+2);\n    if(!isstring(Str),Str=format(Str,10)); // 16.09.30,10.09\n    tmp=replace(Str,\".xy\",\"\");\n    tmp=replace(tmp,\".x\",\"(1)\");\n    Str=replace(tmp,\".y\",\"(2)\");\n    Str=RSslash(Str); // 17.09.24\n    Str=replace(Str,\"`\",\"'\");//180303\n    tmp=Dq+\",\"+Dq+Str+Dq+\")\";\n    if(Noflg&lt;2,\n      Off=[0,0];\n      Xmv=0; Ymv=0;\n      aln=\"mid\"; //200530from\n      if(indexof(Dir,\"c\")&gt;0, Off_2=-0.3*sz);\n      if(indexof(Dir,\"n\")&gt;0,Off_2=0;Ymv=Lettermove(\"n\",Dir)); //210601\n      if(indexof(Dir,\"s\")&gt;0, Off_2=-0.85*sz;Ymv=-Lettermove(\"s\",Dir));\n      if(indexof(Dir,\"e\")&gt;0,\n        aln=\"left\";\n        if(indexof(Dir,\"n\")+indexof(Dir,\"s\")==0,Off=[0,-0.3*sz]);\n        Xmv=Lettermove(\"e\",Dir);\n      );\n      if(indexof(Dir,\"w\")&gt;0,\n        aln=\"right\";\n        if(indexof(Dir,\"n\")+indexof(Dir,\"s\")==0,Off=[0,-0.4*sz]);\n        Xmv=-Lettermove(\"w\",Dir);\n      );\n      Str=list_(Nj+2);  //17.10.17\n      Pos=Pos+[Xmv,Ymv]*MARKLEN;//210530to\n      if(length(color)==4,color=Colorcmyk2rgb(color)); //200523\n      tmp=\"drawtext(\"+format(Pcrd(Pos),10)+\",offset-&gt;\"+text(Off)+\",\"+Dqq(Str)+\",\"; \n      tmp1=\"size-&gt;sz,color-&gt;colornow,align-&gt;\"+Dqq(aln)+\",bold-&gt;\"+bld+\",italics-&gt;\"+ita; //210601\n      tmp1=Assign(tmp1,[\"sz\",text(sz),\"colornow\",text(color),\"aln\",Dqq(aln),\"bld\",text(bld),\"ita\",text(ita)]);\n      tmp=tmp+tmp1+\");\";\n      GCLIST=append(GCLIST,[tmp,[6,0]]); //201004to\n    );\n    Nj=Nj+3;\n  );\n);\nRemovespace(str):=(\n  regional(tmp,flg,out);\n  tmp=length(str)+1;\n  flg=0;\n  forall(1..(length(str)),\n    if(flg==0,\n      if((str_#)!=\" \",\n        tmp=#;\n        flg=1;\n      );\n    );\n  );\n  out=substring(str,tmp-1,length(str));\n  flg=0;\n  tmp=0;\n  forall(reverse(1..(length(out))),\n    if(flg==0,\n      if((out_#)!=\" \",\n        tmp=#;\n        flg=1;\n      );\n    );\n  );\n  out=substring(out,0,tmp);\n);\nLettermove(dir,str):=(\n  regional(Suu,tmp,tmp1,out,nn);\n  Suu=\"+-.0123456789\";\n  tmp=indexof(str,dir);\n  tmp1=substring(str,tmp,length(str));\n  out=\"\";\n  nn=1;\n  while(nn&lt;=length(tmp1),\n    tmp=substring(tmp1,nn-1,nn);\n    if(indexof(Suu,tmp)&gt;0,\n      out=out+tmp;\n    ,\n      nn=length(str);\n    );\n    nn=nn+1;\n  );\n  if(length(out)==0,out=0,out=parse(out));\n  out;\n);\nArrowhead(point,Houkou):=Arrowhead(point,Houkou,[]); //181018from\nArrowhead(Arg1,Arg2,Arg3):=(\n  if(isstring(Arg1),\n    Arrowhead(Arg1,Arg2,Arg3,[]);\n  ,\n    Arrowhead(text(ArrowheadNumber),Arg1,Arg2,Arg3);\n  );\n);\nArrowhead(nm,pointorg,directionorg,optionsorg):=(//191129remade\n   regional(Eps,name,Ltype,Noflg,opstr,opcindy,color,eqL,line,direction,\n         point,options,pP,Houkou,ptstr,hostr,tmp,tmp1,tmp2,list);\n  Eps=10^(-4);\n  name=\"arh\"+nm; //181018\n  ArrowheadNumber=ArrowheadNumber+1;\n  point=Lcrd(pointorg); //210216\n  direction=directionorg; //211217from\n  if(isstring(direction),\n    if(indexof(direction,\"Invert\")&gt;0,\n      tmp=parse(direction);\n      direction=replace(direction,[[\"(\",\"\"],[\")\",\"\"]]);\n      Listplot(\"-\"+direction,tmp,[\"nodisp\"]);\n    );\n  ); //211217to\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2);\n  eqL=tmp_5;\n  line=\"N\";\n  forall(eqL,\n     tmp=Strsplit(#,\"=\");\n     tmp1=substring(tmp_1,0,1);\n     tmp2=substring(tmp_2,0,1);\n     if(Toupper(tmp1)==\"L\",\n       line=Toupper(tmp2);\n       options=remove(options,[#]);\n     );\n  );\n   list=Arrowheaddata(point,direction,options);\n  if(length(point)&gt;1, //210724from\n    if(!Inwindow(point),Noflg=2);\n    if(isstring(direction),\n      if(|Ptend(direction)-point|&lt;Eps,point=1);\n    );\n  ); //210724to\n  if(Noflg&lt;3,\n    tmp=name+\"=\"+Textformat(list,10)+\";\"; //210311\n    parse(tmp);\n    if(isstring(Ltype),\n      if(line==\"N\",\n        fillpoly(apply(list,Pcrd(#)),color-&gt;color);\n        if(Noflg==0,\n          if(isstring(direction), //210215,210724\n            if(ispoint(point) % islist(point), //201214from\n              if(|point-Ptend(direction)|&lt;Eps,point=1);\n            );  //201214to\n            if(point==1, //191202from\n              if(Norm(Ptend(direction)-Ptstart(direction))&gt;Eps,\n                tmp=select(GCLIST,#_1==direction); //201106from\n                tmp1=tmp_1;\n                tmp2=Nearestpt(list_4,direction);\n                tmp2=tmp2_1; //201214[2lines]\n                Partcrv(\"-\"+direction,Ptstart(direction),tmp2,direction,[\"nodisp\",\"Msg=n\"]);\n              ); //201106\n            );\n          );  //210215\n          Listplot(\"-arh\"+nm,list,[\"dr,0.1\",\"Color=\"+text(color),\"Msg=n\"]);//191202\n          Shade([\"arh\"+nm],[\"Color=\"+text(color)]);\n        );\n      ,\n        Listplot(\"-arh\"+nm,list_(1..3),concat(options,[\"Msg=n\"]));\n      );\n   );\n  );\n  list; //191202\n);\nArrowheaddata(point,direction):=\n   Arrowheaddata(point,direction,[YaSize,YaAngle,YaPosition,YaCut]);\nArrowheaddata(pointorg,directionorg,options):=( //191127remade\n  regional(point,direction,scaley,Eps,size,angle,segpos,cut, \n            Houkou,hflg,Str,Ev,Nv,reL,pP,vec,\n            pA,pB,pC,par,out,tmp,tmp1,tmp2);\n  point=Pcrd(pointorg); //230830from\n  tmp=directionorg;\n  if(isstring(tmp),\n    tmp=parse(tmp);\n    direction=apply(tmp,Pcrd(#)); //230830to \n  ,\n    direction=Pcrd(tmp);\n  );\n  Eps=10^(-4);\n  tmp=Divoptions(options);\n  reL=tmp_6;\n  size=0.2*YaSize*1/2.54*1000/MilliIn; \n  angle=YaAngle*pi/180;\n  segpos=YaPosition;\n  cut=YaCut;\n  if(length(reL)&gt;=1,\n    size=0.2*reL_1*1/2.54*1000/MilliIn; \n  );\n  if(length(reL)&gt;=2,\n    if(reL_2&lt;2.5,angle=reL_2*YaAngle,angle=reL_2);\n    angle=angle*pi/180;\n  );\n  if(length(reL)&gt;=3,\n    segpos=reL_3;\n  );\n  if(length(reL)&gt;=4,\n    cut=reL_4;\n  );\n  if(ispoint(point),pP=Lcrd(point),pP=point);\n  hflg=0; \n  out=[];\n  if(ispoint(direction),\n    Houkou=direction.xy;\n    hflg=2;\n  );\n  if(hflg==0, //191203from\n    if(!isstring(direction), //191207\n      if(Measuredepth(direction)==0,\n        Houkou=direction;\n        hflg=2;\n      );\n    );  //191207to\n  ); //191203to\n  scaley=SCALEY;\n  SCALEY=1; //200114\n  if(hflg==0,\n    if(isstring(direction),Houkou=parse(direction),Houkou=direction);\n    if(!islist(pP),\n      par=1+(length(Houkou)-1)*pP; //191207\n      pP=Ptcrv(par,Houkou);\n      tmp=floor(tmp); //191203from\n    ,\n      tmp=Nearestpt(pP,Houkou);\n      pP=tmp_1;\n      par=tmp_2;\n      tmp=floor(par); //191203to\n    );\n    if(tmp&lt;length(Houkou),\n      tmp1=Houkou_tmp;\n      tmp2=Houkou_(tmp+1);\n    ,\n      tmp1=Houkou_(tmp-1);\n      tmp2=Houkou_tmp;\n    );\n    vec=(tmp2-tmp1)/|tmp2-tmp1|;\n    gG=Circledata(\"\",[pP,size*cos(angle)],[\"Num=10\",\"nodata\"]);\n    tmp1=Intersectcrvspp(Houkou,gG);\n    if(length(tmp1)==0,\n      println(\"Arrowhead may be too large (no intersect)\");\n    ,\n      tmp=select(tmp1,#_2&lt;par); //191208from\n      if(length(tmp)&gt;0,\n        tmp=sort(tmp,[-#_2]);\n        pC=tmp_1_1;\n      ,\n        if(Norm(Ptend(direction)-Ptstart(direction))&gt;Eps,\n          tmp=sort(tmp1,[#_2]);\n          pC=2*pP-tmp_1_1;\n        ,\n          tmp=sort(tmp1,[-#_2]);\n          pC=tmp_1_1;\n        );\n      ); //191208to\n      Houkou=pP-pC;\n      hflg=1;\n    );\n  );\n  if(hflg&gt;=1,\n    Ev=-Houkou/|Houkou|;\n    Nv=[-Ev_2, Ev_1];    \n    pA=pP+size*cos(angle)*Ev+size*sin(angle)*Nv;\n    pB=pP+size*cos(angle)*Ev-size*sin(angle)*Nv;\n    if(hflg==2,\n      pC=(pA+pB)/2;\n    );\n    pC=pC+cut*(pP-pC);\n    tmp=(pP-(pA+pB)/2);\n    tmp=(1-segpos)*tmp;\n    pP=Translatepoint(pP,tmp);\n    pA=Translatepoint(pA,tmp);\n    pB=Translatepoint(pB,tmp);\n    pC=Translatepoint(pC,tmp);\n    SCALEY=scaley;\n    out=apply([pA,pP,pB,pC,pA],LLcrd(#));\n  );\n  out;\n);\nPtcrv(Num,Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);\n  tmp_Num;\n);\nNearestpt(pt,plotstr):=(\n  regional(ptL,Eps,dtL,dt,nn,pt1,pt2,dv,nv,tmp,tmp1,tmp2);\n  if(isstring(plotstr),ptL=parse(plotstr),ptL=plotstr);\n  Eps=10^(-6);\n  dtL=[];\n  forall(1..(length(ptL)-1),nn,\n    pt1=ptL_nn;\n    pt2=ptL_(nn+1);\n    if(|pt2-pt1|&lt;Eps,\n      dt=[pt1,nn,|pt1-pt|];\n    ,\n      dv=pt2-pt1;\n      nv=[-dv_2,dv_1];\n      tmp1=Intersectline(pt1,dv,pt,nv);\n      if(length(tmp1)&gt;1, //210319from\n        if((tmp1_2&gt;=0)&amp;(tmp1_2&lt;=1),\n          dt=[tmp1_1,nn+tmp1_2,|tmp1_1-pt|];\n        ,\n          if(tmp1_2&lt;0,\n            dt=[pt1,nn,|pt1-pt|];\n          ,\n            dt=[pt2,nn+1,|pt2-pt|];\n          );\n        );\n      ,\n      ); //210319to\n    );\n    dtL=append(dtL,dt);\n  );\n  dtL=select(dtL,length(#)&gt;=3); //220115\n  dtL=sort(dtL,[#_3,#_2]);\n  dtL_1;\n);\nIntersectline(p1,v1,p2,v2):=(\n  regional(Eps,d,dt,ds,t,s,pt,out,tmp,tmp1,tmp2,tmp3);\n  Eps=10^(-5);\n  out=[];\n  tmp=Dotprod(v1,v2);\n  tmp1=[tmp,|v1|^2];\n  tmp2=[-|v2|^2,-tmp];\n  tmp3=[Dotprod(p2-p1,v2),Dotprod(p2-p1,v1)];\n  d=Crossprod(tmp1,tmp2);\n  tmp=abs(Crossprod(v1,v2));\n  if(tmp&gt;Eps,\n    dt=Crossprod(tmp3,tmp2);\n    ds=Crossprod(tmp1,tmp3);\n    t=dt/d;\n    s=ds/d;\n    pt=p1+v1*t;\n    out=[pt,t,s];\n  ,\n    tmp1=Crossprod(p2-p1,v1)/|v1|; //18.01.05\n    out=[abs(tmp1)]; //18.01.05\n  );\n  out;\n);\nDotprod(vec1,vec2):=(\n  regional(v1,v2,tmp);\n  if(ispoint(vec1),v1=vec1.xy,v1=vec1);\n  if(ispoint(vec2),v2=vec2.xy,v2=vec2);\n  v1*v2;\n);\nCrossprod(a,b):=(\n  regional(tmp1,tmp2,tmp3,Out);\n  if(length(a)==3,\n    tmp1=a_2*b_3-a_3*b_2;\n    tmp2=a_3*b_1-a_1*b_3;\n    tmp3=a_1*b_2-a_2*b_1;\n    Out=[tmp1,tmp2,tmp3];\n  ,\n    Out=a_1*b_2-a_2*b_1;\n  );\n  Out;\n);\nCircledata(cenrad):=Circledata(cenrad,[]);\nCircledata(para1,para2):=(\n  regional(name,cenrad,options,str,n); \n  if(isstring(para1), \n    name=para1;\n    cenrad=para2;\n    options=[];\n    ,\n    cenrad=para1;\n    options=para2;\n    name=\"\";// 16.10.07from\n    forall(cenrad, \n       name=name+#.name;\n    );// 16.10.07until\n  );\n  Circledata(name,cenrad,options);\n);\nCircledata(nm,cenrad,options):=(\n  regional(name,Out,Ctr,Ptcir,ra,Num,Rg,opstr,opcindy,color,color4,Msg,\n      tmp,tmp1,tmp2,Th,Ltype,Noflg,eqL,pA,pB,pC,d1,d2,Eps);  \n  name=\"cr\"+nm;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  Num=50;\n  Rg=[0,2*pi];\n  Msg=\"Y\";\n Msg=\"N\"; //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(substring(#,0,1)==\"N\",\n      Num=parse(tmp_2);\n     opstr=opstr+\",'\"+#+\"'\";\n    );\n    if(substring(#,0,1)==\"R\",\n      Rg=parse(tmp_2);\n      opstr=opstr+\",'\"+#+\"'\";\n    );\n    if(tmp1==\"M\", //190206from\n      Msg=Toupper(substring(tmp_2,0,1));\n    ); //190206to\n  );\n  if(length(cenrad)==2,\n    Ctr=Lcrd(cenrad_1);\n    Ptcir=Lcrd(cenrad_2);\n    if(!islist(Ptcir),  //190323from\n      Ptcir=Ctr+[Ptcir,0];\n    );  //190323to\n    ra=dist(Ctr,Ptcir);\n  ,\n    Eps=10^(-1);\n    pA=Lcrd(cenrad_1);\n    pB=Lcrd(cenrad_2);\n    pC=Lcrd(cenrad_3);\n    tmp=pB-pA;\n    tmp1=(tmp_2,-tmp_1);\n    tmp=pC-pB;\n    tmp2=(tmp_2,-tmp_1);\n    d1=det([tmp1,tmp2]);\n    d2=det([pC-pA,tmp2]);\n    if(abs(d1)&lt;Eps &amp; abs(d2)&gt;10*Eps,\n      println(\"points are in a line\");\n      ra=0;\n    ,\n      Ctr=1/2*(pA+pB)+1/2*d2/d1*tmp1;\n      ra=|pA-Ctr|;\n      tmp=name+\"center=\"+Textformat(Ctr,5)+\";\";\n      parse(tmp);\n    );\n  );\n  if(ra&gt;0,\n    Out=[];\n    forall(0..Num,\n      Th=Rg_1+#*(Rg_2-Rg_1)/Num;\n      Out=append(Out,Ctr+ra*[cos(Th),sin(Th)]);\n    );\n  ,\n    tmp=100/dist(pA,pB)*(pB-pA);\n    Out=Listplot(\"1\",[pA-tmp,pB+tmp],[\"nodata\"]);\n  );\n  if(Noflg&lt;3,\n    if(Msg==\"Y\", //190206\n      println(\"generate Circledata \"+name);\n    );\n    tmp1=apply(Out,Pcrd(#));\n    tmp=name+\"=\"+Textformat(tmp1,10)+\";\"; //190415,210311\n    parse(tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  Out;\n);\nIntersectcrvspp(Gr1,Gr2):=Intersectcrvspp(Gr1,Gr2,[]);\nIntersectcrvspp(Gr1,Gr2,options):=(\n  regional(Out,Eps,Eps2,Eps0,Flg,Data1,Data2,\n    Tmp1,Tmp2,Tmp3,Tmp,KL1,KL2,pA,pB,Ni,Nj,\n    pP,pQ,rT,Flg,eqL,realL,opstr,Dif);\n  Eps=10^(-6); //210730\n  Eps2=0.1;\n  Dif=0.05; // 2015.05.31\n  Flg=0;\n  Tmp1=Divoptions(options); // \n  eqL=Tmp1_5;\n  realL=Tmp1_6;\n  opstr=Tmp1_(length(Tmp1));\n  forall(eqL,\n    if(substring(#,0,1)==\"D\",\n      Tmp1=indexof(#,\"=\");\n      Dif=parse(substring(#,Tmp1,length(#)));\n    );\n  );\n  Tmp1=length(realL);\n  if(Tmp1&gt;0,\n    Eps=realL_1;\n    if(Tmp1&gt;1,\n      Eps2=realL_2;\n    );\n  );\n  Flg=0;\n  if(isstring(Gr1),Data1=parse(Gr1),Data1=Gr1);\n  if(isstring(Gr2),Data2=parse(Gr2),Data2=Gr2);\n  if(Measuredepth(Data1)==2,Data1=Data1_1);\n  if(Measuredepth(Data2)==2,Data2=Data2_1);\n  Data1=apply(Data1,LLcrd(#));\n  Data2=apply(Data2,LLcrd(#));\n  if(length(Data1)==length(Data2),\n    Tmp1=reverse(Data2); \n    Eps0=10^(-6);\n    Tmp2=0;\n    forall(1..(length(Data1)),\n      Tmp2=Tmp2+abs(Data1_#-Data2_#);\n    );\n    Tmp3=0;\n    forall(1..(length(Data1)),\n      Tmp3=Tmp3+abs(Data1_#-Tmp1_#);\n    );\n    if(Tmp2&lt;Eps0 % Tmp3&lt;Eps0,\n      Out=[];\n      Flg=1;\n    );\n  );\n  if(Flg==0,\n    KL1=[];\n    KL2=[];\n    forall(1..(length(Data1)-1),Ni,\n      pA=Data1_Ni;\n      pB=Data1_(Ni+1);\n      forall(1..(length(Data2)-1),\n        pP=Data2_#; pQ=Data2_(#+1);\n        Tmp=Koutenseg(pA,pB,pP,pQ,[Eps,Eps2]);\n        if(Tmp!=[\"inf\",\"inf\"],\n          if(Tmp_3==0,\n            Tmp1=[Tmp_1,Tmp_2,Ni,#];\n            KL1=concat(KL1,[Tmp1]);\n          ,\n            Tmp2=[Tmp_1,Tmp_2,Ni,#];\n            KL2=concat(KL2,[Tmp2]);\n          );\n        );\n      );\n    );\n    Out=[];\n    if(length(KL1)&gt;0,\n      Tmp=KL1_1;\n      pP=Tmp_1;\n      rT=Tmp_2;\n      Ni=Tmp_3;\n      Nj=Tmp_4;\n      Tmp=[pP,Ni+rT,Nj];\n      Out=[Tmp];\n    );\n    forall(2..(length(KL1)),Ni, \n      Tmp=KL1_Ni; \n      pP=Tmp_1;\n      Tmp2=0;\n      Flg=0;\n      forall(1..(length(Out)),Nj,\n        if(Flg==0,\n          Tmp=Out_Nj;\n          if(|pP-Tmp_1|&lt;Eps,\n            Tmp2=1;\n            Flg=1;\n          );\n        );\n      );\n      if(Tmp2==0,\n        Tmp=KL1_Ni; \n        pP=Tmp_1;\n        rT=Tmp_2;\n        Tmp1=Tmp_3;\n        Tmp2=Tmp_4;\n        Tmp=[pP,Tmp1+rT,Tmp2];\n        Out=concat(Out,[Tmp]);\n      );\n    );\n    forall(1..(length(KL2)),Ni,\n      Tmp=KL2_Ni;  // 15.11.21 Usui\n      pP=Tmp_1; \n      Tmp2=0;\n      Flg=0;\n      forall(1..(length(Out)),Nj,\n        if(Flg==0,\n          Tmp=Out_Nj;\n          if(|pP-Tmp_1|&lt;Eps,\n            Tmp2=1;\n            Flg=1;\n          );\n        );\n      );\n      if(Tmp2==0,\n        Tmp=KL2_Ni;\n        rT=Tmp_2;\n        rT=min([max([rT,0]),1]);  // 15.11.21 Usui\n        Tmp=[pP,Tmp_3+rT,Tmp_4];\n        Out=concat(Out,[Tmp]);\n      );\n    );\n  );\n  Tmp1=Out;  // 15.04.06 from\n  Out=[];\n  forall(Tmp1,Tmp2,\n    Tmp3=select(1..(length(Out)),//16.11.27,\n        |Out_#_1-Tmp2_1|&lt;Dif &amp; |Out_#_2-Tmp2_2|&lt;=1&amp; |Out_#_3-Tmp2_3|&lt;=1);\n    if(length(Tmp3)==0,\n      Out=append(Out,Tmp2);\n    ,\n      forall(Tmp3, //16.11.27\n        Out_#_1=(Out_#_1+Tmp2_1)/2;//17.04.14\n      );\n    );\n  ); // 15.04.06 until\n  Out;\n);\nKoutenseg(pA,pB,pC,pD):=Koutenseg(pA,pB,pC,pD,[]);\nKoutenseg(pA,pB,pC,pD,options):=(\n  regional(Eps0,Eps,Eps2,pV,Sv2,Out,pP,pQ,Flg,p1,p2,q1,q2,\n          em1,eM1,em2,eM2,rT,Tmp1,Tmp2);\n  Eps0=10^(-4);\n  pV=pB-pA;\n  Sv2=|pV|;\n  pP=pC-pA; pQ=pD-pA;\n  Eps=10^(-3);\n  Eps2=0.2;\n  Tmp1=0;\n  forall(options,\n    if(Tmp1==0,\n      Eps=#;\n      Tmp1=1;\n    ,\n      Eps2=#;\n    );\n  );\n  Flg=0;\n  if(Sv2&lt;10^(-3),\n     Out=[\"inf\",\"inf\"];\n     Flg=1;\n  );\n  if(Flg==0,\n    Eps=min([Eps2,Eps/Sv2]);\n    p1=pP*pV/Sv2^2;\n    p2=[pP_2,-pP_1]*pV/Sv2^2;\n    q1=pQ*pV/Sv2^2;\n    q2=[pQ_2,-pQ_1]*pV/Sv2^2;\n    em1=-Eps; eM1=1+Eps;\n    em2=-Eps; eM2=Eps;\n    if(max([p1,q1])&lt;em1 % min([p1,q1])&gt;eM1,\n      Out=[\"inf\",\"inf\"];\n      Flg=1;\n    );\n    if(max([p2,q2])&lt;em2 % min([p2,q2])&gt;eM2,\n      Out=[\"inf\",\"inf\"];\n      Flg=1;\n    );\n  );\n  if(Flg==0 &amp; p2*q2&lt;0,\n    rT=p1-(q1-p1)/(q2-p2)*p2;\n    if(rT&gt;em1 &amp; rT&lt;eM1,\n      if(rT&gt;-Eps0 &amp; rT&lt;1+Eps0,\n        Tmp1=pA+rT*pV;\n        Tmp2=min([max([rT,0]),1]);\n        Out=[Tmp1,Tmp2,0];\n      ,\n        Tmp1=pA+rT*pV;\n        Tmp2=min([max([rT,0]),1]);\n        Out=[Tmp1,Tmp2,1];\n      );\n      Flg=1;\n    );\n    if(Flg==0 &amp; (p1&lt;em1 % p1&gt;eM1 % p2&lt;em2 % p2&gt;eM2),\n      if(q1&lt;em1 % q1&gt;eM1 % q2&lt;em2 % q2&gt;eM2,\n         Out=[\"inf\",\"inf\"];\n         Flg=1;\n      );\n      if(Flg==0,\n        rT=min([max([p1,0]),1]);\n        Tmp1=pA+rT*pV;\n        Out=[Tmp1,rT,1];\n        Flg=1;\n      );\n    );\n  );\n  if(Flg==0 &amp; (p1 &gt; -Eps0 &amp; p1 &lt; 1 + Eps0 &amp; p2 &gt; -Eps0 &amp; p2 &lt; Eps0),\n    rT= p1;\n    Tmp1=pA+rT*pV;\n    Out= [Tmp1, rT, 0];\n    Flg=1;\n  );\n  if(Flg==0 &amp; (q1 &gt; -Eps0 &amp; q1 &lt; 1 + Eps0 &amp; q2 &gt; -Eps0 &amp; q2 &lt; Eps0),\n    rT= q1;\n    Tmp1=pA+rT*pV;\n    Out=[Tmp1,rT,0];\n    Flg=1;\n  );\n  if(Flg==0 &amp; (p1&lt;em1 %  p1&gt;eM1 % p2&lt;em2 % p2&gt;eM2),\n    if(q1&lt;em1 % q1&gt;eM1 % q2&lt;em2 % q2&gt;eM2,\n      Out=[\"inf\",\"inf\"];      \n      Flg=1;\n    );\n    if(Flg==0,\n      rT=min([max([q1,0]),1]);\n      Tmp1=pA+rT*pV;\n      Out=[Tmp1,rT,1];\n      Flg=1;\n    );\n  );\n  if(Flg==0 &amp; (q1&lt;em1 %  q1&gt;eM1% q2&lt;em2 % q2&gt;eM2),\n    rT=min([max([p1,0]),1]);\n    Tmp1=pA+rT*pV;\n    Out=[Tmp1,rT,1];\n    Flg=1;\n  );\n  if(Flg==0,\n    if(abs(p2)&lt;abs(q2),\n      rT=min([max([p1,0]),1]);\n    ,\n      rT=min([max([q1,0]),1]);\n    );\n    Tmp1=pA+rT*pV;\n    Out=[Tmp1,rT,1];\n  );\n  if(!isstring(Out_1),Out=apply(Out,re(#))); //190802\n  Out;\n);\nPtend(Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);\n  tmp_(length(tmp)); // 15.04.12\n);\nPtstart(Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);  // 16.01.21\n  tmp_1;\n);\nTranslatepoint(point,mov):=(\n  regional(X1,X2,Y1,Y2,Cx,Cy,tmp);\n  tmp=Lcrd(point);\n  X1=tmp_1; Y1=tmp_2;\n  tmp=Lcrd(mov);\n  Cx=tmp_1; Cy=tmp_2;\n  X2=X1+Cx;\n  Y2=Y1+Cy; \n  [X2,Y2];\n);\nInwindow(point):=Inwindow(point,[XMIN,XMAX],[YMIN,YMAX]);\nInwindow(point,xrng,yrng):=(\n  regional(Eps,pt,x,y,xmin,xmax,ymin,ymax,tmp);\n  Eps=10.0^(-6);\n  if(ispoint(point),pt=point.xy,pt=point);\n  x=pt_1; y=pt_2;\n  xmin=xrng_1; xmax=xrng_2;\n  ymin=yrng_1; ymax=yrng_2;\n  tmp=(x&gt;xmin-Eps)&amp;(x&lt;xmax+Eps)&amp;(y&gt;ymin-Eps)&amp;(y&lt;ymax+Eps);\n  if(tmp,true,false);\n);\nPartcrv(nm,pA,pB,PkLstr):=Partcrv(nm,pA,pB,PkLstr,[]);\nPartcrv(nm,pAorg,pBorg,PkLstr,options):=(\n  regional(pA,pB,PkL,PkLL,Ans,Eps,Npt,Out1,Out2,tmp,tmp1,tmp2,Flg,nS,nE,\n        PPL,pP,opcindy,Ta,Tb,name,Ltype,Noflg,eqL,msg,DepthFlg,color,color4);\n  if(substring(nm,0,1)==\"-\", //201106from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"part\"+nm;\n  ); //201106to\n  pA=pAorg; pB=pBorg; //201031\n  if(isstring(PkLstr),PkL=parse(PkLstr),PkL=PkLstr);\n  DepthFlg=0;\n  if(Measuredepth(PkL)==2,\n    PkL=PkL_1;\n    DepthFlg=1;\n  );\n  PkLL=apply(PkL,LLcrd(#)); //201031\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  msg=\"Y\";\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    tmp2=Toupper(substring(tmp_2,0,1));\n    if(tmp1==\"M\",\n      msg=tmp2;\n    );\n  );\n  Eps=10^(-4);\n  Flg=0;\n  if(isreal(pA),\n    if(pA&gt;pB+Eps,\n      Npt=Numptcrv(PkL);\n      Out1=Partcrv(\"\",pA,Npt,PkLstr,[\"nodata\"]);\n      Out2=Partcrv(\"\",1,pB,PkLstr,[\"nodata\"]);\n      tmp=Ptstart(PkL)-Ptend(PkL);\n      if(|tmp|&lt;Eps,\n        Ans=Joincrvs(\"\",[Out1,Out2],[\"nodata\"]);\n      ,\n        Ans=[apply(Out1,Pcrd(#)),apply(Out2,Pcrd(#))];\n      );\n      Flg=1;\n    );\n    if(Flg==0,\n      nS=ceil(pA);\n      nE=floor(pB);\n      PPL=[];\n      if(pA&lt;nS-Eps,\n        pP=(nS-pA)*PkL_(nS-1)+(1-nS+pA)*PkL_nS;\n        PPL=[pP];\n      );\n      PPL=concat(PPL,PkL_(nS..nE));\n      if(pB&gt;nE+Eps,\n        pP=(1-pB+nE)*PkL_nE+(pB-nE)*PkL_(nE+1);\n        PPL=concat(PPL,[pP]);\n      );\n      Ans=PPL;\n      Flg=1;\n    );\n  );\n  if(Flg==0,\n    pA=Pcrd(pA); //201031from\n    pB=Pcrd(pB); \n    tmp=Nearestpt(LLcrd(pA),PkLL); //201031to\n    Ta=tmp_2;\n    tmp=Nearestpt(LLcrd(pB),PkLL); // 15.09.12\n    Tb=tmp_2;\n    Ans=Partcrv(\"\",Ta,Tb,PkL,[\"nodata\"] );\n  );\n  if(Noflg&lt;3,\n    tmp1=apply(Ans,Pcrd(#)); //201030\n    tmp=name+\"=\"+Textformat(Ans,5)+\";\"; //190415\n    parse(tmp);\n    if(DepthFlg==0,\n      tmp=PkLstr;\n    ,\n      tmp=PkLstr+\"(1)\";\n    );\n    tmp1=name+\"=Partcrv(\"+Textformat(Lcrd(pA),5)\n         +\",\"+Textformat(Lcrd(pB),5)+\",\"+tmp+\")\"; // 16.04.03\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  Ans;\n);\nNumptcrv(Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);  // 15.12.23\n  length(tmp);\n);\nJoincrvs(nm,plotstrL):=Joincrvs(nm,plotstrL,[]);\nJoincrvs(nm,plotstrL,options):=(\n  regional(plotlist,PtL,Eps,QdL,Flg,Ni,Qd,pP,pS,pQ,pR,rMN,\n        opcindy,tmp,tmp1,tmp2,str,name,Ltype,Noflg,color,color4);\n  name=\"join\"+nm;\n  plotlist=[];\n  forall(plotstrL,str,\n    if(isstring(str),\n      tmp=parse(str);\n      tmp=apply(tmp,LLcrd(#));\n    ,\n      tmp=str;\n    );\n    plotlist=append(plotlist,tmp);\n  );\n  Eps=10^(-4);\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200629\n  opcindy=tmp_(length(tmp));\n  tmp1=tmp_6;\n  if(length(tmp1)&gt;0,Eps=tmp1_1);\n  QdL=[];\n  forall(plotlist,Qd,\n    if(ispoint(Qd_1) % !islist(Qd_1_1),\n      QdL=concat(QdL,[Qd]);\n    ,\n      forall(Qd,\n        QdL=concat(QdL,[#]);\n      );\n    );\n  );\n  Flg=0;\n  if(length(QdL)==0,\n    PtL=[];\n    Flg=1;\n  );\n  if(Flg==0,\n    PtL=QdL_1;\n    forall(2..(length(QdL)),Ni,\n      Qd=QdL_Ni;\n      if(Numptcrv(Qd)&gt;1,\n        pP=Ptend(PtL);\n        pS=Ptstart(PtL);\n        pQ=Ptstart(Qd);\n        pR=Ptend(Qd);\n        rMN=min([|pP-pQ|,|pP-pR|,|pS-pQ|,|pS-pR|]);\n        if(rMN==|pP-pR|,\n          Qd=reverse(Qd);\n        ,\n          if(rMN==|pS-pQ|,\n            PtL=reverse(PtL);\n          ,\n            if(rMN==|pS-pR|,\n              PtL=reverse(PtL);\n              Qd=reverse(Qd);\n            );\n          );\n        );\n      );\n      if(rMN&gt;Eps,\n        PtL=concat(PtL,Qd);\n      ,\n        PtL=concat(PtL,Qd_(2..(length(Qd))));\n      );\n    );\n  );\n  if(Noflg&lt;3,\n    println(\"generate joincurve \"+name);\n    tmp1=apply(PtL,Pcrd(#));\n    tmp=name+\"=\"+Textformat(tmp1,5)+\";\";\n    parse(tmp);\n    tmp1=\"\";\n    forall(plotstrL,\n        tmp1=tmp1+#+\",\";\n    );\n    tmp1=substring(tmp1,0,length(tmp1)-1);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  PtL;\n);\nShade(plist):=Shade(plist,[]); \nShade(Arg1,Arg2):=(\n  if(!isstring(Arg1),\n    Shade(text(SHADECTR),Arg1,Arg2); //190222\n  ,\n    Shade(Arg1,Arg2,[]);\n  );\n);\nShade(nm,plistorg,options):=(\n  regional(name,plist,jj,nn,trim,first,tmp,tmp1,tmp2,Noflg,\n     opstr,opcindy,eqL,reL,Str,G2,flg,encflg,startpt,color,color4,ctr,ptshade);\n  if(substring(nm,0,1)==\"-\", //200513from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"shade\"+nm;\n  ); //200513to\n  plist=plistorg;\n  tmp=Divoptions(options);\n  Noflg=tmp_2; //200512\n  eqL=tmp_5; \n  reL=tmp_6;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  encflg=0; //201029\n  tmp=select(plist,indexof(#,\"Invert\")&gt;0); //180929from\n  trim=\"N\";\n  first=\"N\"; //191007\n  ptshade=\"N\"; //200513\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(tmp_1);\n    tmp2=Toupper(tmp_2);\n    if(substring(tmp1,0,1)==\"E\",\n      if(substring(tmp2,0,1)==\"Y\",\n        encflg=1;\n      );\n    );\n    if(substring(tmp1,0,1)==\"T\",\n      trim=substring(tmp2,0,1);\n    );\n    if(substring(tmp1,0,1)==\"F\",\n      first=substring(tmp2,0,1);\n    );\n    if(substring(tmp1,0,1)==\"P\", //200513[3lines]\n      ptshade=Toupper(substring(tmp2,0,1));\n    );\n  );\n  startpt=[];\n  forall(reL,\n    if(islist(#),\n      startpt=#;\n    );\n  ); //180929to\n  flg=0; ctr=1;\n  if(encflg==1, //180929from\n    if(length(startpt)==2,\n      Enclosing(nm,plist,[startpt,\"nodisp\"]);\n    ,\n      Enclosing(nm,plist,[\"nodisp\"]);\n    );\n    plist=[\"en\"+nm];\n  ); //180929to\n  if((length(plist)==1)&amp;(trim==\"Y\"), //190220from,109224\n    plist=[Shadein(plist)];\n  ); //190220to\n  forall(1..(length(plist)),jj, //180613from\n    if(flg==0,\n      tmp1=plist_jj;\n      if(isstring(tmp1),tmp=parse(tmp1),tmp=tmp1);\n      if(!islist(tmp),\n         flg=1;\n      ,\n        if(!isstring(tmp1),\n          tmp2=[];\n          forall(tmp1,if(ispoint(#),tmp=#.xy,tmp=#);\n            tmp2=append(tmp2,tmp);\n          );\n          Listplot(\"-\"+name+text(ctr),tmp2,[\"nodisp\"]); //190520\n          plist_jj=name+text(ctr);\n          ctr=ctr+1;\n        );\n      ); \n    );\n  );//180613to\n  if(flg==1,\n    println(\"    Shade : some data not defined properly\");\n ,\n    if(Noflg&lt;2, //200512\n      G2=Joincrvs(\"1\",plist,[\"nodata\"]);\n      G2=apply(G2,Pcrd(#));\n      tmp1=\"fillpoly(\"+Textformat(G2,10)+opcindy+\");\";\n      if(ptshade==\"N\", //200513from\n        tmp=select(1..(length(GCLIST)),contains(plist,GCLIST_#_1)); //200715from\n        if(length(tmp)&gt;0,\n          nn=min(tmp);\n        ,\n          nn=length(GCLIST)+1;\n        );\n        tmp2=GCLIST_(1..(nn-1));\n        tmp2=append(tmp2,[tmp1,[5,0]]);\n        GCLIST=concat(tmp2,GCLIST_(nn..(length(GCLIST))));\n      ,\n        PTSHADElist=append(PTSHADElist,[name,tmp1]);\n      ); //200513to\n    );\n  );\n  SHADECTR=SHADECTR+1;\n);\nEnclosing(nm,plist):=Enclosing2(nm,plist,[]);//180706[2lines]\nEnclosing(nm,plistorg,options):=Enclosing2(nm,plistorg,options);\nEnclosing2(nm,plist):=Enclosing2(nm,plist,[]);\nEnclosing2(nm,plistorg,options):=(\n  regional(name,plist,AnsL,Start,Eps,Eps1,Eps2,flg,Fdata,Gdata,KL,\n      t1,t2,tst,ss,ii,nn,nxtno,Ltype,Noflg,realL,eqL,opstr,opcindy,\n      tmp,tmp1,tmp2,tmp3,tmp4,color,color4,p1,p2);\n  if(substring(nm,0,1)==\"-\",  //201110from\n    name=substrin(nm,1,length(nm));\n  ,\n    name=\"en\"+nm;\n  );  //201110to\n  plist=plistorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  realL=tmp_6;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200629\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  Eps=10^(-5); // 16.12.05\n  Eps1=0.01;\n  Eps2=0.1;\n  Start=[];\n  flg=0;\n  forall(realL,\n    if(isList(#) % ispoint(#),\n      Start=Lcrd(#); // 18.02.02\n    ,\n      if(flg==1,Eps1=#);\n      if(flg==2,Eps2=#);\n      flg=flg+1;\n    );\n  );\n  flg=0;\n  AnsL=[];\n  if(length(plist)==1,\n    Fdata=parse(plist_1);\n    tmp1=Fdata_1;\n    tmp2=Fdata_(length(Fdata));\n    if(|tmp1-tmp2|&lt;Eps,\n      AnsL=Fdata;\n    ,\n      AnsL=append(Fdata,tmp1);\n    );\n    flg=1;\n  );\n  if(flg==0,\n    Fdata=plist_1;\n    Gdata=plist_(length(plist));\n    KL=Intersectcurvespp(Fdata,Gdata);\n   if(length(KL)==0,\n      tmp=parse(Gdata);\n      tmp1=LLcrd(Op(length(tmp),tmp)); //18.02.02from\n      tmp=parse(Fdata);\n      tmp2=LLcrd(Op(1,tmp));\n      tmp=Listplot(name,[tmp1,tmp2],[\"nodisp\"]);\n      plist=append(plist,\"sg\"+name);\n      Start=tmp2;\n      tst=1; //18.02.02to\n      p1=Start;\n    ,\n      if(length(KL)==1,\n        tst=KL_1_2;\n        Start=Pointoncurve(tst,Fdata);\n      );\n      if(length(KL)&gt;1,\n        KL=sort(KL,[#_2]);\n        if(Start==[],\n          tst=KL_1_2;\n          Start=Pointoncurve(tst,Fdata);\n        ,\n          tmp=apply(KL,|#_1-Start|);\n          tmp=min(tmp);\n          tmp1=select(KL,|#_1-Start|&lt;tmp+Eps1);//180718\n          tst=tmp1_1_2;\n          Start=Pointoncurve(tst,Fdata);\n        );\n      );\n    );\n  );\n  if(flg==0,\n    t1=tst;\n    p1=Pointoncurve(t1,Fdata); //180713\n    println(\"Start point of enclosing is \"+text(Start));\n    forall(1..(length(plist)),nn,\n      Fdata=plist_nn;\n      if(nn==length(plist),nxtno=1,nxtno=nn+1);\n      Gdata=plist_nxtno;\n      tmp1=parse(Fdata); //200803from\n      tmp2=parse(Gdata);\n      if(|tmp2_1-tmp1_(-1)|&lt;Eps,\n        if(nn&lt;length(plist), //211217from\n          AnsL=concat(AnsL,tmp1);\n        ,\n          tmp3=Partcrv(\"\",AnsL_(-1),tmp2_1,tmp1,[\"nodata\"]);\n          AnsL=concat(AnsL,tmp3);\n        );  //211217fto\n      ,  //200803to\n        KL=Intersectcurvespp(Fdata,Gdata);\n        if(length(KL)==0, \n          tmp2=Prepend(Op(length(tmp1),tmp),tmp2);\n          Gdata=replace(Gdata,\"(\",\"\");\n          Gdata=replace(Gdata,\")\",\"\");\n          tmp=Gdata+\"=\"+Textformat(tmp2,10)+\";\"; //190415\n          parse(tmp);\n          plist_nxtno=Gdata;\n          t2=Length(tmp1);\n          p2=Pointoncurve(t2,Fdata); //180713\n          ss=1; //18.02.02to\n        ,\n          KL=sort(KL,[#_2]);//180706\n          tmp=parse(Fdata);\n          tmp1=t1+Eps;\n          tmp=select(KL,(#_2&gt;tmp1)%((#_2&gt;t1)&amp;(|#_1-p1|&gt;Eps1))); //210411from\n          if(length(tmp)&gt;0,\n            KL=tmp;\n          ,\n            KL=KL;  //211002,1014\n          ); //210411to\n          t2=KL_1_2;\n          ss=KL_1_3;\n          if(abs(t2-t1)&lt;Eps,//180707\n            if(length(KL)&gt;1,\n              t2=KL_2_2;\n              ss=KL_2_3;\n            ,\n              println(text(nn)+\" and \"+text(nxtno)+\" not intersect\");\n              flg=1;\n            );\n          );\n        );\n        if(flg==0,\n          tmp=Partcrv(\"\",t1,t2,Fdata,[\"nodata\"]);\n          if(nn==1,\n            AnsL=tmp;\n          ,\n            AnsL=concat(AnsL,tmp_(2..(length(tmp))));\n          );\n        );\n        t1=ss;//180706\n        p1=Pointoncurve(t1,Gdata); //180713\n      );\n    );\n    if(flg==0,\n      AnsL=apply(1..(length(AnsL)),Pcrd(AnsL_#));\n    );\n  );\n  AnsL=Unscaling(AnsL); //201110\n  if(Noflg&lt;3,\n    println(\"generate Enclosing \"+name);\n    tmp=name+\"=\"+Textformat(AnsL,10)+\";\"; //190415\n    parse(tmp);\n    tmp=parse(name); //210530[2lines]\n    tmp=apply(tmp,LLcrd(#));\n    Listplot(\"-\"+name,tmp,[\"nodisp\"]); //210421\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  AnsL; //201110\n);\nIntersectcurvespp(crv1org,crv2org):=Intersectcurvespp(crv1org,crv2org,[]);\nIntersectcurvespp(crv1org,crv2org,options):=(\n  regional(Eps,Eps1,Eps2,Dist,crv1,crv2,ii,jj,seg1,seg2,self,loopL,out,\n          flg,tmp,tmp1,tmp2);\n  Eps=10^(-4);\n  Eps1=0.01;\n  Eps2=0.1;\n  Dist=10*Eps2;\n  if(length(options)&gt;0,\n    Eps1=options_1;\n    if(length(options)&gt;1,\n      Eps2=options_2;\n      Dist=10*Eps2;\n      if(length(options)&gt;2,\n        Dist=options_3;\n      );\n    );\n  );\n  if(isstring(crv1org),tmp1=parse(crv1org),tmp1=crv1org);//18.01.05from\n  if(isstring(crv2org),tmp2=parse(crv2org),tmp2=crv2org);\n  tmp1=apply(tmp1,LLcrd(#));\n  tmp2=apply(tmp2,LLcrd(#)); \n  crv1=[tmp1_1];\n  forall(tmp1,\n    tmp=crv1_(length(crv1));\n    if(|tmp-#|&gt;Eps,\n      crv1=append(crv1,#);\n    );\n  );\n  crv2=[tmp2_1];\n  forall(tmp2,\n    tmp=crv2_(length(crv2));\n    if(|tmp-#|&gt;Eps,\n      crv2=append(crv2,#);\n    );\n  );//18.01.05until\n  if(crv1==crv2,\n    self=1;\n  ,\n    self=0;\n  );\n  out=[];\n  forall(1..(length(crv1)-1),ii,\n    if(self==0,\n      loopL=1..(length(crv2)-1);\n    ,\n      loopL=(ii+2)..(length(crv2)-1);\n    );\n    forall(loopL,jj,\n      tmp=Intersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2,Dist);\n      if(length(tmp)&gt;0,\n        if(length(out)==0,\n          out=[tmp];\n        ,\n          tmp1=out_(length(out));\n          if(|tmp1_1-tmp_1|&gt;Eps1,\n            out=append(out,tmp);\n          );\n        );\n        if(self==1,\n          tmp=[tmp_1,tmp_3,tmp_2,tmp_4,tmp_5];\n          out=append(out,tmp);\n        );\n      );\n    );\n  );\n  tmp2=out;\n  out=[];\n  tmp1=tmp2;\n  flg=0;\n  forall(1..(length(tmp2)),\n    if(flg==0,\n      tmp=Collectsameseg(tmp1);\n      out=append(out,tmp_1);\n      if(length(tmp_2)==0,\n        flg=1;\n      ,\n        tmp1=tmp_2;\n      );\n    );\n  );\n  forall(1..(length(out)),ii,\n    tmp1=out_ii;\n    if(length(tmp1)==1,\n      out_ii=tmp1_1;\n    ,\n      tmp=apply(tmp1,#_4);\n      dst=min(tmp);\n      tmp1=select(tmp1,#_4&lt;dst+Eps);\n      tmp=apply(tmp1,#_1);\n      tmp=sum(tmp)/length(tmp);\n      tmp2=[tmp];\n      tmp=Nearestpt(tmp2_1,crv1org);\n      tmp2=append(tmp2,tmp_2);\n      tmp=Nearestpt(tmp2_1,crv2org);\n      tmp2=append(tmp2,tmp_2);\n      tmp2=concat(tmp2,[dst,tmp1_1_5]);\n      out_ii=tmp2;\n    );\n  );\n  if(length(out)&gt;0,  //190221from\n    out=sort(out,[#_2]);\n  );  //190221to\n  out;\n);\nIntersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2):=(\n  Intersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2,10*Eps2);\n);\nIntersectpartseg(crv1org,crv2org,ii,jj,Eps1,Eps2,Dist):=(\n  regional(crv1,crv2,Eps,dst,kk,ll,seg1,seg2,snang,\n     p0,p1,p2,p3,os1,os2,out,tmp,tmp1,tmp2,flg);\n  crv1=crv1org; crv2=crv2org;\n  if(isstring(crv1),crv1=parse(crv1));\n  if(isstring(crv2),crv2=parse(crv2));\n  Eps=10^(-4);\n  out=[];\n  seg1=[crv1_ii,crv1_(ii+1)];\n  seg2=[crv2_jj,crv2_(jj+1)];\n  tmp1=seg1_2-seg1_1;\n  tmp2=seg2_2-seg2_1;\n  snang=abs(Crossprod(tmp1,tmp2))/(Norm(tmp1)*Norm(tmp2));\n  tmp=Intersectseg(seg1,seg2,Eps1);\n  dst=tmp_1;\n  if(dst&lt;Eps,\n    out=[tmp_2,ii+tmp_3,jj+tmp_4,dst,snang];\n  ,\n    if(dst&lt;Eps2,\n      if((length(crv1)==2)%(|seg1_2-seg1_1|&gt;Dist-Eps),\n        os1=seg1;\n      ,\n        p1=seg1_1; p2=seg1_2;\n        if(ii==1,\n          p3=crv1_3;\n          tmp=p2-p1;\n          tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n          p0=Reflectpoint(p3,[(p1+p2)/2,tmp]);\n        ,\n          if(ii==length(crv1)-1,\n            p0=crv1_(ii-1);\n            tmp=p2-p1;\n            tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n            p3=Reflectpoint(p0,[(p1+p2)/2,tmp]);\n          ,\n            p0=crv1_(ii-1); p3=crv1_(ii+2);\n          );\n        );\n        os1=Osplineseg([p0,p1,p2,p3]);\n      );\n      if((length(crv2)==2)%(|seg2_2-seg2_1|&gt;Dist-Eps), //18.01.05\n        os2=seg2;\n      ,\n        p1=seg2_1; p2=seg2_2;\n        if(jj==1,\n          p3=crv2_3;\n          tmp=p2-p1;\n          tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n          p0=Reflectpoint(p3,[(p1+p2)/2,tmp]);\n        ,\n          if(jj==length(crv2)-1,\n            p0=crv2_(jj-1);\n            tmp=p2-p1;\n            tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n            p3=Reflectpoint(p0,[(p1+p2)/2,tmp]);\n          ,\n            p0=crv2_(jj-1); p3=crv2_(jj+2);\n          );\n        );\n        os2=Osplineseg([p0,p1,p2,p3]);\n      );\n      tmp2=[];\n      forall(1..(length(os1)-1),kk,\n        forall(1..(length(os2)-1),ll,\n          seg1=[os1_kk,os1_(kk+1)];\n          seg2=[os2_ll,os2_(ll+1)];\n          tmp=Intersectseg(seg1,seg2,Eps1);\n          if((tmp_1&lt;Eps1)&amp;(length(tmp)&gt;1), //18.02.06\n            if(tmp_1&lt;dst+Eps,\n              dst=tmp_1;\n              tmp2=select(tmp2,#_1&lt;dst);\n              tmp2=append(tmp2,[dst,tmp_2]);\n            );\n          );\n        );\n      );\n      if(length(tmp2)&gt;0,\n        tmp=apply(tmp2,#_2_1);\n        tmp1=[sum(tmp)/length(tmp2)];\n        tmp=apply(tmp2,#_2_2);\n        tmp1=append(tmp1,sum(tmp)/length(tmp2));\n        out=[tmp1];\n        p1=crv1_ii; p2=crv1_(ii+1);\n        tmp=[Op(2,p2-p1),-Op(1,p2-p1)];\n        tmp=Intersectline(out_1,tmp,p1,p2-p1);\n        tmp=min([max([tmp_3,0]),1]);\n        out=[tmp1,ii+tmp];\n        p1=crv2_jj; p2=crv2_(jj+1);\n        tmp=[Op(2,p2-p1),-Op(1,p2-p1)];\n        tmp=Intersectline(out_1,tmp,p1,p2-p1);\n        tmp=min([max([tmp_3,0]),1]);\n        out=concat(out,[jj+tmp,dst,snang]);\n      );\n    );\n  );\n  out;\n);\nReflectpoint(point,symL):=(\n  regional(X1,X2,Y1,Y2,Us,Vs,Pt1,Pt2,Cx,Cy,flg,tmp);\n  tmp=Lcrd(point);\n  X1=tmp_1; Y1=tmp_2;\n  if(!islist(symL), //210104from\n    Pt1=Lcrd(symL);\n    Pt2=Pt1;\n  ,\n    if(length(symL)==1,\n      Pt1=Lcrd(symL_1);\n      Pt2=Pt1;\n    ,\n      if(isreal(symL_1),\n        Pt1=Lcrd(symL);\n        Pt2=Pt1;\n      ,\n        Pt1=Lcrd(symL_1);\n        Pt2=Lcrd(symL_2);\n      );\n    );\n  ); //210104to\n  Us=Pt2_1-Pt1_1;\n  Vs=Pt2_2-Pt1_2;\n  if(Pt1==Pt2,\n    X2=2*Pt1_1-X1;\n    Y2=2*Pt1_2-Y1;\n  ,\n    X2=(Us^2-Vs^2)/(Us^2+Vs^2)*X1+2*Us*Vs/(Us^2+Vs^2)*Y1\n              -2*Vs*(Us*Pt1_2-Vs*Pt1_1)/(Us^2+Vs^2);\n    Y2=2*Us*Vs/(Us^2+Vs^2)*X1-(Us^2-Vs^2)/(Us^2+Vs^2)*Y1\n              +2*Us*(Us*Pt1_2-Vs*Pt1_1)/(Us^2+Vs^2);\n  );\n  [X2,Y2];\n);\nOsplineseg(list):=Osplineseg(list,[]);\nOsplineseg(ptlist,optionsorg):=(\n  regional(tmp,tmp1,tmp2,list,ptL,ctrL,Eps,Eps0,\n      p0,p1,p2,p3,pQ,pR,cc,p01,p02,p11,p12,p21,p22,p31,p32,out);\n  Eps=10^(-2);\n  Eps0=10^(-6);\n  if(isstring(ptlist),list=parse(ptlist),list=ptlist);\n  p0=list_1; p1=list_2; p2=list_3; p3=list_4;\n  tmp=1+sqrt((1+Dotprod(p2-p0,p3-p1)/|p2-p0|/|p3-p1|)/2);\n  cc=4*|p2-p1|/3/(|p2-p0|+|p3-p1|)/tmp;\n  pQ=p1+cc*(p2-p0); // 15.09.21  // 16.08.16\n  pR=p2+cc*(p1-p3);  // 16.08.16\n  ctrL=[pQ,pR];\n  options=optionorg;\n  options=concat(options,[\"Num=20\",\"nodata\"]);\n  out=Bezier(\"\",[p1,p2],ctrL,options);\n  out;\n);\nBezier(ptctrlist):=Beziercurve(ptctrlist_3,ptctrlist_1,ptctrlist_2,[]);\nBezier(Arg1,Arg2):=( //190202from\n  regional(nm,ptctrlist,options);\n  if(islist(Arg1),\n    ptctrlist=Arg1; options=Arg2;\n    Beziercurve(ptctrlist_3,ptctrlist_1,ptctrlist_2,options);\n  ,\n    nm=Arg1; ptctrlist=Arg2;\n    Beziercurve(nm,ptctrlist_1,ptctrlist_2,[]);\n  );\n); //190202to\nBezier(nm,ptlist,ctrlist):=Beziercurve(nm,ptlist,ctrlist,[]);\nBezier(nm,ptlist,ctrlist,options):=Beziercurve(nm,ptlist,ctrlist,options);\nBeziercurve(nm,ptlist,ctrlist):=Beziercurve(nm,ptlist,ctrlist,[]);\nBeziercurve(nm,ptlistorg,ctrlistorg,options):=(\n  regional(name,Ltype,Noflg,opstr,opcindy,Num,msgflg,\n    ptlist,ctrlist,tmp,tmp1,tmp2,ii,st,out,list,color,color4);\n  name=\"bz\"+nm;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  Num=10;\n  msgflg=\"Y\";\n  tmp1=tmp_5;\n  forall(tmp1,     // 14.12.31\n    if(substring(#,0,1)==\"N\",\n      tmp2=indexof(#,\"=\");\n      Num=parse(substring(#,tmp2,length(#)));\n      opstr=opstr+\",\"+Dq+#+Dq;\n    );\n    if(substring(#,0,1)==\"M\",\n      tmp2=indexof(#,\"=\");\n      msgflg=Toupper(substring(#,tmp2,tmp2+1));\n    );  );\n  ptlist=apply(ptlistorg,Lcrd(#)); // 16.08.16\n  ctrlist=[];  // 14.12.31\n  if(length(ctrlistorg)==length(ptlist)-1,\n    forall(1..(length(ctrlistorg)),ii, //190202\n      tmp1=apply(ctrlistorg_ii,Lcrd(#));  //190202\n      if(Measuredepth(tmp1)==0,tmp=[tmp1],tmp=tmp1);\n      ctrlist=append(ctrlist,tmp);\n    );\n  ,\n    forall(1..(length(ptlist)-1),ii,\n      tmp=ctrlistorg_((2*ii-1)..(2*ii));\n      tmp=apply(tmp,Lcrd(#)); // 16.08.16\n      ctrlist=append(ctrlist,tmp);\n    );\n  );\n  if(!islist(Num),\n    Num=apply(ctrlist,Num);\n  );\n  list=[];\n  forall(1..(length(ptlist)-1),ii,\n    tmp1=ptlist_(ii..(ii+1));\n    tmp2=ctrlist_ii;\n    if(ii==1,st=0,st=1);\n    forall(st..Num_ii,\n      tmp=Bezierpt(#/Num_ii,tmp1,tmp2);\n      list=append(list,tmp);\n    );\n  );\n  if(Noflg&lt;3,\n    if(msgflg==\"Y\",println(\"generate Bezier \"+name));\n    out=apply(list,Pcrd(#));\n    tmp=name+\"=\"+Textformat(out,10)+\";\"; //190415\n    parse(tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  BezierCtrL=ctrlist; //181001\n  list;\n);\nBezierpt(t,ptlist,ctrlist):=(\n  regional(flg3,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9);\n  p0=ptlist_1;\n  p3=ptlist_2;\n  p1=ctrlist_1;\n  if(length(ctrlist)==1,\n    p2=p3;\n    flg3=0;\n  ,\n    p2=ctrlist_2;\n    flg3=1;\n  );\n  if(length(p0)&lt;3,  // 15.02.08\n    p0=Lcrd(p0);\n    p3=Lcrd(p3);\n    p1=Lcrd(p1);\n    p2=Lcrd(p2);\n  );\n  p4=(1-t)*p0+t*p1;\n  p5=(1-t)*p1+t*p2;\n  p6=(1-t)*p2+t*p3;\n  p7=(1-t)*p4+t*p5;\n  p8=(1-t)*p5+t*p6;\n  p9=(1-t)*p7+t*p8;\n  if(flg3==0,p7,p9);\n);\nIntersectseg(seg1,seg2):=Intersectseg(seg1,seg2,0.01);\nIntersectseg(seg1org,seg2org,Eps1):=(\n  regional(Eps,seg1,seg2,p1,p2,q1,q2,t,s,pt,n,pts,out,dist,\n    tmp,tmp1,tmp2,tmp3);\n  Eps=10^(-4);\n  seg1=seg1org;\n  seg2=seg2org;\n  if(isstring(seg1),seg1=parse(seg1));\n  if(isstring(seg2),seg2=parse(seg2));\n  out=[];\n  p1=seg1_1; q1=seg1_2;\n  p2=seg2_1; q2=seg2_2;\n   if((|q1-p1|&lt;Eps)%(|q2-p2|&lt;Eps),\n    out=[-1];\n  ,\n    tmp=Intersectline(p1,q1-p1,p2,q2-p2);\n    if((islist(tmp))&amp;(length(tmp)==3),\n      pt=tmp_1; t=tmp_2; s=tmp_3;\n      if((t*(t-1)&lt;Eps)&amp;(s*(s-1)&lt;Eps),\n        out=[0,pt,t,s];\n      ,\n        t=min([max([t,0]),1]);\n        s=min([max([s,0]),1]);\n        tmp3=[|p1-p2|,|p1-q2|,|q1-p2|,|q1-q2|]; //18.01.30from\n        tmp1=[Op(2,q2-p2),-Op(1,q2-p2)];\n        tmp=Intersectline(p1,tmp1,p2,q2-p2);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-p1|);\n          );\n        );\n        tmp=Intersectline(q1,tmp1,p2,q2-p2);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-q1|);\n          );\n        );\n        tmp1=[Op(2,q1-p1),-Op(1,q1-p1)];\n        tmp=Intersectline(p2,tmp1,p1,q1-p1);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-p2|);\n          );\n        );\n        tmp=Intersectline(q2,tmp1,p1,q1-p1);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-q2|);\n          );\n        );\n        out=[min(tmp3),pt,t,s]; //18.01.30until\n      );\n    ,\n      dist=tmp_1;\n      tmp1=q1-p1;      \n      n=[tmp1_2,-tmp1_1]/|tmp1|;\n      pts=[];\n      tmp=Intersectline(p1,n,p2,q2-p2);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p2+tmp_3*q2;\n        pts=append(pts,[tmp1,0,tmp_3]);\n      );\n      tmp=Intersectline(q1,n,p2,q2-p2);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p2+tmp_3*q2;\n        pts=append(pts,[tmp1,1,tmp_3]);\n      );\n      tmp=Intersectline(p2,n,p1,q1-p1);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p1+tmp_3*q1;\n        pts=append(pts,[tmp1,tmp_3,0]);\n      );\n      tmp=Intersectline(q2,n,p1,q1-p1);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p1+tmp_3*q1;\n        pts=append(pts,[tmp1,tmp_3,2]);\n      );\n      if(length(pts)==0,\n        tmp1=min([|p2-p1|,|q2-p1|,|p2-q1|,|q2-q1|]);\n        out=[tmp1];\n      ,\n        if(dist&gt;Eps1,\n          out=[dist];\n        ,\n          tmp=apply(pts,#_1_1);\n          tmp1=sum(tmp)/(length(pts));\n          tmp=apply(pts,#_1_2);\n          tmp2=sum(tmp)/(length(pts));\n          tmp3=[tmp1,tmp2];\n          tmp1=seg1_2-seg1_1;\n          tmp=Dotprod(tmp3-seg1_1,tmp1)/Norm(tmp1)^2;\n          if((tmp&gt;0)%(tmp&lt;1),\n            tmp=[seg1_1+tmp*tmp1,1+tmp];\n          ,\n            if(tmp&lt;0,tmp=[seg1_1,1],tmp2=[seg1_2,2]);\n          );\n          tmp1=tmp_2;\n          tmp2=seg2_2-seg2_1;\n          tmp=Dotprod(tmp3-seg2_1,tmp2)/Norm(tmp2)^2;\n          if((tmp&gt;0)%(tmp&lt;1),\n            tmp=[seg2_1+tmp*tmp2,1+tmp];\n          ,\n            if(tmp&lt;0,tmp=[seg2_1,1],tmp=[seg2_2,2]);\n          );\n          tmp2=tmp_2;\n          out=[dist,tmp3,tmp1,tmp2];\n        );\n      );\n    );\n  );\n  out;\n);\nOp(n,object):=( //  16.05.25\n  regional(out);\n  if(islist(object),\n    out=object_n;\n  ,\n    if(isstring(object),\n      out=substring(object,n-1,n);\n    );\n  );\n  out;\n);\nCollectsameseg(ptdL):=(\n  regional(Eps,gL,rL,numL,ii,jj,flg,tmp,tmp1,tmp2,tmp1md,\n       dst,kk,s1,e1,s2,e2);\n  Eps00=10^(-8);\n  if(length(ptdL)==0,\n    gL=[];rL=[];\n  ,\n    tmp1md=[ptdL_1];\n    rL=ptdL_(2..(length(ptdL)));\n    tmp1=tmp1md_1;\n    kk=floor(tmp1_2);\n    if(tmp1_2&lt;kk+Eps00,\n      s1=kk-1-Eps00; e1=s1+2+2*Eps00;\n    ,\n      s1=kk-Eps00; e1=s1+1+2*Eps00;\n    );\n    kk=floor(tmp1_3);\n    if(tmp1_3&lt;kk+Eps00,\n      s2=kk-1-Eps00; e2=s2+2+2*Eps00;\n    ,\n      s2=kk-Eps00; e2=s2+1+2*Eps00;\n    );\n    numL=[];\n    forall(1..(length(rL)),ii,\n      tmp=rL_ii;\n      tmp1=tmp_2;tmp2=tmp_3;\n      if((tmp1&gt;s1)&amp;(tmp1&lt;e1)&amp;(tmp2&gt;s2)&amp;(tmp2&lt;e2),\n        tmp1md=append(tmp1md,tmp);\n        numL=append(numL,ii);\n      );\n    );\n    gL=[];\n    tmp=apply(tmp1md,#_4);\n    dst=min(tmp);\n    forall(tmp1md,\n      if(#_4&lt;dst+Eps00,\n        gL=append(gL,#);\n      );\n    ); \n    rL=remove(rL,rL_(numL));\n  );\n  [gL,rL];\n);\nPointoncurve(tTorg,Gdata):=(\n  regional(tT,Out,Eps,nN,sS,Pa,Pb,PtL);\n  if(isstring(Gdata),PtL=parse(Gdata),PtL=Gdata);\n  if(length(PtL)==1,PtL=PtL_1);\n  tT=max([tTorg,1]); //18.01.04\n  tT=min([tT,length(PtL)]); //18.01.04\n  Eps=10^(-5); //18.01.04\n  nN=floor(tT+Eps);\n  sS=max([tT-nN,0]);\n  if(nN==length(PtL),\n    Out=PtL_nN;\n  ,\n    Pa=PtL_nN;\n    Pb=PtL_(nN+1);\n    Out=(1-sS)*Pa+sS*Pb;\n  );\n  Out;\n);\nUnscaling(pdata):=(\n  regional(Level,Out);\n  Out=[];\n  if(!islist(pdata_1),\n    Out=[pdata_1/SCALEX,pdata_2/SCALEY];\n  ,\n    forall(pdata,\n      Out=append(Out,Unscaling(#))\n    );\n  );\n  Out;\n);\nShadein(pstrorg):=( //190220\n  regional(pstr,ptL,pL,crv,nn,\n      tmp,tmp1,tmp2,pm1,pm2,p1,p2,flg);\n  if(islist(pstrorg),pstr=pstrorg_1,pstr=pstrorg);\n  crv=[];\n  Framedata([\"nodisp\"]);\n  ptL=Intersectcurvespp(pstr,frwin);\n  if(length(ptL)&gt;0,\n    pL=apply(ptL,#_2);\n    forall(1..(length(pL)),nn,\n      if(nn&lt;length(pL),\n       tmp1=pL_nn;\n       tmp2=pL_(nn+1);\n       tmp=Pointoncrv((tmp1+tmp2)/2,pstr);\n      ,\n        tmp1=pL_nn;\n        tmp2=pL_1;\n        tmp=parse(pstr);\n        if(pL_nn==length(tmp),\n          tmp=tmp_1;\n        ,\n          tmp=tmp_(length(tmp));\n        );\n      );\n      if(Inwindow(tmp),\n        tmp=Partcrv(\"\",tmp1,tmp2,pstr,[\"nodata\"]);\n      ,\n        tmp1=Pointoncrv(tmp1,pstr);\n        tmp2=Pointoncrv(tmp2,pstr);\n        pm1=Paramoncrv(tmp1,frwin);\n        pm2=Paramoncrv(tmp2,frwin);\n        if(floor(pm1)==floor(pm2),\n          tmp=Listplot(\"\",[tmp1,tmp2],[\"nodata\"]);\n        ,\n          tmp=floor(pm1);\n          p1=Pointoncrv(tmp,\"frwin\");\n          p2=Pointoncrv(mod(tmp,4)+1,\"frwin\");\n          tmp=p1-10*(p2-p1);\n          Listplot(\"frwin\",[p1,tmp],[\"nodisp\",\"Msg=n\"]);\n          tmp=Intersectcurvespp(\"sgfrwin\",pstr);\n          if(mod(length(tmp),2)==0, //190223from\n            if(pm2&lt;pm1,pm2=pm2+4); \n            tmp=[tmp1];\n            pm1=floor(pm1)+1;\n            flg=0;\n            forall(1..3,\n              if(flg==0,\n                if(pm1&lt;pm2,\n                  p1=Pointoncrv(mod(pm1-1,4)+1,\"frwin\");\n                  tmp=append(tmp,p1);\n                  pm1=pm1+1;\n                ,\n                  flg=1;\n                );\n              );\n            );\n            if(pm1-1&lt;pm2,tmp=append(tmp,tmp2));\n          ,\n            if(pm2&gt;pm1,pm2=pm2-4);\n            tmp=[tmp1];\n            pm1=floor(pm1);\n            flg=0;\n            forall(1..3,\n              if(flg==0,\n                if(pm1&gt;pm2,\n                  p1=Pointoncrv(mod(pm1-1,4)+1,\"frwin\");\n                  tmp=append(tmp,p1);\n                  pm1=pm1-1;\n                ,\n                  flg=1;\n                );\n              );\n            );\n            if(pm1+1&gt;pm2,tmp=append(tmp,tmp2));\n          ); //190223to\n        );\n      );\n      if(length(crv)==0,\n        crv=tmp;\n      ,\n        crv=Joincrvs(\"\",[crv,tmp],[\"nodata\"]);\n      );\n    );\n  ,\n    if(Inwindow(parse(pstr+\"_1\")),crv=pstr,crv=frwin);\n  );\n  crv;\n);\nFramedata():=Framedata([\"dr\"]);//16.10.29from\nFramedata(list):=(\n  regional(pA,pB);\n  if(Measuredepth(list)==0,\n    pA=LLcrd((SW+NE)/2); // 15.09.17\n    pB=LLcrd(NE);\n    Framedata(\"win\",[pA,pB],list);\n  ,\n    Framedata(list,[]);\n  );\n);//16.10.29until\nFramedata(Arg1,Arg2):=(\n  regional(name,list,options,str);\n  if(isstring(Arg1),\n    name=Arg1;\n    list=Arg2;\n    Framedata(name,list,[]);\n  ,\n    list=Arg1;\n    options=Arg2;\n    name=\"\";// 16.10.07from\n    forall(list, \n       name=name+#.name;\n    );// 16.10.07until\n    Framedata(name,list,options);\n  );\n);\nFramedata(nm,list,optionsorg):=( //190424modified\n  regional(name,options,Out,tmp,tmp1,x1,x2,y1,y2,dx,dy,\n      Ltype,Noflg,strL,cent,dx,dy,color,strL,corner);\n  name=\"fr\"+nm;\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  strL=tmp_7; //191126\n  color=tmp_(length(tmp)-2);\n  corner=0; //191126from\n  forall(strL,\n    tmp=substring(Toupper(#),0,1);\n    if(tmp==\"C\",\n      tmp=Lcrd(list_1); tmp1=Lcrd(list_2); //191227\n      cent=(tmp+tmp1)/2;\n      dx=abs(tmp1_1-tmp_1)/2;\n      dy=abs(tmp1_2-tmp_2)/2;\n      corner=1;\n      options=remove(options,[#]);\n    );\n  );\n  if(corner==0,\n    if(length(list)==2,  // 15.05.12\n      cent=Lcrd(list_1); tmp=Lcrd(list_2);\n      dx=abs(tmp_1-cent_1); dy=abs(tmp_2-cent_2);\n    ,\n      cent=Lcrd(list_1);\n      dx=list_2; dy=list_3;\n    );\n  );  //191126to\n  x1=cent_1-dx; x2=cent_1+dx;\n  y1=cent_2-dy; y2=cent_2+dy;\n  Listplot(\"-\"+name,[[x1,y1],[x2,y1],[x2,y2],[x1,y2],[x1,y1]],options);\n);\nFramedata(nm,cent,dx,dy):=Framedata(nm,[cent,dx,dy],[]);\nFramedata(nm,cent,dx,dy,options):=Framedata(nm,[cent,dx,dy],options);\nParamoncrv(pP,Gdata):=Paramoncurve(pP,Gdata);//180723\nParamoncurve(point,Gdata):=(\n  regional(Tmp,PtL,pP);\n  if(ispoint(point),pP=point.xy,pP=point);\n  if(isstring(Gdata),PtL=parse(Gdata),PtL=Gdata);\n  Tmp=Nearestpt(pP,PtL);\n  Tmp_2;\n);\nParamoncurve(pP,nN,plist):=(\n  regional(PtL,Out,Pa,Pb,vV,vW,sS);\n  if(isstring(plist),PtL=parse(plist),PtL=plist);\n  PtL=apply(PtL,LLcrd(#));//16.10.16\n  if(nN==length(PtL),\n    Out=nN;\n  ,\n    Pa=PtL_nN;\n    Pb=PtL_(nN+1);\n    vV=Pb-Pa;\n    vW=pP-Pa;\n    sS=vV*vW/|vV|^2;\n    sS=min([max([sS,0]),1]);\n    Out=nN+sS;\n  );\n  Out;\n);\nPointoncrv(tT,PtL):=Pointoncurve(tT,PtL);\nPointdata3d(name,pt3):=Pointdata3d(name,pt3,[]);//181017from\nPointdata3d(name,pt3,optionsorg):=( //181017from\n  regional(pt2,ptsub,options,tmp,label);\n  label=[];\n  options=append(optionsorg,\"Disp=n\"); //220722from\n  tmp=select(options,Toupper(substring(#,0,1))==\"L\");\n  if(length(tmp)&gt;0,\n    options=remove(options,tmp);\n    label=Strsplit(tmp_1,\",\");\n    if(length(label)==1,label=append(label,\"1\"));\n    if(length(label)==2,label=append(label,\"black\"));\n  ); //220722to\n  pt2=Parapt(pt3);//220713from\n  if(length(label)&gt;0, //220722from\n    tmp=select(options,indexof(#,\"Size=\")==0);\n    tmp=select(tmp,indexof(#,\"Color=\")==0);\n    tmp=concat(tmp,[\"Size=\"+label_2,\"Color=\"+label_3]);\n    Letter(pt2,label_1,name, tmp);\n  ); //220722to\n  Pointdata(\"-\"+name+\"2d\",pt2,options);\n  if(SUBSCR==1,\n    ptsub=Parasubpt(pt3);\n    tmp=append(options,\"nodisp\"); //220722\n    Pointdata(\"-\"+name+\"z2d\",ptsub,tmp);\n  );\n  Defvar(name+\"3d\",pt3);//220713\n);\nPointdata(nm,list):=Pointdata(nm,list,[]);\nPointdata(nm,listorg,optionsorg):=(\n  regional(list,name,opstr,opcindy,Msg,options,Ltype,\n              Noflg,eqL,color,color4,dispflg,//220715\n              size,inside,incolor,ratio,tmp,tmp1,tmp2,tmp3,\n              ngc1,ngc2,ng1,ng2,nc1,nc2);\n  if(substring(nm,0,1)==\"-\", //200510[2lines]\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"pt\"+nm;\n  );\n  options=optionsorg; //200512\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  opstr=tmp_(length(tmp)-1);\n  color=tmp_(length(tmp)-2);\n  color4=Colorrgb2cmyk(color);\n  size=\"1\";\n  dispflg=\"Y\";\n  inside=\"Y\"; //200512\n  incolor=\"\";\n  ratio=0.95; //200708,0813\n  border=\"Y\";\n  Msg=\"Y\";\n Msg=\"N\"; //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"S\",\n      size=tmp_2; //190406[2lines]\n      tmp1=parse(size);\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"D\", //181030from\n      dispflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"I\", //190628from\n      inside=tmp_2; //201027from\n      if(substring(inside,0,1)!=\"[\",\n        tmp2=indexof(tmp_2,\",\");\n        if(tmp2&gt;0,\n          ratio=parse(substring(tmp_2,tmp2,length(tmp_2)));\n          inside=substring(tmp_2,0,tmp2-1); //201027\n        ,\n          inside=tmp_2; \n        ); \n      ); //201027to\n      if(contains([\"0\",\"N\",\"NO\",\"1\",\"Y\",\"YES\"],Toupper(inside)), //200519from\n        if(contains([\"0\",\"N\",\"NO\"],Toupper(inside)),inside=\"N\",inside=\"Y\");\n      ,\n        incolor=inside;\n        inside=\"N\";\n      ); //200519to\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"M\", //190206from\n      Msg=Toupper(substring(tmp_2,0,1));\n    ); //190206to\n  );\n  if(dispflg==\"Y\", \n    if(Msg==\"Y\", //190206\n      println(\"generate pointdata \"+name);\n    );\n  ); //181030to\n  ngc1=length(GCLIST)+1; //210422[2lines\n  ng1=length(GLIST)+1;\n  nc1=length(COM2ndlist)+1;\n  if(isstring(listorg),\n    list=parse(listorg);\n  ,\n    list=listorg;\n  ); //17.10.23\n  if(!islist(list),list=[list]); //200510from\n  list=apply(list,if(ispoint(#),Lcrd(#),#));\n  if(Measuredepth(list)==0,list=[list]);\n  tmp1=Textformat(list,6);\n  if(length(list)&gt;1,tmp2=apply(list,[#]),tmp2=list); //200524\n  tmp2=Textformat(tmp2,6);\n  tmp=name+\"=\"+tmp2+\";\"; //190415\n  parse(tmp);\n  if(Noflg&lt;3,\n    tmp=RSform(tmp1,2);\n  );\n  if(Noflg&lt;2, //210602\n    tmp1=parse(size)*TenSizeInit;\n    forall(1..(length(list)),\n      tmp2=text(#)+name;\n      tmp3=[list_#,tmp1*ratio];\n      Circledata(tmp2,[list_#,tmp1*ratio],[\"nodisp\",\"Msg=n\"]);\n      if(inside==\"N\", //210602from\n        Scaledata(tmp2+\"i\",[\"cr\"+tmp2],1,1/SCALEY,//230423[2line]\n                     [\"Color=\"+color,\"Msg=n\"]);\n        if(length(incolor)&gt;0, //200519from\n          tmp=\"sc\"+tmp2+\"i\";\n          Shade([tmp],[\"Color=\"+incolor]);\n        );\n      ,\n        tmp=[tmp3_1,\"Color=\"+color,\"Msg=n\"]; //220722from\n        if(Noflg==1,tmp=prepend(\"notex\",tmp));\n        Scaledata(tmp2,[\"cr\"+tmp2],1,1/SCALEY,tmp);\n        tmp=\"sc\"+tmp2;\n        Shade([tmp],options); \n      ); //210602to\n      tmp=round(10*sqrt(parse(size))); //201027from (moved)\n      if(Noflg==0,options=[Ltype,\"Color=\"+text(color),\"Num=\"+text(tmp)]);\n      if(Noflg==1,options=[\"notex\",Ltype,\"Color=\"+text(color),\"Num=\"+text(tmp)]);\n      if(Noflg==2,options=[\"nodisp\"]);\n      options=concat(options,[tmp3_1,\"Msg=n\"]);  //201027to\n    ); \n  );\n  ngc2=length(GCLIST); //210422[5lines]\n  ng2=length(GLIST);\n  nc2=length(COM2ndlist);\n  tmp=[name,list,GCLIST_(ngc1..ngc2),\n               GLIST_(ng1..ng2),COM2ndlist_(nc1..nc2)];  \n  PointDataList=append(PointDataList,tmp);\n  list;\n);\nScaledata(nm,plist,ratioV):=(\n  regional(tmp);\n  tmp=ratioV; //180603from\n  if(!islist(tmp),tmp=[tmp,tmp]);\n  tmp=Lcrd(tmp);//180603to\n  Scaledata(nm,plist,tmp_1,tmp_2,[]);\n);\nScaledata(nm,plist,Arg1,Arg2):=(\n  regional(tmp,options);\n  if(islist(Arg2),\n    tmp=Arg1;//180603[2lines]\n    if(!islist(tmp),tmp=[tmp,tmp]);\n    tmp=Lcrd(tmp);\n    options=Arg2;\n    Scaledata(nm,plist,tmp_1,tmp_2,options);\n  ,\n    Scaledata(nm,plist,Arg1,Arg2,[]);\n  );\n);\nScaledata(nm,plist,rx,ry,optionorg):=(\n  regional(tmp,tmp1,tmp2,pdata,Theta,Pt,Cx,Cy,PdL,options,eqL,\n      opcindy,Nj,Njj,Kj,X2,Y2,Ltype,Noflg,name,color,color4,msgflg);\n  if(substring(nm,0,1)==\"-\", //210423from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"sc\"+nm;\n  ); //210423to\n  options=optionorg;\n  Pt=[0,0];\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);\n  color4=Colorrgb2cmyk(color); //200618\n  opcindy=tmp_(length(tmp));\n  tmp1=tmp_6;\n  if(length(tmp1)&gt;0,\n    Pt=Lcrd(tmp1_1);\n  );\n  msgflg=\"Y\"; //190425from\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"M\",\n      msgflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"S\", //210423from\n      options=remove(options,[#]);\n    ); //210423to\n  ); //190425to\n  pdata=plist;\n  if(isstring(pdata),pdata=[pdata]);\n  if(!isstring(pdata_1) &amp; Measuredepth(pdata)==1,\n      pdata=[pdata];\n  );\n  Cx=Pt_1; Cy=Pt_2;\n  PdL=[];\n  forall(pdata,Njj,\n    if(isstring(Njj),Kj=parse(Njj),Kj=Njj);\n    if(Measuredepth(Kj)==1,Kj=[Kj]);\n    tmp2=[];\n    forall(Kj,Nj,\n      tmp1=[];\n      forall(Nj,\n        tmp=LLcrd(#);\n        X2=Cx+rx*(tmp_1-Cx);\n        Y2=Cy+ry*(tmp_2-Cy);\n        tmp1=concat(tmp1,[[X2,Y2]]);\n      );\n      if(length(tmp1)==1, //210423from\n        Pointdata(\"-\"+name,tmp1,optionorg);\n      ,\n        tmp2=concat(tmp2,[tmp1]);\n        PdL=concat(PdL,tmp2);\n      );  //210423to\n    );\n  );\n  if(length(PdL)&gt;0,\n    if(Noflg&lt;3,\n      if(msgflg==\"Y\",\n        println(\"generate Scaledata \"+name);\n      );\n      tmp1=[];\n      forall(PdL,tmp2,\n        tmp=apply(tmp2,Pcrd(#));\n        tmp1=append(tmp1,tmp);\n      );\n      if(length(tmp1)==1,tmp1=tmp1_1);\n      tmp=name+\"=\"+Textformat(tmp1,10)+\";\"; //190415\n      parse(tmp);\n    );\n    if(Noflg&lt;3, //190818\n      if(isstring(Ltype),\n        Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n      ,\n        if(Noflg==1,Ltype=0);\n      );\n      GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n    );\n  );\n  PdL;\n);\nArrowdata(ptlist):=Arrowdataseg(ptlist);\nArrowdata(Arg1,Arg2):=Arrowdataseg(Arg1,Arg2);\nArrowdata(nm,ptlistorg,optionsorg):=(\n  Arrowdataseg(nm,ptlistorg,optionsorg);\n);\nArrowdataseg(ptlist):=Arrowdataseg(ptlist,[]); //181110from\nArrowdataseg(Arg1,Arg2):=(\n  regional(name);\n  if(isstring(Arg1),\n    Arrowdataseg(Arg1,Arg2,[]);\n  ,\n    name=\"\";\n    forall(Arg1,\n      if(ispoint(#),\n        name=name+#.name; //190505\n      );\n    );\n    Arrowdataseg(name,Arg1,Arg2);\n  );\n);  //181110from\nArrowdataseg(nm,ptlistorg,optionsorg):=(\n  regional(options,Ltype,Noflg,opstr,opcindy,eqL,reL,strL,color,size,lineflg,\n      flg,cutend,tmp,tmp1,tmp2,pA,pB,pC,angle,segpos,cut,scaley,Ev,Nv,pP,ptlist);\n  scaley=SCALEY; //190412\n  SCALEY=1; //200114\n  ptlist=[];\n  forall(ptlistorg,\n    if(ispoint(#),tmp=[#.x, #.y], tmp=[#_1,scaley*#_2]);\n    ptlist=append(ptlist,tmp);\n  );\n  pA=ptlist_1; pB=ptlist_2;\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  reL=tmp_6;\n  strL=tmp_7;\n  color=tmp_(length(tmp)-2);\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  size=0.2*YaSize*1/2.54*1000/MilliIn; \n  angle=YaAngle*pi/180;\n  segpos=YaPosition;\n  cut=YaCut;\n  if(length(reL)&gt;=1,\n    size=0.2*reL_1*1/2.54*1000/MilliIn; \n  );\n  if(length(reL)&gt;=2,\n    if(reL_2&lt;2.5,angle=reL_2*YaAngle,angle=reL_2);\n    angle=angle*pi/180;\n  );\n  if(length(reL)&gt;=3,\n    segpos=reL_3;\n  );\n  if(length(reL)&gt;=4,\n    cut=reL_4;\n  );\n  options=remove(options,reL); //191202\n  cutend=[0,0];//180719\n  lineflg=0;\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,2));\n    tmp2=tmp_2;\n    if(tmp1==\"CU\",//180719from\n      tmp2=replace(tmp2,\"[\",\"\");\n      tmp2=replace(tmp2,\"]\",\"\");\n      cutend=tokenize(tmp2,\",\");\n      if(length(cutend)==1,cutend=[cutend_1,cutend_1]);\n    );\n    if(tmp1==\"LI\",//190504from\n      tmp2=Toupper(substring(tmp2,0,1));\n      if(tmp2==\"Y\",lineflg=1);\n    );//190504to\n  );\n  tmp=pB-pA;\n  tmp=tmp/|tmp|;\n  pA=ptlist_1+tmp*cutend_1;\n  pB=ptlist_2-tmp*cutend_2;\n  pP=pA+segpos*(pB-pA);\n  Ev=-1/|pB-pA|*(pB-pA); Nv=[-Ev_2, Ev_1];\n  tmp1=pP+size*cos(angle)*Ev+size*sin(angle)*Nv;\n  tmp2=pP+size*cos(angle)*Ev-size*sin(angle)*Nv;\n  pC=pP+(1-cut)*((tmp1+tmp2)/2-pP);\n  ArrowheadNumber=ArrowheadNumber+1;\n  if(Noflg&lt;2,\n    if(lineflg==1,\n      Listplot(\"-ar\"+nm+\"h\",[tmp1,pP,tmp2],append(options,\"Msg=n\")); //210522\n    ,\n      Listplot(\"-ar\"+nm+\"h\",[tmp1,pP,tmp2,pC,tmp1],[\"dr,0.1\",\"Color=\"+color,\"Msg=n\"]); //210522\ntmp=Colorcmyk2rgb(color); // \nfillpoly(parse(\"ar\"+nm+\"h\"),color-&gt;tmp); // \n    );\n    if(lineflg==0,\n      if(segpos==1,pB=pC); //191202\n    );\n    Listplot(\"-ar\"+nm,[pA,pB],[Ltype,\"Color=\"+color,\"Msg=n\"]); \n  );\n  SCALEY=scaley; //200114\n  [LLcrd(pA),LLcrd(pB)];\n);\nIsangle():=Ptselected(TH)%Ptselected(FI); //180517\nSkeletonparadata(nm):=Skeletondatacindy(nm,Datalist3d(),Datalist3d(),[]); //211010[2lines]\nSkeletonparadata(nm,options):=Skeletondatacindy(nm,Datalist3d(),Datalist3d(),options); \nSkeletonparadata(nm,pltdata1,pltdata2):=Skeletondatacindy(nm,pltdata1,pltdata2);\nSkeletonparadata(nm,pltdata1org,pltdata2org,options):=\n    Skeletondatacindy(nm,pltdata1org,pltdata2org,options);\nDatalist3d():=(\n  regional(out,tmp,tmp2,tmp3);\n  tmp=apply(GCLIST,#_1);\n  tmp=select(tmp,indexof(#,\"2d\")&gt;0);\n  tmp2=select(tmp,indexof(#,\"sub\")==0);\n  tmp3=apply(tmp2,replace(#,\"2d\",\"3d\"));\n  out=tmp3;\n);\nSkeletondatacindy(nm,pltdata1,pltdata2):=\n     Skeletondatacindy(nm,pltdata1,pltdata2,[]);\nSkeletondatacindy(nm,pltdata1org,pltdata2org,optionsorg):=(\n  regional(Eps,Eps2,name2,name3,options,Ltype,Noflg,reL,eqL,strL,opcindy,\n     Out,ObjL,Plt3L,Rr,pltdata1,pltdata2,Plt2L,ObjL,ii,Data,wdtL,\n     Obj3,jj,Gd,PtD,size,tmp,tmp1,tmp2,tmp3,color,fileflg,\n      mkflg,fname,fdname,varL,nn,chkL,flg); //181101\n  name2=\"sk2d\"+nm;\n  name3=\"sk3d\"+nm;\n  pltdata1=[];// 16.01.31\n  forall(pltdata1org,tmp1,\n    if(isstring(tmp1),tmp=parse(tmp1),tmp=tmp1); //210319\n    tmp=apply(tmp,if(isstring(#),parse(#),#));//210620[recoverd]\n    pltdata1=append(pltdata1,tmp);\n  );\n  pltdata2=[];// 211104\n  forall(pltdata2org,tmp1,\n    if(isstring(tmp1),tmp=parse(tmp1),tmp=tmp1); //210319\n    tmp=apply(tmp,if(isstring(#),parse(#),#));//210620[recoverd]\n    pltdata2=append(pltdata2,tmp);\n  );\n  ObjL=Flattenlist(pltdata1);\n  Plt3L=Flattenlist(pltdata2);\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  reL=tmp_6; //16.02.28 \n  strL=tmp_7; //211104\n  color=tmp_(length(tmp)-2);\n  opcindy=tmp_(length(tmp));\n  Rr=0.075*1000/2.54/MilliIn;\n  size=1; //221215\n  Eps2=0.05;\n  Eps=0.001;\n  if(length(reL)&gt;0, //16.02.28 \n    options=remove(options,reL);\n    size=reL_1; //221215\n    Rr=size*Rr;\n    if(length(reL)&gt;1,Eps2=reL_2); //221215\n  );\n  mkflg=0; //221215\n  forall(strL,\n    if(contains([\"m\",\"r\",\"\"],#),\n      if(#==\"m\",mkflg=1);\n      if(#==\"r\",mkflg=-1);\n      if(#==\"\",mkflg=0);\n      options=remove(options,[#]);\n    );\n  );\n  fileflg=\"Y\";\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"F\", //190320\n      fileflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n  );\nfileflg=\"N\"; //\n  if(fileflg==\"Y\",\n    if(!isexists(Dirwork,fname), //221215[2lines]\n      mkflg=1;\n    ,\n      if(mkflg&lt;1,\n        Readoutdata(fname); //221215[4lines]\n        tmp1=|angle_1_1-THETA|+|angle_1_2-PHI|&lt;Eps;\n        tmp2=|size1_1_1-size|&lt;Eps;\n        if((tmp1)&amp;(tmp2),\n          mkflg=-1;\n          GLIST=append(GLIST,\"ReadOutData(\"+Dqq(fname)+\")\");\n          Projpara(name3,options);\n          Out=parse(name3);\n        ,\n          mkflg=1;\n        );\n      );\n    );\n  ,\n    mkflg=1;\n  );\n  tmp=apply(1..(length(Plt3L)),Projcoordcurve(Plt3L_#));\n  Plt2L=Flattenlist(tmp);\n  wdtL=[\n      \"angle\",[[THETA,PHI]],\n      \"size1\",[[size,1]],\n      \"sk\"+nm+\"obj\",ObjL,\n      \"sk\"+nm+\"plt\",Plt3L\n  ];\n  if(mkflg==1,  //221215\n    Out=[];\n    forall(1..(length(ObjL)),ii,\n      Obj3=ObjL_ii;\n      tmp=Projcoordcurve(Obj3);\n      Data=Makeskeletondata([tmp],Plt2L,Rr,Eps2);\n      forall(1..(length(Data)),jj,\n        Gd=Data_jj;\n        if(length(Gd)&gt;1,\n          tmp=apply(1..(length(Gd)-1),Norm(Ptcrv(#,Gd)-Ptcrv(#+1,Gd)));\n          tmp=max(tmp);\n          if(tmp&gt;Eps,\n            PtD=[];\n            forall(1..(length(Gd)),nn,\n              tmp=Gd_nn;\n              tmp1=Invparapt(tmp,Obj3);\n              if(length(tmp1)&gt;0,\n                PtD=append(PtD,tmp1);\n              );\n            );\n           );\n          Out=append(Out,PtD);\n        );\n      );\n    );\n    Out=select(Out,length(Projcurve(#))&gt;0); // 16.12.19\n    tmp1=apply(Out,Textformat(#,6));\n    tmp=name3+\"=\"+tmp1+\";\"; //190415\n    parse(tmp);\n    forall(1..(length(Out)), //221215[3lines]\n      Spaceline(\"-\"+name3+#,Out_#,append(options,\"Msg=n\"));\n    );\n    if(fileflg==\"Y\",\n      wdtL=concat(wdtL,[name3,parse(name3)]);\n      Writeoutdata(fname,wdtL);\n    );\n  );\n  forall(pltdata1org,\n    if(isstring(#),Changestyle3d(#,[\"nodisp\"]));\n  );\n  println(\"generate skeleton :\"+name3); //220116[removed from here]\n  if(SUBSCR==1,\n    Subgraph(name3,opcindy);\n  );\n);\nReadoutdata():=Readoutdata(Fnameout);\nReadoutdata(filename):=Readoutdata(\"\",filename);  //16.03.07\nReadoutdata(Arg1,Arg2):=( //181030from\n  if(islist(Arg2),\n    Readoutdata(\"\",Arg1,Arg2);\n  ,\n    Readoutdata(Arg1,Arg2,[]);\n  );\n); //181030to\nReadoutdata(pathorg,filenameorg,optionsorg):=(\n  regional(options,path,filename,varname,varL,ptL,pts,tmp,tmp1,tmp2,tmp3,tmp4,\n     nmbr,cmdall,cmd,outdt,goutdt,eqL,msg,Rflg);\n  options=optionsorg;\n  tmp=Divoptions(options); //181024from\n  msg=\"Y\";\n  Rflg=\"N\"; //211228\nmsg=\"N\"; //\n  eqL=tmp_5;\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=substring(tmp_1,0,1); tmp1=Toupper(tmp1);\n    tmp2=substring(tmp_2,0,1); tmp2=Toupper(tmp2);\n    if(tmp1==\"M\",\n      msg=tmp2;;\n      options=remove(options,[#]); //181030\n    );\n    if(tmp1==\"R\",\n      Rflg=tmp2; //211228\n      options=remove(options,[#]); //181030\n    );\n  ); //181024to\n  filename=filenameorg;\n  if(indexof(filename,\".\")==0,filename=filename+\".txt\");\n  path=pathorg;   //16.03.07 from\n  if(length(path)&gt;0,\n    if(indexof(path,\"\\\")&gt;0,tmp1=\"\\\",tmp1=\"/\");\n    tmp=substring(path,length(path)-1,length(path));\n    if(tmp!=tmp1,path=path+tmp1);\n    tmp=Readlines(path,filename); //200514\n  ,\n    tmp=Readlines(filename); //200514\n  );\n  cmdall=apply(tmp,replace(#,\"//\",\"\"));\n  varname=cmdall_1; \n  cmdall=cmdall_(2..length(cmdall)); \n  outdt=[];\n  varL=[varname];\n  ptL=[];\n  forall(cmdall,cmd, //200514\n    if(length(cmd)&gt;0,\n      if(cmd==\"start\" % cmd==\"end\" % substring(cmd,0,1)==\"[\",\n        if(cmd==\"start\", \n          pts=[];\n        );\n        if(cmd==\"end\",\n          ptL=append(ptL,pts);\n        );\n        if(substring(cmd,0,1)==\"[\",\n          tmp1=parse(cmd);\n          if(length(tmp1_1)==2,\n            tmp1=apply(tmp1,Pcrd(#));\n          );\n          pts=concat(pts,tmp1);\n        );\n      ,\n        if(length(ptL)&gt;0,\n          if(length(ptL)==1,\n            ptL=ptL_1;\n            tmp=apply(ptL,Textformat(#,10));\n          ,\n            tmp=\"[\";\n            forall(ptL,tmp1,\n              tmp=tmp+apply(tmp1,Textformat(#,10))+\",\";\n            );\n            tmp=substring(tmp,0,length(tmp)-1)+\"]\";\n          );\n        ,\n          tmp=\"[]\";\n        );\n        parse(varname+\"=\"+tmp+\";\"); //190415\n        outdt=append(outdt,ptL);\n        ptL=[];\n        varname=cmd;\n        varL=append(varL,varname);\n      );\n    );\n  );\n  if(length(ptL)&gt;0,\n    if(length(ptL)==1,\n      ptL=ptL_1;\n      tmp=apply(ptL,Textformat(#,10));\n    ,\n      tmp=\"[\";\n      forall(ptL,tmp1,\n        tmp=tmp+apply(tmp1,Textformat(#,10))+\",\";\n      );\n      tmp=substring(tmp,0,length(tmp)-1)+\"]\";\n    );\n  ,\n    tmp=\"[]\";\n  );\n  parse(varname+\"=\"+tmp+\";\"); //190415\n  outdt=append(outdt,ptL);\n  if(path==\"\",tmp=filename,tmp=path+filename); //16.03.07\n  GOUTLIST=append(GOUTLIST,[tmp,varL]); // 200914recoverd\n  if(length(path)&gt;0, // 16.03.09\n    setdirectory(Dirwork); // 16.03.07\n  );\n  if(msg==\"Y\", //200624from\n    print(\"readoutdata from \"+tmp+\" : \");\n    println(varL);\n  );  //200624to\n  if(Rflg==\"Y\", //200514from, //211228\n    GLIST=append(GLIST,\"Tmpout=ReadOutData(\"+Dqq(filename)+\")\");\n  ); //200514to\n  varL;\n);\nReadlines(file):=Readlines(Dirwork,file); //181126\nReadlines(path,file):=(\n  regional(tmp,out);\n  if(!isexists(path,file), //200706from\n    println(file+\" not found in \"+path);\n    out=[];//200706to\n  ,\n    out=readfile2str(path,file);\n    out=\"S\"+replace(out,\"\n\",\"\nS\");//220528from\n    out=tokenize(out,\"\n\"); //190129\n    out=apply(out,substring(#,1,length(#)));\n    tmp=out_(length(out)); //220528to\n    if(length(tmp)==0,\n      out=out_(1..(length(out)-1));\n    );\n    tmp=out; //200423[2lines]\n    out=apply(tmp,if(!isstring(#),text(#),#));\n    out;\n  );\n);\nFlattenlist(pltlist):=(\n  regional(Out,nn,Dt,ii,tmp,flg);\n  Out=[];\n  if(Measuredepth(pltlist)==1,\n    Out=[pltlist];\n  ,\n    forall(1..(length(pltlist)),nn,\n      Dt=pltlist_nn;\n      if(Measuredepth(Dt)&lt;2,\n        Out=append(Out,Dt);\n      ,\n        forall(1..(length(Dt)),ii,\n          tmp=Flattenlist(Dt_ii);\n          Out=concat(Out,tmp);\n        );\n      );\n    );\n  );\n  Out;\n);\nProjcoordcurve(Curve):=(\n  regional(SP,CP,ST,CT,Out,jj,pt,x,y,z,xz,yz,zz);\n  SP=sin(PHI); CP=cos(PHI);\n  ST=sin(THETA); CT=cos(THETA);\n  Out=[];\n  forall(1..(length(Curve)),jj,\n    pt=Curve_jj;\n    x=pt_1; y=pt_2; z=pt_3;\n    xz=-x*SP+y*CP;\n    yz=-x*CP*CT-y*SP*CT+z*ST;\n    zz=x*CP*ST+y*SP*ST+z*CT;\n    Out=append(Out,[xz,yz,zz]);\n  );\n  Out;\n);\nMakeskeletondata(Obj2L,Plt2L,R0,Eps2):=(\n  regional(Allres,Eps,Dmat,Dind,ii,Dt,nn1,nn2,Nind,Nobj,\n      Plt2,PhL,ClipL,ns,pt1,pt2,pt,pta,ptb,za,zb,z1,z2,t1,t2,te,\n\t  koc,KukanL,nn,tt,Rr,Flg,ii,jj,ptq,hh,Ku,Res,contflg,breakflg);\n  Eps=10.0^(-4);\n  Dmat=[];\n  Dind=[];\n  forall(1..(length(Plt2L)),ii,\n    Dt=Plt2L_ii;\n    nn1=length(Dmat)+1;\n    Dmat=concat(Dmat,Dt);\n    nn2=length(Dmat);\n    Dind=append(Dind,[nn1,nn2]);\n  );\n  Nind=length(Dind);\n  Allres=[];\n  forall(1..(length(Obj2L)),Nobj,\n    Plt2=Obj2L_Nobj;\n    PhL=Columnlist(Plt2,1..2);\n\tClipL=[];\n    forall(1..(length(PhL)-1),ns,\n      pt1=PhL_(ns..(ns+1));\n      forall(1..(length(Dind)),ii,\n        tmp=Dind_ii;\n        tmp=Dmat_(Dind_ii_1..Dind_ii_2);\n        pt2=Columnlist(tmp,1..2);\n        koc=Intersectcrvspp(pt1,pt2,[Eps]);\n        if(length(koc)&gt;0,\n          breakflg=0;\n          forall(1..(length(koc)),jj,\n            contflg=0;\n            if(breakflg==0,\n              pt=Op(1,Op(jj,koc));\n              tmp=Op(2,Op(jj,koc));\n              if((tmp&lt;1+Eps) &amp; (ns==1), \n                contflg=1;\n              );    \n              if(contflg==0,\n                if((tmp&gt;length(pt1)-Eps) \n                 &amp; (ns==length(PhL)-1),\n                  contflg=1;\n                );\n              );\n              if(contflg==0,\n                nn1=ns;\n                nn2=Op(3,Op(jj,koc));\n                tmp=Plt2_nn1;\n                pta=tmp_(1..2);\n                za=tmp_3;\n                tmp=Plt2_(nn1+1);\n                ptb=tmp_(1..2);\n                zb=tmp_3;\n                if(Norm(pta-ptb)&lt;Eps,\n                  contflg=1;\n                );\n              );\n              if(contflg==0,\n                t1=Norm(pta-pt)/Norm(pta-ptb);\n                z1=(1-t1)*za+t1*zb;\n                tmp=Dmat_(Dind_ii_1..Dind_ii_2);\n                tmp1=tmp_nn2;\n                pta=tmp1_(1..2);\n                za=tmp1_3;\n                tmp2=tmp_(nn2+1);\n                ptb=tmp2_(1..2);\n                zb=tmp2_3;\n                if(Norm(pta-ptb)&lt;Eps,\n                  contflg=1;\n                );\n              );\n              if(contflg==0,\n                t2=Norm(pta-pt)/Norm(pta-ptb);\n                z2=(1-t2)*za+t2*zb;\n                if(z1&lt;z2-Eps2,\n                   if(length(ClipL)==0, \n                    tmp=1;\n                  ,\n                    tmp1=column(ClipL,1);\n                    tmp1=apply(tmp1,#-pt_1);\n                    tmp2=column(ClipL,2);\n                    tmp2=apply(tmp2,#-pt_2);\n                    tmp3=apply(tmp1,#^2)+apply(tmp2,#^2);\n                    tmp=min(tmp3);         \n                  );\n                  if(tmp&gt;Eps^2,\n                    tmp1=pt1_2-pt1_1;\n                    tmp2=ptb-pta;\n                    tmp3=Dotprod(tmp1,tmp2);\n                    tmp3=tmp3/Norm(tmp1)/Norm(tmp2);\n                    tmp=1-0.5*tmp3^2;\n                    tmp1=concat(pt,[nn1,t1,R0/tmp]);\n                    ClipL=append(ClipL,tmp1);\n                  );\n                );\n              );\n            );\n          );\n        );\n      );\n    );\n    te=length(Plt2);\n    KukanL=[[1.0,te]];\n    pt1=PhL;\n    if(length(ClipL)&gt;0,\n      forall(1..(length(ClipL)),ii,\n        tmp=ClipL_ii;\n        pt=tmp_(1..2);\n        nn=tmp_3;\n        tt=nn+tmp_4;\n        Rr=tmp_5;\n        Flg=0;\n        breakflg=0;\n        forall(reverse(1..nn),jj,\n          contflg=0;\n          if(breakflg==0,\n            ptq=Pointoncurve(jj,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              contflg=1;\n            );\n            if(contflg==0,\n              Flg=jj;\n              breakflg=1;\n              contflg=1;\n            );\n          );\n        );\n        if(Flg==0,\n          t1=1;\n        ,\n          t1=Flg; t2=tt;\n          hh=t2-t1;\n          forall(1..10,\n            hh=hh*0.5;\n            ptq=Pointoncurve(t1+hh,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              t2=t2-hh;\n            ,\n              t1=t1+hh;\n            );\n          );\n        );\n        Ku=[t1];\n        Flg=0;\n        breakflg=0;\n        forall((nn+1)..te,jj,\n          contflg=0;\n          if(breakflg==0,\n            ptq=Pointoncurve(jj,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              contflg=1;\n            );\n            if(contflg==0,\n              Flg=jj;\n              breakflg=1;\n              contflg=1;\n            );\n          );\n        );\n        if(Flg==0,\n          t2=te;\n        ,\n          t1=tt; t2=Flg;\n          hh=t2-t1;\n          forall(1..10,\n            hh=hh*0.5;\n            ptq=Pointoncurve(t1+hh,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              t1=t1+hh;\n            ,\n              t2=t2-hh;\n            );\n          );\n        );\n        Ku=append(Ku,t2);\n        KukanL=Kukannozoku(Ku,KukanL);\n\t  );\n    );\n    Res=[];\n    forall(1..(length(KukanL)),ii,\n      tmp=KukanL_ii;\n      t1=tmp_1; nn1=re(floor(t1));\n      t2=tmp_2; nn2=re(floor(t2));\n     PtL=[];\n      if(t1-nn1&lt;1-Eps,\n        tmp=Pointoncurve(t1,pt1);\n        PtL=[tmp];\n      );\n      forall((nn1+1)..nn2,jj,\n        tmp=Pointoncurve(jj,pt1);\n        PtL=append(PtL,tmp);\n      );\n      if(t2-nn2&gt;Eps,\n        tmp=Pointoncurve(t2,pt1);\n        PtL=append(PtL,tmp);\n      );\n      tmp=Listplot(\"\",PtL,[\"nodata\"]);\n      Res=append(Res,tmp);\n    );\n    Allres=concat(Allres,Res);\n  );\n\n  Allres;\n);\nColumnlist(dt,list):=( // 16.09.04\n  apply(dt,#_list);\n);\nKukannozoku(Jokyo,KukanL):=(\n  regional(Res,Eps,nn,ii,t1,t2,Ku,Flg,contflg,tmp,tmp1);\n  Eps=10^(-6);\n  nn=length(KukanL);\n  t1=Jokyo_1; t2=Jokyo_2;\n  tmp=KukanL_1;\n  t1=max(t1,tmp_1);\n  tmp=KukanL_nn;\n  t2=min(t2,tmp_2);\n  Res=[];\n  Flg=0;\n  contflg=0;\n  forall(1..nn,ii,\n    if(contflg==0,\n      Ku=KukanL_ii;\n      if(Flg==0,\n        if(Ku_2&lt;t1,\n          Res=append(Res,Ku);\n        ,\n          Flg=1;\n          if(Ku_1&lt;t1-Eps, \n            tmp=[Ku_1,t1];\n            Res=append(Res,tmp);\n          );\n          if(Ku_2&gt;t2+Eps,\n            tmp=[t2,Ku_2];\n            Res=append(Res,tmp);\n          );\n        );\n      ,\n        if(Flg==1,\n          if(Ku_2&lt;t2,\n            contflg=1;\n          ,\n            if(contflg==0,\n              Flg=2;\n              if(Ku_1&lt;t2-Eps,\n                Ku=[t2,Ku_2];\n              );\n              Res=append(Res,Ku);\n            );\n          );\n        ,\n          if(contflg==0,\n            Res=append(Res,Ku);\n          );\n        );\n      );\n    );\n  );\n  Res;\n);\nInvparapt(pt,pd):=(\n  regional(tmp);\n  tmp=Invparaptpp(pt,pd);\n  if(length(tmp)&gt;0, //220213from\n    tmp_1;\n  ,\n    []\n  );  //220213to\n);\nInvparaptpp(pt,pd):=(\n  regional(Eps,fk,nfk,ph,fh,ah,bh,ak,bk,v1,v2,\n    nn,s0,t2,out,tmp,tmp1,tmp2,flg);\n  Eps=10^(-4);\n  if(isstring(pd),\n    fk=pd;\n  ,\n    fk=textformat(pd,10);\n  );\n  nfk=Numptcrv(parse(fk));\n  flg=0;\n  tmp=pt;\n  if(length(tmp)==1,\n    ph=tmp;\n    fh=pd;\n  ,\n    fh=Projpara(fk,[\"nodata\"]);\n    if(nfk&gt;2,\n      tmp1=Nearestpt(tmp,fh);\n      ph=tmp1_2;\n    ,\n      ah=Ptcrv(1,fh); bh=Ptcrv(2,fh);\n      v1=tmp-ah; v2=bh-ah;\n      tmp1=Crossprod(v1,v2);\n      if(abs(tmp1)&gt;Eps,\n        println(\"  Not on the line\");\n        out=[];\n        flg=1;\n      ,\n        ph=Dotprod(v1,v2)/|v2|^2+1;\n      );\n    );\n  );\n  if(flg==0,\n    if(nfk&gt;2,\n      nn=re(floor(ph)); //190505\n      s0=ph-nn;\n      if(ph&gt;Numptcrv(fh)-Eps,\n        out=[Ptend(fk),Numptcrv(fh)];\n        flg=1;\n      );\n    ,\n      nn=1;\n      s0=ph-1;\n    );\n  );\n  if(flg==0,\n    ak=Ptcrv(nn,fk); bk=Ptcrv(nn+1,fk);\n    ah=Ptcrv(nn,fh); bh=Ptcrv(nn+1,fh);\n    ph=(1-s0)*ah+a0*bh;\n    t2=s0;\n    pk=(1-t2)*ak+t2*bk;\n    out=[pk,nn+t2];\n  );\n  out;\n);\nWriteoutdata(filename,ptlist):=Writeoutdata(filename,ptlist,[]); //211226\nWriteoutdata(filename,ptlist,options):=(//211226\n  regional(nn,Gname,Gdata,Str,Gstr,Gj,Pt,Flg,\n      msg,tmp,tmp1,tmp2,loopend);\n  msg=\"Y\"; //211226from\n  forall(options, \n    tmp=Strsplit(#,\"=\");\n    tmp1=substring(tmp_1,0,1); tmp1=Toupper(tmp1);\n    tmp2=substring(tmp_2,0,1); tmp2=Toupper(tmp2);\n    if(tmp1==\"M\",\n      msg=tmp2;;\n      options=remove(options,[#]); //181030\n    );\n  ); //211226to\n  Flg=0;\n  if(isstring(ptlist_(length(ptlist))),\n    Flg=1;\n  );\n  SCEOUTPUT = openfile(filename);\n  if(Flg==0,\n    loopend=length(ptlist)/2;\n  ,\n    loopend=length(ptlist);\n  );\n  Gstr=\"[\";\n  forall(1..loopend,nn,\n    if(Flg==0,\n      Gname=ptlist_(2*nn-1);\n    ,\n      Gname=ptlist_nn;\n    );\n    Gstr=Gstr+Gname+\",\";\n    println(SCEOUTPUT,Gname+\"//\");\n    if(Flg==0,\n      Gdata=ptlist_(2*nn);\n    ,\n      Gdata=parse(Gname);\n    );\n    Gdata=Flattenlist(Gdata);\n    if(Measuredepth(Gdata)==1,Gdata=[Gdata]);\n    forall(Gdata,Gj,\n      println(SCEOUTPUT,\"start//\");\n      Str=\"\";\n      forall(Gj,Pt,\n        if(length(Str)&gt;0,\n          Str=Str+\",\"\n        );\n        Str=Str+\"[\"+format(Pt_1,10)+\",\";\n        Str=Str+format(Pt_2,10);\n        if(length(Pt)&lt;3,\n          Str=Str+\"]\";\n        ,\n          Str=Str+\",\"+format(Pt_3,10)+\"]\";\n        );\n        if(length(Str)&gt;80,\n          println(SCEOUTPUT,\"[\"+Str+\"]//\");\n          Str=\"\";\n        );\n      );\n      if(length(Str)&gt;0,\n        println(SCEOUTPUT,\"[\"+Str+\"]//\");\n      );\n      if((nn==loopend) &amp; (Gj==Gdata_(length(Gdata))),  \n        println(SCEOUTPUT,\"end////\");\n      ,\n        println(SCEOUTPUT,\"end//\");\n      );\n    );\n  );\n  closefile(SCEOUTPUT);\n  Gstr=substring(Gstr,0,length(Gstr)-1)+\"]\";\n  if(Msg==\"Y\",\n    println(\"writeoutdata \"+filename+\":\"+Gstr);\n  );\n);\nChangestyle3d(nameL,style):=(\n  regional(nmL,name,tmp,tmp1,tmp2);\n  if(islist(nameL),nmL=nameL,nmL=[nameL]);\n  tmp1=[];\n  forall(nmL,name,\n    tmp=parse(name);\n    if(islist(tmp),\n      if(length(tmp)&gt;0, //211229\n        if(isstring(tmp_1),\n          tmp1=concat(tmp1,tmp);\n        ,\n          tmp1=append(tmp1,name);\n        );\n      );  //211229\n      tmp=apply(tmp1,replace(#,\"3d\",\"2d\"));\n        Changestyle(tmp,style);\n        tmp=apply(tmp,\"sub\"+#); // 15.05.24\n        Changestyle(tmp,style);\n    );\n  );\n);\nChangestyle3d(nameL,style,styleh):=( //211228from\n  regional(nmL,name,tmp,tmp1,tmp2,nm,nmh);\n  if(islist(nameL),nmL=nameL,nmL=[nameL]);\n  forall(nmL,nm,\n    tmp=indexof(nm,\"3d\");\n    nmh=substring(nm,0,tmp-1)+\"h\"+substring(nm,tmp-1,length(nm));\n    if(length(parse(nm))&gt;0,\n      Changestyle3d(nm,style);\n    );\n    tmp1=select(style,indexof(#,\"Color\")&gt;0);\n    tmp2=select(styleh,indexof(#,\"Color\")&gt;0);\n    tmp=styleh;\n    if(length(tmp)==0,tmp=[\"do\"]);\n    if(length(tmp2)==0,\n      tmp=concat(tmp,tmp1);\n    );\n    if(length(parse(nmh))&gt;0,\n      Changestyle3d(nmh,tmp);\n    );\n  );\n); //211228to\nChangestyle(nameL,styleorg):=( //210422pt\n  regional(nmL,name,style,Ltype,Noflg,color,color4,opcindy,\n      dtlist,tmp,tmp1,tmp2,tmp3);\n  style=styleorg; //191203from\n  tmp=Divoptions(style);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  if(length(color)==4,\n    color=Colorcmyk2rgb(color);\n  );\n  if(islist(nameL),nmL=nameL,nmL=[nameL]);\n  forall(nmL,name,\n    if(substring(name,0,2)==\"pt\",  //210422from\n      tmp1=select(PointDataList,name==#_1);\n      tmp1=tmp1_1;\n      PointDataList=remove(PointDataList,[tmp1]);\n      GCLIST=remove(GCLIST,tmp1_3);      \n      COM2ndlist=remove(COM2ndlist,tmp1_5);\n      tmp=replace(name,\"pt\",\"\");\n      Pointdata(tmp,tmp1_2,style); //210422to\n    ,\n      tmp=parse(name);\n      if(islist(tmp),\n        while(Measuredepth(tmp)&gt;1,\n          tmp=tmp_1;\n        );\n        if(length(tmp)==1,pttype=\"Y\",pttype=\"N\");\n        tmp=select(GCLIST,indexof(#_1,name)&gt;0);\n        GCLIST=remove(GCLIST,tmp);\n      );\n      if(Noflg&lt;3,\n        if(pttype==\"Y\",\n          tmp=select(PTSHADElist,indexof(#_1,name)&gt;0);\n          PTSHADElist=remove(PTSHADElist,tmp); \n          tmp1=apply(parse(name),#_1);\n          tmp=[\"Color=\"+text(color),\"Size=\"+ptsize,\"Inside=\"+inside];\n          Pointdata(\"-\"+name,tmp1,tmp);\n        ,\n          tmp=select(1..(length(GCLIST)),GCLIST_#_1!=parse(name));//220315from\n          GCLIST=GCLIST_(tmp);\n          if(Noflg==2,tmp1=[name,[-1,0]]);\n          if(Noflg==1,tmp1=[name,[0,1]])); //220315to\n          if(Noflg==0,\n            Ltype=Getlinestyle(text(Noflg)+Ltype,name); //200514[2Lines]\n            tmp1=[name,Ltype]; //220315\n            if(color4!=KCOLOR, //180904 \n              Texcom(\"}\");//180722\n            );\n          );\n          if(Noflg&lt;=3, //220315from\n            tmp=select(GCLIST,[#_1,#_2]==tmp1);\n            if(length(tmp)==0,\n              GCLIST=append(GCLIST,append(tmp1,opcindy));\n           ); //220315to\n        );\n      );\n    );\n  );  \n);\nWindispg():=(\n  if(ADDAXES==\"1\", //181215from\n    Drwxy();\n    ADDAXES=\"0\";\n  ); //181215to\n  Windispg(GCLIST); //190125\n);\nWindispg(gcLorg):=( //190125\n  regional(gcL,Nj,Nk,Dt,Vj,tmp,tmp1,tmp2,tmp3,tmp4,typeL,opcindy,flg);\n  gcL=gcLorg; //190125from\n  if(length(gcL)&gt;0,\n    if(!islist(gcL_1),gcL=[gcL]);\n  ); //190125to\n  gcL=select(gcL,#_2_1&gt;=0); //190818\n  gsave();\n  layer(KETPIClAYER); // 210602[spell]\n  forall(gcL,Nj,\n    flg=0;\n    if(isstring(Nj_1),\n      if(Nj_2_1&gt;4, //200716from\n        parse(Nj_1);\n        flg=1; \n      ,\n        Dt=parse(Nj_1);\n      );  //200716to\n    ,\n      Dt=Nj_1\n    );  // 11.17\n    if((flg==0)&amp;(islist(Dt))&amp;(length(Dt)&gt;0),  // 12.19,12.22,200716\n      tmp=Measuredepth(Dt);\n      if(tmp==1,Dt=[Dt]);\n      opcindy=Nj_3;\n      typeL=Nj_2; //200620from\n      if(isstring(typeL_2),tmp=tokenize(typeL_2,\",\"),tmp=[typeL_2]); //200623\n      typeL=prepend(typeL_1,tmp); //200620from\n      if(typeL_1&lt;0,typeL_1=0);\n      tmp1=typeL_1;\n      if(tmp1&lt;10,\n        forall(Dt,Nk,\n          if(length(Nk)&gt;1,\n            tmp3=\"\";\n            if(indexof(opcindy,\"color\")==0, //190122from\n              tmp=Colorcmyk2rgb(KCOLOR); //200513[2lines]\n              tmp3=tmp3+\",linecolor-&gt;\"+text(tmp);\n            );\n            tmp3=tmp3+opcindy;\n            if(tmp1==0,  //190126from\n              if(indexof(opcindy,\"size\")==0, \n                tmp3=tmp3+\",size-&gt;\"+text(typeL_2);\n              ); //190124to\n              tmp=\"connect(\"+Textformat(Nk,10)+tmp3+\");\";//190125\n              parse(tmp);\n            );\n            if((tmp1==1)%(tmp1==2),\n              if(length(typeL)&lt;4,typeL=append(typeL,1)); //\n              if(typeL_(-1)!=1,\n                tmp=\"linesize(\"+text(typeL_4)+\")\";\n                parse(tmp);\n              );\n              tmp3=\",dashtype-&gt;1\"+tmp3;\n              forall(1..(length(Nk)-1),\n                tmp=\"draw(\"+Textformat([Nk_#,Nk_(#+1)],10)+tmp3+\");\";\n                parse(tmp);\n              );\n              if(typeL_(-1)!=1,\n                tmp=\"linesize(1)\";\n                parse(tmp);\n              );  //\n            );\n            if(tmp1==3,\n              if(typeL_3!=1,\n                tmp=\"linesize(\"+text(typeL_3)+\")\";\n                parse(tmp);\n              );\n              tmp3=\",dashtype-&gt;3\"+tmp3;\n              forall(1..(length(Nk)-1),\n                tmp=\"draw(\"+Textformat([Nk_#,Nk_(#+1)],10)+tmp3+\");\";\n                parse(tmp);\n              );\n              if(typeL_3!=1,\n                tmp=\"linesize(1)\";\n                parse(tmp);\n              );\n            );\n          ,\n            if(indexof(opcindy,\"size\")==0,  //190425from\n              opcindy=opcindy+\",size-&gt;\"+text(TenSize/TenSizeInit);\n            ); //190425to\n            tmp=\"draw(\"+text(Nk_1)+opcindy+\");\"; \n            parse(tmp);\n           ); //190126to\n        );\n      );\n    );\n  );\n  forall(PTSHADElist, //200519from\n    parse(#_2);\n  ); //200519to\n\n  grestore(); \n  layer(0);\n);\nDrwxy():=(\n  regional(org,tmp,tmp1,tmp2);\n  org=GENTEN; \n  Listplot(\"-axx\",[[XMIN,org_2],[XMAX,org_2]],AXSTYLE_2);\n  Listplot(\"-axy\",[[org_1,YMIN],[org_1,YMAX]],AXSTYLE_2);\n  tmp=AXSTYLE_1;\n  if(tmp_1==\"a\",\n    Arrowhead([XMAX,org_2],[1,0],AXSTYLE_2);\n    Arrowhead([org_1,YMAX],[0,1],AXSTYLE_2);\n  );\n  Expr([XMAX,org_2],tmp_3,tmp_2,AXSTYLE_3); \n  Expr([org_1,YMAX],tmp_5,tmp_4,AXSTYLE_3); \n  Letter(org,tmp_7,tmp_6,AXSTYLE_3);\n);\nKetcindyjsfigure=0;\nKetcindyjsscale=1;\n\nKetinit();\nKetinit3d();\n\n\n;\n\n);\ncsdraw() := (\nStart3d();\nSetketcindyJS([\"Label=[]\"]);\n\nPointdata3d(\"O\",[0,0,0],[\"notex\"]);\nXyzax3data(\"\",\"x=[-5,5]\",\"y=[-5,5]\",\"z=[-5,5]\");\n\nPointdata3d(\"A\",[2,1,3],[\"Size=2\"]);\nPointdata3d(\"B\",[-1,2,1],[\"Size=2\"]);\n\nArrowdata(\"1\",[O2d_1,A2d_1]);\nArrowdata(\"2\",[O2d_1,B2d_1]);\n\nprintln(A2d);\n\nif(!Isangle(),\n gdt=[\"ax3d\",\"sl3d1\"];\n Skeletonparadata(\"1\",gdt,gdt,[1.5]);\n);\n\nWindispg();\nHelp(\"Arrowdata\");\n\n;\n\n);\n";
Palette_Cindy.cinderella_obj[2].evokeCS(Palette_Cindy.cinderella_init[2]);

Palette_Cindy.cinderella_code[3]=`Palette_Cindy.cinderella_obj[3] = CindyJS({"scripts":"cs*","use":["katex"],"defaultAppearance":{"dimDependent":0.7,"fontFamily":"sans-serif","lineSize":1,"pointSize":5,"textsize":12},"angleUnit":"°","geometry":[{"name":"Zz","type":"Free","pos":[4,1.978563556852648,0.3957127113705296],"color":[1,1,1],"labeled":false,"textsize":10,"size":2,"border":false},{"name":"NE","type":"Free","pos":[4,3.5376884422110364,0.7830327047117029],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"SW","type":"Free","pos":[4,3.2,-0.8],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"TH","type":"Free","pos":[-1.2030769487644923,-4,0.8888888888888888],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"FI","type":"Free","pos":[0.4997396556406349,-4,0.8],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"LB","type":"Free","pos":[4,3.6363636363636362,-0.7272727272727273],"color":[1,0,0],"size":0,"border":true}],"ports":[{"width":677,"height":485,"id":"CSCanvas_3","transform":[{"visibleRect":[-7.1707434963018235,6.962518639784892,12.090055731514326,-5.843310036006386]}],"grid":1,"snap":true,"background":"rgb(247,247,247)"}],"csconsole":false,"cinderella":{"build":2083,"version":[3,0,2083]}});`;
eval(Palette_Cindy.cinderella_code[3]);
Palette_Cindy.cinderella_json[3]=`{"scripts":"cs*","use":["katex"],"defaultAppearance":{"dimDependent":0.7,"fontFamily":"sans-serif","lineSize":1,"pointSize":5,"textsize":12},"angleUnit":"°","geometry":[{"name":"Zz","type":"Free","pos":[4,1.978563556852648,0.3957127113705296],"color":[1,1,1],"labeled":false,"textsize":10,"size":2,"border":false},{"name":"NE","type":"Free","pos":[4,3.5376884422110364,0.7830327047117029],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"SW","type":"Free","pos":[4,3.2,-0.8],"color":[1,1,1],"labeled":false,"size":2,"border":false},{"name":"TH","type":"Free","pos":[-1.2030769487644923,-4,0.8888888888888888],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"FI","type":"Free","pos":[0.4997396556406349,-4,0.8],"color":[1,0,0],"labeled":true,"size":3,"border":true},{"name":"LB","type":"Free","pos":[4,3.6363636363636362,-0.7272727272727273],"color":[1,0,0],"size":0,"border":true}],"ports":[{"width":677,"height":485,"id":"CSCanvas_3","transform":[{"visibleRect":[-7.1707434963018235,6.962518639784892,12.090055731514326,-5.843310036006386]}],"grid":1,"snap":true,"background":"rgb(247,247,247)"}],"csconsole":false,"cinderella":{"build":2083,"version":[3,0,2083]}}`;
Palette_Cindy.cinderella_init[3]="csinit() := (\nInvert(x):=reverse(x);\nKetinit():=Ketinit(\"fig\",0.3); //190831from\nKetinit(Arg):=(//181001from\n  if(isstring(Arg),\n    Ketinit(Arg,0.3);\n  ,\n    Ketinit(\"fig\",Arg);\n  );\n);\nKetinit(work,strictsep):=( //200509\n regional(pt,tmp,tmp1,tmp2,letterc,boxc,shadowc,mboxc);\n  PenThickInit=8;\n  ULEN=\"1cm\";\n  MEMORI=0.05;//18.01.15from\n  MEMORIInit=MEMORI;\n  MEMORINow=MEMORI;\n  MARKLEN=0.05;\n  MARKLENInit=MARKLEN; //180504\n  MARKLENNow= MARKLEN;\n  GENTEN=[0,0];//18.01.15to\n  TABLECOUNT=0; //190428\n  KETPICLAYER=20;\n  MilliIn=1/2.54*1000;\n  PenThick=round(MilliIn*0.02);\n  PenThickInit=PenThick;\n  TenSizeInit=0.02;\n  TenSize=TenSizeInit;\n  YaSize=1; YaAngle=18; YaPosition=1;\n  YaCut=0.2; //191203\n  YasenStyle=\"dr,1\"; Yajiristyle=\"tf\";\n  KETPICCOUNT=1;\n  KCOLOR=[0,0,0,1]; //200513,200618\n  GLIST=[]; //201005rechanged\n  GCLIST=[]; //201005rechanged\n  AddGraphList=[]; //210422[2lines]\n  PointDataList=[];\n  if(!islist(VLISTadd),VLIST=[],VLIST=VLISTadd); //200123\n  if(!islist(FUNLISTadd),FUNLIST=[],FUNLIST=FUNLISTadd); //200123\n  LETTERlist=[];\n  ADDAXES=\"1\";\n  AXSTYLE=[[\"l\",\"x\",\"e\",\"y\",\"n\",\"O\",\"sw\"],[],[]]; //230704\n  AXCOUNT=1; //181215\n  SHADECTR=1; //190222\n  LFmark=unicode(\"000a\"); Bs=unicode(\"005c\");\n  CRmark=unicode(\"000d\");//16.12.13\n  Dq=unicode(\"0022\");\n  Changework(Dircdy+pathsep()+work); //180329to,181001\n  ArrowlineNumber=1;  // 15.01.05\n  ArrowheadNumber=1;\n  BezierNumber=1; //15.01.03\n  SCALEX=1;\n  SCALEY=1;\n  XMIN=-5;\n  XMAX=5;\n  YMIN=-5;\n  YMAX=5;\n  StrictSep=strictsep; //190831\n  Setwindow(\"Msg=n\"); // 16.05.31\n  forall(remove(allpoints(),[SW,NE]),\n    Strictmove(#.name);\n    Ptpos(#,#.xy); //200529\n  ); //190917\n);\nSetwindow():=Setwindow(\"Msg=y\");\nSetwindow(str):=(\n  regional(tmp,tmp1,tmp2,msg);\n  msg=\"Y\";\n  tmp=indexof(str,\"=\"); // 16.02.10\n  msg=Toupper(substring(str,tmp,tmp+1));\n  Strictmove(\"SW\"); Strictmove(\"NE\");//190927\n  if((ispoint(SW)) &amp; (ispoint(NE)),\n    tmp1=LLcrd(Ptpos(SW));//190912[2lines]\n    tmp2=LLcrd(Ptpos(NE));\n    XMIN=tmp1_1; XMAX=tmp2_1;\n    YMIN=tmp1_2; YMAX=tmp2_2;\n  ,\n    if(!ispoint(SW), //191005from\n      Putpoint(\"SW\",Pcrd([-5,-5]));\n      XMIN=-5; YMIN=-5;\n      Ptpos(SW,SW.xy);\n    );\n    if(!ispoint(NE),\n      Putpoint(\"NE\", Pcrd([5,5]));\n      XMAX=5; YMAX=5;\n      Ptpos(NE,NE.xy);\n    ); //191005to\n  );\n);\nSetwindow(xrange,yrange):=Setwindow(xrange,yrange,\"Msg=y\");\nSetwindow(xrange,yrange,msg):=(\n  XMIN=xrange_1;\n  XMAX=xrange_2;\n  YMIN=yrange_1;\n  YMAX=yrange_2;\n  Ptpos(SW,Pcrd([XMIN,YMIN])); //190927from\n  Ptpos(NE,Pcrd([XMAX,YMAX]));\n  Strictmove(\"SW\"); Strictmove(\"NE\");\n);\nToupper(str):=(\n  regional(alphabet,out,tmp,tmp1);\n  alphabet=\"abcdefghijklmnopqrstuvwxyz\";\n  out=\"\";\n  forall(1..(length(str)),\n    tmp=substring(str,#-1,#);\n    tmp1=indexof(alphabet,tmp);\n    if(tmp1&gt;0,\n      out=out+unicode(text(tmp1+64),base-&gt;10);\n    ,\n      out=out+tmp;\n    );\n  );\n  out;\n);\nLLcrd(pt):=(\n  regional(tmp);\n  if(ispoint(pt),\n    tmp=pt.xy\n  ,\n    tmp=pt;\n  );\n  tmp=[tmp_1/SCALEX,tmp_2/SCALEY];\n  re(tmp); //191231\n);\nPutpoint(name,Pt):=Putpoint(name,Pt,Pt);\nPutpoint(name,Ptinit,Pt):=(\n  regional(ptstr); \n    ptstr=name+\".xy=\"+Textformat(Pcrd(Pt),10)+\";\";\n    parse(ptstr);\n    Ptpos(name,Pcrd([Pt_1,Pt_2])); //200529\n);\nTextformat(value,dig):=(\n  regional(vv,tmp,tmp1);\n  if(islist(value),\n    tmp1=\"[\";\n    forall(value,\n      tmp1=tmp1+Textformat(#,dig)+\",\";\n    );\n    if(length(tmp1)&gt;1, //18.01.29from\n      tmp1=substring(tmp1,0,length(tmp1)-1);\n    );\n    tmp1=tmp1+\"]\"; //18.01.29until\n  ,\n    if(ispoint(value) % isstring(value),\n      if(isstring(value),tmp1=Dq+value+Dq,tmp1=text(value)); // 15.10.02\n    ,\n      tmp1=format(value,dig);\n    );\n  );\n  tmp1;\n);\nPtpos(pt):=Ptpos(pt,[]);\nPtpos(ptorg,pos):=(\n  regional(pt,out,tmp);\n  if(ispoint(ptorg),pt=ptorg,pt=parse(ptorg));\n  if(length(pos)==0,\n    tmp=pt.name+\"position\";\n    out=parse(tmp);\n    if(!islist(out),\n      tmp=tmp+\"=\"+Textformat(pt.xy,12)+\";\";  //200108 6-&gt;12\n      parse(tmp);\n    );\n  ,\n    pt.xy=pos;\n    tmp=pt.name+\"position=\"+Textformat(pt.xy,12)+\";\"; //200108 6-&gt;12\n    parse(tmp);\n    out=pt.xy;\n  );\n  out;\n);\nPcrd(pt):=(\n  regional(tmp);\n  if(ispoint(pt),\n    tmp=pt.xy;\n  ,\n    tmp=[pt_1*SCALEX,pt_2*SCALEY];\n  );\n re(tmp); //191231\n);\nStrictmove(pC):=Strictmove(pC,StrictSep); //190831\nStrictmove(pCorg,sep):=(\n  regional(pC,tmp,tmp1,tmp2);\n  pC=pCorg;\n  if(ispoint(pC),pC=pC.name);\n  tmp1=pC+\"position\";\n  if(!islist(parse(tmp1)),\n    tmp=tmp1+\"=\"+Textformat(parse(pC).xy,12)+\";\"; //200112\n    parse(tmp);\n  ,\n   tmp=parse(pC).xy;\n    tmp2=mouse().xy;\n    if(|tmp-tmp2|&gt;sep,\n      tmp=pC+\".xy=\"+pC+\"position\";\n      parse(pC).xy=parse(pC+\"position\");\n    ,\n      tmp=tmp1+\"=\"+Textformat(parse(pC).xy,12)+\";\"; //200112\n      parse(tmp);\n    );\n  );\n);\nKetinit3d():=Ketinit3d(1);\nKetinit3d(subflg):=(\n  regional(ctr,tmp,tmp1,tmp2,tmp3,tmp4);\n SUBSCR=0; // \n  Setwindow(\"Msg=no\");\n  Addax(0);\n  TSIZE=10;\n  TSIZEZ=10;\n  ErrFlg=0;\n  xPos=-5; yTh=tmp-0.5; yPh=tmp-1;\n  THETA=(TH.x-xPos)*20*pi/180;\n  PHI=(FI.x-xPos)*40*pi/180; //190713to\n  Skeleton=1; //210324\n);\nAddax(param):=(\n  ADDAXES=text(param);\n);\nStart3d():=Start3d([],[]); \nStart3d(Arg):=( //190503from\n  regional(tmp);\n  tmp=select(Arg,isstring(#)); //190822\n  tmp=select(tmp,indexof(#,\"=\")&gt;0);\n  if(length(tmp)==0,\n    Start3d(Arg,[]);\n  ,\n    Start3d([],Arg);\n  );\n);\nStart3d(ptexception,optionjs):=(//190503to\n  regional(xPos,yTh,yPh,xmn,xMx,ymn,yMx,pt,pt3,pt2,theta,phi,\n    Eps,tmp,tmp1,tmp2,tmp3,tmp4);\n  PTEXCEPTION=[\"LB\"];\n  SLIDEFLG=\"Y\";\n  forall(optionjs,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"S\",\n      SLIDEFLG=Toupper(substring(tmp_2,0,1));\n    );\n    if(tmp1==\"R\",\n      tmp2=tmp_2;\n      if(substring(tmp2,0,1)==\"[\",tmp2=substring(tmp2,1,length(tmp2)-1));\n      tmp2=tokenize(tmp2,\",\");\n      REMOVEPTJS=concat(REMOVEPTJS,tmp2);\n    );\n  );\n  GCLIST=[];\n  SEG3dlist=[];\n  KETJSOP=[]; //190129\n  REMOVEPTJS=[]; SLIDEFLG=\"Y\"; //190504\n  KetcindyjsDataList=[]; //190511\n  ArrowlineNumber=1;  // 16.01.31\n  ArrowheadNumber=1;\n  BezierNumber=1; //16.01.31\n  BezierNumber3=1; //16.08.19\n  Setwindow(\"Msg=no\"); // 16.06.20from\n  tmp=round(4*SW.y)/4;\n  xPos=-5; yTh=tmp-0.5; yPh=tmp-1; //220126\n  Putpoint(\"LB\",[xPos-0.5,yPh]); //220215[2lines]\n  inspect(LB,\"ptsize\",0);\n  inspect(LB,\"labeled\",false);\n  if(SLIDEFLG==\"Y\", // \n    Slider(\"TH\",[xPos,yTh],[xPos+9,yTh],[\"Color=green\"]); //190209\n    Slider(\"FI\",[xPos,yPh],[xPos+9,yPh],[\"Color=green\"]); //190209\n    THETA=(TH.x-xPos)*20*pi/180;\n    PHI=(FI.x-xPos)*40*pi/180; // 16.06.20until\n    drawtext([xPos-0.8,yTh-0.1],Sprintf(THETA*180/pi,2),align-&gt;\"right\");\n    drawtext([xPos-0.8,yPh-0.1],Sprintf(PHI*180/pi,2),align-&gt;\"right\");  //220208to\n  ); // \n  if(Ptselected(TH) % Ptselected(FI), //190505\n    if(length(Ch)&gt;0,\n      ChNum=Ch_(length(Ch));\n      if(ChNum==0, ChNum=1);\n    ,\n      ChNum=1;\n    );\n    Ch=[0];\n  );\n  tmp=ptexception; //181106\n  if(!islist(tmp),tmp=[tmp]);  //190209\n  PTEXCEPTION=concat(PTEXCEPTION,tmp); //190209 \n  Ptseg3data(PTEXCEPTION);//16.08.23\n  FuncListC=[]; //220126[2lines]\n  SurfList=[];\n  LenAddSurf=0; //220202\n);\nStrsplit(strorg,key):=( // 210422 renewed\n  regional(str,ctr,tmp,tmp1,out);\n  str=strorg+key; \n  out=[];\n  tmp=indexof(str,key);\n  while(tmp&gt;0,\n    tmp1=substring(str,0,tmp-1);\n    out=append(out,tmp1);\n    str=substring(str,tmp-1+length(key),length(str));\n    tmp=indexof(str,key);\n  );\n  out;\n);\nSlider(ptstr,p1,p2):=Slider(ptstr,p1,p2,[]);\nSlider(ptstr,p1,p2,optionsorg):=(//220903\n  regional(pA,pB,pC,options,color,thick,sep,\n        tmp,tmp1,tmp2);\n  options=optionsorg;\n  color=\"Color=0.6*[0,0,1]\"; //190120from\n  thick=\"size-&gt;2\";\n  sep=0.3; //190824\n  forall(options,\n    tmp=Toupper(substring(#,0,1));\n    if(tmp==\"C\",\n      color=#;\n      options=remove(options,[tmp]);//220903\n    );\n    if(tmp==\"T\",\n      tmp=Strsplit(#,\"=\");\n      thick=\"size-&gt;\"+tmp_2;\n      options=remove(options,[tmp]);//220903\n    );\n    if(tmp==\"S\",//190824from\n      tmp=Strsplit(#,\"=\");\n      sep=parse(tmp_2);\n      options=remove(options,[tmp]);//220903\n    ); //190824to\n  );\n  tmp=Indexall(ptstr,\"-\");\n  if(length(tmp)&gt;0,\n    pA=substring(ptstr,0,tmp_1-1); //190824from\n    pC=substring(ptstr,tmp_1,tmp_2-1);\n    pB=substring(ptstr,tmp_2,length(ptstr));\n    parse(pA).xy=p1;\n    parse(pB).xy=p2; //190824to\n    tmp1=pC+\"position\"; //190827from\n    if(!islist(parse(tmp1)),\n      tmp2=parse(pC).xy;\n      if(|tmp2-p1|&lt;0.1,tmp2=p1+0.1*(p2-p1)/|p2-p1|);\n      if(|tmp2-p2|&lt;0.1,tmp2=p2+0.1*(p1-p2)/|p1-p2|);\n      tmp=tmp1+\"=\"+textformat(tmp2,10)+\";\";\n      parse(tmp);\n      parse(pC).xy=tmp2;\n    ); //190827to\n    PTEXCEPTION=concat(TEXCEPTION,[pA,pC,pB]);\n  ,\n    pC=ptstr; pA=pC+\"l\"; pB=pC+\"r\"; \n    PTEXCEPTION=concat(PTEXCEPTION,[pC]);\n  );\n  options=concat(options,[\"Msg=n\",color,thick]); //220903[2lines]\n  if(!contains(options,\"nodisp\"),options=append(options,\"notex\"));\n  Listplot(pA+pB,[p1,p2],options);\n  Putonseg(pC,parse(\"sg\"+pA+pB));\n);\nIndexall(str,key):=(\n  regional(rest,out,flg,tmp,tmp1,);\n  out=[];\n  rest=str;\n  flg=0;\n  forall(1..(length(str)),\n    if(flg==0,\n      tmp=indexof(rest,key);\n      if(tmp&gt;0,\n        tmp1=tmp+length(str)-length(rest);\n        out=append(out,tmp1);\n        rest=substring(rest,tmp,length(rest));\n      ,\n        flg=1;\n      );\n    );\n  );\n  out;\n);\nListplot(list):=Listplot(list,[]);\nListplot(Arg1,Arg2):=(\n  regional(name,list,options,str);\n  if(isstring(Arg1),\n    name=Arg1;\n    list=Arg2;\n    Listplot(name,list,[]);\n  ,\n    list=Arg1;\n    options=Arg2;\n    name=\"\";\n    forall(list, // 16.10.07from\n       name=name+#.name;\n    );// 16.10.07until\n    Listplot(name,list,options);\n  );\n);\nListplot(nm,list,options):=(\n  regional(name,cutend,tmp,tmp1,tmp2,ptlist,Ltype,opcindy,Noflg,eqL,Msg,color,color4);\n  if(substring(nm,0,1)==\"-\",  // 16.01.27 from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"sg\"+nm;\n  ); // upto\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opcindy=tmp_(length(tmp));\n  Msg=\"Y\";  //190206\n Msg=\"N\"; //\n  cutend=[0,0];//180719\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"M\",\n      Msg=Toupper(substring(tmp_2,0,1));\n    );\n    if(tmp1==\"C\",//180719from\n      tmp2=replace(tmp_2,\"[\",\"\");\n      tmp2=replace(tmp2,\"]\",\"\");\n      cutend=tokenize(tmp2,\",\");\n      if(length(cutend)==1,cutend=[cutend_1,cutend_1]);     \n    );//180719to\n  );\n  if(Noflg&lt;3,\n    if(Msg==\"Y\", //190206\n      println(\"generate Listplot \"+name);\n    );\n    if(isstring(list_1),tmp=apply(list,parse(#)),tmp=list); // 15.03.24\n    ptlist=apply(tmp,Pcrd(#));\n    if(|cutend|&gt;0,//180719from\n      tmp=ptlist_(length(ptlist))-ptlist_1;\n      tmp=tmp/|tmp|;\n      ptlist_1=ptlist_1+tmp*cutend_1;\n      ptlist_(length(ptlist))=ptlist_(length(ptlist))-tmp*cutend_2;\n    );//180719to\n    tmp=name+\"=\"+Textformat(ptlist,5)+\";\"; //190415\n    parse(tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  tmp1=apply(list,Lcrd(#));\n  tmp1;\n);\nDivoptions(options):=(\n  regional(Ltype,Noflg,Inflg,Outflg,eqL,realL,strL,\n      color,opstr,opcindy,flg,tmp,tmp1,tmp2);\n  Ltype=\"dr\";  // 2015.01.13\n  Noflg=0;\n  Inflg=0;\n  Outflg=0;\n  eqL=[];\n  realL=[];\n  strL=[];\n  color=Colorcmyk2rgb(KCOLOR); //200513\n  opstr=\"\";\n  opcindy=\"\";\n  forall(options,\n    flg=0;\n    if(flg==0,\n      if(isreal(#) % ispoint(#) % islist(#),\n        realL=append(realL,#);\n        opstr=opstr+\",\"+text(#);\n        flg=1;\n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"=\")&gt;0,\n        tmp=Strsplit(#,\"=\"); //180602from\n        tmp1=Toupper(tmp_1);\n        tmp2=tmp_2;\n        if(tmp1==\"COLOR\",\n          if(indexof(tmp2,\"[\")&gt;0, //180928\n            tmp1=parse(tmp2);\n            color=tmp1;\n            if(length(tmp1)==4,\n              tmp1=Colorcmyk2rgb(tmp1);\n            );\n          ,\n            color=Colorname2cmyk(tmp2);//200425\n            tmp1=Colorcmyk2rgb(color); ;//200425\n          );\n          tmp=\"color-&gt;\"+text(tmp1);\n          opcindy=opcindy+\",\"+tmp;\n        ,\n          eqL=append(eqL,#);\n        );//180602to\n        flg=1; \n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"no\")+indexof(#,\"No\")&gt;0,\n        if(indexof(#,\"tex\")&gt;0,Noflg=1);\n        if(indexof(#,\"disp\")&gt;0,Noflg=2);\n        if(indexof(#,\"data\")&gt;0,Noflg=3);\n        flg=1;\n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"-&gt;\")&gt;0,\n        opcindy=opcindy+\",\"+#;\n        flg=1; \n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"out\")+indexof(#,\"Out\")&gt;0,\n        if(indexof(#,\"-\")==0,\n          Outflg=1;\n        ,\n          Outflg=2;\n        );\n        flg=1;\n      );\n    );\n    if(flg==0,\n      if(indexof(#,\"in\")+indexof(#,\"In\")&gt;0,\n        if(indexof(#,\"-\")==0,\n          Inflg=1;\n        ,\n          Inflg=2;\n        );\n        flg=1;\n      );\n    );\n    if(flg==0,\n      tmp=substring(#,0,2);\n      tmp1=indexof(tmp,\"dr\")+indexof(tmp,\"Dr\");\n      tmp1=tmp1+indexof(tmp,\"da\")+indexof(tmp,\"Da\");\n      tmp1=tmp1+indexof(tmp,\"id\")+indexof(tmp,\"Id\");\n      tmp1=tmp1+indexof(tmp,\"do\")+indexof(tmp,\"Do\");\n      tmp1=tmp1+indexof(tmp,\"dp\")+indexof(tmp,\"Dp\");\n      if(tmp1&gt;0,\n        Ltype=#;\n        flg=1;\n      );\n      if(flg==0,\n        if(length(#)&gt;0, //180408\n          strL=append(strL,#);\n          opstr=opstr+\",\"+Dq+#+Dq;\n        );\n      );\n    );\n  );\n  if(indexof(opcindy,\"color-&gt;\")==0,// 16.10.07from\n    tmp=Colorcmyk2rgb(KCOLOR); //200513[2lines]\n    opcindy=opcindy+\",color-&gt;\"+text(tmp);\n  );\n  [Ltype,Noflg,Inflg,Outflg,eqL,realL,strL,color,opstr,opcindy];\n);\nColorname2cmyk(name):=( //181212\n  regional(dL,code,tmp);\n  dL=[\n    [\"greenyellow\",[0.15,0,0.69,0]],[\"yellow\",[0,0,1,0]],\n    [\"goldenrod\",[0,0.1,0.84,0]],[\"dandelion\",[0,0.29,0.84,0]],\n    [\"apricot\",[0,0.32,0.52,0]],[\"peach\",[0,0.5,0.7,0]],\n    [\"melon\",[0,0.46,0.5,0]],[\"yelloworange\",[0,0.42,1,0]],\n    [\"orange\",[0,0.61,0.87,0]],[\"burntorange\",[0,0.51,1,0]],\n    [\"bittersweet\",[0,0.75,1,0.24]],[\"redorange\",[0,0.77,0.87,0]],\n    [\"mahogany\",[0,0.85,0.87,0.35]],[\"maroon\",[0,0.87,0.68,0.32]],\n    [\"brickred\",[0,0.89,0.94,0.28]],[\"red\",[0,1,1,0]],\n    [\"orangered\",[0,1,0.5,0]],[\"rubinered\",[0,1,0.13,0]],\n    [\"wildstrawberry\",[0,0.96,0.39,0]],[\"salmon\",[0,0.53,0.38,0]],\n    [\"carnationpink\",[0,0.63,0,0]],[\"magenta\",[0,1,0,0]],\n    [\"violetred\",[0,0.81,0,0]],[\"rhodamine\",[0,0.82,0,0]],\n    [\"mulberry\",[0.34,0.9,0,0.02]],[\"redviolet\",[0.07,0.9,0,0.34]],\n    [\"fuchsia\",[0.47,0.91,0,0.08]],[\"lavender\",[0,0.48,0,0]],\n    [\"thistle\",[0.12,0.59,0,0]],[\"orchid\",[0.32,0.64,0,0]],\n    [\"darkorchid\",[0.4,0.8,0.2,0]],[\"purple\",[0.45,0.86,0,0]],\n    [\"plum\",[0.5,1,0,0]],[\"violet\",[0.79,0.88,0,0]],\n    [\"royalpurple\",[0.75,0.9,0,0]],[\"blueviolet\",[0.86,0.91,0,0.04]],\n    [\"periwinkle\",[0.57,0.55,0,0]], [\"cadetblue\",[0.62,0.57,0.23,0]],\n    [\"cornflowerblue\",[0.65,0.13,0,0]],\n    [\"midnightblue\",[0.98,0.13,0,0.43]],\n    [\"navyblue\",[0.94,0.54,0,0]],[\"royalblue\",[1,0.5,0,0]],\n    [\"blue\",[1,1,0,0]],[\"cerulean\",[0.94,0.11,0,0]],\n    [\"cyan\",[1,0,0,0]],[\"processblue\",[0.96,0,0,0]],\n    [\"skyblue\",[0.62,0,0.12,0]],[\"turquoise\",[0.85,0,0.2,0]],\n    [\"tealblue\",[0.86,0,0.34,0.02]],[\"aquamarine\",[0.82,0,0.3,0]],\n    [\"bluegreen\",[0.85,0,0.33,0]],[\"emerald\",[1,0,0.5,0]],\n    [\"junglegreen\",[0.99,0,0.52,0]],[\"seagreen\",[0.69,0,0.5,0]],\n    [\"green\",[1,0,1,0]],[\"forestgreen\",[0.91,0,0.88,0.12]],\n    [\"pinegreen\",[0.92,0,0.59,0.25]],[\"limegreen\",[0.5,0,1,0]],\n    [\"yellowgreen\",[0.44,0,0.74,0]],[\"springgreen\",[0.26,0,0.76,0]],\n    [\"olivegreen\",[0.64,0,0.95,0.4]],[\"rawsienna\",[0,0.72,1,0.45]],\n    [\"sepia\",[0,0.83,1,0.7]],[\"brown\",[0,0.81,1,0.6]],\n    [\"tan\",[0.14,0.42,0.56,0]],[\"gray\",[0,0,0,0.5]],\n    [\"lightgray\",[0,0,0,0.15]], //190429,0809\n    [\"cindycolor\",[0.125,0.083,0,0.247]], //201027\n    [\"black\",[0,0,0,1]],[\"white\",[0,0,0,0]],\n    [\"offwhite\",[0,0,0,0.03]] //190809\n  ];\n  tmp=select(dL,#_1==name);\n  if(length(tmp)&gt;0,\n    tmp=tmp_1;\n    code=tmp_2;\n  ,\n    println(\"    \"+name+\" not found\");\n    code=Assign(name); //190323\n  );\n);\nAssign(str):=( //190125from\n  regional(tmp);\n  tmp=[];\n  forall(VLIST,tmp=concat(tmp,[#_1,#_2]));\n  Assign(str,tmp);\n); //190125to\nAssign(funstr,vrL):=Assign(funstr,vrL,6);\nAssign(funstr,Arg1,Arg2):=( //190813from\n  regional(vrL,precise,nn,out,tmp);\n  if(islist(Arg1),\n    vrL=Arg1; precise=Arg2;\n    nn=length(vrL)/2;\n    out=funstr;\n    forall(1..nn,\n      out=Assign(out,vrL_(2*#-1),vrL_(2*#),precise);\n    );\n  , \n    out=Assign(funstr,Arg1,Arg2,6);\n  );\n  out;\n); //190813to\nAssign(funstr,varname,rep,precision):=(\n  regional(repstr,ii,jj,tmp,tmp1,tmp2,Notvar,Flg);\n  if(isstring(rep),repstr=rep,repstr=\"(\"+Textformat(rep,precise)+\")\"); //190811to\n  tmp=[46];  // 12.20\n  tmp=concat(tmp,48..57);\n  tmp=concat(tmp,65..90);\n  tmp=concat(tmp,97..122);\n  Notvar=apply(tmp,unicode(text(#),base-&gt;10));\n  tmp2=\"\";\n  forall(1..100,\n    ii=indexof(funstr,varname);\n    if(ii&gt;0,\n      Flg=0;\n      if(ii&gt;1,\n        tmp=substring(funstr,ii-2,ii-1);\n        if(contains(Notvar,tmp),\n          tmp2=tmp2+substring(funstr,0,ii);\n          funstr=substring(funstr,ii,length(funstr));\n          Flg=1;\n        );\n      );\n      if(Flg==0,\n        jj=ii-1+length(varname);\n        if(jj&lt;length(funstr),\n          tmp=substring(funstr,jj,jj+1));\n          if(contains(Notvar,tmp),\n          tmp2=tmp2+substring(funstr,0,jj);\n          funstr=substring(funstr,jj,length(funstr));\n          Flg=1;\n        );\n      );\n      if(Flg==0,\n        tmp2=tmp2+substring(funstr,0,ii-1)+repstr;\n        funstr=substring(funstr,jj,length(funstr));\n      );\n    );\n  );\n  funstr=tmp2+funstr;\n  funstr;\n);\nColorcmyk2rgb(clr):=(\n  regional(clrnew,tmp,black);\n  if(length(clr)==4,  //200618\n    black=clr_4;\n    tmp=apply(clr,1-min(1,#*(1-black)+black));\n    clrnew=tmp_(1..3);\n  ,\n    clrnew=clr;  //200618\n  );\n  clrnew;\n);\nColorrgb2cmyk(clr):=(\n  regional(clrnew,tmp,black);\n  if(length(clr)==3, //200618\n    tmp=apply(clr,1-#);\n    black=min(tmp);\n    if(black!=1, //181112from\n      tmp=apply(clr,(1-#-black)/(1-black));\n      clrnew=append(tmp,black);\n    ,\n      clrnew=[0,0,0,1];  //200618\n    ); //181112to\n  ,\n    clrnew=clr;\n  );\n  clrnew;\n);\nGetlinestyle(str,name):=(\n  regional(noflg,tmp,tmp1,tmp2,Dop,Ltype,subflg);\n  Ltype=-1;\n  Dop=\"\";\n  tmp1=indexof(str,\",\");\n  if(tmp1&gt;0,\n    Dop=\",\"+substring(str,tmp1,length(str));\n  );\n  noflg=parse(substring(str,0,1));\n  if(substring(name,0,3)==\"sub\",subflg=1,subflg=0);  // 16.02.29\n  if(noflg&lt;=1, //1900818from\n    tmp1=Toupper(substring(str,1,3));\n  ,\n    tmp1=\"NO\";\n  ); //1900818to\n  tmp2=\"\"; //190119from\n  tmp=indexof(str,\",\");\n  if(tmp&gt;0,\n    tmp2=substring(str,tmp,length(str));\n  ); //190119to\n  if(tmp1==\"DR\",\n    if(length(tmp2)==0,tmp2=\"1\"); //190125\n    Ltype=[0,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"DA\",\n    if(length(tmp2)==0,tmp2=\"1,1\"); //190125\n    if(indexof(tmp2,\",\")==0,tmp2=tmp2+\",1\"); //200911\n    Ltype=[1,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"ID\",\n    if(length(tmp2)==0,tmp2=\"1,1\"); //190125\n    if(indexof(tmp2,\",\")==0,tmp2=tmp2+\",1\"); //200911\n    Ltype=[2,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"DO\",\n    if(length(tmp2)==0,tmp2=\"1,1\"); //190125\n    if(indexof(tmp2,\",\")==0,tmp2=tmp2+\",1\"); //200911\n    Ltype=[3,tmp2];  //190119\n    if(noflg==0 &amp; subflg==0, // 16.02.29\n    );\n  );\n  if(tmp1==\"DP\",\n    if(length(tmp2)==0,tmp2=\"1\"); //190125\n    Ltype=[0,tmp2];  //190119\n    tmp1=parse(name);\n    tmp2=\"\";\n    forall(tmp1,\n      tmp2=tmp2+Textformat(#_1,5)+\",\";\n    );\n    tmp2=substring(tmp2,0,length(tmp2)-1);\n    if(noflg==0,\n    );\n  );\n  if(tmp1==\"NO\", //190818from\n    Ltype=[-1,\"0\"];\n  );  //190818to\n  Ltype;\n);\nLcrd(pt):=(\n  regional(tmp);\n  if(ispoint(pt),\n    tmp=[pt.x/SCALEX,pt.y/SCALEY];\n  ,\n    tmp=pt;\n  );\n  re(tmp); //191231\n);\nPutonseg(name,sgstr):=(\n  regional(seg,p1,p2);\n  if(isstring(sgstr),seg=parse(sgstr),seg=sgstr);\n  Putonseg(name,LLcrd(seg_1),LLcrd(seg_2));\n);\nPutonseg(name,p1,p2):=Putonseg(name,p1,p2,[]);\nPutonseg(name,p1org,p2org,options):=(\n  regional(Eps,par,p1,p2,dx,dy,p,tmp,tmp1,tmp2);\n  Eps=10^(-5);\n  par=0.5;\n  tmp=Divoptions(options);\n  if(length(tmp_6)&gt;0,\n    par=tmp_6_1;\n  );\n  p1=Lcrd(p1org);//16.10.11from\n  p2=Lcrd(p2org);\n  p1=Pcrd(p1); p2=Pcrd(p2); //190120\n  dx=p2_1-p1_1;\n  dy=p2_2-p1_2;\n  p=parse(name+\".xy\");\n  if(abs(dx)&gt;abs(dy), //190120from\n    if(p1_1&gt;p2_1,tmp=p1;p1=p2;p2=tmp);\n    if(p_1&lt;p1_1,parse(name+\".xy=\"+Textformat(p1,10));p=p1);\n    if(p_1&gt;p2_1,parse(name+\".xy=\"+Textformat(p2,10));p=p2);\n    tmp=(p2_2-p1_2)/(p2_1-p1_1)*(p_1-p1_1)+p1_2;\n    parse(name+\".y=\"+tmp+\";\"); //190415\n  ,\n    if(p1_2&gt;p2_2,tmp=p1;p1=p2;p2=tmp);\n    if(p_2&lt;p1_2,parse(name+\".xy=\"+Textformat(p1,10));p=p1);\n    if(p_2&gt;p2_2,parse(name+\".xy=\"+Textformat(p2,10));p=p2);\n    tmp=(p2_1-p1_1)/(p2_2-p1_2)*(p_2-p1_2)+p1_1;\n    parse(name+\".x=\"+tmp+\";\"); //190415\n  ); //190120to\n);\nSprintf(value,dig):=(\n  regional(vv,tmp,tmp1);\n  if(!islist(value),  // 17.03.12from\n    if(isstring(value),\n      vv=value;\n    ,\n      vv=Textformat(value,dig);\n    );  // 17.03.12from\n    if(indexof(vv,\".\")==0,vv=vv+\".\");\n    vv=vv+\"0000000000000000\";\n    tmp=indexof(vv,\".\")+dig;\n    vv=substring(vv,0,tmp);\n  ,\n    vv=apply(value,Sprintf(#,dig));\n  );\n  vv;\n);\nPtselected():=Ptselected(allpoints()); //190805\nPtselected(ptlistorg):=(\n regional(ptlist,flg,Eps);\n Eps=StrictSep;//(XMAX-XMIN)/10; //190505,221003\n flg=0;\n ptlist=ptlistorg; //190505[2lines]\n if(!islist(ptlist),ptlist=[ptlist]);\n forall(ptlist,\n  if(flg==0,\n    if(|mouse().xy-#.xy|&lt;Eps,flg=1); // \n  );\n );\n if(flg==0,false,true);\n);\nPtseg3data():=Ptseg3data([]);\nPtseg3data(options):=(\n  regional(pt,ptz,pt3,plist,plistz,tmp,tmp1,tmp2);\n  tmp=remove(allpoints(),options);\n  tmp=remove(tmp,[SW,NE,TH,FI]);\n  plist=select(tmp,indexof(#.name,\"z\")==0);\n  plistz=select(tmp,indexof(#.name,\"z\")&gt;0);\n  if(Ptselected(TH) % Ptselected(FI),\n    forall(plist,pt,\n      tmp=select(plistz,#.name==pt.name+\"z\");\n      if(length(tmp)&gt;0,\n        ptz=tmp_1;\n      ,\n        ptz=[];\n      );\n      tmp=select(VLIST,#_1==pt.name+\"3d\"); //190506\n      if(length(tmp)&gt;0,\n        pt3=tmp_1_2;\n        pt.xy=Parapt(pt3);\n        ptz.xy=Parasubpt(pt3);\n      ,\n        pt3=Mainsubpt3d(pt.xy,ptz.xy); //181107[2lines]\n        Defvar(pt+\"3d\",pt3);\n      );\n    );\n  ,\n    Mkpointlist(options); // 16.12.18\n  );\n);\nParapt(pt):=(\n  regional(Xz,Yz);\n  Xz=-pt_1*sin(PHI)+pt_2*cos(PHI);\n  Yz=-pt_1*cos(PHI)*cos(THETA)-pt_2*sin(PHI)*cos(THETA)+pt_3*sin(THETA);\n  [Xz,Yz];\n);\nParasubpt(pt):=( //181027\n  regional(mv,dp,xs);\n  mv=NE.x-SW.x;\n  dp=pi/24;\n  xs=-pt_1*sin(PHI+dp)+pt_2*cos(PHI+dp);\n  [xs+mv,pt_3];\n);\nMainsubpt3d(pm,psv):=( //181027\n  regional(Eps,mv,dp,v,x,y,z);\n  Eps=10^(-4);\n  mv=NE.x-SW.x;\n  dp=pi/24;\n  if(abs(cos(THETA))&gt;Eps,\n    if(length(psv)&gt;1,v=psv_2, v=psv);\n    x=(v*cos(PHI)*sin(THETA)-pm_1*sin(PHI)*cos(THETA)-pm_2*cos(PHI))/cos(THETA);\n    y=(v*sin(PHI)*sin(THETA)+pm_1*cos(PHI)*cos(THETA)-pm_2*sin(PHI))/cos(THETA);\n    z=v;\n  ,\n    if(length(psv)&gt;1,v=psv_1, v=psv);\n    x=(pm_1*cos(PHI+dp)-(v-mv)*cos(PHI))/sin(dp);\n\ty=(pm_1*sin(PHI+dp)-(v-mv)*sin(PHI))/sin(dp);\n    z=pm_2;\n  );\n  [x,y,z];\n);\nDefvar(varstr):=(\n  regional(name,value,tmp,tmp1);\n  if(isstring(varstr),\n    parse(varstr+\";\");\n    tmp=indexof(varstr,\"=\");\n    name=substring(varstr,0,tmp-1);\n    value=substring(varstr,tmp,length(varstr));\n    value=parse(value);\n    tmp1=select(1..length(VLIST),VLIST_#_1==name);\n    if(length(tmp1)&gt;0,\n      tmp=tmp1_1;\n      VLIST_tmp=[name,value];\n    ,\n      VLIST=prepend([name,value],VLIST);\n    );\n  ,\n    forall(1..(length(varstr)/2), // 16.11.16from\n      name=varstr_(2*#-1);\n      value=varstr_(2*#);\n      Defvar(name,value);\n    ); // 16.11.16until\n  );\n);\nDefvar(name,value):=(\n  regional(tmp,tmp1);\n  if(islist(value),\n    tmp1=\"[\";\n    forall(value,\n      if(isstring(#), // 16.11.14\n        tmp1=tmp1+Dq+#+Dq+\",\"; // 16.11.14\n      ,\n        tmp1=tmp1+format(#,16)+\",\"; //190918\n      );\n    );\n    tmp1=substring(tmp1,0,length(tmp1)-1)+\"]\";\n  ,\n    tmp1=format(value,10);\n  );\n  tmp=name+\"=\"+tmp1+\";\"; // 15.02.06//190415\n  parse(tmp);\n  VLIST=select(VLIST,#_1!=name); // 15.02.08\n  VLIST=prepend([name,value],VLIST);\n);\nMkpointlist():=Mkpointlist([]); //16.11.12\nMkpointlist(options):=( //181030\n  regional(Eps,dp,mv,pos,worklist,plist,pt,ptstr,pt3,ptz,par,\n     tmp,tmp1,tmp2,tmp3,tmp4,p1,p2,flg);\n  dp=pi/24;\n  mv=NE.x-SW.x;\n  Eps=10^(-4);\n  pos=[NE.x+1,NE.y+0.1];\n  worklist=Workprocess(); //181030\n  plist=select(worklist,length(#_3)!=2);\n  plist=apply(plist,#_1);\n  plist=remove(plist,PTEXCEPTION);\n  tmp=apply(VLIST,#_1);//181029from\n  tmp=select(tmp,indexof(#,\"3d\")&gt;0);\n  tmp2=apply(tmp,replace(#,\"3d\",\"\"));\n  forall(tmp2,ptstr,\n    if(!contains(plist,ptstr),\n      tmp=select(VLIST,\n            (#_1==pt+\"3d\")%(#_1==pt+\"2d\")%(#_1==pt+\"fix\"));\n      VLIST=remove(VLIST,tmp);\n    );\n  ); //181029to\n  if(SUBSCR==0,plist=[]);\n  forall(plist,ptstr,\n    pt=parse(ptstr);\n    inspect(pt,\"ptsize\",3);\n    inspect(pt,\"color\",2);\n    inspect(pt,\"textsize\",TSIZE);\n    ptz=pt.name+\"z\";  //190505\n    tmp=Finddef(pt);\n    tmp=select(VLIST,#_1==pt.name+\"3d\"); //190505\n    if(length(tmp)==0,\n      tmp=parse(ptz); //181108from\n      if(ispoint(tmp),\n        pt3=Mainsubpt3d(pt.xy,tmp.xy); //181108to\n      ,\n        if(abs(cos(THETA))&gt;Eps,//181028from\n          tmp1=Mainsubpt3d(pt.xy,0); \n          tmp=Parasubpt(tmp1);\n          Putpoint(ptz,tmp,[tmp_1,parse(ptz+\".y\")]);\n          pt3=Mainsubpt3d(pt.xy,parse(ptz+\".xy\"));\n        ,\n          if(abs(sin(PHI))&gt;abs(cos(PHI)), //181029from\n            tmp=Parasubpt([-pt.x/sin(PHI),0,pt.y]);\n          ,\n            tmp=Parasubpt([0,pt.x/cos(PHI),pt.y]);\n          );\n          Putpoint(ptz,tmp,[parse(ptz+\".x\"),pt.y]);//181029\n          pt3=Mainsubpt3d(pt.xy,parse(ptz+\".xy\"));\n        );\n      ); //181028to\n      Defvar(pt.name+\"3d\",pt3); //190505\n      Defvar(pt.name+\"fix\",0); //190505\n    );\n    flg=0;\n    if(isstring(ptz),ptz=parse(ptz));//181029from\n    inspect(ptz,\"ptsize\",3);\n    inspect(ptz,\"color\",3);\n    inspect(ptz,\"textsize\",TSIZEZ);//181029to\n    if(Ptselected(pt),\n      if(parse(pt.name+\"fix\")!=1, //190505\n        tmp=select(VLIST,#_1==pt.name+\"3d\"); //190505\n        tmp1=tmp_1_2;\n        pt3=Mainsubpt3d(pt.xy,ptz.xy); //181029\n        Putpoint(ptz.name,Parasubpt(pt3));\n        if(Norm(tmp1-pt3)&gt;Eps,\n           Defvar(pt.name+\"3d\",pt3); //190505\n        );\n        flg=1;\n      );\n    );\n    if(Ptselected(ptz),//181108from\n      tmp=select(VLIST,#_1==pt.name+\"3d\");  //190505\n      tmp1=tmp_1_2;\n      tmp=Parasubpt(tmp1); //181108from\n      if(abs(cos(THETA))&gt;Eps,\n        tmp=ptz.name+\".x=\"+format(tmp_1,10)+\";\"; //210112\n        parse(tmp);\n        tmp=Parapt([tmp1_1,tmp1_2,ptz.y]);\n        Putpoint(pt.name,tmp); //190505\n     ,\n        tmp=ptz.name+\".y=\"+format(tmp_2,10)+\";\";  //190505\n        parse(tmp);\n        if(abs(sin(PHI+dp))&gt;abs(cos(PHI+dp)), //181108\n          tmp=-(ptz.x-mv-tmp1_2*cos(PHI+dp))/sin(PHI+dp);\n          tmp=Parapt([tmp,tmp1_2,tmp1_3]);\n        ,\n          tmp=(ptz.x-mv+tmp1_1*sin(PHI+dp))/cos(PHI+dp); //181109pm\n          tmp=Parapt([tmp1_1,tmp,tmp1_3]);\n        );\n        Putpoint(pt.name,tmp); //190505\n      );\n      pt3=Mainsubpt3d(pt.xy,ptz.xy); \n      Defvar(pt.name+\"3d\",pt3); //190505\n      flg=2;\n    );\n    if(Ptselected(TH) % Ptselected(FI), //181029\n      tmp=select(VLIST,#_1==pt.name+\"3d\"); //190505\n      if(length(tmp)&gt;0, //17.10.07\n        tmp1=Parapt(tmp_1_2);\n        Putpoint(pt.name,tmp1);  //190505\n        tmp2=Parasubpt(tmp_1_2);//181027[2lines]\n        Putpoint(ptz.name,tmp2);  //190505\n        flg=3;\n      ); //17.10.07\n    );\n    if(flg==0, //181030from\n      pt3=Mainsubpt3d(pt.xy,ptz.xy);\n      Defvar(pt.name+\"3d\",pt3); //190505\n    ); //181030to\n    if(Ptselected(pt) % Ptselected(ptz),\n    );\n    if(!contains([\"p\",\"q\"],pt.name), //190505\n      ptL=append(ptL,pt);\n    );\n  );\n);\nWorkprocess():=Drawprocess(300,[\"Disp=n\"]); //181030\nWorkprocess(nn):=(\n  Drawprocess(nn,[\"Disp=n\"]); \n);\nDrawprocess():=Drawprocess(300,[\"Disp=y\"]);\nDrawprocess(nn):=Drawprocess(nn,[\"Disp=y\"]);\nDrawprocess(nn,options):=(\n  regional(All,added,remain,out,flg,dispflg,eqL,tmp,tmp1,tmp2);\n  tmp=Divoptions(options); //181030from\n  eqL=tmp_5;\n  dispflg=\"Y\";\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    tmp2=Toupper(substring(tmp_2,0,1));\n    if(tmp1==\"D\",dispflg=tmp2);\n  ); //181030to\n  tmp=remove(allpoints(),[NE,SW,TH,FI]);\n  tmp1=select(tmp,\n    substring(#.name,length(#.name)-1,length(#.name))!=\"z\"); //190505\n  tmp1=concat(tmp1,alllines());\n  All=apply(tmp1,Dependgeo(#));\n  added=select(All,length(#_3)==0);\n  out=sort(apply(added,#_1));\n  remain=remove(All,added);\n  flg=0;\n  repeat(nn,\n    if(flg==0,\n      tmp1=select(remain,remove(#_3,out)==[]);\n      tmp2=sort(apply(tmp1,#_1));\n      out=concat(out,tmp2);\n      remain=remove(remain,tmp1);\n      if(length(remain)==0,flg=1);\n    );\n  );\n  if(dispflg==\"Y\",\n    println(\"Process of drawing\");\n  );\n  tmp1=[];//181030from\n  forall(out,\n    tmp=Dependgeo(parse(#));\n    tmp1=append(tmp1,tmp);\n    if(dispflg==\"Y\",\n      println(Dependgeo(parse(#)));\n    );\n  );\n  tmp1;//181030to\n);\nDependgeo(geo):=(\n  regional(tmp,tmp1,tmp2,out);\n  tmp=Finddef(geo);\n  if(!iscircle(geo),\n    out=[geo.name]; //190505\n  ,\n    out=[geo];\n  );\n  if(length(tmp)&lt;3,\n    out=concat(out,[tmp_1,[]]);\n  ,\n    out=concat(out,[tmp_1]);\n    tmp1=[tmp_2,tmp_3];\n    tmp=parse(tmp1_2);\n    if(islist(tmp) % isreal(tmp),\n      tmp1=[tmp1_1];\n    );\n    out=append(out,tmp1);\n  );\n  out;\n);\nFinddef(G):=(\n  regional(def,tmp,tmp1,tmp2,tmp3);\n  if(isstring(G),tmp=parse(G),tmp=G);\n  def=text(inspect(tmp,\"definition\"));\n  tmp1=indexof(def,\"(\");\n  tmp2=indexof(def,\";\");\n  tmp3=indexof(def,\")\");\n  tmp=[substring(def,0,tmp1-1)];\n  if(tmp2&gt;0,\n    tmp=append(tmp,substring(def,tmp1,tmp2-1));\n    if(indexof(def,\")\",tmp3+1)==0,\n      tmp=append(tmp,substring(def,tmp2,tmp3-1));\n    ,\n      tmp=append(tmp,substring(def,tmp2,tmp3));\n    );\n  ,\n    tmp=append(tmp,substring(def,tmp1-1,tmp3));\n  );\n  tmp;\n);\nNorm(v1):=(  // 16.09.01\n  regional(out,tmp,tmp1,tmp2);\n  out=0;\n  forall(1..(length(v1)),\n    out=out+(v1_#)^2;\n  );\n  out=sqrt(out);\n  out;\n);\nNorm(v1,v2):=(\n  Norm(v2-v1);\n);\nXyzax3data(nm,Xrange,Yrange,Zrange):=\n          Xyzax3data(nm,Xrange,Yrange,Zrange,[]);\nXyzax3data(nm,Xrange,Yrange,Zrange,optionorg):=(\n  regional(name2,name3,Out,tmp,tmp1,tmp2,ops,eqL,reL,strL,msgflg,\n    options,opstr,opcindy,Ltype,Noflg,Axname,Arrow,Origin,color,color4);\n  name2=\"ax2d\"+nm;\n  name3=\"ax3d\"+nm;\n  options=optionorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  reL=tmp_6;\n  strL=tmp_7;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  Axname=1;\n  Arrow=[];  // 190505\n  Origin=\"\"; // 16.08.14\n  if(length(reL)&gt;0,\n    Axname=reL_1;\n  );\n  forall(strL,  // 16.08.14from\n    tmp1=Toupper(substring(#,0,1));\n    if(tmp1==\"A\",\n      tmp=substring(#,1,length(#));\n      if(length(tmp)&gt;0,\n        Arrow=tokenize(tmp,\",\"); //190505\n        if(length(Arrow)==1,Arrow=append(Arrow,18));\n      );\n    );\n    if(tmp1==\"O\",\n      tmp=indexof(#,\",\");\n      if(tmp&gt;0,\n        Origin=substring(#,tmp,length(#));\n      ,\n        tmp=substring(#,1,length(#));\n        if(length(tmp)&gt;0,\n          Origin=tmp;\n        ,\n          Origin=\"sw\";\n        );\n      );\n    );\n  ); // 16.08.14to\n  options=remove(options,reL);\n  options=remove(options,strL);\n  msgflg=\"Y\";  //190506from\nmsgflg=\"N\";  //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"M\",\n      msgflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n  ); //190506to\n  tmp1=indexof(Xrange,\"=\");\n  tmp=parse(substring(Xrange,tmp1,length(Xrange)));\n  Px=[tmp_1,0,0]; Qx=[tmp_2,0,0];\n  tmp1=indexof(Yrange,\"=\");\n  tmp=parse(substring(Yrange,tmp1,length(Yrange)));\n  Py=[0,tmp_1,0]; Qy=[0,tmp_2,0];\n  tmp1=indexof(Zrange,\"=\");\n  tmp=parse(substring(Zrange,tmp1,length(Zrange)));\n  Pz=[0,0,tmp_1]; Qz=[0,0,tmp_2];\n  tmp=[\"nodisp\",\"Msg=n\"];\n  Spaceline(\"-axx3d\"+nm,[Px,Qx],tmp);\n  Spaceline(\"-axy3d\"+nm,[Py,Qy],tmp);\n  Spaceline(\"-axz3d\"+nm,[Pz,Qz],tmp);\n  Out=[[Px,Qx],[Py,Qy],[Pz,Qz]];\n  if(Axname&gt;0,\n    Xyzaxparaname(Xrange,Yrange,Zrange,[Axname]);\n  );\n  if(Noflg&lt;3,\n    if(msgflg==\"Y\",\n      tmp=\"generate axes \"+name3;\n      tmp=tmp+\" : axx3d\"+nm+\",axy3d\"+nm+\",axz3d\"+nm;\n      println(tmp);\n    );\n    tmp=\"[\"+\"axx3d\"+nm+\",\"+\"axy3d\"+nm+\",\";\n    tmp=tmp+\"axz3d\"+nm+\"]\";\n    tmp=name3+\"=\"+tmp;\n    parse(tmp);\n    tmp1=Projpara([name3],[\"nodata\"]);\n    tmp=name2+\"=\"+textformat(tmp1,10)+\";\"; //190415\n    parse(tmp);\n    tmp=name3+\"=Xyzax3data(\"+\n\t  Dq+Xrange+Dq+\",\"+Dq+Yrange+Dq+\",\"+Dq+Zrange+Dq+\")\";\n    GLIST=append(GLIST,tmp);\n    tmp=name2+\"=Projpara(\"+name3+\")\";\n    GLIST=append(GLIST,tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      if(color4!=KCOLOR, //180904\n        Texcom(\"{\");Com2nd(\"Setcolor(\"+color4+\")\");//180722\n      );\n\t  Ltype=Getlinestyle(text(Noflg)+Ltype,name2);\n      if(color4!=KCOLOR, //180904\n        Texcom(\"}\");//180722\n      );\n\t,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name2,Ltype,opcindy]);\n    if(Noflg&lt;1,  // 16.08.14from\n      if(length(Arrow)==2, //190505from\n        tmp1=Parapt(Px); tmp2=Parapt(Qx);\n        ops=[Arrow_1,Arrow_2,\"Line=n\"];\n        Arrowhead(\"ax1\",tmp2,tmp2-tmp1,ops); //210521\n        tmp1=Parapt(Py); tmp2=Parapt(Qy);\n        Arrowhead(\"ax2\",tmp2,tmp2-tmp1,ops); //210521\n        tmp1=Parapt(Pz); tmp2=Parapt(Qz);\n        Arrowhead(\"ax3\",tmp2,tmp2-tmp1,ops); //210521\n      ); //190505to\n      if(length(Origin)&gt;0,\n        Letter([Parapt([0,0,0]),Origin,\"O\"]);\n      );\n    );  // 16.08.14until\n    if(SUBSCR==1, //  15.02.11\n      Subgraph(name3,opcindy); //181029\n    );\n  );\n  Out;\n);\nSpaceline(ptlist):=Spaceline(ptlist,[]); // 16.02.22 from\nSpaceline(Arg1,Arg2):=(\n  regional(name,tmp,tmp1,tmp2);\n  if(isstring(Arg1),\n    Spaceline(Arg1,Arg2,[]);\n  ,\n    tmp=Arg1.name; //190505\n    tmp=substring(tmp,1,length(tmp)-1);\n    name=\"-\"+replace(tmp,\",\",\"\");\n    Spaceline(name,Arg1,Arg2);\n  );\n); // 16.02.22 to\nSpaceline(nm,ptlistorg,optionorg):=(\n  regional(name2,name3,options,Out,tmp,tmp1,tmp2,\n        opstr,opcindy,Ltype,Noflg,eqL,ptlist, Msg,color,color4);\n  ptlist=apply(ptlistorg,if(ispoint(#),parse(#.name+\"3d\"),#)); // 190505\n  ptlist=apply(ptlist,if(isstring(#),parse(#),#)); //190330\n  if(substring(nm,0,2)==\"bz\",\n    name2=replace(nm,\"bz\",\"bz2d\");\n    name3=replace(nm,\"bz\",\"bz3d\");\n  ,\n    if(substring(nm,0,1)==\"-\",\n      tmp=substring(nm,1,length(nm));\n      if(indexof(tmp,\"3d\")&gt;0,name3=tmp,name3=tmp+\"3d\");\n      name2=replace(name3,\"3d\",\"2d\");\n    ,\n      name2=\"sl2d\"+nm;\n      name3=\"sl3d\"+nm;\n    );\n  );\n  options=select(optionorg,length(#)&gt;0);  // 160415\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  Msg=1;\nMsg=0; // \n  forall(eqL,\n    tmp=substring(#,0,1);\n    if(Toupper(tmp)==\"M\",\n      tmp=indexof(#,\"=\");\n      tmp1=substring(#,tmp,tmp+1);\n      if(Toupper(tmp1)==\"N\",\n        Msg=0;\n      );\n    );\n  );\n  if(Noflg&lt;3,\n    if(Msg==1,\n      println(\"generate Spaceline \"+name3);\n    );\n    tmp=name3+\"=\"+Textformat(ptlist,10)+\";\"; //190330//190415\n    parse(tmp);\n    tmp1=Projpara(name3,[\"nodata\"]);\n    tmp=name2+\"=\"+Textformat(tmp1,10)+\";\"; //190415\n    parse(tmp);\n    tmp=\"[\";\n    forall(ptlist, //17.07.13from\n      if(isstring(#),\n        tmp=tmp+#+\",\";\n      ,\n        tmp=tmp+Textformat(#,10)+\",\";\n      );\n    );\n    tmp=substring(tmp,0,length(tmp)-1)+\"]\";\n    tmp=name3+\"=Spaceline(\"+tmp+\")\"; //17.07.13to\n    GLIST=append(GLIST,tmp);\n    tmp=name2+\"=Projpara(\"+name3+\")\";\n    GLIST=append(GLIST,tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      if(color4!=KCOLOR, //180904\n        Texcom(\"{\");Com2nd(\"Setcolor(\"+color4+\")\");//180722\n      );\n\t  Ltype=Getlinestyle(text(Noflg)+Ltype,name2);\n      if(color4!=KCOLOR, //180904\n        Texcom(\"}\");//180722\n      );\n\t,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name2,Ltype,opcindy]);\n  );\n  ptlist;\n);\nProjpara(ptdata):=Projpara(ptdata,[]);\nProjpara(ptdata,optionsorg):=(\n  regional(options,name2,name3,Ltype,Noflg,eqL,opcindy,\n     dtL,ptL,tmp,tmp1,Out,color,color4,msg);\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  msg=\"Y\"; //180602from\nmsg=\"N\"; //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1)); //181111\n    if(tmp1==\"M\",\n      tmp=substring(tmp_2,0,1);\n      msg=Toupper(tmp);\n      options=remove(options,[#]);\n    );\n  );//180602to\n  Out=[];\n  if(isstring(ptdata),tmp=parse(ptdata),tmp=ptdata);\n  if(Measuredepth(tmp)&lt;1,dtL=ptdata,dtL=[ptdata]);\n  forall(dtL,name3,\n    if(indexof(name3,\"3d\")&gt;0, //17.05.24\n      name2=replace(name3,\"3d\",\"2d\");\n    ,\n      name2=\"para\"+name3;\n    );  \n    ptL=Projcurve(name3);\n    ptL=select(ptL,length(#)&gt;1);//17.06.02\n    if(length(ptL)==1,\n      ptL=ptL_1;\n    );\n    if(Noflg&lt;3,\n      if(msg==\"Y\", //220206\n        println(\"generate projparadata  \"+name2);\n      );//180602to\n      tmp=name2+\"=\"+Textformat(ptL,6)+\";\"; //220206\n      parse(tmp);\n      tmp=name2+\"=Projpara(\"+name3+\")\";\n      GLIST=append(GLIST,tmp);\n    );\n    if(Noflg&lt;3, //190818\n      if(isstring(Ltype),\n        if(color4!=KCOLOR, //180904\n          Texcom(\"{\");Com2nd(\"Setcolor(\"+color4+\")\");//180722\n        );\n\t\tLtype=Getlinestyle(text(Noflg)+Ltype,name2);\n        if(color4!=KCOLOR, //180904\n          Texcom(\"}\");//180722\n        );\n\t  ,\n        if(Noflg==1,Ltype=0);\n      );\n     GCLIST=append(GCLIST,[name2,Ltype,opcindy]);\n    );\n    Out=append(Out,ptL);\n  );\n  if(length(Out)==1,Out=Out_1);\n  if(length(Out)==1,Out=Out_1); // 15.02.24\n  tmp=[];\n  forall(Out,\n    if(length(#)&gt;0,tmp=append(tmp,#));\n  );\n  Out=tmp;\n  Out;\n);\nMeasuredepth(list):=( //190423\n  regional(str,nn,tmp,tmp1,tmp2);\n  str=text(list);\n  tmp1=Indexall(str,\"[\");\n  tmp2=select(tmp1,!contains(tmp1,#+1));\n  nn=tmp2_1;\n  tmp1=substring(str,nn,length(str));\n  tmp=indexof(tmp1,\",\");\n  tmp1=substring(tmp1,0,tmp-1);\n  if(!ispoint(parse(tmp1)),\n    nn=nn-1;\n  );\n  nn;\n);\nProjcurve(crv):=(\n  regional(CurveL,Curve,Eps,AnsL,Out,sp,cp,st,,ct,ii,pt,\n       Xz,Yz,tmp,tmp1,tmp2);\n  Eps=10^(-6);\n  sp=sin(PHI); cp=cos(PHI);\n  st=sin(THETA); ct=cos(THETA);\n  if(isstring(crv),CurveL=parse(crv),CurveL=crv);\n  if(Measuredepth(CurveL)==1,CurveL=[CurveL]);\n  Out=[];\n  forall(CurveL,Curve,\n    AnsL=[];\n    forall(1..length(Curve),ii,\n      pt=Curve_ii;\n      if(pt_1!=\"inf\",\n        Xz=-pt_1*sp+pt_2*cp;\n        Yz=-pt_1*cp*ct-pt_2*sp*ct+pt_3*st;\n        tmp=[Xz,Yz];\n        if(ii==1,\n           AnsL=[tmp];\n        ,\n          tmp1=AnsL_(length(AnsL));\n          if(tmp1_1==\"inf\" % |tmp-tmp1|&gt;Eps,\n            AnsL=append(AnsL,tmp);\n          );\n        );\n      ,\n        AnsL=append(AnsL,[\"inf\"]);\n      );\n    );\n    tmp1=[];\n    tmp2=select(1..length(AnsL),AnsL_#==[\"inf\"]);\n    tmp=1;\n    forall(tmp2,\n      if(#&gt;tmp,\n        tmp1=concat(tmp1,[AnsL_(tmp..(#-1))])\n      );\n      tmp=#+1;\n    );\n    if(tmp&lt;length(AnsL),\n      tmp1=concat(tmp1,[AnsL_(tmp..length(AnsL))]);\n    );\n    AnsL=tmp1;\n    if(length(AnsL)==1,AnsL=AnsL_1);\n    Out=append(Out,AnsL);\n  );\n  if(length(Out)==1,\n    Out=Out_1;\n  );\n  Out;\n);\nXyzaxparaname(Xrange,Yrange,Zrange):=\n   Xyzaxparaname(Xrange,Yrange,Zrange,[]);\nXyzaxparaname(Xrange,Yrange,Zrange,options):=(\n regional(tmp,tmp1,tmp2,Eps,Dr,Noflg,Xname,Yname,Zname,\n     px,qx,py,qy,pz,qz,ph,qh,rr,ch);\n  Eps=10.0^(-6);\n  Dr=0.19*1000/2.54/MilliIn;\n  Noflg=0;\n  forall(options,\n    if(isreal(#),Dr=Dr*#);\n  );\n  tmp1=Strsplit(Xrange,\"=\");\n  Xname=tmp1_1;\n  tmp=parse(tmp1_2);\n  px=[tmp_1,0,0]; qx=[tmp_2,0,0];\n  tmp1=Strsplit(Yrange,\"=\");\n  Yname=tmp1_1;\n  tmp=parse(tmp1_2);\n  py=[0,tmp_1,0]; qy=[0,tmp_2,0];\n  tmp1=Strsplit(Zrange,\"=\");\n  Zname=tmp1_1;\n  tmp=parse(tmp1_2);\n  pz=[0,0,tmp_1]; qz=[0,0,tmp_2];\n  COM2ndlist=select(COM2ndlist,indexof(#,Dqq(\"$\"+Xname+\"$\"))==0);//180608[3lines]\n  COM2ndlist=select(COM2ndlist,indexof(#,Dqq(\"$\"+Yname+\"$\"))==0);\n  COM2ndlist=select(COM2ndlist,indexof(#,Dqq(\"$\"+Zname+\"$\"))==0);\n  ph=Parapt(px); qh=Parapt(qx); rr=|ph-qh|;\n  if(rr&gt;Eps,\n    ch=qh+Dr/rr*(qh-ph);\n    Expr(ch,\"c\",Xname);\n  );\n  ph=Parapt(py); qh=Parapt(qy); rr=|ph-qh|;\n  if(rr&gt;Eps,\n    ch=qh+Dr/rr*(qh-ph);\n    Expr(ch,\"c\",Yname);\n  );\n  ph=Parapt(pz); qh=Parapt(qz); rr=|ph-qh|;\n  if(rr&gt;Eps,\n    ch=qh+Dr/rr*(qh-ph);\n    Expr(ch,\"c\",Zname);\n  );\n);\nDqq(str):=DqDq(str); //18.02.11\nDqDq(str):=(\n  unicode(\"0022\")+str+unicode(\"0022\");\n);\nExpr(Pt,Dr,St):=Expr([Pt,Dr,St]);\nExpr(list):=Expr(list,[]);\nExpr(Pt,Dr,St,options):=Expr([Pt,Dr,St],options); //190409\nExpr(listorg,options):=( //16.10.09\n  regional(list,str,tmp,tmp1,tmp2);\n  list=listorg;\n  forall(1..round(length(list)/3),\n    str=list_(3*#);\n    if(isstring(str), //200526from\n      if(!iswindows(),\n        str=replace(str,\"¥\",\"\\\");\n      ); \n    ,\n      str=format(str,10)\n    ); //200526to\n    str=\"$\"+str+\"$\"; //200526\n    list_(3*#)=str;\n  );\n  Letter(list,options);\n);\nLetter(Pt,Dr,St):=Letter([Pt,Dr,St]);\nLetter(list):=Letter(list,[]);\nLetter(Pt,Dr,St,options):=Letter([Pt,Dr,St],options);//181218\nLetter(list,options):=(\n  regional(Nj,Pos,Dir,Str,Off,Xmv,Ymv,Noflg,opcindy,\n      opL,aln,sz,clr,bld,ita,tmp,tmp1,tmp2,color,color4,eqL);\n  tmp=Divoptions(options);\n  eqL=tmp_5; //190209\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opL=select(options,indexof(#,\"-&gt;\")&gt;0); //16.10.09from\n  tmp=select(opL,indexof(#,\"color\"));\n  sz=16; //210516\n  bld=false;\n  ita=false;\n  aln=\"left\";\n  forall(opL,\n    tmp=indexof(#,\"-&gt;\");\n    tmp1=Removespace(substring(#,0,tmp-1));\n    tmp2=substring(#,tmp+1,length(#));\n    if(tmp1==\"size\",sz=parse(tmp2));\n    if(tmp1==\"color\",clr=parse(tmp2));\n    if(tmp1==\"bold\",bld=parse(tmp2));\n    if(tmp1==\"ita\",ita=parse(tmp2));\n  );//16.10.09to\n  forall(eqL, //190209from\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"S\",\n      sz=round(parse(tmp_2)*16); //210516\n    );\n  ); //190209to\n  Nj=1;\n  if(Ketcindyjsfigure&gt;0,sz=round(sz*Ketcindyjsscale) ); // \n  while(Nj+2&lt;=length(list),\n    Pos=Lcrd(list_Nj);  //220814\n    Dir=list_(Nj+1);\n    Str=list_(Nj+2);\n    if(!isstring(Str),Str=format(Str,10)); // 16.09.30,10.09\n    tmp=replace(Str,\".xy\",\"\");\n    tmp=replace(tmp,\".x\",\"(1)\");\n    Str=replace(tmp,\".y\",\"(2)\");\n    Str=RSslash(Str); // 17.09.24\n    Str=replace(Str,\"`\",\"'\");//180303\n    tmp=Dq+\",\"+Dq+Str+Dq+\")\";\n    if(Noflg&lt;2,\n      Off=[0,0];\n      Xmv=0; Ymv=0;\n      aln=\"mid\"; //200530from\n      if(indexof(Dir,\"c\")&gt;0, Off_2=-0.3*sz);\n      if(indexof(Dir,\"n\")&gt;0,Off_2=0;Ymv=Lettermove(\"n\",Dir)); //210601\n      if(indexof(Dir,\"s\")&gt;0, Off_2=-0.85*sz;Ymv=-Lettermove(\"s\",Dir));\n      if(indexof(Dir,\"e\")&gt;0,\n        aln=\"left\";\n        if(indexof(Dir,\"n\")+indexof(Dir,\"s\")==0,Off=[0,-0.3*sz]);\n        Xmv=Lettermove(\"e\",Dir);\n      );\n      if(indexof(Dir,\"w\")&gt;0,\n        aln=\"right\";\n        if(indexof(Dir,\"n\")+indexof(Dir,\"s\")==0,Off=[0,-0.4*sz]);\n        Xmv=-Lettermove(\"w\",Dir);\n      );\n      Str=list_(Nj+2);  //17.10.17\n      Pos=Pos+[Xmv,Ymv]*MARKLEN;//210530to\n      if(length(color)==4,color=Colorcmyk2rgb(color)); //200523\n      tmp=\"drawtext(\"+format(Pcrd(Pos),10)+\",offset-&gt;\"+text(Off)+\",\"+Dqq(Str)+\",\"; \n      tmp1=\"size-&gt;sz,color-&gt;colornow,align-&gt;\"+Dqq(aln)+\",bold-&gt;\"+bld+\",italics-&gt;\"+ita; //210601\n      tmp1=Assign(tmp1,[\"sz\",text(sz),\"colornow\",text(color),\"aln\",Dqq(aln),\"bld\",text(bld),\"ita\",text(ita)]);\n      tmp=tmp+tmp1+\");\";\n      GCLIST=append(GCLIST,[tmp,[6,0]]); //201004to\n    );\n    Nj=Nj+3;\n  );\n);\nRemovespace(str):=(\n  regional(tmp,flg,out);\n  tmp=length(str)+1;\n  flg=0;\n  forall(1..(length(str)),\n    if(flg==0,\n      if((str_#)!=\" \",\n        tmp=#;\n        flg=1;\n      );\n    );\n  );\n  out=substring(str,tmp-1,length(str));\n  flg=0;\n  tmp=0;\n  forall(reverse(1..(length(out))),\n    if(flg==0,\n      if((out_#)!=\" \",\n        tmp=#;\n        flg=1;\n      );\n    );\n  );\n  out=substring(out,0,tmp);\n);\nLettermove(dir,str):=(\n  regional(Suu,tmp,tmp1,out,nn);\n  Suu=\"+-.0123456789\";\n  tmp=indexof(str,dir);\n  tmp1=substring(str,tmp,length(str));\n  out=\"\";\n  nn=1;\n  while(nn&lt;=length(tmp1),\n    tmp=substring(tmp1,nn-1,nn);\n    if(indexof(Suu,tmp)&gt;0,\n      out=out+tmp;\n    ,\n      nn=length(str);\n    );\n    nn=nn+1;\n  );\n  if(length(out)==0,out=0,out=parse(out));\n  out;\n);\nArrowhead(point,Houkou):=Arrowhead(point,Houkou,[]); //181018from\nArrowhead(Arg1,Arg2,Arg3):=(\n  if(isstring(Arg1),\n    Arrowhead(Arg1,Arg2,Arg3,[]);\n  ,\n    Arrowhead(text(ArrowheadNumber),Arg1,Arg2,Arg3);\n  );\n);\nArrowhead(nm,pointorg,directionorg,optionsorg):=(//191129remade\n   regional(Eps,name,Ltype,Noflg,opstr,opcindy,color,eqL,line,direction,\n         point,options,pP,Houkou,ptstr,hostr,tmp,tmp1,tmp2,list);\n  Eps=10^(-4);\n  name=\"arh\"+nm; //181018\n  ArrowheadNumber=ArrowheadNumber+1;\n  point=Lcrd(pointorg); //210216\n  direction=directionorg; //211217from\n  if(isstring(direction),\n    if(indexof(direction,\"Invert\")&gt;0,\n      tmp=parse(direction);\n      direction=replace(direction,[[\"(\",\"\"],[\")\",\"\"]]);\n      Listplot(\"-\"+direction,tmp,[\"nodisp\"]);\n    );\n  ); //211217to\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2);\n  eqL=tmp_5;\n  line=\"N\";\n  forall(eqL,\n     tmp=Strsplit(#,\"=\");\n     tmp1=substring(tmp_1,0,1);\n     tmp2=substring(tmp_2,0,1);\n     if(Toupper(tmp1)==\"L\",\n       line=Toupper(tmp2);\n       options=remove(options,[#]);\n     );\n  );\n   list=Arrowheaddata(point,direction,options);\n  if(length(point)&gt;1, //210724from\n    if(!Inwindow(point),Noflg=2);\n    if(isstring(direction),\n      if(|Ptend(direction)-point|&lt;Eps,point=1);\n    );\n  ); //210724to\n  if(Noflg&lt;3,\n    tmp=name+\"=\"+Textformat(list,10)+\";\"; //210311\n    parse(tmp);\n    if(isstring(Ltype),\n      if(line==\"N\",\n        fillpoly(apply(list,Pcrd(#)),color-&gt;color);\n        if(Noflg==0,\n          if(isstring(direction), //210215,210724\n            if(ispoint(point) % islist(point), //201214from\n              if(|point-Ptend(direction)|&lt;Eps,point=1);\n            );  //201214to\n            if(point==1, //191202from\n              if(Norm(Ptend(direction)-Ptstart(direction))&gt;Eps,\n                tmp=select(GCLIST,#_1==direction); //201106from\n                tmp1=tmp_1;\n                tmp2=Nearestpt(list_4,direction);\n                tmp2=tmp2_1; //201214[2lines]\n                Partcrv(\"-\"+direction,Ptstart(direction),tmp2,direction,[\"nodisp\",\"Msg=n\"]);\n              ); //201106\n            );\n          );  //210215\n          Listplot(\"-arh\"+nm,list,[\"dr,0.1\",\"Color=\"+text(color),\"Msg=n\"]);//191202\n          Shade([\"arh\"+nm],[\"Color=\"+text(color)]);\n        );\n      ,\n        Listplot(\"-arh\"+nm,list_(1..3),concat(options,[\"Msg=n\"]));\n      );\n   );\n  );\n  list; //191202\n);\nArrowheaddata(point,direction):=\n   Arrowheaddata(point,direction,[YaSize,YaAngle,YaPosition,YaCut]);\nArrowheaddata(pointorg,directionorg,options):=( //191127remade\n  regional(point,direction,scaley,Eps,size,angle,segpos,cut, \n            Houkou,hflg,Str,Ev,Nv,reL,pP,vec,\n            pA,pB,pC,par,out,tmp,tmp1,tmp2);\n  point=Pcrd(pointorg); //230830from\n  tmp=directionorg;\n  if(isstring(tmp),\n    tmp=parse(tmp);\n    direction=apply(tmp,Pcrd(#)); //230830to \n  ,\n    direction=Pcrd(tmp);\n  );\n  Eps=10^(-4);\n  tmp=Divoptions(options);\n  reL=tmp_6;\n  size=0.2*YaSize*1/2.54*1000/MilliIn; \n  angle=YaAngle*pi/180;\n  segpos=YaPosition;\n  cut=YaCut;\n  if(length(reL)&gt;=1,\n    size=0.2*reL_1*1/2.54*1000/MilliIn; \n  );\n  if(length(reL)&gt;=2,\n    if(reL_2&lt;2.5,angle=reL_2*YaAngle,angle=reL_2);\n    angle=angle*pi/180;\n  );\n  if(length(reL)&gt;=3,\n    segpos=reL_3;\n  );\n  if(length(reL)&gt;=4,\n    cut=reL_4;\n  );\n  if(ispoint(point),pP=Lcrd(point),pP=point);\n  hflg=0; \n  out=[];\n  if(ispoint(direction),\n    Houkou=direction.xy;\n    hflg=2;\n  );\n  if(hflg==0, //191203from\n    if(!isstring(direction), //191207\n      if(Measuredepth(direction)==0,\n        Houkou=direction;\n        hflg=2;\n      );\n    );  //191207to\n  ); //191203to\n  scaley=SCALEY;\n  SCALEY=1; //200114\n  if(hflg==0,\n    if(isstring(direction),Houkou=parse(direction),Houkou=direction);\n    if(!islist(pP),\n      par=1+(length(Houkou)-1)*pP; //191207\n      pP=Ptcrv(par,Houkou);\n      tmp=floor(tmp); //191203from\n    ,\n      tmp=Nearestpt(pP,Houkou);\n      pP=tmp_1;\n      par=tmp_2;\n      tmp=floor(par); //191203to\n    );\n    if(tmp&lt;length(Houkou),\n      tmp1=Houkou_tmp;\n      tmp2=Houkou_(tmp+1);\n    ,\n      tmp1=Houkou_(tmp-1);\n      tmp2=Houkou_tmp;\n    );\n    vec=(tmp2-tmp1)/|tmp2-tmp1|;\n    gG=Circledata(\"\",[pP,size*cos(angle)],[\"Num=10\",\"nodata\"]);\n    tmp1=Intersectcrvspp(Houkou,gG);\n    if(length(tmp1)==0,\n      println(\"Arrowhead may be too large (no intersect)\");\n    ,\n      tmp=select(tmp1,#_2&lt;par); //191208from\n      if(length(tmp)&gt;0,\n        tmp=sort(tmp,[-#_2]);\n        pC=tmp_1_1;\n      ,\n        if(Norm(Ptend(direction)-Ptstart(direction))&gt;Eps,\n          tmp=sort(tmp1,[#_2]);\n          pC=2*pP-tmp_1_1;\n        ,\n          tmp=sort(tmp1,[-#_2]);\n          pC=tmp_1_1;\n        );\n      ); //191208to\n      Houkou=pP-pC;\n      hflg=1;\n    );\n  );\n  if(hflg&gt;=1,\n    Ev=-Houkou/|Houkou|;\n    Nv=[-Ev_2, Ev_1];    \n    pA=pP+size*cos(angle)*Ev+size*sin(angle)*Nv;\n    pB=pP+size*cos(angle)*Ev-size*sin(angle)*Nv;\n    if(hflg==2,\n      pC=(pA+pB)/2;\n    );\n    pC=pC+cut*(pP-pC);\n    tmp=(pP-(pA+pB)/2);\n    tmp=(1-segpos)*tmp;\n    pP=Translatepoint(pP,tmp);\n    pA=Translatepoint(pA,tmp);\n    pB=Translatepoint(pB,tmp);\n    pC=Translatepoint(pC,tmp);\n    SCALEY=scaley;\n    out=apply([pA,pP,pB,pC,pA],LLcrd(#));\n  );\n  out;\n);\nPtcrv(Num,Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);\n  tmp_Num;\n);\nNearestpt(pt,plotstr):=(\n  regional(ptL,Eps,dtL,dt,nn,pt1,pt2,dv,nv,tmp,tmp1,tmp2);\n  if(isstring(plotstr),ptL=parse(plotstr),ptL=plotstr);\n  Eps=10^(-6);\n  dtL=[];\n  forall(1..(length(ptL)-1),nn,\n    pt1=ptL_nn;\n    pt2=ptL_(nn+1);\n    if(|pt2-pt1|&lt;Eps,\n      dt=[pt1,nn,|pt1-pt|];\n    ,\n      dv=pt2-pt1;\n      nv=[-dv_2,dv_1];\n      tmp1=Intersectline(pt1,dv,pt,nv);\n      if(length(tmp1)&gt;1, //210319from\n        if((tmp1_2&gt;=0)&amp;(tmp1_2&lt;=1),\n          dt=[tmp1_1,nn+tmp1_2,|tmp1_1-pt|];\n        ,\n          if(tmp1_2&lt;0,\n            dt=[pt1,nn,|pt1-pt|];\n          ,\n            dt=[pt2,nn+1,|pt2-pt|];\n          );\n        );\n      ,\n      ); //210319to\n    );\n    dtL=append(dtL,dt);\n  );\n  dtL=select(dtL,length(#)&gt;=3); //220115\n  dtL=sort(dtL,[#_3,#_2]);\n  dtL_1;\n);\nIntersectline(p1,v1,p2,v2):=(\n  regional(Eps,d,dt,ds,t,s,pt,out,tmp,tmp1,tmp2,tmp3);\n  Eps=10^(-5);\n  out=[];\n  tmp=Dotprod(v1,v2);\n  tmp1=[tmp,|v1|^2];\n  tmp2=[-|v2|^2,-tmp];\n  tmp3=[Dotprod(p2-p1,v2),Dotprod(p2-p1,v1)];\n  d=Crossprod(tmp1,tmp2);\n  tmp=abs(Crossprod(v1,v2));\n  if(tmp&gt;Eps,\n    dt=Crossprod(tmp3,tmp2);\n    ds=Crossprod(tmp1,tmp3);\n    t=dt/d;\n    s=ds/d;\n    pt=p1+v1*t;\n    out=[pt,t,s];\n  ,\n    tmp1=Crossprod(p2-p1,v1)/|v1|; //18.01.05\n    out=[abs(tmp1)]; //18.01.05\n  );\n  out;\n);\nDotprod(vec1,vec2):=(\n  regional(v1,v2,tmp);\n  if(ispoint(vec1),v1=vec1.xy,v1=vec1);\n  if(ispoint(vec2),v2=vec2.xy,v2=vec2);\n  v1*v2;\n);\nCrossprod(a,b):=(\n  regional(tmp1,tmp2,tmp3,Out);\n  if(length(a)==3,\n    tmp1=a_2*b_3-a_3*b_2;\n    tmp2=a_3*b_1-a_1*b_3;\n    tmp3=a_1*b_2-a_2*b_1;\n    Out=[tmp1,tmp2,tmp3];\n  ,\n    Out=a_1*b_2-a_2*b_1;\n  );\n  Out;\n);\nCircledata(cenrad):=Circledata(cenrad,[]);\nCircledata(para1,para2):=(\n  regional(name,cenrad,options,str,n); \n  if(isstring(para1), \n    name=para1;\n    cenrad=para2;\n    options=[];\n    ,\n    cenrad=para1;\n    options=para2;\n    name=\"\";// 16.10.07from\n    forall(cenrad, \n       name=name+#.name;\n    );// 16.10.07until\n  );\n  Circledata(name,cenrad,options);\n);\nCircledata(nm,cenrad,options):=(\n  regional(name,Out,Ctr,Ptcir,ra,Num,Rg,opstr,opcindy,color,color4,Msg,\n      tmp,tmp1,tmp2,Th,Ltype,Noflg,eqL,pA,pB,pC,d1,d2,Eps);  \n  name=\"cr\"+nm;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  Num=50;\n  Rg=[0,2*pi];\n  Msg=\"Y\";\n Msg=\"N\"; //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(substring(#,0,1)==\"N\",\n      Num=parse(tmp_2);\n     opstr=opstr+\",'\"+#+\"'\";\n    );\n    if(substring(#,0,1)==\"R\",\n      Rg=parse(tmp_2);\n      opstr=opstr+\",'\"+#+\"'\";\n    );\n    if(tmp1==\"M\", //190206from\n      Msg=Toupper(substring(tmp_2,0,1));\n    ); //190206to\n  );\n  if(length(cenrad)==2,\n    Ctr=Lcrd(cenrad_1);\n    Ptcir=Lcrd(cenrad_2);\n    if(!islist(Ptcir),  //190323from\n      Ptcir=Ctr+[Ptcir,0];\n    );  //190323to\n    ra=dist(Ctr,Ptcir);\n  ,\n    Eps=10^(-1);\n    pA=Lcrd(cenrad_1);\n    pB=Lcrd(cenrad_2);\n    pC=Lcrd(cenrad_3);\n    tmp=pB-pA;\n    tmp1=(tmp_2,-tmp_1);\n    tmp=pC-pB;\n    tmp2=(tmp_2,-tmp_1);\n    d1=det([tmp1,tmp2]);\n    d2=det([pC-pA,tmp2]);\n    if(abs(d1)&lt;Eps &amp; abs(d2)&gt;10*Eps,\n      println(\"points are in a line\");\n      ra=0;\n    ,\n      Ctr=1/2*(pA+pB)+1/2*d2/d1*tmp1;\n      ra=|pA-Ctr|;\n      tmp=name+\"center=\"+Textformat(Ctr,5)+\";\";\n      parse(tmp);\n    );\n  );\n  if(ra&gt;0,\n    Out=[];\n    forall(0..Num,\n      Th=Rg_1+#*(Rg_2-Rg_1)/Num;\n      Out=append(Out,Ctr+ra*[cos(Th),sin(Th)]);\n    );\n  ,\n    tmp=100/dist(pA,pB)*(pB-pA);\n    Out=Listplot(\"1\",[pA-tmp,pB+tmp],[\"nodata\"]);\n  );\n  if(Noflg&lt;3,\n    if(Msg==\"Y\", //190206\n      println(\"generate Circledata \"+name);\n    );\n    tmp1=apply(Out,Pcrd(#));\n    tmp=name+\"=\"+Textformat(tmp1,10)+\";\"; //190415,210311\n    parse(tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  Out;\n);\nIntersectcrvspp(Gr1,Gr2):=Intersectcrvspp(Gr1,Gr2,[]);\nIntersectcrvspp(Gr1,Gr2,options):=(\n  regional(Out,Eps,Eps2,Eps0,Flg,Data1,Data2,\n    Tmp1,Tmp2,Tmp3,Tmp,KL1,KL2,pA,pB,Ni,Nj,\n    pP,pQ,rT,Flg,eqL,realL,opstr,Dif);\n  Eps=10^(-6); //210730\n  Eps2=0.1;\n  Dif=0.05; // 2015.05.31\n  Flg=0;\n  Tmp1=Divoptions(options); // \n  eqL=Tmp1_5;\n  realL=Tmp1_6;\n  opstr=Tmp1_(length(Tmp1));\n  forall(eqL,\n    if(substring(#,0,1)==\"D\",\n      Tmp1=indexof(#,\"=\");\n      Dif=parse(substring(#,Tmp1,length(#)));\n    );\n  );\n  Tmp1=length(realL);\n  if(Tmp1&gt;0,\n    Eps=realL_1;\n    if(Tmp1&gt;1,\n      Eps2=realL_2;\n    );\n  );\n  Flg=0;\n  if(isstring(Gr1),Data1=parse(Gr1),Data1=Gr1);\n  if(isstring(Gr2),Data2=parse(Gr2),Data2=Gr2);\n  if(Measuredepth(Data1)==2,Data1=Data1_1);\n  if(Measuredepth(Data2)==2,Data2=Data2_1);\n  Data1=apply(Data1,LLcrd(#));\n  Data2=apply(Data2,LLcrd(#));\n  if(length(Data1)==length(Data2),\n    Tmp1=reverse(Data2); \n    Eps0=10^(-6);\n    Tmp2=0;\n    forall(1..(length(Data1)),\n      Tmp2=Tmp2+abs(Data1_#-Data2_#);\n    );\n    Tmp3=0;\n    forall(1..(length(Data1)),\n      Tmp3=Tmp3+abs(Data1_#-Tmp1_#);\n    );\n    if(Tmp2&lt;Eps0 % Tmp3&lt;Eps0,\n      Out=[];\n      Flg=1;\n    );\n  );\n  if(Flg==0,\n    KL1=[];\n    KL2=[];\n    forall(1..(length(Data1)-1),Ni,\n      pA=Data1_Ni;\n      pB=Data1_(Ni+1);\n      forall(1..(length(Data2)-1),\n        pP=Data2_#; pQ=Data2_(#+1);\n        Tmp=Koutenseg(pA,pB,pP,pQ,[Eps,Eps2]);\n        if(Tmp!=[\"inf\",\"inf\"],\n          if(Tmp_3==0,\n            Tmp1=[Tmp_1,Tmp_2,Ni,#];\n            KL1=concat(KL1,[Tmp1]);\n          ,\n            Tmp2=[Tmp_1,Tmp_2,Ni,#];\n            KL2=concat(KL2,[Tmp2]);\n          );\n        );\n      );\n    );\n    Out=[];\n    if(length(KL1)&gt;0,\n      Tmp=KL1_1;\n      pP=Tmp_1;\n      rT=Tmp_2;\n      Ni=Tmp_3;\n      Nj=Tmp_4;\n      Tmp=[pP,Ni+rT,Nj];\n      Out=[Tmp];\n    );\n    forall(2..(length(KL1)),Ni, \n      Tmp=KL1_Ni; \n      pP=Tmp_1;\n      Tmp2=0;\n      Flg=0;\n      forall(1..(length(Out)),Nj,\n        if(Flg==0,\n          Tmp=Out_Nj;\n          if(|pP-Tmp_1|&lt;Eps,\n            Tmp2=1;\n            Flg=1;\n          );\n        );\n      );\n      if(Tmp2==0,\n        Tmp=KL1_Ni; \n        pP=Tmp_1;\n        rT=Tmp_2;\n        Tmp1=Tmp_3;\n        Tmp2=Tmp_4;\n        Tmp=[pP,Tmp1+rT,Tmp2];\n        Out=concat(Out,[Tmp]);\n      );\n    );\n    forall(1..(length(KL2)),Ni,\n      Tmp=KL2_Ni;  // 15.11.21 Usui\n      pP=Tmp_1; \n      Tmp2=0;\n      Flg=0;\n      forall(1..(length(Out)),Nj,\n        if(Flg==0,\n          Tmp=Out_Nj;\n          if(|pP-Tmp_1|&lt;Eps,\n            Tmp2=1;\n            Flg=1;\n          );\n        );\n      );\n      if(Tmp2==0,\n        Tmp=KL2_Ni;\n        rT=Tmp_2;\n        rT=min([max([rT,0]),1]);  // 15.11.21 Usui\n        Tmp=[pP,Tmp_3+rT,Tmp_4];\n        Out=concat(Out,[Tmp]);\n      );\n    );\n  );\n  Tmp1=Out;  // 15.04.06 from\n  Out=[];\n  forall(Tmp1,Tmp2,\n    Tmp3=select(1..(length(Out)),//16.11.27,\n        |Out_#_1-Tmp2_1|&lt;Dif &amp; |Out_#_2-Tmp2_2|&lt;=1&amp; |Out_#_3-Tmp2_3|&lt;=1);\n    if(length(Tmp3)==0,\n      Out=append(Out,Tmp2);\n    ,\n      forall(Tmp3, //16.11.27\n        Out_#_1=(Out_#_1+Tmp2_1)/2;//17.04.14\n      );\n    );\n  ); // 15.04.06 until\n  Out;\n);\nKoutenseg(pA,pB,pC,pD):=Koutenseg(pA,pB,pC,pD,[]);\nKoutenseg(pA,pB,pC,pD,options):=(\n  regional(Eps0,Eps,Eps2,pV,Sv2,Out,pP,pQ,Flg,p1,p2,q1,q2,\n          em1,eM1,em2,eM2,rT,Tmp1,Tmp2);\n  Eps0=10^(-4);\n  pV=pB-pA;\n  Sv2=|pV|;\n  pP=pC-pA; pQ=pD-pA;\n  Eps=10^(-3);\n  Eps2=0.2;\n  Tmp1=0;\n  forall(options,\n    if(Tmp1==0,\n      Eps=#;\n      Tmp1=1;\n    ,\n      Eps2=#;\n    );\n  );\n  Flg=0;\n  if(Sv2&lt;10^(-3),\n     Out=[\"inf\",\"inf\"];\n     Flg=1;\n  );\n  if(Flg==0,\n    Eps=min([Eps2,Eps/Sv2]);\n    p1=pP*pV/Sv2^2;\n    p2=[pP_2,-pP_1]*pV/Sv2^2;\n    q1=pQ*pV/Sv2^2;\n    q2=[pQ_2,-pQ_1]*pV/Sv2^2;\n    em1=-Eps; eM1=1+Eps;\n    em2=-Eps; eM2=Eps;\n    if(max([p1,q1])&lt;em1 % min([p1,q1])&gt;eM1,\n      Out=[\"inf\",\"inf\"];\n      Flg=1;\n    );\n    if(max([p2,q2])&lt;em2 % min([p2,q2])&gt;eM2,\n      Out=[\"inf\",\"inf\"];\n      Flg=1;\n    );\n  );\n  if(Flg==0 &amp; p2*q2&lt;0,\n    rT=p1-(q1-p1)/(q2-p2)*p2;\n    if(rT&gt;em1 &amp; rT&lt;eM1,\n      if(rT&gt;-Eps0 &amp; rT&lt;1+Eps0,\n        Tmp1=pA+rT*pV;\n        Tmp2=min([max([rT,0]),1]);\n        Out=[Tmp1,Tmp2,0];\n      ,\n        Tmp1=pA+rT*pV;\n        Tmp2=min([max([rT,0]),1]);\n        Out=[Tmp1,Tmp2,1];\n      );\n      Flg=1;\n    );\n    if(Flg==0 &amp; (p1&lt;em1 % p1&gt;eM1 % p2&lt;em2 % p2&gt;eM2),\n      if(q1&lt;em1 % q1&gt;eM1 % q2&lt;em2 % q2&gt;eM2,\n         Out=[\"inf\",\"inf\"];\n         Flg=1;\n      );\n      if(Flg==0,\n        rT=min([max([p1,0]),1]);\n        Tmp1=pA+rT*pV;\n        Out=[Tmp1,rT,1];\n        Flg=1;\n      );\n    );\n  );\n  if(Flg==0 &amp; (p1 &gt; -Eps0 &amp; p1 &lt; 1 + Eps0 &amp; p2 &gt; -Eps0 &amp; p2 &lt; Eps0),\n    rT= p1;\n    Tmp1=pA+rT*pV;\n    Out= [Tmp1, rT, 0];\n    Flg=1;\n  );\n  if(Flg==0 &amp; (q1 &gt; -Eps0 &amp; q1 &lt; 1 + Eps0 &amp; q2 &gt; -Eps0 &amp; q2 &lt; Eps0),\n    rT= q1;\n    Tmp1=pA+rT*pV;\n    Out=[Tmp1,rT,0];\n    Flg=1;\n  );\n  if(Flg==0 &amp; (p1&lt;em1 %  p1&gt;eM1 % p2&lt;em2 % p2&gt;eM2),\n    if(q1&lt;em1 % q1&gt;eM1 % q2&lt;em2 % q2&gt;eM2,\n      Out=[\"inf\",\"inf\"];      \n      Flg=1;\n    );\n    if(Flg==0,\n      rT=min([max([q1,0]),1]);\n      Tmp1=pA+rT*pV;\n      Out=[Tmp1,rT,1];\n      Flg=1;\n    );\n  );\n  if(Flg==0 &amp; (q1&lt;em1 %  q1&gt;eM1% q2&lt;em2 % q2&gt;eM2),\n    rT=min([max([p1,0]),1]);\n    Tmp1=pA+rT*pV;\n    Out=[Tmp1,rT,1];\n    Flg=1;\n  );\n  if(Flg==0,\n    if(abs(p2)&lt;abs(q2),\n      rT=min([max([p1,0]),1]);\n    ,\n      rT=min([max([q1,0]),1]);\n    );\n    Tmp1=pA+rT*pV;\n    Out=[Tmp1,rT,1];\n  );\n  if(!isstring(Out_1),Out=apply(Out,re(#))); //190802\n  Out;\n);\nPtend(Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);\n  tmp_(length(tmp)); // 15.04.12\n);\nPtstart(Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);  // 16.01.21\n  tmp_1;\n);\nTranslatepoint(point,mov):=(\n  regional(X1,X2,Y1,Y2,Cx,Cy,tmp);\n  tmp=Lcrd(point);\n  X1=tmp_1; Y1=tmp_2;\n  tmp=Lcrd(mov);\n  Cx=tmp_1; Cy=tmp_2;\n  X2=X1+Cx;\n  Y2=Y1+Cy; \n  [X2,Y2];\n);\nInwindow(point):=Inwindow(point,[XMIN,XMAX],[YMIN,YMAX]);\nInwindow(point,xrng,yrng):=(\n  regional(Eps,pt,x,y,xmin,xmax,ymin,ymax,tmp);\n  Eps=10.0^(-6);\n  if(ispoint(point),pt=point.xy,pt=point);\n  x=pt_1; y=pt_2;\n  xmin=xrng_1; xmax=xrng_2;\n  ymin=yrng_1; ymax=yrng_2;\n  tmp=(x&gt;xmin-Eps)&amp;(x&lt;xmax+Eps)&amp;(y&gt;ymin-Eps)&amp;(y&lt;ymax+Eps);\n  if(tmp,true,false);\n);\nPartcrv(nm,pA,pB,PkLstr):=Partcrv(nm,pA,pB,PkLstr,[]);\nPartcrv(nm,pAorg,pBorg,PkLstr,options):=(\n  regional(pA,pB,PkL,PkLL,Ans,Eps,Npt,Out1,Out2,tmp,tmp1,tmp2,Flg,nS,nE,\n        PPL,pP,opcindy,Ta,Tb,name,Ltype,Noflg,eqL,msg,DepthFlg,color,color4);\n  if(substring(nm,0,1)==\"-\", //201106from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"part\"+nm;\n  ); //201106to\n  pA=pAorg; pB=pBorg; //201031\n  if(isstring(PkLstr),PkL=parse(PkLstr),PkL=PkLstr);\n  DepthFlg=0;\n  if(Measuredepth(PkL)==2,\n    PkL=PkL_1;\n    DepthFlg=1;\n  );\n  PkLL=apply(PkL,LLcrd(#)); //201031\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  msg=\"Y\";\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    tmp2=Toupper(substring(tmp_2,0,1));\n    if(tmp1==\"M\",\n      msg=tmp2;\n    );\n  );\n  Eps=10^(-4);\n  Flg=0;\n  if(isreal(pA),\n    if(pA&gt;pB+Eps,\n      Npt=Numptcrv(PkL);\n      Out1=Partcrv(\"\",pA,Npt,PkLstr,[\"nodata\"]);\n      Out2=Partcrv(\"\",1,pB,PkLstr,[\"nodata\"]);\n      tmp=Ptstart(PkL)-Ptend(PkL);\n      if(|tmp|&lt;Eps,\n        Ans=Joincrvs(\"\",[Out1,Out2],[\"nodata\"]);\n      ,\n        Ans=[apply(Out1,Pcrd(#)),apply(Out2,Pcrd(#))];\n      );\n      Flg=1;\n    );\n    if(Flg==0,\n      nS=ceil(pA);\n      nE=floor(pB);\n      PPL=[];\n      if(pA&lt;nS-Eps,\n        pP=(nS-pA)*PkL_(nS-1)+(1-nS+pA)*PkL_nS;\n        PPL=[pP];\n      );\n      PPL=concat(PPL,PkL_(nS..nE));\n      if(pB&gt;nE+Eps,\n        pP=(1-pB+nE)*PkL_nE+(pB-nE)*PkL_(nE+1);\n        PPL=concat(PPL,[pP]);\n      );\n      Ans=PPL;\n      Flg=1;\n    );\n  );\n  if(Flg==0,\n    pA=Pcrd(pA); //201031from\n    pB=Pcrd(pB); \n    tmp=Nearestpt(LLcrd(pA),PkLL); //201031to\n    Ta=tmp_2;\n    tmp=Nearestpt(LLcrd(pB),PkLL); // 15.09.12\n    Tb=tmp_2;\n    Ans=Partcrv(\"\",Ta,Tb,PkL,[\"nodata\"] );\n  );\n  if(Noflg&lt;3,\n    tmp1=apply(Ans,Pcrd(#)); //201030\n    tmp=name+\"=\"+Textformat(Ans,5)+\";\"; //190415\n    parse(tmp);\n    if(DepthFlg==0,\n      tmp=PkLstr;\n    ,\n      tmp=PkLstr+\"(1)\";\n    );\n    tmp1=name+\"=Partcrv(\"+Textformat(Lcrd(pA),5)\n         +\",\"+Textformat(Lcrd(pB),5)+\",\"+tmp+\")\"; // 16.04.03\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  Ans;\n);\nNumptcrv(Fig):=(\n  regional(tmp);\n  if(isstring(Fig),tmp=parse(Fig),tmp=Fig);  // 15.12.23\n  length(tmp);\n);\nJoincrvs(nm,plotstrL):=Joincrvs(nm,plotstrL,[]);\nJoincrvs(nm,plotstrL,options):=(\n  regional(plotlist,PtL,Eps,QdL,Flg,Ni,Qd,pP,pS,pQ,pR,rMN,\n        opcindy,tmp,tmp1,tmp2,str,name,Ltype,Noflg,color,color4);\n  name=\"join\"+nm;\n  plotlist=[];\n  forall(plotstrL,str,\n    if(isstring(str),\n      tmp=parse(str);\n      tmp=apply(tmp,LLcrd(#));\n    ,\n      tmp=str;\n    );\n    plotlist=append(plotlist,tmp);\n  );\n  Eps=10^(-4);\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200629\n  opcindy=tmp_(length(tmp));\n  tmp1=tmp_6;\n  if(length(tmp1)&gt;0,Eps=tmp1_1);\n  QdL=[];\n  forall(plotlist,Qd,\n    if(ispoint(Qd_1) % !islist(Qd_1_1),\n      QdL=concat(QdL,[Qd]);\n    ,\n      forall(Qd,\n        QdL=concat(QdL,[#]);\n      );\n    );\n  );\n  Flg=0;\n  if(length(QdL)==0,\n    PtL=[];\n    Flg=1;\n  );\n  if(Flg==0,\n    PtL=QdL_1;\n    forall(2..(length(QdL)),Ni,\n      Qd=QdL_Ni;\n      if(Numptcrv(Qd)&gt;1,\n        pP=Ptend(PtL);\n        pS=Ptstart(PtL);\n        pQ=Ptstart(Qd);\n        pR=Ptend(Qd);\n        rMN=min([|pP-pQ|,|pP-pR|,|pS-pQ|,|pS-pR|]);\n        if(rMN==|pP-pR|,\n          Qd=reverse(Qd);\n        ,\n          if(rMN==|pS-pQ|,\n            PtL=reverse(PtL);\n          ,\n            if(rMN==|pS-pR|,\n              PtL=reverse(PtL);\n              Qd=reverse(Qd);\n            );\n          );\n        );\n      );\n      if(rMN&gt;Eps,\n        PtL=concat(PtL,Qd);\n      ,\n        PtL=concat(PtL,Qd_(2..(length(Qd))));\n      );\n    );\n  );\n  if(Noflg&lt;3,\n    println(\"generate joincurve \"+name);\n    tmp1=apply(PtL,Pcrd(#));\n    tmp=name+\"=\"+Textformat(tmp1,5)+\";\";\n    parse(tmp);\n    tmp1=\"\";\n    forall(plotstrL,\n        tmp1=tmp1+#+\",\";\n    );\n    tmp1=substring(tmp1,0,length(tmp1)-1);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  PtL;\n);\nShade(plist):=Shade(plist,[]); \nShade(Arg1,Arg2):=(\n  if(!isstring(Arg1),\n    Shade(text(SHADECTR),Arg1,Arg2); //190222\n  ,\n    Shade(Arg1,Arg2,[]);\n  );\n);\nShade(nm,plistorg,options):=(\n  regional(name,plist,jj,nn,trim,first,tmp,tmp1,tmp2,Noflg,\n     opstr,opcindy,eqL,reL,Str,G2,flg,encflg,startpt,color,color4,ctr,ptshade);\n  if(substring(nm,0,1)==\"-\", //200513from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"shade\"+nm;\n  ); //200513to\n  plist=plistorg;\n  tmp=Divoptions(options);\n  Noflg=tmp_2; //200512\n  eqL=tmp_5; \n  reL=tmp_6;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  encflg=0; //201029\n  tmp=select(plist,indexof(#,\"Invert\")&gt;0); //180929from\n  trim=\"N\";\n  first=\"N\"; //191007\n  ptshade=\"N\"; //200513\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(tmp_1);\n    tmp2=Toupper(tmp_2);\n    if(substring(tmp1,0,1)==\"E\",\n      if(substring(tmp2,0,1)==\"Y\",\n        encflg=1;\n      );\n    );\n    if(substring(tmp1,0,1)==\"T\",\n      trim=substring(tmp2,0,1);\n    );\n    if(substring(tmp1,0,1)==\"F\",\n      first=substring(tmp2,0,1);\n    );\n    if(substring(tmp1,0,1)==\"P\", //200513[3lines]\n      ptshade=Toupper(substring(tmp2,0,1));\n    );\n  );\n  startpt=[];\n  forall(reL,\n    if(islist(#),\n      startpt=#;\n    );\n  ); //180929to\n  flg=0; ctr=1;\n  if(encflg==1, //180929from\n    if(length(startpt)==2,\n      Enclosing(nm,plist,[startpt,\"nodisp\"]);\n    ,\n      Enclosing(nm,plist,[\"nodisp\"]);\n    );\n    plist=[\"en\"+nm];\n  ); //180929to\n  if((length(plist)==1)&amp;(trim==\"Y\"), //190220from,109224\n    plist=[Shadein(plist)];\n  ); //190220to\n  forall(1..(length(plist)),jj, //180613from\n    if(flg==0,\n      tmp1=plist_jj;\n      if(isstring(tmp1),tmp=parse(tmp1),tmp=tmp1);\n      if(!islist(tmp),\n         flg=1;\n      ,\n        if(!isstring(tmp1),\n          tmp2=[];\n          forall(tmp1,if(ispoint(#),tmp=#.xy,tmp=#);\n            tmp2=append(tmp2,tmp);\n          );\n          Listplot(\"-\"+name+text(ctr),tmp2,[\"nodisp\"]); //190520\n          plist_jj=name+text(ctr);\n          ctr=ctr+1;\n        );\n      ); \n    );\n  );//180613to\n  if(flg==1,\n    println(\"    Shade : some data not defined properly\");\n ,\n    if(Noflg&lt;2, //200512\n      G2=Joincrvs(\"1\",plist,[\"nodata\"]);\n      G2=apply(G2,Pcrd(#));\n      tmp1=\"fillpoly(\"+Textformat(G2,10)+opcindy+\");\";\n      if(ptshade==\"N\", //200513from\n        tmp=select(1..(length(GCLIST)),contains(plist,GCLIST_#_1)); //200715from\n        if(length(tmp)&gt;0,\n          nn=min(tmp);\n        ,\n          nn=length(GCLIST)+1;\n        );\n        tmp2=GCLIST_(1..(nn-1));\n        tmp2=append(tmp2,[tmp1,[5,0]]);\n        GCLIST=concat(tmp2,GCLIST_(nn..(length(GCLIST))));\n      ,\n        PTSHADElist=append(PTSHADElist,[name,tmp1]);\n      ); //200513to\n    );\n  );\n  SHADECTR=SHADECTR+1;\n);\nEnclosing(nm,plist):=Enclosing2(nm,plist,[]);//180706[2lines]\nEnclosing(nm,plistorg,options):=Enclosing2(nm,plistorg,options);\nEnclosing2(nm,plist):=Enclosing2(nm,plist,[]);\nEnclosing2(nm,plistorg,options):=(\n  regional(name,plist,AnsL,Start,Eps,Eps1,Eps2,flg,Fdata,Gdata,KL,\n      t1,t2,tst,ss,ii,nn,nxtno,Ltype,Noflg,realL,eqL,opstr,opcindy,\n      tmp,tmp1,tmp2,tmp3,tmp4,color,color4,p1,p2);\n  if(substring(nm,0,1)==\"-\",  //201110from\n    name=substrin(nm,1,length(nm));\n  ,\n    name=\"en\"+nm;\n  );  //201110to\n  plist=plistorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  realL=tmp_6;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200629\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  Eps=10^(-5); // 16.12.05\n  Eps1=0.01;\n  Eps2=0.1;\n  Start=[];\n  flg=0;\n  forall(realL,\n    if(isList(#) % ispoint(#),\n      Start=Lcrd(#); // 18.02.02\n    ,\n      if(flg==1,Eps1=#);\n      if(flg==2,Eps2=#);\n      flg=flg+1;\n    );\n  );\n  flg=0;\n  AnsL=[];\n  if(length(plist)==1,\n    Fdata=parse(plist_1);\n    tmp1=Fdata_1;\n    tmp2=Fdata_(length(Fdata));\n    if(|tmp1-tmp2|&lt;Eps,\n      AnsL=Fdata;\n    ,\n      AnsL=append(Fdata,tmp1);\n    );\n    flg=1;\n  );\n  if(flg==0,\n    Fdata=plist_1;\n    Gdata=plist_(length(plist));\n    KL=Intersectcurvespp(Fdata,Gdata);\n   if(length(KL)==0,\n      tmp=parse(Gdata);\n      tmp1=LLcrd(Op(length(tmp),tmp)); //18.02.02from\n      tmp=parse(Fdata);\n      tmp2=LLcrd(Op(1,tmp));\n      tmp=Listplot(name,[tmp1,tmp2],[\"nodisp\"]);\n      plist=append(plist,\"sg\"+name);\n      Start=tmp2;\n      tst=1; //18.02.02to\n      p1=Start;\n    ,\n      if(length(KL)==1,\n        tst=KL_1_2;\n        Start=Pointoncurve(tst,Fdata);\n      );\n      if(length(KL)&gt;1,\n        KL=sort(KL,[#_2]);\n        if(Start==[],\n          tst=KL_1_2;\n          Start=Pointoncurve(tst,Fdata);\n        ,\n          tmp=apply(KL,|#_1-Start|);\n          tmp=min(tmp);\n          tmp1=select(KL,|#_1-Start|&lt;tmp+Eps1);//180718\n          tst=tmp1_1_2;\n          Start=Pointoncurve(tst,Fdata);\n        );\n      );\n    );\n  );\n  if(flg==0,\n    t1=tst;\n    p1=Pointoncurve(t1,Fdata); //180713\n    println(\"Start point of enclosing is \"+text(Start));\n    forall(1..(length(plist)),nn,\n      Fdata=plist_nn;\n      if(nn==length(plist),nxtno=1,nxtno=nn+1);\n      Gdata=plist_nxtno;\n      tmp1=parse(Fdata); //200803from\n      tmp2=parse(Gdata);\n      if(|tmp2_1-tmp1_(-1)|&lt;Eps,\n        if(nn&lt;length(plist), //211217from\n          AnsL=concat(AnsL,tmp1);\n        ,\n          tmp3=Partcrv(\"\",AnsL_(-1),tmp2_1,tmp1,[\"nodata\"]);\n          AnsL=concat(AnsL,tmp3);\n        );  //211217fto\n      ,  //200803to\n        KL=Intersectcurvespp(Fdata,Gdata);\n        if(length(KL)==0, \n          tmp2=Prepend(Op(length(tmp1),tmp),tmp2);\n          Gdata=replace(Gdata,\"(\",\"\");\n          Gdata=replace(Gdata,\")\",\"\");\n          tmp=Gdata+\"=\"+Textformat(tmp2,10)+\";\"; //190415\n          parse(tmp);\n          plist_nxtno=Gdata;\n          t2=Length(tmp1);\n          p2=Pointoncurve(t2,Fdata); //180713\n          ss=1; //18.02.02to\n        ,\n          KL=sort(KL,[#_2]);//180706\n          tmp=parse(Fdata);\n          tmp1=t1+Eps;\n          tmp=select(KL,(#_2&gt;tmp1)%((#_2&gt;t1)&amp;(|#_1-p1|&gt;Eps1))); //210411from\n          if(length(tmp)&gt;0,\n            KL=tmp;\n          ,\n            KL=KL;  //211002,1014\n          ); //210411to\n          t2=KL_1_2;\n          ss=KL_1_3;\n          if(abs(t2-t1)&lt;Eps,//180707\n            if(length(KL)&gt;1,\n              t2=KL_2_2;\n              ss=KL_2_3;\n            ,\n              println(text(nn)+\" and \"+text(nxtno)+\" not intersect\");\n              flg=1;\n            );\n          );\n        );\n        if(flg==0,\n          tmp=Partcrv(\"\",t1,t2,Fdata,[\"nodata\"]);\n          if(nn==1,\n            AnsL=tmp;\n          ,\n            AnsL=concat(AnsL,tmp_(2..(length(tmp))));\n          );\n        );\n        t1=ss;//180706\n        p1=Pointoncurve(t1,Gdata); //180713\n      );\n    );\n    if(flg==0,\n      AnsL=apply(1..(length(AnsL)),Pcrd(AnsL_#));\n    );\n  );\n  AnsL=Unscaling(AnsL); //201110\n  if(Noflg&lt;3,\n    println(\"generate Enclosing \"+name);\n    tmp=name+\"=\"+Textformat(AnsL,10)+\";\"; //190415\n    parse(tmp);\n    tmp=parse(name); //210530[2lines]\n    tmp=apply(tmp,LLcrd(#));\n    Listplot(\"-\"+name,tmp,[\"nodisp\"]); //210421\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  AnsL; //201110\n);\nIntersectcurvespp(crv1org,crv2org):=Intersectcurvespp(crv1org,crv2org,[]);\nIntersectcurvespp(crv1org,crv2org,options):=(\n  regional(Eps,Eps1,Eps2,Dist,crv1,crv2,ii,jj,seg1,seg2,self,loopL,out,\n          flg,tmp,tmp1,tmp2);\n  Eps=10^(-4);\n  Eps1=0.01;\n  Eps2=0.1;\n  Dist=10*Eps2;\n  if(length(options)&gt;0,\n    Eps1=options_1;\n    if(length(options)&gt;1,\n      Eps2=options_2;\n      Dist=10*Eps2;\n      if(length(options)&gt;2,\n        Dist=options_3;\n      );\n    );\n  );\n  if(isstring(crv1org),tmp1=parse(crv1org),tmp1=crv1org);//18.01.05from\n  if(isstring(crv2org),tmp2=parse(crv2org),tmp2=crv2org);\n  tmp1=apply(tmp1,LLcrd(#));\n  tmp2=apply(tmp2,LLcrd(#)); \n  crv1=[tmp1_1];\n  forall(tmp1,\n    tmp=crv1_(length(crv1));\n    if(|tmp-#|&gt;Eps,\n      crv1=append(crv1,#);\n    );\n  );\n  crv2=[tmp2_1];\n  forall(tmp2,\n    tmp=crv2_(length(crv2));\n    if(|tmp-#|&gt;Eps,\n      crv2=append(crv2,#);\n    );\n  );//18.01.05until\n  if(crv1==crv2,\n    self=1;\n  ,\n    self=0;\n  );\n  out=[];\n  forall(1..(length(crv1)-1),ii,\n    if(self==0,\n      loopL=1..(length(crv2)-1);\n    ,\n      loopL=(ii+2)..(length(crv2)-1);\n    );\n    forall(loopL,jj,\n      tmp=Intersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2,Dist);\n      if(length(tmp)&gt;0,\n        if(length(out)==0,\n          out=[tmp];\n        ,\n          tmp1=out_(length(out));\n          if(|tmp1_1-tmp_1|&gt;Eps1,\n            out=append(out,tmp);\n          );\n        );\n        if(self==1,\n          tmp=[tmp_1,tmp_3,tmp_2,tmp_4,tmp_5];\n          out=append(out,tmp);\n        );\n      );\n    );\n  );\n  tmp2=out;\n  out=[];\n  tmp1=tmp2;\n  flg=0;\n  forall(1..(length(tmp2)),\n    if(flg==0,\n      tmp=Collectsameseg(tmp1);\n      out=append(out,tmp_1);\n      if(length(tmp_2)==0,\n        flg=1;\n      ,\n        tmp1=tmp_2;\n      );\n    );\n  );\n  forall(1..(length(out)),ii,\n    tmp1=out_ii;\n    if(length(tmp1)==1,\n      out_ii=tmp1_1;\n    ,\n      tmp=apply(tmp1,#_4);\n      dst=min(tmp);\n      tmp1=select(tmp1,#_4&lt;dst+Eps);\n      tmp=apply(tmp1,#_1);\n      tmp=sum(tmp)/length(tmp);\n      tmp2=[tmp];\n      tmp=Nearestpt(tmp2_1,crv1org);\n      tmp2=append(tmp2,tmp_2);\n      tmp=Nearestpt(tmp2_1,crv2org);\n      tmp2=append(tmp2,tmp_2);\n      tmp2=concat(tmp2,[dst,tmp1_1_5]);\n      out_ii=tmp2;\n    );\n  );\n  if(length(out)&gt;0,  //190221from\n    out=sort(out,[#_2]);\n  );  //190221to\n  out;\n);\nIntersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2):=(\n  Intersectpartseg(crv1,crv2,ii,jj,Eps1,Eps2,10*Eps2);\n);\nIntersectpartseg(crv1org,crv2org,ii,jj,Eps1,Eps2,Dist):=(\n  regional(crv1,crv2,Eps,dst,kk,ll,seg1,seg2,snang,\n     p0,p1,p2,p3,os1,os2,out,tmp,tmp1,tmp2,flg);\n  crv1=crv1org; crv2=crv2org;\n  if(isstring(crv1),crv1=parse(crv1));\n  if(isstring(crv2),crv2=parse(crv2));\n  Eps=10^(-4);\n  out=[];\n  seg1=[crv1_ii,crv1_(ii+1)];\n  seg2=[crv2_jj,crv2_(jj+1)];\n  tmp1=seg1_2-seg1_1;\n  tmp2=seg2_2-seg2_1;\n  snang=abs(Crossprod(tmp1,tmp2))/(Norm(tmp1)*Norm(tmp2));\n  tmp=Intersectseg(seg1,seg2,Eps1);\n  dst=tmp_1;\n  if(dst&lt;Eps,\n    out=[tmp_2,ii+tmp_3,jj+tmp_4,dst,snang];\n  ,\n    if(dst&lt;Eps2,\n      if((length(crv1)==2)%(|seg1_2-seg1_1|&gt;Dist-Eps),\n        os1=seg1;\n      ,\n        p1=seg1_1; p2=seg1_2;\n        if(ii==1,\n          p3=crv1_3;\n          tmp=p2-p1;\n          tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n          p0=Reflectpoint(p3,[(p1+p2)/2,tmp]);\n        ,\n          if(ii==length(crv1)-1,\n            p0=crv1_(ii-1);\n            tmp=p2-p1;\n            tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n            p3=Reflectpoint(p0,[(p1+p2)/2,tmp]);\n          ,\n            p0=crv1_(ii-1); p3=crv1_(ii+2);\n          );\n        );\n        os1=Osplineseg([p0,p1,p2,p3]);\n      );\n      if((length(crv2)==2)%(|seg2_2-seg2_1|&gt;Dist-Eps), //18.01.05\n        os2=seg2;\n      ,\n        p1=seg2_1; p2=seg2_2;\n        if(jj==1,\n          p3=crv2_3;\n          tmp=p2-p1;\n          tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n          p0=Reflectpoint(p3,[(p1+p2)/2,tmp]);\n        ,\n          if(jj==length(crv2)-1,\n            p0=crv2_(jj-1);\n            tmp=p2-p1;\n            tmp=(p1+p2)/2+[tmp_2,-tmp_1];\n            p3=Reflectpoint(p0,[(p1+p2)/2,tmp]);\n          ,\n            p0=crv2_(jj-1); p3=crv2_(jj+2);\n          );\n        );\n        os2=Osplineseg([p0,p1,p2,p3]);\n      );\n      tmp2=[];\n      forall(1..(length(os1)-1),kk,\n        forall(1..(length(os2)-1),ll,\n          seg1=[os1_kk,os1_(kk+1)];\n          seg2=[os2_ll,os2_(ll+1)];\n          tmp=Intersectseg(seg1,seg2,Eps1);\n          if((tmp_1&lt;Eps1)&amp;(length(tmp)&gt;1), //18.02.06\n            if(tmp_1&lt;dst+Eps,\n              dst=tmp_1;\n              tmp2=select(tmp2,#_1&lt;dst);\n              tmp2=append(tmp2,[dst,tmp_2]);\n            );\n          );\n        );\n      );\n      if(length(tmp2)&gt;0,\n        tmp=apply(tmp2,#_2_1);\n        tmp1=[sum(tmp)/length(tmp2)];\n        tmp=apply(tmp2,#_2_2);\n        tmp1=append(tmp1,sum(tmp)/length(tmp2));\n        out=[tmp1];\n        p1=crv1_ii; p2=crv1_(ii+1);\n        tmp=[Op(2,p2-p1),-Op(1,p2-p1)];\n        tmp=Intersectline(out_1,tmp,p1,p2-p1);\n        tmp=min([max([tmp_3,0]),1]);\n        out=[tmp1,ii+tmp];\n        p1=crv2_jj; p2=crv2_(jj+1);\n        tmp=[Op(2,p2-p1),-Op(1,p2-p1)];\n        tmp=Intersectline(out_1,tmp,p1,p2-p1);\n        tmp=min([max([tmp_3,0]),1]);\n        out=concat(out,[jj+tmp,dst,snang]);\n      );\n    );\n  );\n  out;\n);\nReflectpoint(point,symL):=(\n  regional(X1,X2,Y1,Y2,Us,Vs,Pt1,Pt2,Cx,Cy,flg,tmp);\n  tmp=Lcrd(point);\n  X1=tmp_1; Y1=tmp_2;\n  if(!islist(symL), //210104from\n    Pt1=Lcrd(symL);\n    Pt2=Pt1;\n  ,\n    if(length(symL)==1,\n      Pt1=Lcrd(symL_1);\n      Pt2=Pt1;\n    ,\n      if(isreal(symL_1),\n        Pt1=Lcrd(symL);\n        Pt2=Pt1;\n      ,\n        Pt1=Lcrd(symL_1);\n        Pt2=Lcrd(symL_2);\n      );\n    );\n  ); //210104to\n  Us=Pt2_1-Pt1_1;\n  Vs=Pt2_2-Pt1_2;\n  if(Pt1==Pt2,\n    X2=2*Pt1_1-X1;\n    Y2=2*Pt1_2-Y1;\n  ,\n    X2=(Us^2-Vs^2)/(Us^2+Vs^2)*X1+2*Us*Vs/(Us^2+Vs^2)*Y1\n              -2*Vs*(Us*Pt1_2-Vs*Pt1_1)/(Us^2+Vs^2);\n    Y2=2*Us*Vs/(Us^2+Vs^2)*X1-(Us^2-Vs^2)/(Us^2+Vs^2)*Y1\n              +2*Us*(Us*Pt1_2-Vs*Pt1_1)/(Us^2+Vs^2);\n  );\n  [X2,Y2];\n);\nOsplineseg(list):=Osplineseg(list,[]);\nOsplineseg(ptlist,optionsorg):=(\n  regional(tmp,tmp1,tmp2,list,ptL,ctrL,Eps,Eps0,\n      p0,p1,p2,p3,pQ,pR,cc,p01,p02,p11,p12,p21,p22,p31,p32,out);\n  Eps=10^(-2);\n  Eps0=10^(-6);\n  if(isstring(ptlist),list=parse(ptlist),list=ptlist);\n  p0=list_1; p1=list_2; p2=list_3; p3=list_4;\n  tmp=1+sqrt((1+Dotprod(p2-p0,p3-p1)/|p2-p0|/|p3-p1|)/2);\n  cc=4*|p2-p1|/3/(|p2-p0|+|p3-p1|)/tmp;\n  pQ=p1+cc*(p2-p0); // 15.09.21  // 16.08.16\n  pR=p2+cc*(p1-p3);  // 16.08.16\n  ctrL=[pQ,pR];\n  options=optionorg;\n  options=concat(options,[\"Num=20\",\"nodata\"]);\n  out=Bezier(\"\",[p1,p2],ctrL,options);\n  out;\n);\nBezier(ptctrlist):=Beziercurve(ptctrlist_3,ptctrlist_1,ptctrlist_2,[]);\nBezier(Arg1,Arg2):=( //190202from\n  regional(nm,ptctrlist,options);\n  if(islist(Arg1),\n    ptctrlist=Arg1; options=Arg2;\n    Beziercurve(ptctrlist_3,ptctrlist_1,ptctrlist_2,options);\n  ,\n    nm=Arg1; ptctrlist=Arg2;\n    Beziercurve(nm,ptctrlist_1,ptctrlist_2,[]);\n  );\n); //190202to\nBezier(nm,ptlist,ctrlist):=Beziercurve(nm,ptlist,ctrlist,[]);\nBezier(nm,ptlist,ctrlist,options):=Beziercurve(nm,ptlist,ctrlist,options);\nBeziercurve(nm,ptlist,ctrlist):=Beziercurve(nm,ptlist,ctrlist,[]);\nBeziercurve(nm,ptlistorg,ctrlistorg,options):=(\n  regional(name,Ltype,Noflg,opstr,opcindy,Num,msgflg,\n    ptlist,ctrlist,tmp,tmp1,tmp2,ii,st,out,list,color,color4);\n  name=\"bz\"+nm;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2); color4=Colorrgb2cmyk(color); //200618\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  Num=10;\n  msgflg=\"Y\";\n  tmp1=tmp_5;\n  forall(tmp1,     // 14.12.31\n    if(substring(#,0,1)==\"N\",\n      tmp2=indexof(#,\"=\");\n      Num=parse(substring(#,tmp2,length(#)));\n      opstr=opstr+\",\"+Dq+#+Dq;\n    );\n    if(substring(#,0,1)==\"M\",\n      tmp2=indexof(#,\"=\");\n      msgflg=Toupper(substring(#,tmp2,tmp2+1));\n    );  );\n  ptlist=apply(ptlistorg,Lcrd(#)); // 16.08.16\n  ctrlist=[];  // 14.12.31\n  if(length(ctrlistorg)==length(ptlist)-1,\n    forall(1..(length(ctrlistorg)),ii, //190202\n      tmp1=apply(ctrlistorg_ii,Lcrd(#));  //190202\n      if(Measuredepth(tmp1)==0,tmp=[tmp1],tmp=tmp1);\n      ctrlist=append(ctrlist,tmp);\n    );\n  ,\n    forall(1..(length(ptlist)-1),ii,\n      tmp=ctrlistorg_((2*ii-1)..(2*ii));\n      tmp=apply(tmp,Lcrd(#)); // 16.08.16\n      ctrlist=append(ctrlist,tmp);\n    );\n  );\n  if(!islist(Num),\n    Num=apply(ctrlist,Num);\n  );\n  list=[];\n  forall(1..(length(ptlist)-1),ii,\n    tmp1=ptlist_(ii..(ii+1));\n    tmp2=ctrlist_ii;\n    if(ii==1,st=0,st=1);\n    forall(st..Num_ii,\n      tmp=Bezierpt(#/Num_ii,tmp1,tmp2);\n      list=append(list,tmp);\n    );\n  );\n  if(Noflg&lt;3,\n    if(msgflg==\"Y\",println(\"generate Bezier \"+name));\n    out=apply(list,Pcrd(#));\n    tmp=name+\"=\"+Textformat(out,10)+\";\"; //190415\n    parse(tmp);\n  );\n  if(Noflg&lt;3, //190818\n    if(isstring(Ltype),\n      Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n    ,\n      if(Noflg==1,Ltype=0);\n    );\n    GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n  );\n  BezierCtrL=ctrlist; //181001\n  list;\n);\nBezierpt(t,ptlist,ctrlist):=(\n  regional(flg3,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9);\n  p0=ptlist_1;\n  p3=ptlist_2;\n  p1=ctrlist_1;\n  if(length(ctrlist)==1,\n    p2=p3;\n    flg3=0;\n  ,\n    p2=ctrlist_2;\n    flg3=1;\n  );\n  if(length(p0)&lt;3,  // 15.02.08\n    p0=Lcrd(p0);\n    p3=Lcrd(p3);\n    p1=Lcrd(p1);\n    p2=Lcrd(p2);\n  );\n  p4=(1-t)*p0+t*p1;\n  p5=(1-t)*p1+t*p2;\n  p6=(1-t)*p2+t*p3;\n  p7=(1-t)*p4+t*p5;\n  p8=(1-t)*p5+t*p6;\n  p9=(1-t)*p7+t*p8;\n  if(flg3==0,p7,p9);\n);\nIntersectseg(seg1,seg2):=Intersectseg(seg1,seg2,0.01);\nIntersectseg(seg1org,seg2org,Eps1):=(\n  regional(Eps,seg1,seg2,p1,p2,q1,q2,t,s,pt,n,pts,out,dist,\n    tmp,tmp1,tmp2,tmp3);\n  Eps=10^(-4);\n  seg1=seg1org;\n  seg2=seg2org;\n  if(isstring(seg1),seg1=parse(seg1));\n  if(isstring(seg2),seg2=parse(seg2));\n  out=[];\n  p1=seg1_1; q1=seg1_2;\n  p2=seg2_1; q2=seg2_2;\n   if((|q1-p1|&lt;Eps)%(|q2-p2|&lt;Eps),\n    out=[-1];\n  ,\n    tmp=Intersectline(p1,q1-p1,p2,q2-p2);\n    if((islist(tmp))&amp;(length(tmp)==3),\n      pt=tmp_1; t=tmp_2; s=tmp_3;\n      if((t*(t-1)&lt;Eps)&amp;(s*(s-1)&lt;Eps),\n        out=[0,pt,t,s];\n      ,\n        t=min([max([t,0]),1]);\n        s=min([max([s,0]),1]);\n        tmp3=[|p1-p2|,|p1-q2|,|q1-p2|,|q1-q2|]; //18.01.30from\n        tmp1=[Op(2,q2-p2),-Op(1,q2-p2)];\n        tmp=Intersectline(p1,tmp1,p2,q2-p2);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-p1|);\n          );\n        );\n        tmp=Intersectline(q1,tmp1,p2,q2-p2);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-q1|);\n          );\n        );\n        tmp1=[Op(2,q1-p1),-Op(1,q1-p1)];\n        tmp=Intersectline(p2,tmp1,p1,q1-p1);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-p2|);\n          );\n        );\n        tmp=Intersectline(q2,tmp1,p1,q1-p1);\n        if(islist(tmp_1),\n          if(tmp_3*(tmp_3-1)&lt;Eps,\n            tmp3=append(tmp3,|tmp_1-q2|);\n          );\n        );\n        out=[min(tmp3),pt,t,s]; //18.01.30until\n      );\n    ,\n      dist=tmp_1;\n      tmp1=q1-p1;      \n      n=[tmp1_2,-tmp1_1]/|tmp1|;\n      pts=[];\n      tmp=Intersectline(p1,n,p2,q2-p2);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p2+tmp_3*q2;\n        pts=append(pts,[tmp1,0,tmp_3]);\n      );\n      tmp=Intersectline(q1,n,p2,q2-p2);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p2+tmp_3*q2;\n        pts=append(pts,[tmp1,1,tmp_3]);\n      );\n      tmp=Intersectline(p2,n,p1,q1-p1);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p1+tmp_3*q1;\n        pts=append(pts,[tmp1,tmp_3,0]);\n      );\n      tmp=Intersectline(q2,n,p1,q1-p1);\n      if(tmp_3*(tmp_3-1)&lt;Eps,\n        tmp1=(1-tmp_3)*p1+tmp_3*q1;\n        pts=append(pts,[tmp1,tmp_3,2]);\n      );\n      if(length(pts)==0,\n        tmp1=min([|p2-p1|,|q2-p1|,|p2-q1|,|q2-q1|]);\n        out=[tmp1];\n      ,\n        if(dist&gt;Eps1,\n          out=[dist];\n        ,\n          tmp=apply(pts,#_1_1);\n          tmp1=sum(tmp)/(length(pts));\n          tmp=apply(pts,#_1_2);\n          tmp2=sum(tmp)/(length(pts));\n          tmp3=[tmp1,tmp2];\n          tmp1=seg1_2-seg1_1;\n          tmp=Dotprod(tmp3-seg1_1,tmp1)/Norm(tmp1)^2;\n          if((tmp&gt;0)%(tmp&lt;1),\n            tmp=[seg1_1+tmp*tmp1,1+tmp];\n          ,\n            if(tmp&lt;0,tmp=[seg1_1,1],tmp2=[seg1_2,2]);\n          );\n          tmp1=tmp_2;\n          tmp2=seg2_2-seg2_1;\n          tmp=Dotprod(tmp3-seg2_1,tmp2)/Norm(tmp2)^2;\n          if((tmp&gt;0)%(tmp&lt;1),\n            tmp=[seg2_1+tmp*tmp2,1+tmp];\n          ,\n            if(tmp&lt;0,tmp=[seg2_1,1],tmp=[seg2_2,2]);\n          );\n          tmp2=tmp_2;\n          out=[dist,tmp3,tmp1,tmp2];\n        );\n      );\n    );\n  );\n  out;\n);\nOp(n,object):=( //  16.05.25\n  regional(out);\n  if(islist(object),\n    out=object_n;\n  ,\n    if(isstring(object),\n      out=substring(object,n-1,n);\n    );\n  );\n  out;\n);\nCollectsameseg(ptdL):=(\n  regional(Eps,gL,rL,numL,ii,jj,flg,tmp,tmp1,tmp2,tmp1md,\n       dst,kk,s1,e1,s2,e2);\n  Eps00=10^(-8);\n  if(length(ptdL)==0,\n    gL=[];rL=[];\n  ,\n    tmp1md=[ptdL_1];\n    rL=ptdL_(2..(length(ptdL)));\n    tmp1=tmp1md_1;\n    kk=floor(tmp1_2);\n    if(tmp1_2&lt;kk+Eps00,\n      s1=kk-1-Eps00; e1=s1+2+2*Eps00;\n    ,\n      s1=kk-Eps00; e1=s1+1+2*Eps00;\n    );\n    kk=floor(tmp1_3);\n    if(tmp1_3&lt;kk+Eps00,\n      s2=kk-1-Eps00; e2=s2+2+2*Eps00;\n    ,\n      s2=kk-Eps00; e2=s2+1+2*Eps00;\n    );\n    numL=[];\n    forall(1..(length(rL)),ii,\n      tmp=rL_ii;\n      tmp1=tmp_2;tmp2=tmp_3;\n      if((tmp1&gt;s1)&amp;(tmp1&lt;e1)&amp;(tmp2&gt;s2)&amp;(tmp2&lt;e2),\n        tmp1md=append(tmp1md,tmp);\n        numL=append(numL,ii);\n      );\n    );\n    gL=[];\n    tmp=apply(tmp1md,#_4);\n    dst=min(tmp);\n    forall(tmp1md,\n      if(#_4&lt;dst+Eps00,\n        gL=append(gL,#);\n      );\n    ); \n    rL=remove(rL,rL_(numL));\n  );\n  [gL,rL];\n);\nPointoncurve(tTorg,Gdata):=(\n  regional(tT,Out,Eps,nN,sS,Pa,Pb,PtL);\n  if(isstring(Gdata),PtL=parse(Gdata),PtL=Gdata);\n  if(length(PtL)==1,PtL=PtL_1);\n  tT=max([tTorg,1]); //18.01.04\n  tT=min([tT,length(PtL)]); //18.01.04\n  Eps=10^(-5); //18.01.04\n  nN=floor(tT+Eps);\n  sS=max([tT-nN,0]);\n  if(nN==length(PtL),\n    Out=PtL_nN;\n  ,\n    Pa=PtL_nN;\n    Pb=PtL_(nN+1);\n    Out=(1-sS)*Pa+sS*Pb;\n  );\n  Out;\n);\nUnscaling(pdata):=(\n  regional(Level,Out);\n  Out=[];\n  if(!islist(pdata_1),\n    Out=[pdata_1/SCALEX,pdata_2/SCALEY];\n  ,\n    forall(pdata,\n      Out=append(Out,Unscaling(#))\n    );\n  );\n  Out;\n);\nShadein(pstrorg):=( //190220\n  regional(pstr,ptL,pL,crv,nn,\n      tmp,tmp1,tmp2,pm1,pm2,p1,p2,flg);\n  if(islist(pstrorg),pstr=pstrorg_1,pstr=pstrorg);\n  crv=[];\n  Framedata([\"nodisp\"]);\n  ptL=Intersectcurvespp(pstr,frwin);\n  if(length(ptL)&gt;0,\n    pL=apply(ptL,#_2);\n    forall(1..(length(pL)),nn,\n      if(nn&lt;length(pL),\n       tmp1=pL_nn;\n       tmp2=pL_(nn+1);\n       tmp=Pointoncrv((tmp1+tmp2)/2,pstr);\n      ,\n        tmp1=pL_nn;\n        tmp2=pL_1;\n        tmp=parse(pstr);\n        if(pL_nn==length(tmp),\n          tmp=tmp_1;\n        ,\n          tmp=tmp_(length(tmp));\n        );\n      );\n      if(Inwindow(tmp),\n        tmp=Partcrv(\"\",tmp1,tmp2,pstr,[\"nodata\"]);\n      ,\n        tmp1=Pointoncrv(tmp1,pstr);\n        tmp2=Pointoncrv(tmp2,pstr);\n        pm1=Paramoncrv(tmp1,frwin);\n        pm2=Paramoncrv(tmp2,frwin);\n        if(floor(pm1)==floor(pm2),\n          tmp=Listplot(\"\",[tmp1,tmp2],[\"nodata\"]);\n        ,\n          tmp=floor(pm1);\n          p1=Pointoncrv(tmp,\"frwin\");\n          p2=Pointoncrv(mod(tmp,4)+1,\"frwin\");\n          tmp=p1-10*(p2-p1);\n          Listplot(\"frwin\",[p1,tmp],[\"nodisp\",\"Msg=n\"]);\n          tmp=Intersectcurvespp(\"sgfrwin\",pstr);\n          if(mod(length(tmp),2)==0, //190223from\n            if(pm2&lt;pm1,pm2=pm2+4); \n            tmp=[tmp1];\n            pm1=floor(pm1)+1;\n            flg=0;\n            forall(1..3,\n              if(flg==0,\n                if(pm1&lt;pm2,\n                  p1=Pointoncrv(mod(pm1-1,4)+1,\"frwin\");\n                  tmp=append(tmp,p1);\n                  pm1=pm1+1;\n                ,\n                  flg=1;\n                );\n              );\n            );\n            if(pm1-1&lt;pm2,tmp=append(tmp,tmp2));\n          ,\n            if(pm2&gt;pm1,pm2=pm2-4);\n            tmp=[tmp1];\n            pm1=floor(pm1);\n            flg=0;\n            forall(1..3,\n              if(flg==0,\n                if(pm1&gt;pm2,\n                  p1=Pointoncrv(mod(pm1-1,4)+1,\"frwin\");\n                  tmp=append(tmp,p1);\n                  pm1=pm1-1;\n                ,\n                  flg=1;\n                );\n              );\n            );\n            if(pm1+1&gt;pm2,tmp=append(tmp,tmp2));\n          ); //190223to\n        );\n      );\n      if(length(crv)==0,\n        crv=tmp;\n      ,\n        crv=Joincrvs(\"\",[crv,tmp],[\"nodata\"]);\n      );\n    );\n  ,\n    if(Inwindow(parse(pstr+\"_1\")),crv=pstr,crv=frwin);\n  );\n  crv;\n);\nFramedata():=Framedata([\"dr\"]);//16.10.29from\nFramedata(list):=(\n  regional(pA,pB);\n  if(Measuredepth(list)==0,\n    pA=LLcrd((SW+NE)/2); // 15.09.17\n    pB=LLcrd(NE);\n    Framedata(\"win\",[pA,pB],list);\n  ,\n    Framedata(list,[]);\n  );\n);//16.10.29until\nFramedata(Arg1,Arg2):=(\n  regional(name,list,options,str);\n  if(isstring(Arg1),\n    name=Arg1;\n    list=Arg2;\n    Framedata(name,list,[]);\n  ,\n    list=Arg1;\n    options=Arg2;\n    name=\"\";// 16.10.07from\n    forall(list, \n       name=name+#.name;\n    );// 16.10.07until\n    Framedata(name,list,options);\n  );\n);\nFramedata(nm,list,optionsorg):=( //190424modified\n  regional(name,options,Out,tmp,tmp1,x1,x2,y1,y2,dx,dy,\n      Ltype,Noflg,strL,cent,dx,dy,color,strL,corner);\n  name=\"fr\"+nm;\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  strL=tmp_7; //191126\n  color=tmp_(length(tmp)-2);\n  corner=0; //191126from\n  forall(strL,\n    tmp=substring(Toupper(#),0,1);\n    if(tmp==\"C\",\n      tmp=Lcrd(list_1); tmp1=Lcrd(list_2); //191227\n      cent=(tmp+tmp1)/2;\n      dx=abs(tmp1_1-tmp_1)/2;\n      dy=abs(tmp1_2-tmp_2)/2;\n      corner=1;\n      options=remove(options,[#]);\n    );\n  );\n  if(corner==0,\n    if(length(list)==2,  // 15.05.12\n      cent=Lcrd(list_1); tmp=Lcrd(list_2);\n      dx=abs(tmp_1-cent_1); dy=abs(tmp_2-cent_2);\n    ,\n      cent=Lcrd(list_1);\n      dx=list_2; dy=list_3;\n    );\n  );  //191126to\n  x1=cent_1-dx; x2=cent_1+dx;\n  y1=cent_2-dy; y2=cent_2+dy;\n  Listplot(\"-\"+name,[[x1,y1],[x2,y1],[x2,y2],[x1,y2],[x1,y1]],options);\n);\nFramedata(nm,cent,dx,dy):=Framedata(nm,[cent,dx,dy],[]);\nFramedata(nm,cent,dx,dy,options):=Framedata(nm,[cent,dx,dy],options);\nParamoncrv(pP,Gdata):=Paramoncurve(pP,Gdata);//180723\nParamoncurve(point,Gdata):=(\n  regional(Tmp,PtL,pP);\n  if(ispoint(point),pP=point.xy,pP=point);\n  if(isstring(Gdata),PtL=parse(Gdata),PtL=Gdata);\n  Tmp=Nearestpt(pP,PtL);\n  Tmp_2;\n);\nParamoncurve(pP,nN,plist):=(\n  regional(PtL,Out,Pa,Pb,vV,vW,sS);\n  if(isstring(plist),PtL=parse(plist),PtL=plist);\n  PtL=apply(PtL,LLcrd(#));//16.10.16\n  if(nN==length(PtL),\n    Out=nN;\n  ,\n    Pa=PtL_nN;\n    Pb=PtL_(nN+1);\n    vV=Pb-Pa;\n    vW=pP-Pa;\n    sS=vV*vW/|vV|^2;\n    sS=min([max([sS,0]),1]);\n    Out=nN+sS;\n  );\n  Out;\n);\nPointoncrv(tT,PtL):=Pointoncurve(tT,PtL);\nPointdata3d(name,pt3):=Pointdata3d(name,pt3,[]);//181017from\nPointdata3d(name,pt3,optionsorg):=( //181017from\n  regional(pt2,ptsub,options,tmp,label);\n  label=[];\n  options=append(optionsorg,\"Disp=n\"); //220722from\n  tmp=select(options,Toupper(substring(#,0,1))==\"L\");\n  if(length(tmp)&gt;0,\n    options=remove(options,tmp);\n    label=Strsplit(tmp_1,\",\");\n    if(length(label)==1,label=append(label,\"1\"));\n    if(length(label)==2,label=append(label,\"black\"));\n  ); //220722to\n  pt2=Parapt(pt3);//220713from\n  if(length(label)&gt;0, //220722from\n    tmp=select(options,indexof(#,\"Size=\")==0);\n    tmp=select(tmp,indexof(#,\"Color=\")==0);\n    tmp=concat(tmp,[\"Size=\"+label_2,\"Color=\"+label_3]);\n    Letter(pt2,label_1,name, tmp);\n  ); //220722to\n  Pointdata(\"-\"+name+\"2d\",pt2,options);\n  if(SUBSCR==1,\n    ptsub=Parasubpt(pt3);\n    tmp=append(options,\"nodisp\"); //220722\n    Pointdata(\"-\"+name+\"z2d\",ptsub,tmp);\n  );\n  Defvar(name+\"3d\",pt3);//220713\n);\nPointdata(nm,list):=Pointdata(nm,list,[]);\nPointdata(nm,listorg,optionsorg):=(\n  regional(list,name,opstr,opcindy,Msg,options,Ltype,\n              Noflg,eqL,color,color4,dispflg,//220715\n              size,inside,incolor,ratio,tmp,tmp1,tmp2,tmp3,\n              ngc1,ngc2,ng1,ng2,nc1,nc2);\n  if(substring(nm,0,1)==\"-\", //200510[2lines]\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"pt\"+nm;\n  );\n  options=optionsorg; //200512\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  opstr=tmp_(length(tmp)-1);\n  color=tmp_(length(tmp)-2);\n  color4=Colorrgb2cmyk(color);\n  size=\"1\";\n  dispflg=\"Y\";\n  inside=\"Y\"; //200512\n  incolor=\"\";\n  ratio=0.95; //200708,0813\n  border=\"Y\";\n  Msg=\"Y\";\n Msg=\"N\"; //\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"S\",\n      size=tmp_2; //190406[2lines]\n      tmp1=parse(size);\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"D\", //181030from\n      dispflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"I\", //190628from\n      inside=tmp_2; //201027from\n      if(substring(inside,0,1)!=\"[\",\n        tmp2=indexof(tmp_2,\",\");\n        if(tmp2&gt;0,\n          ratio=parse(substring(tmp_2,tmp2,length(tmp_2)));\n          inside=substring(tmp_2,0,tmp2-1); //201027\n        ,\n          inside=tmp_2; \n        ); \n      ); //201027to\n      if(contains([\"0\",\"N\",\"NO\",\"1\",\"Y\",\"YES\"],Toupper(inside)), //200519from\n        if(contains([\"0\",\"N\",\"NO\"],Toupper(inside)),inside=\"N\",inside=\"Y\");\n      ,\n        incolor=inside;\n        inside=\"N\";\n      ); //200519to\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"M\", //190206from\n      Msg=Toupper(substring(tmp_2,0,1));\n    ); //190206to\n  );\n  if(dispflg==\"Y\", \n    if(Msg==\"Y\", //190206\n      println(\"generate pointdata \"+name);\n    );\n  ); //181030to\n  ngc1=length(GCLIST)+1; //210422[2lines\n  ng1=length(GLIST)+1;\n  nc1=length(COM2ndlist)+1;\n  if(isstring(listorg),\n    list=parse(listorg);\n  ,\n    list=listorg;\n  ); //17.10.23\n  if(!islist(list),list=[list]); //200510from\n  list=apply(list,if(ispoint(#),Lcrd(#),#));\n  if(Measuredepth(list)==0,list=[list]);\n  tmp1=Textformat(list,6);\n  if(length(list)&gt;1,tmp2=apply(list,[#]),tmp2=list); //200524\n  tmp2=Textformat(tmp2,6);\n  tmp=name+\"=\"+tmp2+\";\"; //190415\n  parse(tmp);\n  if(Noflg&lt;3,\n    tmp=RSform(tmp1,2);\n  );\n  if(Noflg&lt;2, //210602\n    tmp1=parse(size)*TenSizeInit;\n    forall(1..(length(list)),\n      tmp2=text(#)+name;\n      tmp3=[list_#,tmp1*ratio];\n      Circledata(tmp2,[list_#,tmp1*ratio],[\"nodisp\",\"Msg=n\"]);\n      if(inside==\"N\", //210602from\n        Scaledata(tmp2+\"i\",[\"cr\"+tmp2],1,1/SCALEY,//230423[2line]\n                     [\"Color=\"+color,\"Msg=n\"]);\n        if(length(incolor)&gt;0, //200519from\n          tmp=\"sc\"+tmp2+\"i\";\n          Shade([tmp],[\"Color=\"+incolor]);\n        );\n      ,\n        tmp=[tmp3_1,\"Color=\"+color,\"Msg=n\"]; //220722from\n        if(Noflg==1,tmp=prepend(\"notex\",tmp));\n        Scaledata(tmp2,[\"cr\"+tmp2],1,1/SCALEY,tmp);\n        tmp=\"sc\"+tmp2;\n        Shade([tmp],options); \n      ); //210602to\n      tmp=round(10*sqrt(parse(size))); //201027from (moved)\n      if(Noflg==0,options=[Ltype,\"Color=\"+text(color),\"Num=\"+text(tmp)]);\n      if(Noflg==1,options=[\"notex\",Ltype,\"Color=\"+text(color),\"Num=\"+text(tmp)]);\n      if(Noflg==2,options=[\"nodisp\"]);\n      options=concat(options,[tmp3_1,\"Msg=n\"]);  //201027to\n    ); \n  );\n  ngc2=length(GCLIST); //210422[5lines]\n  ng2=length(GLIST);\n  nc2=length(COM2ndlist);\n  tmp=[name,list,GCLIST_(ngc1..ngc2),\n               GLIST_(ng1..ng2),COM2ndlist_(nc1..nc2)];  \n  PointDataList=append(PointDataList,tmp);\n  list;\n);\nScaledata(nm,plist,ratioV):=(\n  regional(tmp);\n  tmp=ratioV; //180603from\n  if(!islist(tmp),tmp=[tmp,tmp]);\n  tmp=Lcrd(tmp);//180603to\n  Scaledata(nm,plist,tmp_1,tmp_2,[]);\n);\nScaledata(nm,plist,Arg1,Arg2):=(\n  regional(tmp,options);\n  if(islist(Arg2),\n    tmp=Arg1;//180603[2lines]\n    if(!islist(tmp),tmp=[tmp,tmp]);\n    tmp=Lcrd(tmp);\n    options=Arg2;\n    Scaledata(nm,plist,tmp_1,tmp_2,options);\n  ,\n    Scaledata(nm,plist,Arg1,Arg2,[]);\n  );\n);\nScaledata(nm,plist,rx,ry,optionorg):=(\n  regional(tmp,tmp1,tmp2,pdata,Theta,Pt,Cx,Cy,PdL,options,eqL,\n      opcindy,Nj,Njj,Kj,X2,Y2,Ltype,Noflg,name,color,color4,msgflg);\n  if(substring(nm,0,1)==\"-\", //210423from\n    name=substring(nm,1,length(nm));\n  ,\n    name=\"sc\"+nm;\n  ); //210423to\n  options=optionorg;\n  Pt=[0,0];\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  color=tmp_(length(tmp)-2);\n  color4=Colorrgb2cmyk(color); //200618\n  opcindy=tmp_(length(tmp));\n  tmp1=tmp_6;\n  if(length(tmp1)&gt;0,\n    Pt=Lcrd(tmp1_1);\n  );\n  msgflg=\"Y\"; //190425from\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"M\",\n      msgflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n    if(tmp1==\"S\", //210423from\n      options=remove(options,[#]);\n    ); //210423to\n  ); //190425to\n  pdata=plist;\n  if(isstring(pdata),pdata=[pdata]);\n  if(!isstring(pdata_1) &amp; Measuredepth(pdata)==1,\n      pdata=[pdata];\n  );\n  Cx=Pt_1; Cy=Pt_2;\n  PdL=[];\n  forall(pdata,Njj,\n    if(isstring(Njj),Kj=parse(Njj),Kj=Njj);\n    if(Measuredepth(Kj)==1,Kj=[Kj]);\n    tmp2=[];\n    forall(Kj,Nj,\n      tmp1=[];\n      forall(Nj,\n        tmp=LLcrd(#);\n        X2=Cx+rx*(tmp_1-Cx);\n        Y2=Cy+ry*(tmp_2-Cy);\n        tmp1=concat(tmp1,[[X2,Y2]]);\n      );\n      if(length(tmp1)==1, //210423from\n        Pointdata(\"-\"+name,tmp1,optionorg);\n      ,\n        tmp2=concat(tmp2,[tmp1]);\n        PdL=concat(PdL,tmp2);\n      );  //210423to\n    );\n  );\n  if(length(PdL)&gt;0,\n    if(Noflg&lt;3,\n      if(msgflg==\"Y\",\n        println(\"generate Scaledata \"+name);\n      );\n      tmp1=[];\n      forall(PdL,tmp2,\n        tmp=apply(tmp2,Pcrd(#));\n        tmp1=append(tmp1,tmp);\n      );\n      if(length(tmp1)==1,tmp1=tmp1_1);\n      tmp=name+\"=\"+Textformat(tmp1,10)+\";\"; //190415\n      parse(tmp);\n    );\n    if(Noflg&lt;3, //190818\n      if(isstring(Ltype),\n        Ltype=Getlinestyle(text(Noflg)+Ltype,name);\n      ,\n        if(Noflg==1,Ltype=0);\n      );\n      GCLIST=append(GCLIST,[name,Ltype,opcindy]);\n    );\n  );\n  PdL;\n);\nArrowdata(ptlist):=Arrowdataseg(ptlist);\nArrowdata(Arg1,Arg2):=Arrowdataseg(Arg1,Arg2);\nArrowdata(nm,ptlistorg,optionsorg):=(\n  Arrowdataseg(nm,ptlistorg,optionsorg);\n);\nArrowdataseg(ptlist):=Arrowdataseg(ptlist,[]); //181110from\nArrowdataseg(Arg1,Arg2):=(\n  regional(name);\n  if(isstring(Arg1),\n    Arrowdataseg(Arg1,Arg2,[]);\n  ,\n    name=\"\";\n    forall(Arg1,\n      if(ispoint(#),\n        name=name+#.name; //190505\n      );\n    );\n    Arrowdataseg(name,Arg1,Arg2);\n  );\n);  //181110from\nArrowdataseg(nm,ptlistorg,optionsorg):=(\n  regional(options,Ltype,Noflg,opstr,opcindy,eqL,reL,strL,color,size,lineflg,\n      flg,cutend,tmp,tmp1,tmp2,pA,pB,pC,angle,segpos,cut,scaley,Ev,Nv,pP,ptlist);\n  scaley=SCALEY; //190412\n  SCALEY=1; //200114\n  ptlist=[];\n  forall(ptlistorg,\n    if(ispoint(#),tmp=[#.x, #.y], tmp=[#_1,scaley*#_2]);\n    ptlist=append(ptlist,tmp);\n  );\n  pA=ptlist_1; pB=ptlist_2;\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  reL=tmp_6;\n  strL=tmp_7;\n  color=tmp_(length(tmp)-2);\n  opstr=tmp_(length(tmp)-1);\n  opcindy=tmp_(length(tmp));\n  size=0.2*YaSize*1/2.54*1000/MilliIn; \n  angle=YaAngle*pi/180;\n  segpos=YaPosition;\n  cut=YaCut;\n  if(length(reL)&gt;=1,\n    size=0.2*reL_1*1/2.54*1000/MilliIn; \n  );\n  if(length(reL)&gt;=2,\n    if(reL_2&lt;2.5,angle=reL_2*YaAngle,angle=reL_2);\n    angle=angle*pi/180;\n  );\n  if(length(reL)&gt;=3,\n    segpos=reL_3;\n  );\n  if(length(reL)&gt;=4,\n    cut=reL_4;\n  );\n  options=remove(options,reL); //191202\n  cutend=[0,0];//180719\n  lineflg=0;\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,2));\n    tmp2=tmp_2;\n    if(tmp1==\"CU\",//180719from\n      tmp2=replace(tmp2,\"[\",\"\");\n      tmp2=replace(tmp2,\"]\",\"\");\n      cutend=tokenize(tmp2,\",\");\n      if(length(cutend)==1,cutend=[cutend_1,cutend_1]);\n    );\n    if(tmp1==\"LI\",//190504from\n      tmp2=Toupper(substring(tmp2,0,1));\n      if(tmp2==\"Y\",lineflg=1);\n    );//190504to\n  );\n  tmp=pB-pA;\n  tmp=tmp/|tmp|;\n  pA=ptlist_1+tmp*cutend_1;\n  pB=ptlist_2-tmp*cutend_2;\n  pP=pA+segpos*(pB-pA);\n  Ev=-1/|pB-pA|*(pB-pA); Nv=[-Ev_2, Ev_1];\n  tmp1=pP+size*cos(angle)*Ev+size*sin(angle)*Nv;\n  tmp2=pP+size*cos(angle)*Ev-size*sin(angle)*Nv;\n  pC=pP+(1-cut)*((tmp1+tmp2)/2-pP);\n  ArrowheadNumber=ArrowheadNumber+1;\n  if(Noflg&lt;2,\n    if(lineflg==1,\n      Listplot(\"-ar\"+nm+\"h\",[tmp1,pP,tmp2],append(options,\"Msg=n\")); //210522\n    ,\n      Listplot(\"-ar\"+nm+\"h\",[tmp1,pP,tmp2,pC,tmp1],[\"dr,0.1\",\"Color=\"+color,\"Msg=n\"]); //210522\ntmp=Colorcmyk2rgb(color); // \nfillpoly(parse(\"ar\"+nm+\"h\"),color-&gt;tmp); // \n    );\n    if(lineflg==0,\n      if(segpos==1,pB=pC); //191202\n    );\n    Listplot(\"-ar\"+nm,[pA,pB],[Ltype,\"Color=\"+color,\"Msg=n\"]); \n  );\n  SCALEY=scaley; //200114\n  [LLcrd(pA),LLcrd(pB)];\n);\nIsangle():=Ptselected(TH)%Ptselected(FI); //180517\nSkeletonparadata(nm):=Skeletondatacindy(nm,Datalist3d(),Datalist3d(),[]); //211010[2lines]\nSkeletonparadata(nm,options):=Skeletondatacindy(nm,Datalist3d(),Datalist3d(),options); \nSkeletonparadata(nm,pltdata1,pltdata2):=Skeletondatacindy(nm,pltdata1,pltdata2);\nSkeletonparadata(nm,pltdata1org,pltdata2org,options):=\n    Skeletondatacindy(nm,pltdata1org,pltdata2org,options);\nDatalist3d():=(\n  regional(out,tmp,tmp2,tmp3);\n  tmp=apply(GCLIST,#_1);\n  tmp=select(tmp,indexof(#,\"2d\")&gt;0);\n  tmp2=select(tmp,indexof(#,\"sub\")==0);\n  tmp3=apply(tmp2,replace(#,\"2d\",\"3d\"));\n  out=tmp3;\n);\nSkeletondatacindy(nm,pltdata1,pltdata2):=\n     Skeletondatacindy(nm,pltdata1,pltdata2,[]);\nSkeletondatacindy(nm,pltdata1org,pltdata2org,optionsorg):=(\n  regional(Eps,Eps2,name2,name3,options,Ltype,Noflg,reL,eqL,strL,opcindy,\n     Out,ObjL,Plt3L,Rr,pltdata1,pltdata2,Plt2L,ObjL,ii,Data,wdtL,\n     Obj3,jj,Gd,PtD,size,tmp,tmp1,tmp2,tmp3,color,fileflg,\n      mkflg,fname,fdname,varL,nn,chkL,flg); //181101\n  name2=\"sk2d\"+nm;\n  name3=\"sk3d\"+nm;\n  pltdata1=[];// 16.01.31\n  forall(pltdata1org,tmp1,\n    if(isstring(tmp1),tmp=parse(tmp1),tmp=tmp1); //210319\n    tmp=apply(tmp,if(isstring(#),parse(#),#));//210620[recoverd]\n    pltdata1=append(pltdata1,tmp);\n  );\n  pltdata2=[];// 211104\n  forall(pltdata2org,tmp1,\n    if(isstring(tmp1),tmp=parse(tmp1),tmp=tmp1); //210319\n    tmp=apply(tmp,if(isstring(#),parse(#),#));//210620[recoverd]\n    pltdata2=append(pltdata2,tmp);\n  );\n  ObjL=Flattenlist(pltdata1);\n  Plt3L=Flattenlist(pltdata2);\n  options=optionsorg;\n  tmp=Divoptions(options);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  eqL=tmp_5;\n  reL=tmp_6; //16.02.28 \n  strL=tmp_7; //211104\n  color=tmp_(length(tmp)-2);\n  opcindy=tmp_(length(tmp));\n  Rr=0.075*1000/2.54/MilliIn;\n  size=1; //221215\n  Eps2=0.05;\n  Eps=0.001;\n  if(length(reL)&gt;0, //16.02.28 \n    options=remove(options,reL);\n    size=reL_1; //221215\n    Rr=size*Rr;\n    if(length(reL)&gt;1,Eps2=reL_2); //221215\n  );\n  mkflg=0; //221215\n  forall(strL,\n    if(contains([\"m\",\"r\",\"\"],#),\n      if(#==\"m\",mkflg=1);\n      if(#==\"r\",mkflg=-1);\n      if(#==\"\",mkflg=0);\n      options=remove(options,[#]);\n    );\n  );\n  fileflg=\"Y\";\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=Toupper(substring(tmp_1,0,1));\n    if(tmp1==\"F\", //190320\n      fileflg=Toupper(substring(tmp_2,0,1));\n      options=remove(options,[#]);\n    );\n  );\nfileflg=\"N\"; //\n  if(fileflg==\"Y\",\n    if(!isexists(Dirwork,fname), //221215[2lines]\n      mkflg=1;\n    ,\n      if(mkflg&lt;1,\n        Readoutdata(fname); //221215[4lines]\n        tmp1=|angle_1_1-THETA|+|angle_1_2-PHI|&lt;Eps;\n        tmp2=|size1_1_1-size|&lt;Eps;\n        if((tmp1)&amp;(tmp2),\n          mkflg=-1;\n          GLIST=append(GLIST,\"ReadOutData(\"+Dqq(fname)+\")\");\n          Projpara(name3,options);\n          Out=parse(name3);\n        ,\n          mkflg=1;\n        );\n      );\n    );\n  ,\n    mkflg=1;\n  );\n  tmp=apply(1..(length(Plt3L)),Projcoordcurve(Plt3L_#));\n  Plt2L=Flattenlist(tmp);\n  wdtL=[\n      \"angle\",[[THETA,PHI]],\n      \"size1\",[[size,1]],\n      \"sk\"+nm+\"obj\",ObjL,\n      \"sk\"+nm+\"plt\",Plt3L\n  ];\n  if(mkflg==1,  //221215\n    Out=[];\n    forall(1..(length(ObjL)),ii,\n      Obj3=ObjL_ii;\n      tmp=Projcoordcurve(Obj3);\n      Data=Makeskeletondata([tmp],Plt2L,Rr,Eps2);\n      forall(1..(length(Data)),jj,\n        Gd=Data_jj;\n        if(length(Gd)&gt;1,\n          tmp=apply(1..(length(Gd)-1),Norm(Ptcrv(#,Gd)-Ptcrv(#+1,Gd)));\n          tmp=max(tmp);\n          if(tmp&gt;Eps,\n            PtD=[];\n            forall(1..(length(Gd)),nn,\n              tmp=Gd_nn;\n              tmp1=Invparapt(tmp,Obj3);\n              if(length(tmp1)&gt;0,\n                PtD=append(PtD,tmp1);\n              );\n            );\n           );\n          Out=append(Out,PtD);\n        );\n      );\n    );\n    Out=select(Out,length(Projcurve(#))&gt;0); // 16.12.19\n    tmp1=apply(Out,Textformat(#,6));\n    tmp=name3+\"=\"+tmp1+\";\"; //190415\n    parse(tmp);\n    forall(1..(length(Out)), //221215[3lines]\n      Spaceline(\"-\"+name3+#,Out_#,append(options,\"Msg=n\"));\n    );\n    if(fileflg==\"Y\",\n      wdtL=concat(wdtL,[name3,parse(name3)]);\n      Writeoutdata(fname,wdtL);\n    );\n  );\n  forall(pltdata1org,\n    if(isstring(#),Changestyle3d(#,[\"nodisp\"]));\n  );\n  println(\"generate skeleton :\"+name3); //220116[removed from here]\n  if(SUBSCR==1,\n    Subgraph(name3,opcindy);\n  );\n);\nReadoutdata():=Readoutdata(Fnameout);\nReadoutdata(filename):=Readoutdata(\"\",filename);  //16.03.07\nReadoutdata(Arg1,Arg2):=( //181030from\n  if(islist(Arg2),\n    Readoutdata(\"\",Arg1,Arg2);\n  ,\n    Readoutdata(Arg1,Arg2,[]);\n  );\n); //181030to\nReadoutdata(pathorg,filenameorg,optionsorg):=(\n  regional(options,path,filename,varname,varL,ptL,pts,tmp,tmp1,tmp2,tmp3,tmp4,\n     nmbr,cmdall,cmd,outdt,goutdt,eqL,msg,Rflg);\n  options=optionsorg;\n  tmp=Divoptions(options); //181024from\n  msg=\"Y\";\n  Rflg=\"N\"; //211228\nmsg=\"N\"; //\n  eqL=tmp_5;\n  forall(eqL,\n    tmp=Strsplit(#,\"=\");\n    tmp1=substring(tmp_1,0,1); tmp1=Toupper(tmp1);\n    tmp2=substring(tmp_2,0,1); tmp2=Toupper(tmp2);\n    if(tmp1==\"M\",\n      msg=tmp2;;\n      options=remove(options,[#]); //181030\n    );\n    if(tmp1==\"R\",\n      Rflg=tmp2; //211228\n      options=remove(options,[#]); //181030\n    );\n  ); //181024to\n  filename=filenameorg;\n  if(indexof(filename,\".\")==0,filename=filename+\".txt\");\n  path=pathorg;   //16.03.07 from\n  if(length(path)&gt;0,\n    if(indexof(path,\"\\\")&gt;0,tmp1=\"\\\",tmp1=\"/\");\n    tmp=substring(path,length(path)-1,length(path));\n    if(tmp!=tmp1,path=path+tmp1);\n    tmp=Readlines(path,filename); //200514\n  ,\n    tmp=Readlines(filename); //200514\n  );\n  cmdall=apply(tmp,replace(#,\"//\",\"\"));\n  varname=cmdall_1; \n  cmdall=cmdall_(2..length(cmdall)); \n  outdt=[];\n  varL=[varname];\n  ptL=[];\n  forall(cmdall,cmd, //200514\n    if(length(cmd)&gt;0,\n      if(cmd==\"start\" % cmd==\"end\" % substring(cmd,0,1)==\"[\",\n        if(cmd==\"start\", \n          pts=[];\n        );\n        if(cmd==\"end\",\n          ptL=append(ptL,pts);\n        );\n        if(substring(cmd,0,1)==\"[\",\n          tmp1=parse(cmd);\n          if(length(tmp1_1)==2,\n            tmp1=apply(tmp1,Pcrd(#));\n          );\n          pts=concat(pts,tmp1);\n        );\n      ,\n        if(length(ptL)&gt;0,\n          if(length(ptL)==1,\n            ptL=ptL_1;\n            tmp=apply(ptL,Textformat(#,10));\n          ,\n            tmp=\"[\";\n            forall(ptL,tmp1,\n              tmp=tmp+apply(tmp1,Textformat(#,10))+\",\";\n            );\n            tmp=substring(tmp,0,length(tmp)-1)+\"]\";\n          );\n        ,\n          tmp=\"[]\";\n        );\n        parse(varname+\"=\"+tmp+\";\"); //190415\n        outdt=append(outdt,ptL);\n        ptL=[];\n        varname=cmd;\n        varL=append(varL,varname);\n      );\n    );\n  );\n  if(length(ptL)&gt;0,\n    if(length(ptL)==1,\n      ptL=ptL_1;\n      tmp=apply(ptL,Textformat(#,10));\n    ,\n      tmp=\"[\";\n      forall(ptL,tmp1,\n        tmp=tmp+apply(tmp1,Textformat(#,10))+\",\";\n      );\n      tmp=substring(tmp,0,length(tmp)-1)+\"]\";\n    );\n  ,\n    tmp=\"[]\";\n  );\n  parse(varname+\"=\"+tmp+\";\"); //190415\n  outdt=append(outdt,ptL);\n  if(path==\"\",tmp=filename,tmp=path+filename); //16.03.07\n  GOUTLIST=append(GOUTLIST,[tmp,varL]); // 200914recoverd\n  if(length(path)&gt;0, // 16.03.09\n    setdirectory(Dirwork); // 16.03.07\n  );\n  if(msg==\"Y\", //200624from\n    print(\"readoutdata from \"+tmp+\" : \");\n    println(varL);\n  );  //200624to\n  if(Rflg==\"Y\", //200514from, //211228\n    GLIST=append(GLIST,\"Tmpout=ReadOutData(\"+Dqq(filename)+\")\");\n  ); //200514to\n  varL;\n);\nReadlines(file):=Readlines(Dirwork,file); //181126\nReadlines(path,file):=(\n  regional(tmp,out);\n  if(!isexists(path,file), //200706from\n    println(file+\" not found in \"+path);\n    out=[];//200706to\n  ,\n    out=readfile2str(path,file);\n    out=\"S\"+replace(out,\"\n\",\"\nS\");//220528from\n    out=tokenize(out,\"\n\"); //190129\n    out=apply(out,substring(#,1,length(#)));\n    tmp=out_(length(out)); //220528to\n    if(length(tmp)==0,\n      out=out_(1..(length(out)-1));\n    );\n    tmp=out; //200423[2lines]\n    out=apply(tmp,if(!isstring(#),text(#),#));\n    out;\n  );\n);\nFlattenlist(pltlist):=(\n  regional(Out,nn,Dt,ii,tmp,flg);\n  Out=[];\n  if(Measuredepth(pltlist)==1,\n    Out=[pltlist];\n  ,\n    forall(1..(length(pltlist)),nn,\n      Dt=pltlist_nn;\n      if(Measuredepth(Dt)&lt;2,\n        Out=append(Out,Dt);\n      ,\n        forall(1..(length(Dt)),ii,\n          tmp=Flattenlist(Dt_ii);\n          Out=concat(Out,tmp);\n        );\n      );\n    );\n  );\n  Out;\n);\nProjcoordcurve(Curve):=(\n  regional(SP,CP,ST,CT,Out,jj,pt,x,y,z,xz,yz,zz);\n  SP=sin(PHI); CP=cos(PHI);\n  ST=sin(THETA); CT=cos(THETA);\n  Out=[];\n  forall(1..(length(Curve)),jj,\n    pt=Curve_jj;\n    x=pt_1; y=pt_2; z=pt_3;\n    xz=-x*SP+y*CP;\n    yz=-x*CP*CT-y*SP*CT+z*ST;\n    zz=x*CP*ST+y*SP*ST+z*CT;\n    Out=append(Out,[xz,yz,zz]);\n  );\n  Out;\n);\nMakeskeletondata(Obj2L,Plt2L,R0,Eps2):=(\n  regional(Allres,Eps,Dmat,Dind,ii,Dt,nn1,nn2,Nind,Nobj,\n      Plt2,PhL,ClipL,ns,pt1,pt2,pt,pta,ptb,za,zb,z1,z2,t1,t2,te,\n\t  koc,KukanL,nn,tt,Rr,Flg,ii,jj,ptq,hh,Ku,Res,contflg,breakflg);\n  Eps=10.0^(-4);\n  Dmat=[];\n  Dind=[];\n  forall(1..(length(Plt2L)),ii,\n    Dt=Plt2L_ii;\n    nn1=length(Dmat)+1;\n    Dmat=concat(Dmat,Dt);\n    nn2=length(Dmat);\n    Dind=append(Dind,[nn1,nn2]);\n  );\n  Nind=length(Dind);\n  Allres=[];\n  forall(1..(length(Obj2L)),Nobj,\n    Plt2=Obj2L_Nobj;\n    PhL=Columnlist(Plt2,1..2);\n\tClipL=[];\n    forall(1..(length(PhL)-1),ns,\n      pt1=PhL_(ns..(ns+1));\n      forall(1..(length(Dind)),ii,\n        tmp=Dind_ii;\n        tmp=Dmat_(Dind_ii_1..Dind_ii_2);\n        pt2=Columnlist(tmp,1..2);\n        koc=Intersectcrvspp(pt1,pt2,[Eps]);\n        if(length(koc)&gt;0,\n          breakflg=0;\n          forall(1..(length(koc)),jj,\n            contflg=0;\n            if(breakflg==0,\n              pt=Op(1,Op(jj,koc));\n              tmp=Op(2,Op(jj,koc));\n              if((tmp&lt;1+Eps) &amp; (ns==1), \n                contflg=1;\n              );    \n              if(contflg==0,\n                if((tmp&gt;length(pt1)-Eps) \n                 &amp; (ns==length(PhL)-1),\n                  contflg=1;\n                );\n              );\n              if(contflg==0,\n                nn1=ns;\n                nn2=Op(3,Op(jj,koc));\n                tmp=Plt2_nn1;\n                pta=tmp_(1..2);\n                za=tmp_3;\n                tmp=Plt2_(nn1+1);\n                ptb=tmp_(1..2);\n                zb=tmp_3;\n                if(Norm(pta-ptb)&lt;Eps,\n                  contflg=1;\n                );\n              );\n              if(contflg==0,\n                t1=Norm(pta-pt)/Norm(pta-ptb);\n                z1=(1-t1)*za+t1*zb;\n                tmp=Dmat_(Dind_ii_1..Dind_ii_2);\n                tmp1=tmp_nn2;\n                pta=tmp1_(1..2);\n                za=tmp1_3;\n                tmp2=tmp_(nn2+1);\n                ptb=tmp2_(1..2);\n                zb=tmp2_3;\n                if(Norm(pta-ptb)&lt;Eps,\n                  contflg=1;\n                );\n              );\n              if(contflg==0,\n                t2=Norm(pta-pt)/Norm(pta-ptb);\n                z2=(1-t2)*za+t2*zb;\n                if(z1&lt;z2-Eps2,\n                   if(length(ClipL)==0, \n                    tmp=1;\n                  ,\n                    tmp1=column(ClipL,1);\n                    tmp1=apply(tmp1,#-pt_1);\n                    tmp2=column(ClipL,2);\n                    tmp2=apply(tmp2,#-pt_2);\n                    tmp3=apply(tmp1,#^2)+apply(tmp2,#^2);\n                    tmp=min(tmp3);         \n                  );\n                  if(tmp&gt;Eps^2,\n                    tmp1=pt1_2-pt1_1;\n                    tmp2=ptb-pta;\n                    tmp3=Dotprod(tmp1,tmp2);\n                    tmp3=tmp3/Norm(tmp1)/Norm(tmp2);\n                    tmp=1-0.5*tmp3^2;\n                    tmp1=concat(pt,[nn1,t1,R0/tmp]);\n                    ClipL=append(ClipL,tmp1);\n                  );\n                );\n              );\n            );\n          );\n        );\n      );\n    );\n    te=length(Plt2);\n    KukanL=[[1.0,te]];\n    pt1=PhL;\n    if(length(ClipL)&gt;0,\n      forall(1..(length(ClipL)),ii,\n        tmp=ClipL_ii;\n        pt=tmp_(1..2);\n        nn=tmp_3;\n        tt=nn+tmp_4;\n        Rr=tmp_5;\n        Flg=0;\n        breakflg=0;\n        forall(reverse(1..nn),jj,\n          contflg=0;\n          if(breakflg==0,\n            ptq=Pointoncurve(jj,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              contflg=1;\n            );\n            if(contflg==0,\n              Flg=jj;\n              breakflg=1;\n              contflg=1;\n            );\n          );\n        );\n        if(Flg==0,\n          t1=1;\n        ,\n          t1=Flg; t2=tt;\n          hh=t2-t1;\n          forall(1..10,\n            hh=hh*0.5;\n            ptq=Pointoncurve(t1+hh,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              t2=t2-hh;\n            ,\n              t1=t1+hh;\n            );\n          );\n        );\n        Ku=[t1];\n        Flg=0;\n        breakflg=0;\n        forall((nn+1)..te,jj,\n          contflg=0;\n          if(breakflg==0,\n            ptq=Pointoncurve(jj,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              contflg=1;\n            );\n            if(contflg==0,\n              Flg=jj;\n              breakflg=1;\n              contflg=1;\n            );\n          );\n        );\n        if(Flg==0,\n          t2=te;\n        ,\n          t1=tt; t2=Flg;\n          hh=t2-t1;\n          forall(1..10,\n            hh=hh*0.5;\n            ptq=Pointoncurve(t1+hh,pt1);\n            if(Norm(pt-ptq)&lt;Rr,\n              t1=t1+hh;\n            ,\n              t2=t2-hh;\n            );\n          );\n        );\n        Ku=append(Ku,t2);\n        KukanL=Kukannozoku(Ku,KukanL);\n\t  );\n    );\n    Res=[];\n    forall(1..(length(KukanL)),ii,\n      tmp=KukanL_ii;\n      t1=tmp_1; nn1=re(floor(t1));\n      t2=tmp_2; nn2=re(floor(t2));\n     PtL=[];\n      if(t1-nn1&lt;1-Eps,\n        tmp=Pointoncurve(t1,pt1);\n        PtL=[tmp];\n      );\n      forall((nn1+1)..nn2,jj,\n        tmp=Pointoncurve(jj,pt1);\n        PtL=append(PtL,tmp);\n      );\n      if(t2-nn2&gt;Eps,\n        tmp=Pointoncurve(t2,pt1);\n        PtL=append(PtL,tmp);\n      );\n      tmp=Listplot(\"\",PtL,[\"nodata\"]);\n      Res=append(Res,tmp);\n    );\n    Allres=concat(Allres,Res);\n  );\n\n  Allres;\n);\nColumnlist(dt,list):=( // 16.09.04\n  apply(dt,#_list);\n);\nKukannozoku(Jokyo,KukanL):=(\n  regional(Res,Eps,nn,ii,t1,t2,Ku,Flg,contflg,tmp,tmp1);\n  Eps=10^(-6);\n  nn=length(KukanL);\n  t1=Jokyo_1; t2=Jokyo_2;\n  tmp=KukanL_1;\n  t1=max(t1,tmp_1);\n  tmp=KukanL_nn;\n  t2=min(t2,tmp_2);\n  Res=[];\n  Flg=0;\n  contflg=0;\n  forall(1..nn,ii,\n    if(contflg==0,\n      Ku=KukanL_ii;\n      if(Flg==0,\n        if(Ku_2&lt;t1,\n          Res=append(Res,Ku);\n        ,\n          Flg=1;\n          if(Ku_1&lt;t1-Eps, \n            tmp=[Ku_1,t1];\n            Res=append(Res,tmp);\n          );\n          if(Ku_2&gt;t2+Eps,\n            tmp=[t2,Ku_2];\n            Res=append(Res,tmp);\n          );\n        );\n      ,\n        if(Flg==1,\n          if(Ku_2&lt;t2,\n            contflg=1;\n          ,\n            if(contflg==0,\n              Flg=2;\n              if(Ku_1&lt;t2-Eps,\n                Ku=[t2,Ku_2];\n              );\n              Res=append(Res,Ku);\n            );\n          );\n        ,\n          if(contflg==0,\n            Res=append(Res,Ku);\n          );\n        );\n      );\n    );\n  );\n  Res;\n);\nInvparapt(pt,pd):=(\n  regional(tmp);\n  tmp=Invparaptpp(pt,pd);\n  if(length(tmp)&gt;0, //220213from\n    tmp_1;\n  ,\n    []\n  );  //220213to\n);\nInvparaptpp(pt,pd):=(\n  regional(Eps,fk,nfk,ph,fh,ah,bh,ak,bk,v1,v2,\n    nn,s0,t2,out,tmp,tmp1,tmp2,flg);\n  Eps=10^(-4);\n  if(isstring(pd),\n    fk=pd;\n  ,\n    fk=textformat(pd,10);\n  );\n  nfk=Numptcrv(parse(fk));\n  flg=0;\n  tmp=pt;\n  if(length(tmp)==1,\n    ph=tmp;\n    fh=pd;\n  ,\n    fh=Projpara(fk,[\"nodata\"]);\n    if(nfk&gt;2,\n      tmp1=Nearestpt(tmp,fh);\n      ph=tmp1_2;\n    ,\n      ah=Ptcrv(1,fh); bh=Ptcrv(2,fh);\n      v1=tmp-ah; v2=bh-ah;\n      tmp1=Crossprod(v1,v2);\n      if(abs(tmp1)&gt;Eps,\n        println(\"  Not on the line\");\n        out=[];\n        flg=1;\n      ,\n        ph=Dotprod(v1,v2)/|v2|^2+1;\n      );\n    );\n  );\n  if(flg==0,\n    if(nfk&gt;2,\n      nn=re(floor(ph)); //190505\n      s0=ph-nn;\n      if(ph&gt;Numptcrv(fh)-Eps,\n        out=[Ptend(fk),Numptcrv(fh)];\n        flg=1;\n      );\n    ,\n      nn=1;\n      s0=ph-1;\n    );\n  );\n  if(flg==0,\n    ak=Ptcrv(nn,fk); bk=Ptcrv(nn+1,fk);\n    ah=Ptcrv(nn,fh); bh=Ptcrv(nn+1,fh);\n    ph=(1-s0)*ah+a0*bh;\n    t2=s0;\n    pk=(1-t2)*ak+t2*bk;\n    out=[pk,nn+t2];\n  );\n  out;\n);\nWriteoutdata(filename,ptlist):=Writeoutdata(filename,ptlist,[]); //211226\nWriteoutdata(filename,ptlist,options):=(//211226\n  regional(nn,Gname,Gdata,Str,Gstr,Gj,Pt,Flg,\n      msg,tmp,tmp1,tmp2,loopend);\n  msg=\"Y\"; //211226from\n  forall(options, \n    tmp=Strsplit(#,\"=\");\n    tmp1=substring(tmp_1,0,1); tmp1=Toupper(tmp1);\n    tmp2=substring(tmp_2,0,1); tmp2=Toupper(tmp2);\n    if(tmp1==\"M\",\n      msg=tmp2;;\n      options=remove(options,[#]); //181030\n    );\n  ); //211226to\n  Flg=0;\n  if(isstring(ptlist_(length(ptlist))),\n    Flg=1;\n  );\n  SCEOUTPUT = openfile(filename);\n  if(Flg==0,\n    loopend=length(ptlist)/2;\n  ,\n    loopend=length(ptlist);\n  );\n  Gstr=\"[\";\n  forall(1..loopend,nn,\n    if(Flg==0,\n      Gname=ptlist_(2*nn-1);\n    ,\n      Gname=ptlist_nn;\n    );\n    Gstr=Gstr+Gname+\",\";\n    println(SCEOUTPUT,Gname+\"//\");\n    if(Flg==0,\n      Gdata=ptlist_(2*nn);\n    ,\n      Gdata=parse(Gname);\n    );\n    Gdata=Flattenlist(Gdata);\n    if(Measuredepth(Gdata)==1,Gdata=[Gdata]);\n    forall(Gdata,Gj,\n      println(SCEOUTPUT,\"start//\");\n      Str=\"\";\n      forall(Gj,Pt,\n        if(length(Str)&gt;0,\n          Str=Str+\",\"\n        );\n        Str=Str+\"[\"+format(Pt_1,10)+\",\";\n        Str=Str+format(Pt_2,10);\n        if(length(Pt)&lt;3,\n          Str=Str+\"]\";\n        ,\n          Str=Str+\",\"+format(Pt_3,10)+\"]\";\n        );\n        if(length(Str)&gt;80,\n          println(SCEOUTPUT,\"[\"+Str+\"]//\");\n          Str=\"\";\n        );\n      );\n      if(length(Str)&gt;0,\n        println(SCEOUTPUT,\"[\"+Str+\"]//\");\n      );\n      if((nn==loopend) &amp; (Gj==Gdata_(length(Gdata))),  \n        println(SCEOUTPUT,\"end////\");\n      ,\n        println(SCEOUTPUT,\"end//\");\n      );\n    );\n  );\n  closefile(SCEOUTPUT);\n  Gstr=substring(Gstr,0,length(Gstr)-1)+\"]\";\n  if(Msg==\"Y\",\n    println(\"writeoutdata \"+filename+\":\"+Gstr);\n  );\n);\nChangestyle3d(nameL,style):=(\n  regional(nmL,name,tmp,tmp1,tmp2);\n  if(islist(nameL),nmL=nameL,nmL=[nameL]);\n  tmp1=[];\n  forall(nmL,name,\n    tmp=parse(name);\n    if(islist(tmp),\n      if(length(tmp)&gt;0, //211229\n        if(isstring(tmp_1),\n          tmp1=concat(tmp1,tmp);\n        ,\n          tmp1=append(tmp1,name);\n        );\n      );  //211229\n      tmp=apply(tmp1,replace(#,\"3d\",\"2d\"));\n        Changestyle(tmp,style);\n        tmp=apply(tmp,\"sub\"+#); // 15.05.24\n        Changestyle(tmp,style);\n    );\n  );\n);\nChangestyle3d(nameL,style,styleh):=( //211228from\n  regional(nmL,name,tmp,tmp1,tmp2,nm,nmh);\n  if(islist(nameL),nmL=nameL,nmL=[nameL]);\n  forall(nmL,nm,\n    tmp=indexof(nm,\"3d\");\n    nmh=substring(nm,0,tmp-1)+\"h\"+substring(nm,tmp-1,length(nm));\n    if(length(parse(nm))&gt;0,\n      Changestyle3d(nm,style);\n    );\n    tmp1=select(style,indexof(#,\"Color\")&gt;0);\n    tmp2=select(styleh,indexof(#,\"Color\")&gt;0);\n    tmp=styleh;\n    if(length(tmp)==0,tmp=[\"do\"]);\n    if(length(tmp2)==0,\n      tmp=concat(tmp,tmp1);\n    );\n    if(length(parse(nmh))&gt;0,\n      Changestyle3d(nmh,tmp);\n    );\n  );\n); //211228to\nChangestyle(nameL,styleorg):=( //210422pt\n  regional(nmL,name,style,Ltype,Noflg,color,color4,opcindy,\n      dtlist,tmp,tmp1,tmp2,tmp3);\n  style=styleorg; //191203from\n  tmp=Divoptions(style);\n  Ltype=tmp_1;\n  Noflg=tmp_2;\n  color=tmp_(length(tmp)-2);color4=Colorrgb2cmyk(color); //200626\n  opcindy=tmp_(length(tmp));\n  if(length(color)==4,\n    color=Colorcmyk2rgb(color);\n  );\n  if(islist(nameL),nmL=nameL,nmL=[nameL]);\n  forall(nmL,name,\n    if(substring(name,0,2)==\"pt\",  //210422from\n      tmp1=select(PointDataList,name==#_1);\n      tmp1=tmp1_1;\n      PointDataList=remove(PointDataList,[tmp1]);\n      GCLIST=remove(GCLIST,tmp1_3);      \n      COM2ndlist=remove(COM2ndlist,tmp1_5);\n      tmp=replace(name,\"pt\",\"\");\n      Pointdata(tmp,tmp1_2,style); //210422to\n    ,\n      tmp=parse(name);\n      if(islist(tmp),\n        while(Measuredepth(tmp)&gt;1,\n          tmp=tmp_1;\n        );\n        if(length(tmp)==1,pttype=\"Y\",pttype=\"N\");\n        tmp=select(GCLIST,indexof(#_1,name)&gt;0);\n        GCLIST=remove(GCLIST,tmp);\n      );\n      if(Noflg&lt;3,\n        if(pttype==\"Y\",\n          tmp=select(PTSHADElist,indexof(#_1,name)&gt;0);\n          PTSHADElist=remove(PTSHADElist,tmp); \n          tmp1=apply(parse(name),#_1);\n          tmp=[\"Color=\"+text(color),\"Size=\"+ptsize,\"Inside=\"+inside];\n          Pointdata(\"-\"+name,tmp1,tmp);\n        ,\n          tmp=select(1..(length(GCLIST)),GCLIST_#_1!=parse(name));//220315from\n          GCLIST=GCLIST_(tmp);\n          if(Noflg==2,tmp1=[name,[-1,0]]);\n          if(Noflg==1,tmp1=[name,[0,1]])); //220315to\n          if(Noflg==0,\n            Ltype=Getlinestyle(text(Noflg)+Ltype,name); //200514[2Lines]\n            tmp1=[name,Ltype]; //220315\n            if(color4!=KCOLOR, //180904 \n              Texcom(\"}\");//180722\n            );\n          );\n          if(Noflg&lt;=3, //220315from\n            tmp=select(GCLIST,[#_1,#_2]==tmp1);\n            if(length(tmp)==0,\n              GCLIST=append(GCLIST,append(tmp1,opcindy));\n           ); //220315to\n        );\n      );\n    );\n  );  \n);\nWindispg():=(\n  if(ADDAXES==\"1\", //181215from\n    Drwxy();\n    ADDAXES=\"0\";\n  ); //181215to\n  Windispg(GCLIST); //190125\n);\nWindispg(gcLorg):=( //190125\n  regional(gcL,Nj,Nk,Dt,Vj,tmp,tmp1,tmp2,tmp3,tmp4,typeL,opcindy,flg);\n  gcL=gcLorg; //190125from\n  if(length(gcL)&gt;0,\n    if(!islist(gcL_1),gcL=[gcL]);\n  ); //190125to\n  gcL=select(gcL,#_2_1&gt;=0); //190818\n  gsave();\n  layer(KETPIClAYER); // 210602[spell]\n  forall(gcL,Nj,\n    flg=0;\n    if(isstring(Nj_1),\n      if(Nj_2_1&gt;4, //200716from\n        parse(Nj_1);\n        flg=1; \n      ,\n        Dt=parse(Nj_1);\n      );  //200716to\n    ,\n      Dt=Nj_1\n    );  // 11.17\n    if((flg==0)&amp;(islist(Dt))&amp;(length(Dt)&gt;0),  // 12.19,12.22,200716\n      tmp=Measuredepth(Dt);\n      if(tmp==1,Dt=[Dt]);\n      opcindy=Nj_3;\n      typeL=Nj_2; //200620from\n      if(isstring(typeL_2),tmp=tokenize(typeL_2,\",\"),tmp=[typeL_2]); //200623\n      typeL=prepend(typeL_1,tmp); //200620from\n      if(typeL_1&lt;0,typeL_1=0);\n      tmp1=typeL_1;\n      if(tmp1&lt;10,\n        forall(Dt,Nk,\n          if(length(Nk)&gt;1,\n            tmp3=\"\";\n            if(indexof(opcindy,\"color\")==0, //190122from\n              tmp=Colorcmyk2rgb(KCOLOR); //200513[2lines]\n              tmp3=tmp3+\",linecolor-&gt;\"+text(tmp);\n            );\n            tmp3=tmp3+opcindy;\n            if(tmp1==0,  //190126from\n              if(indexof(opcindy,\"size\")==0, \n                tmp3=tmp3+\",size-&gt;\"+text(typeL_2);\n              ); //190124to\n              tmp=\"connect(\"+Textformat(Nk,10)+tmp3+\");\";//190125\n              parse(tmp);\n            );\n            if((tmp1==1)%(tmp1==2),\n              if(length(typeL)&lt;4,typeL=append(typeL,1)); //\n              if(typeL_(-1)!=1,\n                tmp=\"linesize(\"+text(typeL_4)+\")\";\n                parse(tmp);\n              );\n              tmp3=\",dashtype-&gt;1\"+tmp3;\n              forall(1..(length(Nk)-1),\n                tmp=\"draw(\"+Textformat([Nk_#,Nk_(#+1)],10)+tmp3+\");\";\n                parse(tmp);\n              );\n              if(typeL_(-1)!=1,\n                tmp=\"linesize(1)\";\n                parse(tmp);\n              );  //\n            );\n            if(tmp1==3,\n              if(typeL_3!=1,\n                tmp=\"linesize(\"+text(typeL_3)+\")\";\n                parse(tmp);\n              );\n              tmp3=\",dashtype-&gt;3\"+tmp3;\n              forall(1..(length(Nk)-1),\n                tmp=\"draw(\"+Textformat([Nk_#,Nk_(#+1)],10)+tmp3+\");\";\n                parse(tmp);\n              );\n              if(typeL_3!=1,\n                tmp=\"linesize(1)\";\n                parse(tmp);\n              );\n            );\n          ,\n            if(indexof(opcindy,\"size\")==0,  //190425from\n              opcindy=opcindy+\",size-&gt;\"+text(TenSize/TenSizeInit);\n            ); //190425to\n            tmp=\"draw(\"+text(Nk_1)+opcindy+\");\"; \n            parse(tmp);\n           ); //190126to\n        );\n      );\n    );\n  );\n  forall(PTSHADElist, //200519from\n    parse(#_2);\n  ); //200519to\n\n  grestore(); \n  layer(0);\n);\nDrwxy():=(\n  regional(org,tmp,tmp1,tmp2);\n  org=GENTEN; \n  Listplot(\"-axx\",[[XMIN,org_2],[XMAX,org_2]],AXSTYLE_2);\n  Listplot(\"-axy\",[[org_1,YMIN],[org_1,YMAX]],AXSTYLE_2);\n  tmp=AXSTYLE_1;\n  if(tmp_1==\"a\",\n    Arrowhead([XMAX,org_2],[1,0],AXSTYLE_2);\n    Arrowhead([org_1,YMAX],[0,1],AXSTYLE_2);\n  );\n  Expr([XMAX,org_2],tmp_3,tmp_2,AXSTYLE_3); \n  Expr([org_1,YMAX],tmp_5,tmp_4,AXSTYLE_3); \n  Letter(org,tmp_7,tmp_6,AXSTYLE_3);\n);\nKetcindyjsfigure=0;\nKetcindyjsscale=1;\n\nKetinit();\nKetinit3d();\n\n\n;\n\n);\ncsdraw() := (\nStart3d();\nSetketcindyJS([\"Label=[]\"]);\n\nPointdata3d(\"O\",[0,0,0],[\"notex\"]);\nXyzax3data(\"\",\"x=[-5,5]\",\"y=[-5,5]\",\"z=[-5,5]\");\n\nPointdata3d(\"A\",[2,1,3],[\"Size=2\"]);\nPointdata3d(\"B\",[-1,2,1],[\"Size=2\"]);\n\nArrowdata(\"1\",[O2d_1,A2d_1]);\nArrowdata(\"2\",[O2d_1,B2d_1]);\n\nprintln(A2d);\n\nif(!Isangle(),\n gdt=[\"ax3d\",\"sl3d1\"];\n Skeletonparadata(\"1\",gdt,gdt,[1.5]);\n);\n\nWindispg();\nHelp(\"Arrowdata\");\n\n;\n\n);\n";
Palette_Cindy.cinderella_obj[3].evokeCS(Palette_Cindy.cinderella_init[3]);</textarea>
</div>

</div>

<script id="csdraw" type="text/x-cindyscript">
csdraw();
</script>

<script id="csmove" type="text/x-cindyscript">
csmove();
</script>

<script id="csinit" type="text/x-cindyscript">
csdraw() := ();
csmove() := ();

Tocindyform(str):=(
  regional(plv,funL,repL,out,sub,head,flg,rep,fun,pre,post,ctr,clv,nn,
      sharpL,tmp,tmp1,tmp2,tmp3,tmp4);
  repL=[ //190515from
    ["fr(",["","(xx)/(yy)"]],
    ["log(",["{log}(xx)","{log}(yy)/{log}(xx)"]], //220520
    ["sq(",["{sqrt}(xx)","(yy)^(1/(xx))"]], //190522
    ["po(",["","(xx)^(yy)"]],
    ["sin(",["{sin}(xx)","{sin}(yy)^(xx)"]], //190522from
    ["cos(",["{cos}(xx)","{cos}(yy)^(xx)"]],
    ["tan(",["{tan}(xx)","{tan}(yy)^(xx)"]],
    ["pi(",["{pi}()"]] //190522to
  ];
  out=replace(str,"(!","("); //210816,211118
  out=replace(out,"pi","pi()"); //210805
  out=replace(out,"tfr(","fr("); //220523
  out=replace(out," ",""); //220617
  out=replace(out,"(cross)","*"); //220615
  tmp1=""; //210817from
  flg=0;
  forall(1..(length(out)),
    tmp=out_#;
    if(contains(["[","]"],tmp),
      if(tmp=="[",flg=1);
      if(tmp=="]",flg=0);
    ,
      if(flg==0,tmp1=tmp1+tmp);
    );
  );
  out=tmp1; //210817to
  out=Removespace(out);
  head="";
  flg=0;
  plv=Bracket(out,"()");
  if(length(plv)>0,
    if(plv_1_2==0,
      head=substring(out,0,plv_1_1);
      out=substring(out,plv_1_1,length(out));
      if(substring(out,0,1)=="*",out=substring(out,1,length(out)));
      plv=Bracket(out,"()");
    );
    tmp=plv_(-1);
    if(tmp_2!=-1,
      out=str;
      flg=1;
    );
  );
  sharpL=[];
  ctr=1;
  if(flg==0,
    forall(repL,rep,
      fun=rep_1;
      tmp=indexof(out,fun);
      while((tmp>0)&(ctr<100),
        pre=substring(out,0,tmp-1);
        out=substring(out,tmp-1,length(out));
        plv=Bracket(out,"()");
        tmp=select(plv,#_2==-1);
        tmp=tmp_1;
        post=substring(out,tmp_1,length(out));
        out=substring(out,0,tmp_1);
        clv=Getlevel(out);
        clv=select(clv,#_2==1);
        nn=length(clv)+1;
        if(nn==1,
          tmp1=substring(out,plv_1_1,length(out)-1);
          out=replace(rep_2_1,"xx",tmp1);
        );
        if(nn==2,
          tmp1=substring(out,plv_1_1,clv_1_1-1);
          tmp2=substring(out,clv_1_1,length(out)-1);
          tmp=replace(rep_2_2,"xx",tmp1);
          out=replace(tmp,"yy",tmp2);
        );
        out=pre+out+post;        
        tmp1=indexof(out,"{"); //220520from
        tmp2=indexof(out,"}");
        sub=substring(out,tmp1,tmp2-1);
        tmp="#"+text(ctr)+"#";
        out=replace(out,"{"+sub+"}",tmp); //220520to
        sharpL=append(sharpL,[tmp,sub]);
        tmp=indexof(out,fun); //220513
        ctr=ctr+1;
      );
    );
  );
  out=Addasterisk(out);
  out=replace(out,"()","");
  forall(reverse(sharpL),
    out=replace(out,#_1,#_2);
  );
  out=head+out;
  out=replace(out,"e^","(exp(1))^"); //220610
  out;
);
Addasterisk(strorg):=(
  regional(str,out,sgnL,numL,alphaL,numalpha,ctr,
      pre,now,tmp,tmp1,tmp2);
  str=Removespace(strorg);
  str=replace(str,"  ","*");
  sgnL=["+","-","*","/","^"];
  numL=append(apply(0..9,text(#)),"."); //210226
  tmp1=32..126;
  tmp=(65..90)++(97..122);
  tmp1=remove(tmp1,tmp);
  alphaL=apply(tmp,unicode(text(#),base->10));
  numalpha=numL++alphaL;
  out=""; pre="@";
  while(length(str)>0,
    now=str_1;
    str=substring(str,1,length(str));
    if(now=="#",
      if(contains(numalpha++[")"],pre),out=out+"*");
      tmp=indexof(str,"#");
      out=out+"#"+substring(str,0,tmp-1);
      str=substring(str,tmp,length(str));
    );    
    if(contains(numL,now),
      if(contains(alphaL++[")"],pre),out=out+"*");
    );
    if(contains(alphaL++["("],now),
      if(contains(numalpha++[")"],pre),out=out+"*");
    );
    out=out+now;
    pre=now;
  );
  out;
);
Removespace(str):=(
  regional(tmp,flg,out);
  tmp=length(str)+1;
  flg=0;
  forall(1..(length(str)),
    if(flg==0,
      if((str_#)!=" ",
        tmp=#;
        flg=1;
      );
    );
  );
  out=substring(str,tmp-1,length(str));
  flg=0;
  tmp=0;
  forall(reverse(1..(length(out))),
    if(flg==0,
      if((out_#)!=" ",
        tmp=#;
        flg=1;
      );
    );
  );
  out=substring(out,0,tmp);
);
Bracket(str):=Bracket(str,"()");
Bracket(str,br):=(
  regional(ph,pt,out,noL,ncL,nall,level,tmp);
  ph=substring(br,0,1);
  pt=substring(br,1,2);
  noL=Indexall(str,ph);
  ncL=Indexall(str,pt); // 16.05.22until
  nall=sort(concat(noL,ncL));
  level=0;
  out=[];
  forall(nall,
    if(contains(noL,#),
      level=level+1;
      tmp=[#,level];
    ,
      tmp=[#,-level];
      level=level-1;
    );
    out=append(out,tmp);
  );
  out;
);
Indexall(str,key):=(
  regional(rest,out,flg,tmp,tmp1,);
  out=[];
  rest=str;
  flg=0;
  forall(1..(length(str)),
    if(flg==0,
      tmp=indexof(rest,key);
      if(tmp>0,
        tmp1=tmp+length(str)-length(rest);
        out=append(out,tmp1);
        rest=substring(rest,tmp,length(rest));
      ,
        flg=1;
      );
    );
  );
  out;
);

</script>

<!--
<script id="csinit" type="text/x-cindyscript">
csdraw() := (
  plot(x*x-3*x);
);
</script>
-->


<script>

function set_cood(selector,x,y) {

  console.log("set_cood: selector="+selector+", x="+x+", y="+y);

  $(selector).css("left",String(x)+"px");
  $(selector).css("top",String(y)+"px");
  
}

function submit_data(ansdata,logname,fname,funame) {

/*
  let con = confirm("問題の解答とキー入力のログをサーバーに送り、課題を終了しますが、それで良いですか？");
  if (!(con)) {
    return(0);
  }
*/

/*
  document.getElementById('test_iframe').contentWindow.cdy.evokeCS('rec=rechead+Getcurtime()+";;"; ansL_nqu=Textedit(ch,"",""); str=""; forall(1..(length(ansL)),n,str=str+ansL_n+";;";); rec=rec+substring(str,0,length(str)-2); Subsedit(9,rec); StrL_4=rec;');
  document.getElementById('test_iframe').contentWindow.cdy.evokeCS('jsrec = replace(rec,"\'","[[dash]]")');
  let ansdata = document.getElementById('test_iframe').contentWindow.cdy.evalcs('jsrec').value.replaceAll("[[dash]]","'") + "\n";
  let logname = document.querySelector("#logname_data_1").value;
  let fname = "ketlms/"+ logname + ".log";
*/
  let url = "https://ktky.sakura.ne.jp/file/recieve_data6.php";
  let com = {};
  com["data"] = ansdata;
  com["filename"] = fname;
  console.log("url"+url);
  console.log("com="+com);
  Palette.exec_url(url,com);
  com = {};
/*
  let uname = ansdata.split(";;")[0];
  fname = "ketlms/" + logname + "_" + uname + ".klog";
*/
  let logdata = document.querySelector("#log").value;
  com["data"] = logdata;
  com["filename"] = funame;
  Palette.exec_url(url,com);

}

function file_check(fname) {

  let url = "https://ktky.sakura.ne.jp/file/file_check.php";
  let com = {};
  com["filename"] = fname;
  let ans = Palette.exec_url(url,com);
  let mans = ans.match(/<body>\r?\n([\s\S]*?)\r?\n<\/body>/);
  return mans[1];
  
}

function check_submit_data() {

  let con = confirm("問題の解答とキー入力のログをサーバーに送り、課題を終了しますが、それで良いですか？");
  if (!(con)) {
    return(0);
  }
  document.getElementById('test_iframe').contentWindow.cdy.evokeCS('rec=rechead+Getcurtime()+";;"; ansL_nqu=Textedit(ch,"",""); str=""; forall(1..(length(ansL)),n,str=str+ansL_n+";;";); rec=rec+substring(str,0,length(str)-2); Subsedit(9,rec); StrL_4=rec;');
  document.getElementById('test_iframe').contentWindow.cdy.evokeCS('jsrec = replace(rec,"\'","[[dash]]")');
  let ansdata = document.getElementById('test_iframe').contentWindow.cdy.evalcs('jsrec').value.replaceAll("[[dash]]","'") + "\n";
  let logname = document.querySelector("#logname_data_1").value;
  let fname = "ketlms/"+ logname + ".log";
  let uname = ansdata.split(";;")[0];
  let funame = "ketlms/" + logname + "_" + uname + ".klog";
  console.log("check_submit_data fname="+fname);
  let ans = file_check(funame);
  if (ans == "TRUE") {
    alert("課題は既に提出されています");
  } else {
    submit_data(ansdata,logname,fname,funame);
  }
  

}

function copy_data() {

  document.getElementById('test_iframe').contentWindow.cdy.evokeCS('rec=rechead+Getcurtime()+";;"; ansL_nqu=Textedit(ch,"",""); str=""; forall(1..(length(ansL)),n,str=str+ansL_n+";;";); rec=rec+substring(str,0,length(str)-2); Subsedit(9,rec); StrL_4=rec;');
  document.getElementById('test_iframe').contentWindow.cdy.evokeCS('jsrec = replace(rec,"\'","[[dash]]")');
  let ansdata = document.getElementById('test_iframe').contentWindow.cdy.evalcs('jsrec').value.replaceAll("[[dash]]","'") + "\n";
  alert("ansdata="+ansdata);
  navigator.clipboard.writeText(ansdata);
  alert("解答の文字列がバッファへコピーされました");

}

// let epagew = Number(document.querySelector('.paint_url + div[name="url1"]').querySelector('.paint_url_width').value);
// let epagew = Number(document.querySelector('div[name="url1"]').querySelector('.paint_url_width').value);
let epagew = Number(document.querySelector('div[name="url1"] > .paint_url_width').value);
console.log("epagew = "+epagew);

function HtmlString_To_Document(text){
  try{
    var dom_parser = new DOMParser();
    var document_obj = dom_parser.parseFromString(text , "text/html");
    if(document_obj.getElementsByTagName("parsererror").length == 0){
      return document_obj;
    }
  }catch(e){
  }

  try{
    var document_obj = document.implementation.createHTMLDocument("");
    document_obj.body.innerHTML = text;
    return document_obj;
  }catch(e){
  }

  return null;
}

function set_scale(selector,scale) {
  
 $(selector).css({ 'transform-origin' : '0 0','transform' : 'scale('+scale+')'});

}

/*
function getViewportSize() {
  const w1 = document.documentElement.clientWidth,
  w2 =  window.innerWidth,
  h1 = document.documentElement.clientHeight,
  h2 = window.innerHeight;
        
  alert("w1="+w1+", w2="+w2+", h1="+h1+",h2="+h2);
  
}
*/

// getViewportSize();

set_scale("#scale_div",(document.documentElement.clientWidth)/epagew);
// set_scale("#scale_div",1);
function set_mode_scale() {

  if (Palette.mode == "user") {
  
    set_scale("#scale_div",(document.documentElement.clientWidth)/epagew);
    
  } else {
  
    set_scale("#scale_div",1);
  }
}

// set_mode_scale();

let timecount = 0;
let timeout = 100;
var mode = "flick";

// alert($("#show_hide_data_1").val());

var show_hide = JSON.parse($("#show_hide_data_1").val());
// console.log("show_hide="+show_hide["#c1"]);


function takelog() {

  console.log("mode="+mode);
  let d3 = document.getElementById('test_iframe').contentWindow.cdy.evalcs("nqu").value.real;

  if (mode=="flick") {
  
    let d1 = document.getElementById('test_iframe').contentWindow.cdy.evalcs("startposf").value.real;
    if (d1 != 0) {
      let d2 = $("#log").val();
      let d4 = document.getElementById('test_iframe').contentWindow.cdy.evalcs("hyoujif").value.real;
//      let d4 = document.getElementById('test_iframe').contentWindow.cdy.evalcs("hyoujifa").value.real;
      $("#log").val(d2+"\n"+d3+","+d4);
      timecount = timecount+1;
    }
    
  } else {
  
    let d2 = $("#log").val();
    let d4 = -1;
    $("#log").val(d2+"\n"+d3+","+d4);
    timecount = timecount+1;
    
  }
  
  for (let key in show_hide) {
    if (show_hide[key].indexOf(d3) >= 0) {
       $(key).show();
    } else {
       $(key).hide();
    }
  }

}

const intervalId = setInterval(() =>{
    takelog();
    if(timecount > timeout){
      clearInterval(intervalId);
    }}, 
1000);

/*
eval(getatr("onoff","tmp"));
if (tmp=="on") {
  eval(bgcolor(44,125,212,0.3));
  eval(setatr("onoff","off"));
} else {
  eval(bgcolor(44,125,212,1));
  eval(setatr("onoff","on"));
}



url = this.parentNode.querySelector('.palette_button_text_text').value;
window.open(url,"_blank");


});
*/

function bgcolor(r,g,b,a) {

/*
  let com = "this.parentNode.querySelector('.palette_button_body').style.background = 'rgba("+r+","+g+","+b+","+a+")';";
  eval(com);
*/
//  return("this.parentNode.querySelector('.palette_button_body').style.background = 'rgba("+r+","+g+","+b+","+a+")';");

//  eval("this.parentNode.querySelector('.palette_button_body').style.background = 'rgba("+r+","+g+","+b+","+a+")';");

  Palette_Body.target.style.background = "rgba("+r+","+g+","+b+","+a+")";

}

function setstring(str) {

//  return("this.parentNode.querySelector('.palette_button_body').value='"+str+"';");

  Palette_Body.target.value = str;
}

function setatr(atr,val) {

//  return("this.parentNode.querySelector('.palette_button_body').setAttribute('"+atr+"','"+val+"');");
  Palette_Body.target.setAttribute(atr,val);
  
}

function getatr(atr) {

//  return(varname+"=this.parentNode.querySelector('.palette_button_body').getAttribute('"+atr+"');");
  return(Palette_Body.target.getAttribute(atr));
}

function setstyle(prop,val) {

  $(Palette_Body.target).css(prop,val);
//  eval('Palette_Body.target.style.'+prop+' = "'+val+'"');
  
}

function getstyle(prop) {

//  let getStyle = getComputedStyle(Palette_Body.target);
//  return(eval('getStyle.'+prop));
  return($(Palette_Body.target).css(prop));
  
}

function getparentstyle() {

  return(this.parentNode.getAttribute("style"));
  
}

/*

link(gettext());

*/

function gettext() {

  return(Palette_Body.target.value);

}

function link(url) {

  window.open(url,'_blank');
  
}

window.onload = function() {

//  startcindy();
  Palette.mode_set("user");

}

function get_ketmath_input_raw() {

  return(document.getElementById('test_iframe').contentWindow.cdy.evalcs('Text2').value.text);

}

function get_ketmath_input() {

  return(get_ketmath_input_raw().split("=")[1]);

}

function cseval(cindyname,com) {

  let idx = Number($("#"+cindyname).attr("index"));
  return(Palette_Cindy.cinderella_obj[idx].evalcs(com).value);

}

function csdraw(cindyname,com) {

  let idx = Number($("#"+cindyname).attr("index"));
  Palette_Cindy.cinderella_obj[idx].evokeCS("csdraw():=("+com+")");

}

</script>

</div>

</body></html>